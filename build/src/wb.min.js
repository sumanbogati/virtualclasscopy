/*
  2014 Suman Bogati, Pinky Sharma and Jai Gupta  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,b,a){d!=Array.prototype&&d!=Object.prototype&&(d[b]=a.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var b=0;return $jscomp.iteratorPrototype(function(){return b<d.length?{done:!1,value:d[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=d[Symbol.iterator];return b?b.call(d):$jscomp.arrayIterator(d)};
$jscomp.polyfill=function(d,b,a,c){if(b){a=$jscomp.global;d=d.split(".");for(c=0;c<d.length-1;c++){var f=d[c];f in a||(a[f]={});a=a[f]}d=d[d.length-1];c=a[d];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function b(){this.batch_=null}function a(a){return a instanceof f?a:new f(function(c,b){c(a)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var c=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){c(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var b=a[c];delete a[c];try{b()}catch(p){this.asyncThrow_(p)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(n){c.reject(n)}};f.prototype.createResolveAndReject_=
function(){function a(a){return function(f){b||(b=!0,a.call(c,f))}}var c=this,b=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var c=
void 0;try{c=a.then}catch(n){this.reject_(n);return}"function"==typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,c=0;c<a.length;++c)a[c].call(),a[c]=null;this.onSettledCallbacks_=null}};var g=new b;f.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};f.prototype.settleSameAsThenable_=function(a,c){var b=this.createResolveAndReject_();try{a.call(c,b.resolve,b.reject)}catch(p){b.reject(p)}};f.prototype.then=function(a,c){function b(a,c){return"function"==typeof a?function(c){try{g(a(c))}catch(B){k(B)}}:c}var g,k,d=new f(function(a,
c){g=a;k=c});this.callWhenSettled_(b(a,g),b(c,k));return d};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,c){function b(){switch(f.state_){case 1:a(f.result_);break;case 2:c(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?g.asyncExecute(b):this.onSettledCallbacks_.push(function(){g.asyncExecute(b)})};f.resolve=a;f.reject=function(a){return new f(function(c,b){b(a)})};f.race=function(c){return new f(function(b,
f){for(var g=$jscomp.makeIterator(c),k=g.next();!k.done;k=g.next())a(k.value).callWhenSettled_(b,f)})};f.all=function(c){var b=$jscomp.makeIterator(c),g=b.next();return g.done?a([]):new f(function(c,f){function k(a){return function(b){d[a]=b;m--;0==m&&c(d)}}var d=[],m=0;do d.push(void 0),m++,a(g.value).callWhenSettled_(k(d.length-1),f),g=b.next();while(!g.done)})};return f},"es6","es3");
$jscomp.executeAsyncGenerator=function(d){function b(a){return d.next(a)}function a(a){return d.throw(a)}return new Promise(function(c,f){function g(k){k.done?c(k.value):Promise.resolve(k.value).then(b,a).then(g,f)}g(d.next())})};
$jscomp.inherits=function(d,b){function a(){}a.prototype=b.prototype;d.superClass_=b.prototype;d.prototype=new a;d.prototype.constructor=d;for(var c in b)if("prototype"!=c)if(Object.defineProperties){var f=Object.getOwnPropertyDescriptor(b,c);f&&Object.defineProperty(d,c,f)}else d[c]=b[c]};$jscomp.arrayFromIterator=function(d){for(var b,a=[];!(b=d.next()).done;)a.push(b.value);return a};$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};
$jscomp.checkStringArgs=function(d,b,a){if(null==d)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return d+""};
$jscomp.polyfill("String.prototype.startsWith",function(d){return d?d:function(b,a){var c=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var f=c.length,g=b.length;a=Math.max(0,Math.min(a|0,c.length));for(var k=0;k<g&&a<f;)if(c[a++]!=b[k++])return!1;return k>=g}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(d){return d?d:function(b,a,c){var f=this.length||0;0>a&&(a=Math.max(0,f+a));if(null==c||c>f)c=f;c=Number(c);0>c&&(c=Math.max(0,f+c));for(a=Number(a||0);a<c;a++)this[a]=b;return this}},"es6","es3");$jscomp.findInternal=function(d,b,a){d instanceof String&&(d=String(d));for(var c=d.length,f=0;f<c;f++){var g=d[f];if(b.call(a,g,f,d))return{i:f,v:g}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");$jscomp.iteratorFromArray=function(d,b){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var a=0,c={next:function(){if(a<d.length){var f=a++;return{value:b(f,d[f]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
$jscomp.polyfill("Array.prototype.keys",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.owns=function(d,b){return Object.prototype.hasOwnProperty.call(d,b)};
$jscomp.polyfill("WeakMap",function(d){function b(a){$jscomp.owns(a,c)||$jscomp.defineProperty(a,c,{value:{}})}function a(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if(function(){if(!d||!Object.seal)return!1;try{var a=Object.seal({}),c=Object.seal({}),b=new d([[a,2],[c,3]]);if(2!=b.get(a)||3!=b.get(c))return!1;b.delete(a);b.set(c,4);return!b.has(a)&&4==b.get(c)}catch(p){return!1}}())return d;var c="$jscomp_hidden_"+Math.random().toString().substring(2);a("freeze");a("preventExtensions");
a("seal");var f=0,g=function(a){this.id_=(f+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};g.prototype.set=function(a,f){b(a);if(!$jscomp.owns(a,c))throw Error("WeakMap key fail: "+a);a[c][this.id_]=f;return this};g.prototype.get=function(a){return $jscomp.owns(a,c)?a[c][this.id_]:void 0};g.prototype.has=function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)};g.prototype.delete=
function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)?delete a[c][this.id_]:!1};return g},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(d){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),c=new d($jscomp.makeIterator([[a,"s"]]));if("s"!=c.get(a)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var b=c.entries(),f=b.next();if(f.done||f.value[0]!=a||"s"!=f.value[1])return!1;f=b.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!b.next().done?!1:!0}catch(u){return!1}}())return d;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,a=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};a.prototype.set=function(a,b){var f=c(this,a);f.list||(f.list=this.data_[f.id]=[]);f.entry?f.entry.value=b:(f.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},f.list.push(f.entry),this.head_.previous.next=f.entry,this.head_.previous=f.entry,this.size++);return this};a.prototype.delete=
function(a){a=c(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};a.prototype.has=function(a){return!!c(this,a).entry};a.prototype.get=function(a){return(a=c(this,a).entry)&&a.value};a.prototype.entries=function(){return f(this,function(a){return[a.key,
a.value]})};a.prototype.keys=function(){return f(this,function(a){return a.key})};a.prototype.values=function(){return f(this,function(a){return a.value})};a.prototype.forEach=function(a,c){for(var b=this.entries(),f;!(f=b.next()).done;)f=f.value,a.call(c,f[1],f[0],this)};a.prototype[Symbol.iterator]=a.prototype.entries;var c=function(a,c){var f=c&&typeof c;"object"==f||"function"==f?b.has(c)?f=b.get(c):(f=""+ ++k,b.set(c,f)):f="p_"+c;var g=a.data_[f];if(g&&$jscomp.owns(a.data_,f))for(a=0;a<g.length;a++){var d=
g[a];if(c!==c&&d.key!==d.key||c===d.key)return{id:f,list:g,index:a,entry:d}}return{id:f,list:g,index:-1,entry:void 0}},f=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=a.next=a.head=a},k=0;return a},"es6","es3");
$jscomp.polyfill("Object.assign",function(d){return d?d:function(b,a){for(var c=1;c<arguments.length;c++){var f=arguments[c];if(f)for(var g in f)$jscomp.owns(f,g)&&(b[g]=f[g])}return b}},"es6","es3");$jscomp.polyfill("Math.trunc",function(d){return d?d:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var a=Math.floor(Math.abs(b));return 0>b?-a:a}},"es6","es3");
$jscomp.polyfill("Set",function(d){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),c=new d($jscomp.makeIterator([a]));if(!c.has(a)||1!=c.size||c.add(a)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var b=c.entries(),g=b.next();if(g.done||g.value[0]!=a||g.value[1]!=a)return!1;g=b.next();return g.done||g.value[0]==a||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:b.next().done}catch(k){return!1}}())return d;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)this.add(c.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=function(){return this.map_.entries()};
b.prototype.values=function(){return this.map_.values()};b.prototype.keys=b.prototype.values;b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,c){var b=this;this.map_.forEach(function(f){return a.call(c,f,f,b)})};return b},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})}},"es6","es3");
$jscomp.polyfill("Object.is",function(d){return d?d:function(b,a){return b===a?0!==b||1/b===1/a:b!==b&&a!==a}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(d){return d?d:function(b,a){var c=this;c instanceof String&&(c=String(c));var f=c.length;for(a=a||0;a<f;a++)if(c[a]==b||Object.is(c[a],b))return!0;return!1}},"es7","es3");
$jscomp.polyfill("String.prototype.includes",function(d){return d?d:function(b,a){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,a||0)}},"es6","es3");$jscomp.polyfill("Array.prototype.findIndex",function(d){return d?d:function(b,a){return $jscomp.findInternal(this,b,a).i}},"es6","es3");
var io={cfg:{},sock:null,wsuri:null,error:null,uniquesids:null,serial:null,globallock:!1,readyToSend:!1,globalmsgjson:[],packetQueue:[],binMsgQueue:[],jsnMsgQueue:[],recBinMsgQueue:[],recjsnMsgQueue:null,stockReadyState:!1,workerIOOnmessage:!1,sessionSet:!1,init:function(d){this.cfg=d;"use strict";console.log("==== io init ");ioInit.sendToWorker({cmd:"init",msg:d})},send:function(d,b,a){d.hasOwnProperty("m")&&"all"==d.m.user&&alert("som packet are sending");d={cfun:b,arg:{msg:d}};a&&(d.arg.touser=
a);if(this.webSocketConnected()&&io.sessionSet){if(0<io.packetQueue.length){for(a=0;a<io.packetQueue.length;a++)b=JSON.parse(io.packetQueue[a]),this.realSend(b);io.packetQueue.length=0}this.realSend(d)}else console.log("SOCKET is not ready."),a=JSON.stringify(d),io.packetQueue.push(a)},realSend:function(d){if("undefined"!=typeof d.arg.touser)if(null==io.uniquesids)console.log("uniqueid is null");else if(d.arg.touser=io.uniquesids[d.arg.touser],"undefined"==typeof d.arg.touser){console.log("User is not connected."+
d.arg.touser);return}var b={userid:wbUser.id};switch(d.cfun){case "broadcastToAll":if("undefined"==typeof d.arg.touser)b={user:b,m:d.arg.msg},d='F-BR-{"0'+JSON.stringify(b);else{b={user:b,m:d.arg.msg,userto:d.arg.touser};for(d=d.arg.touser;12>d.length;)d="0"+d;d='F-BRU-{"'+d+'{"0'+JSON.stringify(b)}break;case "ping":b={type:"PONG",m:d.arg.msg};d="F-PI-"+JSON.stringify(b);break;case "speed":d='F-SPE-{"'+d.arg.msg;break;case "session":d='F-SS-{"'+d.arg.msg;break;case "recording":d='F-SR-{"'+d.arg.msg;
break;default:d=JSON.stringify(d)}if(6E5>=d.length)workerIO.postMessage({cmd:"send",msg:d});else{if(this.jsnMsgQueue=this.chunkSubstr(d,55E4))for(d=0;d<this.jsnMsgQueue.length;d++)workerIO.postMessage({cmd:"send",msg:this.jsnMsgQueue[d]});this.jsnMsgQueue=[]}},chunkSubstr:function(d,b){if(d.startsWith('F-BR-{"0')){var a='F-BR-{"';d=d.replace('F-BR-{"0',"")}else if(d.startsWith('F-BRU-{"'))a=d.substring(0,22),d=d.substring(23,d.length);else return!1;for(var c=Math.ceil(d.length/b),f=Array(c),g=0,k=
0;g<c;++g,k+=b)f[g]=d.substr(k,b),f[g]=0==g?a+"1"+f[g]:g<c-1?a+"2"+f[g]:a+"3"+f[g];return f},cleanRecJson:function(d){if(!(d.startsWith('{"0{"')||d.startsWith('{"1{"')||d.startsWith('{"2')||d.startsWith('{"3')))return d;if(d.startsWith('{"0{"'))return d=d.replace('{"0{"','{"');if(d.startsWith('{"1{"'))this.recjsnMsgQueue=d.replace('{"1{"','{"');else if(d.startsWith('{"2'))0<this.recjsnMsgQueue.length&&(this.recjsnMsgQueue+=d.replace('{"2',""));else if(d.startsWith('{"3')){if(0<this.recjsnMsgQueue.length)return this.recjsnMsgQueue+=
d.replace('{"3',"")}else this.recjsnMsgQueue="";return!1},sendBinary:function(d){workerIO.postMessage({cmd:"sendBinary",msg:d})},onRecMessage:function(d){if(d.data instanceof ArrayBuffer)workerIO.postMessage({cmd:"onRecBinary",msg:d.data});else ioInit.onmessage({data:{cmd:"receivedJson",msg:d.data}})},webSocketConnected:function(){return 1==io.stockReadyState&&1==this.readyToSend},onRecJson:function(d){if(!1===io.globallock)if(0<io.globalmsgjson.length)for(;0<io.globalmsgjson.length&&!1===io.globallock;)d=
io.globalmsgjson.shift(),io.onRecJsonIndividual(d);else if(null!=d&&!1===io.globallock&&0==io.globalmsgjson.length)io.onRecJsonIndividual(d);else null!=d&&io.globalmsgjson.push(d);else null!=d&&io.globalmsgjson.push(d)},onRecJsonIndividual:function(d){var b="";switch(d.type){case "joinroom":d.hasOwnProperty("users")?(ioAdapter.setRecording(),roles.hasControls()||ioAdapter.makeSessionReady(),console.log("==== Member add, join room")):console.log("No users");this.readyToSend=!0;workerIO.postMessage({cmd:"readyToSend"});
b=null;if(null!=io.uniquesids)for(var a in d.clientids)void 0==io.uniquesids[a]&&(b=a);io.uniquesids=d.clientids;a={type:"member_added",newuser:b,joinUser:d.action};d.hasOwnProperty("users")?(a.message=d.users,a.users=!0):d.hasOwnProperty("user")&&(a.message=d.user,a.user=!0);(!virtualclass.vutil.isPlayMode()||d.hasOwnProperty("clientids")&&!virtualclass.hasOwnProperty("connectedUsers")||virtualclass.hasOwnProperty("connectedUsers")&&!d.hasOwnProperty("clientids"))&&virtualclass.ioEventApi.readyto_member_add(a);
break;case "broadcastToAll":case "broadcast":null!==d&&(void 0!=d.userto&&(b=d.userto),virtualclass.ioEventApi.newmessage({type:"newmessage",message:d.m,fromUser:d.user,toUser:virtualclass.vutil.getUserAllInfo(b,virtualclass.connectedUsers)}));break;case "userleft":if(null!=io.uniquesids)for(var c in d.action)console.log("===== JOIN user left call "+c),delete io.uniquesids[c];virtualclass.ioEventApi.readyto_user_logout(d);break;case "Unauthenticated":console.log("Case:- unauthenticated");virtualclass.ioEventApi.authentication_failed({type:"authentication_failed",
message:"Authentication failed"});break;case "Multiple_login":console.log("Case:- Multiple_login");virtualclass.ioEventApi.Multiple_login({type:"Multiple_login"});break;case "PONG":virtualclass.ioEventApi.PONG({type:"PONG",message:d.m});break;case "Text_Limit_Exeed":virtualclass.ioEventApi.Text_Limit_Exeed({type:"Text_Limit_Exeed"});break;case "Binary_Limit_Exeed":virtualclass.ioEventApi.Binary_Limit_Exeed({type:"Binary_Limit_Exeed"});break;case "Max_rooms":virtualclass.ioEventApi.Max_rooms({type:"Max_rooms"});
break;case "Max_users":virtualclass.ioEventApi.Max_users({type:"Max_users"});break;case "setSession":roles.hasControls()&&ioAdapter.initSetSession(d.session)}},disconnect:function(){workerIO.postMessage({cmd:"disconnect"})}};workerIO.onmessage=function(d){ioInit.onmessage(d)};
var ioInit={sendToWorker:function(d){workerIO.postMessage(d)},onmessage:function(d){var b;switch(d.data.cmd){case "connectionopen":io.stockReadyState=1;virtualclass.ioEventApi.connectionopen(d.data.msg);break;case "receivedJson":if(b=io.cleanRecJson(d.data.msg))if(d=JSON.parse(b),!d.hasOwnProperty("type")&&d.hasOwnProperty("user")&&(d.type="broadcastToAll","undefined"==typeof virtualclass.gObj.allUserObj[d.user.userid]&&(virtualclass.gObj.allUserObj[d.user.userid]={},virtualclass.gObj.allUserObj[d.user.userid].userid=
d.user.userid,virtualclass.gObj.allUserObj[d.user.userid].lname=" ",virtualclass.gObj.allUserObj[d.user.userid].name="student",virtualclass.gObj.allUserObj[d.user.userid].role="s"),virtualclass.gObj.allUserObj[d.user.userid].userid==d.user.userid&&(d.user.lname=virtualclass.gObj.allUserObj[d.user.userid].lname,d.user.name=virtualclass.gObj.allUserObj[d.user.userid].name,d.user.role=virtualclass.gObj.allUserObj[d.user.userid].role)),this.recjsnMsgQueue="",d.hasOwnProperty("m"))if(d.m.hasOwnProperty("serial"))ioMissingPackets.checkMissing(d);
else if(d.m.hasOwnProperty("reqMissPac"))virtualclass.recorder.hasOwnProperty("startUpload")||ioMissingPackets.sendMissedPackets(d);else if(d.m.hasOwnProperty("missedpackets"))console.log("Execute missed packets"),ioMissingPackets.fillExecutedStore(d);else if(d.m.hasOwnProperty("userSerial"))ioMissingPackets.userCheckMissing(d);else if(d.m.hasOwnProperty("userReqMissPac"))virtualclass.recorder.hasOwnProperty("startUpload")||ioMissingPackets.userSendMissedPackets(d);else if(d.m.hasOwnProperty("userMissedpackets"))ioMissingPackets.userFillExecutedStore(d);
else io.onRecJson(d);else io.onRecJson(d);break;case "onRecBinary":io.onRecBinary(d);break;case "iamclosing":io.stockReadyState=0;break;case "error":io.stockReadyState=0;virtualclass.ioEventApi.error({type:"error",message:d.data.msg});break;case "close":io.stockReadyState=0;virtualclass.ioEventApi.connectionclose({type:"connectionclose",message:d.data.msg});setTimeout(function(){virtualclass.gObj.hasOwnProperty("endSession")||virtualclass.gObj.hasOwnProperty("downloadProgress")||virtualclass.recorder.uploadInProcess||
virtualclass.gObj.hasOwnProperty("invalidlogin")&&virtualclass.gObj.invalidlogin||workerIO.postMessage({cmd:"wsconnect"})},5E3);break;case "initAudioWorklet":virtualclass.gObj.hasOwnProperty("isAudioContextReady")&&!virtualclass.gObj.audioRecWorkerReady&&(virtualclass.media.detectAudioWorklet()?virtualclass.media.audio.initPlay():virtualclass.media.audio.initPlayWithFallback());break;case "stBinary":d.data.hasOwnProperty("triggerBinRec")&&virtualclass.ioEventApi.binrec({type:"binrec",message:d.data.msg.buffer});
break;case "notaudio":virtualclass.ioEventApi.binrec({type:"binrec",message:d.data.msg});break;case "endBinary":d=d.data.msg;d.constructor===Int8Array?b=new Int8Array(d.length+2):d.constructor===Uint8ClampedArray&&(b=new Uint8ClampedArray(d.length+2));b[0]=d[0];b[1]=0;b.set(d,2);virtualclass.ioEventApi.binrec({type:"binrec",message:d.buffer});break;case "firstAudio":var a=virtualclass.user.control.updateUser(d.data.msg.userId,"ad",!0);virtualclass.user.control.audioSign(a,"create");break;case "audioSign":virtualclass.user.control.audioSign(a,
"create");break;default:console.log("Do nothing")}}};/*
 modernizr 3.5.0 (Custom Build) | MIT *
 https://modernizr.com/download/?-webp-setclasses !*/
!function(d,b,a){function c(a){var c=v.className,b=n._config.classPrefix||"";if(u&&(c=c.baseVal),n._config.enableJSClass)c=c.replace(new RegExp("(^|\\s)"+b+"no-js(\\s|$)"),"$1"+b+"js$2");n._config.enableClasses&&(c+=" "+b+a.join(" "+b),u?v.className.baseVal=c:v.className=c)}function f(a,b){if("object"==typeof a)for(var g in a)p(a,g)&&f(g,a[g]);else{a=a.toLowerCase();g=a.split(".");var k=n[g[0]];if(2==g.length&&(k=k[g[1]]),"undefined"!=typeof k)return n;b="function"==typeof b?b():b;1==g.length?n[g[0]]=
b:(!n[g[0]]||n[g[0]]instanceof Boolean||(n[g[0]]=new Boolean(n[g[0]])),n[g[0]][g[1]]=b);c([(b&&0!=b?"":"no-")+g.join("-")]);n._trigger(a,b)}return n}var g=[],k=[],m={_version:"3.5.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(a,c){var b=this;setTimeout(function(){c(b[a])},0)},addTest:function(a,c,b){k.push({name:a,fn:c,options:b})},addAsyncTest:function(a){k.push({name:null,fn:a})}},n=function(){};n.prototype=m;n=new n;var p,v=b.documentElement,u="svg"===
v.nodeName.toLowerCase();!function(){var a={}.hasOwnProperty;p="undefined"===typeof a||"undefined"===typeof a.call?function(a,c){return c in a&&"undefined"===typeof a.constructor.prototype[c]}:function(c,b){return a.call(c,b)}}();m._l={};m.on=function(a,c){this._l[a]||(this._l[a]=[]);this._l[a].push(c);n.hasOwnProperty(a)&&setTimeout(function(){n._trigger(a,n[a])},0)};m._trigger=function(a,c){if(this._l[a]){var b=this._l[a];setTimeout(function(){var a;for(a=0;a<b.length;a++)(0,b[a])(c)},0);delete this._l[a]}};
n._q.push(function(){m.addTest=f});n.addAsyncTest(function(){function a(a,c,b){function g(c){var g=c&&"load"===c.type?1==k.width:!1;f(a,"webp"===a&&g?new Boolean(g):g);b&&b(c)}var k=new Image;k.onerror=g;k.onload=g;k.src=c}var c=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",
name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],b=c.shift();a(b.name,b.uri,function(b){if(b&&"load"===b.type)for(b=0;b<c.length;b++)a(c[b].name,c[b].uri)})});(function(){var a,c,b,f,d;for(d in k)if(k.hasOwnProperty(d)){if(a=[],c=k[d],c.name&&(a.push(c.name.toLowerCase()),c.options&&c.options.aliases&&c.options.aliases.length))for(b=0;b<c.options.aliases.length;b++)a.push(c.options.aliases[b].toLowerCase());b="function"===
typeof c.fn?c.fn():c.fn;for(f=0;f<a.length;f++){var m=a[f];m=m.split(".");1===m.length?n[m[0]]=b:(!n[m[0]]||n[m[0]]instanceof Boolean||(n[m[0]]=new Boolean(n[m[0]])),n[m[0]][m[1]]=b);g.push((b?"":"no-")+m.join("-"))}}})();c(g);delete m.addTest;delete m.addAsyncTest;for(b=0;b<n._q.length;b++)n._q[b]();d.Modernizr=n}(window,document);var roles={isTeacher:function(){return"t"===virtualclass.gObj.uRole},isStudent:function(){return"s"===virtualclass.gObj.uRole},isPresenter:function(){return"p"===virtualclass.gObj.uRole},isEducator:function(){return"e"===virtualclass.gObj.uRole},hasControls:function(){return"t"===virtualclass.gObj.uRole||"p"===virtualclass.gObj.uRole},hasAdmin:function(){return"t"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole},hasView:function(){return"s"===virtualclass.gObj.uRole||"e"===virtualclass.gObj.uRole}};var ioStorage={dataAdapterStore:function(d,b){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataAdapterAllStore(JSON.stringify(d),b):setTimeout(function(){ioStorage.dataAdapterStore(d,b)},10)},dataUserAdapterMustData:function(d,b){"object"==typeof virtualclass.storage&&"object"==typeof virtualclass.storage.db?virtualclass.storage.dataUserAdapterAllStore(JSON.stringify(d),b):setTimeout(function(){ioStorage.dataUserAdapterMustData(d,b)},10)},dataExecutedStoreAll:function(d,
b){virtualclass.storage.dataExecutedStoreAll(JSON.stringify(d),b)},dataExecutedUserStoreAll:function(d,b){virtualclass.storage.dataExecutedUserStoreAll(JSON.stringify(d),b)}};var ioMissingPackets={executedStore:[],executedSerial:null!=localStorage.getItem("executedSerial")?JSON.parse(localStorage.getItem("executedSerial")):{},missRequest:[],aheadPackets:[],missRequestFlag:0,executedUserStore:[],executedUserSerial:null!=localStorage.getItem("executedUserSerial")?JSON.parse(localStorage.getItem("executedUserSerial")):{},missUserRequest:[],aheadUserPackets:[],missUserRequestFlag:0,validateAllVariables:function(d){if("undefined"==typeof this.executedSerial||null==this.executedSerial)this.executedSerial=
{};"undefined"==typeof this.executedSerial[d]&&(this.executedSerial[d]=-1);"undefined"==typeof this.missRequest[d]&&(this.missRequest[d]=0);"undefined"==typeof this.executedStore[d]&&(this.executedStore[d]=[]);"undefined"==typeof this.aheadPackets[d]&&(this.aheadPackets[d]=[])},validateAllUserVariables:function(d){if("undefined"==typeof this.executedUserSerial||null==this.executedUserSerial)this.executedUserSerial={};"undefined"==typeof this.executedUserSerial[d]&&(this.executedUserSerial[d]=-1);
"undefined"==typeof this.missUserRequest[d]&&(this.missUserRequest[d]=0);"undefined"==typeof this.executedUserStore[d]&&(this.executedUserStore[d]=[]);"undefined"==typeof this.aheadUserPackets[d]&&(this.aheadUserPackets[d]=[])},checkMissing:function(d){if(virtualclass.isPlayMode)io.onRecJson(d);else{var b=d.user.userid;this.validateAllVariables(b);if("t"==d.user.role&&d.m.hasOwnProperty("ping")&&d.m.hasOwnProperty("session")){var a=localStorage.getItem("mySession");if(null!=a&&d.m.session!=a){virtualclass.isPlayMode?
localStorage.setItem("mySession","thisismyplaymode"):(localStorage.removeItem("mySession"),virtualclass.storage.config.endSession(),localStorage.setItem("mySession",d.m.session),console.log("REFRESH SESSION"));console.log("Start session gracefully");return}}1==d.m.missedpackets?this.fillExecutedStore(d):"undefined"!=typeof d.m.serial&&null!=d.m.serial?d.m.serial==this.executedSerial[b]+1?(console.log("UID "+b+" Object with Serial "+d.m.serial),this.executedSerial[b]=d.m.serial,this.executedStore[b][d.m.serial]=
d,ioStorage.dataExecutedStoreAll(d,b+"_"+d.m.serial),io.onRecJson(d)):d.m.serial>this.executedSerial[b]+1?(console.log("UID "+b+" requst miss packet"),this.requestMissedPackets(this.executedSerial[b]+1,d.m.serial,d,b)):(console.log("UID "+b+" no action current packet "+this.executedSerial[b]+" coming at "+d.m.serial),this.executedStore[b][d.m.serial]=d):console.log("UID "+b+" checkMissing should not be called without serial")}},userCheckMissing:function(d){var b=d.user.userid;this.validateAllUserVariables(b);
1==d.m.missedpackets?this.fillExecutedStore(d):"undefined"!=typeof d.m.userSerial&&null!=d.m.userSerial?d.m.userSerial==this.executedUserSerial[b]+1?(console.log("UID "+b+" Object with userSerial "+d.m.userSerial),this.executedUserSerial[b]=d.m.userSerial,io.onRecJson(d),this.executedUserStore[b][d.m.userSerial]=d,ioStorage.dataExecutedStoreAll(d,b+"_"+d.m.userSerial)):d.m.userSerial>this.executedUserSerial[b]+1?(console.log("UID "+b+" requst miss packet"),this.userRequestMissedPackets(this.executedUserSerial[b]+
1,d.m.userSerial,d,b)):(console.log("UID "+b+" no action current packet "+this.executedUserSerial[b]+" coming at "+d.m.userSerial),this.executedUserStore[b][d.m.userSerial]=d):console.log("UID "+b+" checkMissing should not be called without userSerial")},requestMissedPackets:function(d,b,a,c){0>d&&(d=0);"use strict";0==this.missRequest[c]?(this.aheadPackets[c].unshift(a.m.serial),this.executedStore[c][a.m.serial]=a,b--,console.log("UID "+c+" request packet from "+d+" to "+b),this.waitAndResetmissRequest(c),
ioAdapter.sendUser({reqMissPac:1,from:d,till:b},c)):(console.log("UID "+c+" ahead packet"+a.m.serial),this.aheadPackets[c].unshift(a.m.serial),this.executedStore[c][a.m.serial]=a)},userRequestMissedPackets:function(d,b,a,c){0>d&&(d=0);"use strict";0==this.missUserRequest[c]?(this.aheadUserPackets[c].unshift(a.m.userSerial),this.executedUserStore[c][a.m.userSerial]=a,b--,console.log("UID "+c+" User request packet from "+d+" to "+b),this.userWaitAndResetmissUserRequest(c),ioAdapter.sendUser({userReqMissPac:1,
from:d,till:b},c)):(console.log("UID "+c+" User ahead packet"+a.m.userSerial),this.aheadUserPackets[c].unshift(a.m.userSerial),this.executedUserStore[c][a.m.userSerial]=a)},waitAndResetmissRequest:function(d){ioMissingPackets.missRequest[d]=1;ioMissingPackets.missRequestFlag=1;setTimeout(function(){ioMissingPackets.missRequest[d]=0;ioMissingPackets.missRequestFlag=0},15E3)},userWaitAndResetmissUserRequest:function(d){ioMissingPackets.missUserRequest[d]=1;ioMissingPackets.missUserRequestFlag=1;setTimeout(function(){ioMissingPackets.missUserRequest[d]=
0;ioMissingPackets.missUserRequestFlag=0},15E3)},sendMissedPackets:function(d){var b=d.user.userid;this.validateAllVariables(b);var a=d.m.from;0>a&&(a=0);a=ioAdapter.adapterMustData.slice(a,d.m.till+1);ioAdapter.sendUser({missedpackets:1,data:a},d.user.userid);console.log("UID "+b+" send packet total chunk length "+a.length)},userSendMissedPackets:function(d){var b=d.user.userid;this.validateAllUserVariables(b);var a=d.m.from;0>a&&(a=0);a=ioAdapter.userAdapterMustData[b].slice(a,d.m.till+1);ioAdapter.sendUser({userMissedpackets:1,
data:a},d.user.userid);console.log("UID "+b+" send packet total chunk length "+a.length)},fillExecutedStore2:function(d){var b=d.user.userid;this.validateAllVariables(b);var a=d.m.data.length,c;for(c=0;c<a;c++)if(null!=d.m.data[c])if("undefined"!=typeof d.m.data[c].m.serial&&null!=d.m.data[c].m.serial){this.executedSerial[b]=d.m.data[c].m.serial;ioStorage.dataExecutedStoreAll(d.m.data[c],b+"_"+d.m.data[c].m.serial);d.m.data[c].user=d.user;this.executedStore[b][d.m.data[c].m.serial]=d.m.data[c];try{console.log("UID "+
b+" Object with Serial "+d.m.data[c].m.serial),io.onRecJson(d.m.data[c])}catch(f){console.log("Error "+f)}}else console.log("UID "+b+" Received Packed missing serial");for(this.aheadPackets[b]=this.aheadPackets[b].sort(function(a,c){return c-a});d=this.aheadPackets[b].pop();)if("undefined"!=typeof d&&null!=d)if("undefined"!=typeof this.executedStore[b][d])this.executedSerial[b]=d,console.log("UID "+b+" Object with Serial "+this.executedStore[b][d].m.serial),ioStorage.dataExecutedStoreAll(this.executedStore[b][d],
b+"_"+this.executedStore[b][d].m.serial),io.onRecJson(this.executedStore[b][d]);else{console.log("fillExecutedStore undefined");return}else console.log("UID "+b+" ahead Packed missing serial");this.missRequest[b]=0;ioMissingPackets.missRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},fillExecutedStore:function(d){var b=d.user.userid;this.validateAllVariables(b);var a=d.m.data.length,c;for(c=0;c<a;c++)if(null!=d.m.data[c])if("undefined"!=typeof d.m.data[c].m.serial&&null!=d.m.data[c].m.serial){this.executedSerial[b]=
d.m.data[c].m.serial;ioStorage.dataExecutedStoreAll(d.m.data[c],b+"_"+d.m.data[c].m.serial);d.m.data[c].user=d.user;this.executedStore[b][d.m.data[c].m.serial]=d.m.data[c];try{console.log("UID "+b+" Object with Serial "+d.m.data[c].m.serial),io.onRecJson(d.m.data[c])}catch(f){console.log("Error "+f)}}else console.log("UID "+b+" Received Packed missing serial");for(this.aheadPackets[b]=this.aheadPackets[b].sort(function(a,c){return c-a});d=this.aheadPackets[b].pop();)if("undefined"!=typeof d&&null!=
d)if("undefined"!=typeof this.executedStore[b][d])this.executedSerial[b]=d,console.log("UID "+b+" Object with Serial "+this.executedStore[b][d].m.serial),ioStorage.dataExecutedStoreAll(this.executedStore[b][d],b+"_"+this.executedStore[b][d].m.serial),io.onRecJson(this.executedStore[b][d]);else{console.log("fillExecutedStore undefined");return}else console.log("UID "+b+" ahead Packed missing serial");this.missRequest[b]=0;ioMissingPackets.missRequestFlag=0;virtualclass.vutil.initCommonSortingChat()},
userFillExecutedStore:function(d){var b=d.user.userid;this.validateAllUserVariables(b);0<d.m.data.length||console.log("UID "+b+" empty user data object");var a=d.m.data.length,c;for(c=0;c<a;c++)if(null!=d.m.data[c])if("undefined"!=typeof d.m.data[c].m.userSerial&&null!=d.m.data[c].m.userSerial){this.executedUserSerial[b]=d.m.data[c].m.userSerial;ioStorage.dataExecutedUserStoreAll(d.m.data[c],b+"_"+d.m.data[c].m.userSerial,d.m.data[c].m.userSerial);d.m.data[c].user=d.user;d.m.data[c].userto=d.userto;
try{console.log("UID "+b+" Object with user Serial "+d.m.data[c].m.userSerial),io.onRecJson(d.m.data[c])}catch(f){console.log("Error "+f)}this.executedUserStore[b][d.m.data[c].m.userSerial]=d.m.data[c]}else console.log("UID "+b+" Received Packed missing User serial");for(this.aheadUserPackets[b]=this.aheadUserPackets[b].sort(function(a,c){return c-a});d=this.aheadUserPackets[b].pop();)"undefined"!=typeof d&&null!=d?(this.executedUserSerial[b]=d,console.log("UID "+b+" Object with Serial "+this.executedUserStore[b][d].m.userSerial),
io.onRecJson(this.executedUserStore[b][d])):console.log("UID "+b+" ahead Packed missing serial");this.missUserRequest[b]=0;ioMissingPackets.missUserRequestFlag=0;virtualclass.vutil.initCommonSortingChat()}};var ioAdapter={adapterMustData:[],serial:-1,userSerial:[],userAdapterMustData:[],sendWithDelayIdentifier:{},validateAllVariables:function(d){if("undefined"==typeof this.userSerial||null==this.userSerial)this.userSerial=[];"undefined"==typeof this.userSerial[d]&&(this.userSerial[d]=-1);if("undefined"==typeof this.userAdapterMustData||null==this.userAdapterMustData)this.userAdapterMustData=[];"undefined"==typeof this.userAdapterMustData[d]&&(this.userAdapterMustData[d]=[])},sendWithDelayAndDrop:function(d,
b,a,c,f){null!=d&&null!=a&&(null==c&&(c=0),null==f&&(f=1E3),this.sendWithDelayIdentifier.hasOwnProperty(c)&&ioAdapter.sendWithDelayIdentifier[c]&&(console.log("Cancelling send "+a+" message "+d.cf),clearTimeout(ioAdapter.sendWithDelayIdentifier[c]),ioAdapter.sendWithDelayIdentifier[c]=0),ioAdapter.sendWithDelayIdentifier[c]=setTimeout(function(){console.log("Sending With Delay "+a+" message "+d.cf);ioAdapter[a](d);ioAdapter.sendWithDelayIdentifier[c]=0},f))},mustSend:function(d){this.serial++;d.serial=
this.serial;this.adapterMustData[this.serial]={type:"broadcast",m:d};this.send(d);ioStorage.dataAdapterStore({type:"broadcast",user:wbUser.id,m:d},this.serial)},send:function(d){io.send(d,"broadcastToAll",null)},mustSendAll:function(d){this.mustSendUser(d,virtualclass.gObj.uid);this.mustSend(d)},mustSendUser:function(d,b){this.validateAllVariables(b);"undefined"!=typeof d.serial&&d.serial&&(d.serial=null);this.userSerial[b]++;console.log("USER s.n "+this.userSerial[b]+" user "+b);d.userSerial=this.userSerial[b];
this.userAdapterMustData[b][d.userSerial]={type:"broadcastToAll",m:d};this.sendUser(d,b);ioStorage.dataUserAdapterMustData({type:"broadcastToAll",user:wbUser.id,m:d},b+"_"+d.userSerial)},sendUser:function(d,b){io.send(d,"broadcastToAll",b)},sendPing:function(d){io.send(d,"ping")},sendSpeed:function(d){ioAdapter.sendWithDelayAndDrop(d,null,"realSendSpeed","sendSpeed",1E3)},realSendSpeed:function(d){io.send(d,"speed")},sendBinary:function(d){io.sendBinary(d)},makeSessionReady:function(){io.sessionSet=
!0},setRecording:function(){if(!virtualclass.isPlayMode&&virtualclass.settings.recording.enableRecording){var d=virtualclass.settings.recording.sendYesOrNo();io.realSend({cfun:"recording",arg:{msg:d}});console.log("==== Send Recording a/v "+d)}},setSession:function(d){io.realSend({cfun:"session",arg:{msg:d}});console.log("==== Send Session serverSession "+d)},initSetSession:function(d){var b=localStorage.getItem("serverSession");null==b?localStorage.setItem("serverSession",d):virtualclass.isPlayMode||
b==d||this.setSession(b);this.makeSessionReady()},sync:function(d){io.send(d,"broadcastToAll",null)}};var ioPingPong={ping:function(d){"member_added"==d.type?roles.hasAdmin()&&(d={ping:"ping",cf:"pong",session:this.sessionName()},ioAdapter.sendWithDelayAndDrop(d,null,"mustSend","pingAll",3E3),console.log("PING BROADCAST")):"member_added"==d.type&&d.hasOwnProperty("users")&&(io.sessionSet=!0)},pong:function(d){d.toUser?(console.log("PONG TO "+d.toUser.userid+" from "+d.fromUser.userid),ioAdapter.mustSendUser({ping:"pong",cf:"pongAck"},d.fromUser.userid),console.log("PONG ACK TO "+d.fromUser.userid)):
(console.log("PONG BROADCAST from "+d.fromUser.userid),this.verifySession(d))},pongAck:function(d){console.log("PONG ACK FROM "+d.fromUser.userid)},sessionName:function(){var d=localStorage.getItem("mySession");null===d&&(virtualclass.gObj.hasOwnProperty("doEndSession")&&(virtualclass.storage.config.endSession(),console.log("==== session, end session")),d=this.setSession());return d},setSession:function(){var d=virtualclass.vutil.randomString(32);console.log("==== session, My session is created by setSession");
localStorage.setItem("mySession",d);return d},verifySession:function(d){var b=d.message.session,a=localStorage.getItem("mySession");null!=a?a!==b&&"t"==d.fromUser.role&&this.sessionDestroy(b,d):(console.log("==== session, start session"),console.log("My session is created"),localStorage.setItem("mySession",b))},sessionDestroy:function(d,b){virtualclass.isPlayMode?(console.log("==== session, end session"),console.log("My session is created"),localStorage.setItem("mySession","thisismyplaymode")):(console.log("==== session, start session"),
b=b.fromUser.userid,localStorage.removeItem("mySession"),virtualclass.storage.config.endSession(),localStorage.setItem("mySession",d),ioMissingPackets.validateAllVariables(b),console.log("REFRESH SESSION"))}};(function(d){d.virtualclass=function(){SCALE_FACTOR=1.02;var b=""!=wbUser.virtualclassPlay?parseInt(wbUser.virtualclassPlay,10):0,a=localStorage.getItem("studentSSstatus");a=null!=a?JSON.parse(localStorage.getItem("studentSSstatus")):{sharing:!1,mesharing:!1,shareToAll:!1};return{isPlayMode:b,apps:{wb:"Whiteboard",ss:"ScreenShare",yt:"Yts",er:"EditorRich",ec:"EditorCode",sp:"SharePresentation",poll:"Poll",vid:"Video",ds:"DocumentShare",quiz:"Quiz",mv:"MultiVideo"},appSessionEnd:"virtualclassSessionEnd",
appAudioTest:"virtualclassAudioTest",rWidgetConfig:{id:"virtualclassAppRightPanel"},wb:"",ss:"",wss:"",rw:"",poll:"",quiz:"",raiseHand:"",error:[],pdfRender:{},clearGlobalLock:"",gObj:{next:{},uid:d.wbUser.id,uRole:d.wbUser.role,uName:d.wbUser.name,tempReplayObjs:{},commandToolsWrapperId:{},editorInitDone:0,resize:!1,has_ts_capability:1==wbUser.ts||1==wbUser.ts?!0:!1,meetingMode:0,chromeExt:!1,pdfdebugg:!0,wbInitHandle:!1,wbCount:0,prvWindowSize:!1,wIds:[0],wbRearrang:!1,currSlide:null!=localStorage.getItem("currSlide")?
localStorage.getItem("currSlide"):0,currIndex:null!=localStorage.getItem("currIndex")?localStorage.getItem("currIndex"):0,uploadingFiles:[],docOrder:{},fetchedData:!1,wbNavtime:50,studentSSstatus:a,screenRh:60,isReadyForVideo:!0,defaultApp:"Whiteboard",tempQueue:{},chatIconColors:{},prevApp:null,myworker:null,requestToScriptNode:null,readyToCommunicate:!1,tempPrefix:"dest_temp/templates",allUserObj:{},docPdfFirstTime:!1,defalutStrk:"1",defalutFont:"25",defalutFntOptn:"1",defaultcolor:"#0000ff",sendAudioStatus:!1,
audioRecWorkerReady:!1,wbTool:{},fullScreenMode:!1},enablePreCheck:!0,clearSession:function(){d.pageEnter=(new Date).getTime();"undefined"==typeof notSend&&virtualclass.vutil.beforeSend({sEnd:!0,cf:"sEnd"},null,!0);"object"==typeof virtualclass.videoUl&&"object"==typeof virtualclass.videoUl.player&&"undefined"!=typeof virtualclass.videoUl.player.dispose&&virtualclass.videoUl.player.dispose();virtualclass.storage.config.endSession();virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&
virtualclass.prevScreen.unShareScreen();virtualclass.previrtualclass="virtualclass"+virtualclass.gObj.defaultApp},init:function(a,b,g){var c=this;return $jscomp.executeAsyncGenerator(function(){function a(a,m){for(;;)switch(f){case 0:t=document.getElementById("virtualclassCont");t.classList.add("loading");r=d.wbUser;virtualclass.uInfo={userid:r.id,sid:r.sid,rid:r.path,authuser:r.auth_user,authpass:r.auth_pass,userobj:{userid:r.id,name:r.name,lname:r.lname,img:r.imageurl,role:null!=localStorage.getItem("uRole")?
localStorage.getItem("uRole"):r.role},room:r.room};c.gObj.congCourse=typeof("undefiend"!=d.congCourse)?d.congCourse:0;c.wbConfig={id:"virtualclass"+virtualclass.apps.wb,classes:"appOptions"};c.ssConfig={id:"virtualclass"+virtualclass.apps.ss,classes:"appOptions"};c.edConfig={id:"virtualclass"+virtualclass.apps.er,classes:"appOptions"};c.edCodeConfig={id:"virtualclass"+virtualclass.apps.ec,classes:"appOptions"};c.ptConfig={id:"virtualclass"+virtualclass.apps.sp,classes:"appOptions"};c.plConfig={id:"virtualclass"+
virtualclass.apps.poll,classes:"appOptions"};c.viConfig={id:"virtualclass"+virtualclass.apps.vid,classes:"appOptions"};c.dtsConfig={id:"virtualclass"+virtualclass.apps.ds,classes:"appOptions"};c.qzConfig={id:"virtualclass"+c.apps.quiz,classes:"appOptions"};c.mvConfig={id:"virtualclass"+c.apps.mv,classes:"appOptions"};c.user=new d.user;c.vutil=d.vutil;c.sharePt=d.sharePt;c.fineUploader=d.fineUploader;c.system=d.system;c.recorder=d.recorder;c.converter=d.converter;c.clear="";c.currApp=c.vutil.capitalizeFirstLetter(b);
c.storage=d.storage;c.dashBoard=dashBoard;c.multiVideo=d.MultiVideo;c.vutil.isChromeExtension();c.wbCommon=d.wbCommon;c.pageNavigation=d.pageIndexNav;c.modal=d.modal;c.zoom=d.zoomWhiteboard();virtualclass.pageIndexNav=d.pageIndexNav;if(!c.system.isIndexedDbSupport()){f=1;break}f=3;return{value:c.storage.init(),done:!1};case 3:if(void 0===m){f=4;break}f=-1;throw m;case 4:f=2;break;case 1:console.log("Indexeddb does not support");case 2:"Quiz"!=c.currApp&&"undefined"!=typeof CDTimer&&clearInterval(CDTimer),
virtualclass.modernizr=Modernizr,c.system.webpInit(),c.dirtyCorner=d.dirtyCorner,c.html.init(c),c.adapter=d.adapter,virtualclass.system.mybrowser.hasOwnProperty("name")||c.system.setBrowserDetails(),virtualclass.api=d.api,virtualclass.vutil.initOnBeforeUnload(virtualclass.system.mybrowser.name),virtualclass.xhr=d.xhr,virtualclass.xhr.init(),virtualclass.xhrn=d.xhrn,virtualclass.xhrn.init(),virtualclass.vutil.getCookie("readyToCommunicate")&&(virtualclass.gObj.readyToCommunicate=!0),c.xhrn.getAcess(function(a){if("ERROR"!=
a||"Error"!=a)virtualclass.gObj.readyToCommunicate=!0,console.log("get access"),virtualclass.vutil.isPlayMode()&&virtualclass.recorder.requestListOfFiles()}),virtualclass.chat=new Chat,virtualclass.chat.init(),virtualclass.dtCon=virtualclass.converter(),virtualclass.pbar=progressBar,virtualclass.editorRich=d.editor("editorRich","virtualclassEditorRich","virtualclassEditorRichBody"),virtualclass.editorCode=d.editor("editorCode","virtualclassEditorCode","virtualclassEditorCodeBody"),virtualclass.poll=
d.poll(),virtualclass.quiz=d.quiz(),virtualclass.videoUl=d.videoUl(),virtualclass.videoHost=d.videoHost,virtualclass.precheck=d.precheck,virtualclass.page=page,console.log("==== session clear zoom object ready "),virtualclass.network=new Network,virtualclass.gesture=gesture,c.serverData=serverData,roles.hasControls()&&c.serverData.fetchAllData(),null!=localStorage.uRole&&(virtualclass.gObj.uRole=localStorage.uRole,t.classList.add(virtualclass.vutil.getClassName(virtualclass.gObj.uRole))),"undefined"==
typeof g||null==g?c.makeAppReady(b,"byclick"):c.makeAppReady(b,"byclick",g),c.system.check(),c.vutil.isSystemCompatible(),c.system.mediaDevices.getMediaDeviceInfo(),c.pageVisible=virtualclass.vutil.pageVisible(),b==virtualclass.apps.ss&&c.system.setAppDimension(),virtualclass.vutil.createReclaimButtonIfNeed(),virtualclass.user.assignRole(virtualclass.gObj.uRole,b),c.media=new d.media,q=localStorage.getItem("precheck"),null!=q&&(q=JSON.parse(q)),virtualclass.makePreCheckAvailable?virtualclass.precheck.init():
(virtualclass.makeReadySocket(),virtualclass.isPlayMode||virtualclass.gesture.initClassJoin()),t.classList.remove("loading"),virtualclass.gObj.precheckScrn=!1,virtualclass.gObj.meetingMode||virtualclass.videoHost.init(320,240),virtualclass.vutil.videoController(),q=document.getElementById("precheckSetting"),q.addEventListener("click",function(){virtualclass.gObj.precheckScrn=!0;virtualclass.precheck.init(virtualclass.precheck)}),c.raiseHand=d.raiseHand,c.raiseHand.init(),c.appSetting=d.appSetting,
c.appSetting.init(),virtualclass.colorSelector=d.colorSelector,virtualclassSetting.theme.selectedColor&&c.colorSelector.makeThemeReady(),u=document.getElementById("virtualclassCont"),null!=u&&u.classList.add(virtualclass.system.mybrowser.name),v=document.getElementById("fullScreenButton"),null!=v&&v.addEventListener("click",virtualclass.vutil.Fullscreen),k=document.getElementById("fullScreenExitButton"),null!=k&&k.addEventListener("click",virtualclass.vutil.closeFullscreen),document.onfullscreenchange=
function(a){virtualclass.gObj.fullScreenMode?(document.querySelector("#fullScreenButton").style.display="block",document.querySelector("#fullScreenExitButton").style.display="none",virtualclass.gObj.fullScreenMode=!1):(document.querySelector("#fullScreenButton").style.display="none",document.querySelector("#fullScreenExitButton").style.display="block",virtualclass.gObj.fullScreenMode=!0)},f=-1;default:return{value:void 0,done:!0}}}var f=0,k,v,u,q,r,t,B={next:function(c){return a(c,void 0)},throw:function(c){return a(void 0,
c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();B[Symbol.iterator]=function(){return this};return B}())},makeReadySocket:function(){if(!virtualclass.vutil.isPlayMode())var a=this,b=setInterval(function(){2<=a.gObj.editorInitDone&&(a.initSocketConn(),clearInterval(b))},100)},initSocketConn:function(){this.system.webSocket&&(io.init(virtualclass.uInfo),d.userdata=virtualclass.uInfo)},html:{id:"virtualclassCont",optionsClass:"appOptions",init:function(a){this.virtualclass=
a},leftAppBar:function(){if(!(0<document.getElementsByClassName("appOptions").length)){document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");var a=virtualclass.getTemplate("appTools")();virtualclass.vutil.insertAppLayout(a);virtualclass.gObj.hasOwnProperty("errNotScreenShare")&&virtualclass.view.disableSSUI();virtualclass.gObj.hasOwnProperty("errAppBar")&&virtualclass.view.disableLeftAppBar()}},createDiv:function(a,b,g,k,d){var c=document.createElement("a");c.href="#";var f=document.createElement("div");
f.id=a;"undefined "!=typeof k&&(f.className=k);k=document.createElement("span");k.className="icon-"+b;c.appendChild(k);c.dataset.title=virtualclass.lang.getString(b);c.className="tooltip";"virtualclassWhiteboardTool"==a&&(c.dataset.doc="_doc_0_"+virtualclass.gObj.wbCount);f.appendChild(c);"undefined"!=typeof d?(d=document.getElementById("virtualclassScreenShareTool"),g.replaceChild(f,d)):g.appendChild(f)},createElement:function(a,b,g){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);if("undefined"!=
typeof g&&1<g.length)for(b=0;b<g.length;b++)a.className+=g[b]+" ";return a}},dispvirtualclassLayout:function(a){if("undefined"!=typeof this.previous)if(this.previous.toUpperCase()!=("virtualclass"+this.currApp).toUpperCase()){var c=document.getElementById(virtualclass.previous);null!=c&&(c.style.display="none");"undefined"!=typeof a?("EDITORRICH"==a.toUpperCase()?(c=document.getElementById("virtualclassEditorCode"),null!=c&&(c.style.display="none")):console.log("EditorRich can not be display:none "+
a),"EDITORCODE"==a.toUpperCase()?(c=document.getElementById("virtualclassEditorRich"),null!=c&&(c.style.display="none")):console.log("EditorCode can not be display:none "+a)):console.log("appId "+a+" undefined")}else{c=document.getElementById("virtualclassCont").getElementsByClassName("virtualclass");for(var b=0;b<c.length;b++)c[b].style.display="none"}"undefined"!=typeof a&&(a="virtualclass"+(a.charAt(0).toUpperCase()+a.slice(1)));c=document.getElementById(a);null!=c&&(c.style.display="block",console.log("App "+
a+" block"))},makeAppReady:function(a,b,g){var c=this,f=arguments;return $jscomp.executeAsyncGenerator(function(){function k(k,p){for(var n;;)switch(m){case 0:virtualclass.dashBoard.close();console.log("Application is ready"+a);c.view=d.view;v=virtualclass.vutil.capitalizeFirstLetter(a);"ScreenShare"!=v&&(c.currApp=v);"DocumentShare"!=a&&(virtualclass.gObj.docPdfFirstTime=!1);console.log("Current App init "+c.currApp);roles.hasControls()&&virtualclass.hasOwnProperty("previrtualclass")&&(a!=virtualclass.apps.ss||
virtualclass.gObj.studentSSstatus.mesharing&&"ScreenShare"==virtualclass.apps.ss)&&virtualclass.vutil.makeActiveApp("virtualclass"+a,virtualclass.previrtualclass);"undefined"==typeof c.previous||"virtualclassEditorRich"!=c.previous&&"virtualclassEditorCode"!=c.previous||(k=c.previous.split("virtualclass")[1],c.user.control.toggleDisplayEditorController(k,"none"));a!=virtualclass.apps.ss&&(c.dispvirtualclassLayout(a),k=document.getElementById("virtualclassCont"),virtualclass.vutil.setCurrApp(k,c.currApp),
p=document.querySelector("#virtualclassApp"),null!=p&&("DocumentShare"==c.currApp||"SharePresentation"==c.currApp||"Video"==c.currApp?virtualclass.vutil.setCurrApp(p,k.dataset.currapp):p.dataset.currapp=""));"undefined"!=typeof c.prevScreen&&c.prevScreen.hasOwnProperty("currentStream")&&c.prevScreen.unShareScreen();if("SharePresentation"==a)"virtualclass"+a!=virtualclass.previous&&c.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(f));else if("DocumentShare"==a)c.appInitiator[a].apply(virtualclass,
Array.prototype.slice.call(f)),roles.hasControls()&&(virtualclass.dts.firstRequest?virtualclass.vutil.triggerDashboard(a,"hidepopup"):virtualclass.vutil.triggerDashboard(a));else if(k=localStorage.getItem("prevApp"),null!=k&&(p=JSON.parse(k),"SharePresentation"==p.name&&(p.name="",localStorage.setItem("prevApp",JSON.stringify(p)))),"Whiteboard"==a){n=[];for(p=0;p<f.length;p++)n.push(f[p]);"undefined"==typeof b&&(n[1]=b);n[2]="undefined"!=typeof g?"_doc_"+g:"_doc_0_"+virtualclass.gObj.currSlide;n.push("virtualclassWhiteboard");
c.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(n));k=JSON.parse(k);virtualclass.wbCommon.initNav(virtualclass.gObj.wIds);virtualclass.gObj.wbRearrang||null==k||null==localStorage.getItem("currSlide")||(n=localStorage.getItem("wIds"),n=JSON.parse(n),null!=n&&0<n.length&&(virtualclass.wbCommon.readyElements(n),virtualclass.wbCommon.initNav(n),virtualclass.gObj.hasOwnProperty("currSlide")&&-1==n.indexOf(Number(virtualclass.gObj.currSlide))&&(console.log("wids, From virtualclass "),n.push(virtualclass.gObj.currSlide)),
virtualclass.wbCommon.reArrangeElements(n),virtualclass.gObj.wbRearrang=!0,virtualclass.gObj.wIds=n,roles.hasControls()&&(virtualclass.wbCommon.rearrange(virtualclass.wbCommon.order),virtualclass.wbCommon.indexNav.addActiveNavigation(virtualclass.gObj.currWb))));virtualclass.wbCommon.identifyFirstNote(virtualclass.gObj.currWb);virtualclass.wbCommon.identifyLastNote(virtualclass.gObj.currWb)}else k=Array.prototype.slice.call(f)[2],c.appInitiator[a].apply(virtualclass,Array.prototype.slice.call(f)),
k&&k.init&&k.init.videoUrl&&k.fromReload&&(n=!0),roles.hasControls()&&"Video"==a&&("virtualclass"+a!=virtualclass.previous&&(k=document.querySelector("#dashboardnav button"),null!=k&&(k.setAttribute("data-currapp","Video"),k.classList.contains("clicked")&&k.classList.remove("clicked"))),virtualclass.vutil.triggerDashboard(a,n));c.previrtualclass=c.previous;a!=virtualclass.apps.wb&&a!=virtualclass.apps.ss&&virtualclass.system.setAppDimension();if("Video"!=a&&virtualclass.hasOwnProperty("videoUl")){virtualclass.videoUl.videoId=
"";(n=document.getElementById("dispVideo_Youtube_api"))&&n.contentWindow&&n.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");if(n=document.querySelector(".congrea #dispVideo"))n.style.display="none",(n=document.querySelector(".congrea #dispVideo video"))&&n.setAttribute("src","");(n=document.querySelector("#listvideo .playing"))&&n.classList.remove("playing");(n=document.querySelector("#listvideo .removeCtr"))&&n.classList.remove("removeCtr");roles.hasControls()||
(virtualclass.gObj.hasOwnProperty("videoPauseTime")&&clearTimeout(virtualclass.gObj.videoPauseTime),"object"==typeof virtualclass.videoUl.player&&null!=virtualclass.videoUl.player.player_&&virtualclass.videoUl.player.paused()&&(console.log("==== Video is paused"),virtualclass.videoUl.player.pause()));"object"==typeof virtualclass.videoUl.player&&delete virtualclass.videoUl.player}roles.hasControls()&&(k=Array.prototype.slice.call(f)[2],"ScreenShare"==a||"SharePresentation"!=virtualclass.currApp&&
"Video"!=virtualclass.currApp?"DocumentShare"!=virtualclass.currApp&&"SharePresentation"!=virtualclass.currApp&&virtualclass.vutil.removeDashboardNav():(virtualclass.vutil.initDashboardNav(k),"Video"==virtualclass.currApp?console.log("currApp "+virtualclass.currApp):virtualclass.sharePt.localStoragFlag||(k=document.querySelector("#dashboardnav button"),null!=k&&k.click())),"SharePresentation"!=virtualclass.currApp&&(n=document.querySelector("#listppt .playing"))&&n.classList.remove("playing"));m=
-1;default:return{value:void 0,done:!0}}}var m=0,v,u={next:function(a){return k(a,void 0)},throw:function(a){return k(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();u[Symbol.iterator]=function(){return this};return u}())},appInitiator:{Whiteboard:function(a,b,g,k){var c=this;return $jscomp.executeAsyncGenerator(function(){function f(f,p){for(var n;;)switch(k){case 0:"object"==typeof c.ss&&(c.ss.prevStream=!1);"undefined"!=typeof c.previous&&"undefined"!=
typeof b&&"byclick"==b&&roles.hasControls()&&"Whiteboard"==virtualclass.currApp&&(f=g.split("_doc_")[1],virtualclass.vutil.beforeSend({dispWhiteboard:!0,cf:"dispWhiteboard",d:f}));t=virtualclass.gObj.currWb=g;"object"!=typeof c.pdfRender[t]?c.pdfRender[t]=d.pdfRender():"Whiteboard"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||virtualclass.zoom.adjustScreenOnDifferentPdfWidth();roles.isStudent()&&"Whiteboard"==virtualclass.currApp&&virtualclass.wbCommon.setCurrSlideNumber(g);if("undefined"==
typeof g){k=1;break}if("object"==typeof c.wb[g]){k=3;break}"object"!=typeof c.wb&&(c.wb={});virtualclass.gObj.commandToolsWrapperId[g]="commandToolsWrapper"+g;c.wb[g]={};virtualclass.gObj.tempReplayObjs[g]=[];c.wb[g]=new d.whiteboard(c.wbConfig,g);null!=c.gObj.tempQueue[g]&&(c.wb[g].gObj.queue=c.gObj.tempQueue[g].slice(),c.gObj.tempQueue[g]=null);"Whiteboard"==virtualclass.currApp?(f=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),virtualclass.gObj.wbInitHandle||(virtualclass.wbCommon.initNavHandler(),
virtualclass.gObj.wbInitHandle=!0)):f=document.getElementById("cont"+g);if(null==f){k=5;break}if(null==document.querySelector("vcanvas"+g)){p=virtualclass.getTemplate("main","whiteboard");if("Whiteboard"==virtualclass.currApp){virtualclass.wbCommon.hideElement();var v="note"+g;n=document.querySelector("#"+v);null!=n?(n.classList.add("canvasContainer","current"),p=p({cn:g,hasControl:roles.hasControls()}),n.innerHTML=p):(p="<div id='"+v+"' data-wb-id='"+g+"' class='canvasContainer current'>"+p({cn:g,
hasControl:roles.hasControls()})+"</div>","_doc_0_0"!=g?f.insertAdjacentHTML("beforeend",p):(f.innerHTML=p,f=document.querySelector("#note_doc_0_0"),null!=f&&f.classList.add("current")))}else p=p({cn:g,hasControl:roles.hasControls()}),f.innerHTML=p;n=document.querySelector("#canvas"+g)}c.wb[g].utility=new d.utility;c.wb[g].alreadyReplay=!1;c.wb[g].packContainer=new d.packContainer;c.wb[g].draw_object=d.draw_object;c.wb[g].makeobj=d.makeobj;c.wb[g].readyFreeHandObj=d.readyFreeHandObj;c.wb[g]._replay=
_replay;c.wb[g].readyTextObj=d.readyTextObj;c.wb[g].bridge=d.bridge;c.wb[g].response=d.response;virtualclass.wb[g].utility.displayCanvas(g);u=virtualclass.wb[g].vcan;roles.hasControls()&&(virtualclass.wb[g].utility.setOrginalTeacherContent(a),virtualclass.wb[g].attachToolFunction(virtualclass.gObj.commandToolsWrapperId[g],!0,g),f=u.utility.canvasCalcOffset(u.main.canid),console.log("whietboard offset x="+f.x+"  y="+f.y));"DocumentShare"==virtualclass.currApp?virtualclass.pdfRender[t].init(n,virtualclass.dts.docs.note.currNote):
virtualclass.pdfRender[t].init(n);k=7;return{value:virtualclass.storage.getWbData(g),done:!1};case 7:if(void 0===p){k=8;break}k=-1;throw p;case 8:k=6;break;case 5:alert("whiteboard container is null");case 6:k=4;break;case 3:r="commandToolsWrapper"+g,q=document.getElementById("commandToolsWrapper"+g),null==q&&roles.hasControls()&&virtualclass.wb[g].attachToolFunction(r,!0,g);case 4:u=virtualclass.wb[g].vcan;null!=document.getElementById("canvas"+g)&&(u.utility.canvasCalcOffset(u.main.canid),0!==c.gObj.tempReplayObjs[g].length&&
"nodata"!==c.gObj.tempReplayObjs[g]||virtualclass.wb[g].utility.makeCanvasEnable());console.log("==== previous set "+c.wbConfig.id);c.previous=c.wbConfig.id;k=2;break;case 1:alert("id is undefined");case 2:console.log("==== SESSION CLEAR"),virtualclass.zoom.init(),m=localStorage.getItem("activeTool"),null!=m&&(f=document.querySelector("#"+m),null!=f&&(f.classList.add("active"),virtualclass.wb[t].prvTool=m)),roles.hasControls()&&d.addEventListener("mouseup",function(a){var c=document.querySelector("#virtualclassCont").dataset.currapp;
if(null!=c&&("Whiteboard"==c||"DocumentShare"==c))if(a.target.dataset.hasOwnProperty("stroke")||a.target.dataset.hasOwnProperty("font"))a=a.target.dataset.hasOwnProperty("stroke")?document.querySelector("#t_strk"+virtualclass.gObj.currWb+" .strkSizeList"):document.querySelector("#t_font"+virtualclass.gObj.currWb+" .fontSizeList"),virtualclass.wb[virtualclass.gObj.currWb].closeElem(a);else if(a.target.classList.contains("icon-color")||a.target.classList.contains("selected")||a.target.classList.contains("congtooltip"))virtualclass.wb[virtualclass.gObj.currWb].closeElem(document.querySelector("#shapes"+
virtualclass.gObj.currWb));else if(a.target.classList.contains("icon-rectangle")||a.target.classList.contains("icon-line")||a.target.classList.contains("icon-oval")||a.target.classList.contains("icon-triangle"))virtualclass.wb[virtualclass.gObj.currWb].closeElem(document.querySelector("#shapes"+virtualclass.gObj.currWb));else{c=document.querySelector("#t_strk"+virtualclass.gObj.currWb+" .strkSizeList");var b=document.querySelector("#t_font"+virtualclass.gObj.currWb+" .fontSizeList"),f=document.querySelector("#colorList"+
virtualclass.gObj.currWb);null!=c&&c.classList.contains("open")&&!document.querySelector("#virtualclassApp").classList.contains("dashboard")?virtualclass.wb[virtualclass.gObj.currWb].closeElem(c):null!=b&&b.classList.contains("open")&&!document.querySelector("#virtualclassApp").classList.contains("dashboard")?virtualclass.wb[virtualclass.gObj.currWb].closeElem(b):null!=f&&f.classList.contains("open")&&!document.querySelector("#virtualclassApp").classList.contains("dashboard")&&virtualclass.wb[virtualclass.gObj.currWb].closeElem(f);
a.target.classList.contains("icon-shapes")||document.querySelector("#virtualclassApp").classList.contains("dashboard")||(a=document.querySelector("#shapes"+virtualclass.gObj.currWb),null!=a&&a.classList.contains("open")&&virtualclass.wb[virtualclass.gObj.currWb].closeElem(a))}}),"undefined"==typeof virtualclass.wb.indexNav&&(virtualclass.wb.indexNav=new virtualclass.pageIndexNav("WB")),k=-1;default:return{value:void 0,done:!0}}}var k=0,m,u,q,r,t,B={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,
a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();B[Symbol.iterator]=function(){return this};return B}())},ScreenShare:function(a){"object"!=typeof this.ss&&(this.ss=new d.screenShare(virtualclass.ssConfig));this.ss.init({type:"ss",app:a})},Yts:function(a,b,g){"undefined"!=typeof g&&null!=g?virtualclass.yts.init(g,g.startFrom):null==document.querySelector("iframe#player")&&virtualclass.yts.init();this.previous=virtualclass.ytsConfig.id},EditorRich:function(a){this.appInitiator.editor.call(virtualclass,
a)},EditorCode:function(a){this.appInitiator.editor.call(virtualclass,a)},SharePresentation:function(a,b){"object"==typeof this.ss&&(this.ss.prevStream=!1);this.sharePt=new d.sharePt;console.log(virtualclass.sharePt.pptUrl);this.sharePt.init(a,b);console.log(virtualclass.sharePt.pptUrl);this.previous=virtualclass.ptConfig.id;virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},Poll:function(a){virtualclass.poll.init()},Quiz:function(a){virtualclass.quiz.init()},
Video:function(a,b,g){"undefined"!=typeof g&&null!=g?"undefined"==typeof g.type?virtualclass.videoUl.init(g,g.startFrom):virtualclass.videoUl.init():virtualclass.videoUl.init()},editor:function(a){this.user.control.toggleDisplayEditorController(a.substring(a.indexOf("virtualclass"),a.length),"block");var c=[];a==virtualclass.apps.er?(virtualclass.editorRich.init(0,c,"",""),this.previous=virtualclass.edConfig.id):(virtualclass.editorCode.init(0,c,"",""),this.previous=virtualclass.edCodeConfig.id);
c=JSON.parse(localStorage.getItem(virtualclass.vutil.smallizeFirstLetter(a)));var b=virtualclass.vutil.smallizeFirstLetter(a);roles.hasAdmin()||(null==c?(this[b].cm.setOption("readOnly","nocursor"),this.user.control.toggleDisplayWriteModeMsgBox(a,!1),console.log("message box is created "+a)):(this.user.control.toggleDisplayWriteModeMsgBox(a,c),c?this[b].cm.setOption("readOnly",!1):this[b].cm.setOption("readOnly","nocursor")),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(b))},makeReadyDsShare:function(a,
b,g){virtualclass.dts.docs.hasOwnProperty("currDoc")?(roles.hasControls()&&(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),console.log("doc share current"),virtualclass.dts.sendCurrentDoc(),virtualclass.dts.sendCurrentSlide()),a=virtualclass.dts.docs.currNote,"undefined"!=typeof a&&virtualclass.vutil.updateCurrentDoc(a)):"undefined"!=typeof g?setTimeout(function(){virtualclass.dts.init(g)},1E3):virtualclass.dts.init();virtualclass.previous=virtualclass.dtsConfig.id;console.log("==== previous "+
virtualclass.previous)},DocumentShare:function(a,b,g){virtualclass.hasOwnProperty("dts")&&null!=virtualclass.dts?(virtualclass.dts.firstRequest=!1,virtualclass.dts.indexNav.init()):virtualclass.dts=d.documentShare();var c=[];"undefined"!=typeof a&&c.push(a);"undefined"!=typeof b&&c.push(b);"undefined"!=typeof g&&c.push(g);"undefined"==typeof virtualclass.dts.indexNav&&(virtualclass.dts.indexNav=new virtualclass.pageIndexNav("documentShare"));virtualclass.gObj.hasOwnProperty("docs")&&(virtualclass.appInitiator.makeReadyDsShare.apply(virtualclass.appInitiator,
c),virtualclass.vutil.initDashboardNav(),virtualclass.dts.firstRequest||virtualclass.dts.noteExist()?(console.log("===== DOCUMENT EXIST"),virtualclass.zoom.adjustScreenOnDifferentPdfWidth()):(a=document.querySelector("#dashboardnav button"),null!=a&&a.click()),null!=virtualclass.gObj.currWb&&"undefined"!=typeof virtualclass.pdfRender[virtualclass.gObj.currWb]&&"DocumentShare"==virtualclass.currApp&&virtualclass.pdfRender[virtualclass.gObj.currWb].hasOwnProperty("page")&&null!=virtualclass.pdfRender[virtualclass.gObj.currWb].page&&
virtualclass.dts.order&&("undefined"==typeof virtualclass.dts.indexNav&&(virtualclass.dts.indexNav=new virtualclass.pageIndexNav("documentShare")),roles.hasControls()?virtualclass.dts.indexNav.createIndex():virtualclass.dts.indexNav.studentDocNavigation(virtualclass.dts.docs.currNote)));(a=document.querySelector("#virtualclassAppLeftPanel .zoomControler .reloadNote span"))&&a.setAttribute("data-title",virtualclass.lang.getString("reloadDoc"))},MultiVideo:function(){var a=this;a.multiVideo.hasOwnProperty("initDone")?
a.multiVideo._init():setTimeout(function(){a.appInitiator.MultiVideo.apply(virtualclass)},2E3);this.previous=virtualclass.mvConfig.id}},attachFunction:function(){for(var a=document.getElementsByClassName("appOptions"),b=0;b<a.length;b++){var g=a[b].getElementsByTagName("a")[0];if("virtualclassEditorCodeTool"!=a[b].id){var k=this;clickedAnchor=g;g.onclick=function(){k.initlizer(this)}}}},initlizer:function(a){a=a.parentNode.id.split("virtualclass")[1];"SessionEndTool"==a?virtualclass.popup.confirmInput(virtualclass.lang.getString("startnewsession"),
function(a){a?(virtualclass.gObj.endSession=!0,virtualclass.gObj.hasOwnProperty("beTeacher")&&roles.isTeacher()&&localStorage.setItem("uRole","t"),localStorage.clear(),(new Promise(function(a,c){virtualclass.gObj.sessionEndResolve=a;virtualclass.clearSession()})).then(function(){delete virtualclass.gObj.sessionEndResolve;virtualclass.popup.sesseionEndWindow()},function(a){console.log("ERRROR "+a)})):console.log("Not start new session")}):(a=a.substring(0,a.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,
a)?alert(virtualclass.lang.getString("screensharealready")):("DocumentShare"==virtualclass.currApp&&(virtualclass.gObj.screenRh=160),this.makeAppReady(a,"byclick"),setTimeout(function(){virtualclass.gObj.screenRh=60},1500)));"ScreenShare"!=a&&virtualclass.vutil.removeClass("audioWidget","fixed")},PrvAndCurrIsWss:function(a,b){return"virtualclassWholeScreenShare"==a&&b==virtualclass.apps.yt?!0:!1},handleCurrentUserWithPrevious:function(){var a=localStorage.getItem("prvUser");if(null==a)virtualclass.setPrvUser();
else if(a=JSON.parse(a),a.id!=wbUser.id||a.room!=wbUser.room||wbUser.role!=a.role||a.recording!=virtualclass.settings.recording.enableRecording)virtualclass.gObj.sessionClear=!0,virtualclass.setPrvUser(),roles.hasControls()&&localStorage.setItem("uRole",this.gObj.uRole)},setPrvUser:function(){localStorage.clear();var a={id:wbUser.id,room:wbUser.room,role:wbUser.role,recording:virtualclass.settings.recording.enableRecording};console.log("previosu user");localStorage.setItem("prvUser",JSON.stringify(a))},
registerPartial:function(){for(var a={whiteboardPath:whiteboardPath},b="precheck teacherVideo audioWidget appTools popupCont appToolsMeeting appSettingDetail joinclass".split(" "),g={hasControl:roles.hasControls()},k,d=0;d<b.length;d++){k=null;if("precheck"==b[d]||"popupCont"==b[d])k=a;else if("audioWidget"==b[d])k=virtualclassSetting,k.isControl=roles.hasControls(),k.isMettingMode=virtualclass.gObj.meetingMode&&roles.isStudent();else if("teacherVideo"==b[d]||"appTools"==b[d]||"appSettingDetail"==
b[d])k=g;this.makeReadyTemplate(b[d],k)}Handlebars.registerPartial({docNotesMain:this.getTemplate("notesMain","documentSharing"),whiteboardToolbar:this.getTemplate("toolbar","whiteboard"),rightBar:this.getTemplate("rightBar"),recordingControl:this.getTemplate("recordingControl"),leftBar:this.getTemplate("leftBar"),main:this.getTemplate("main"),whiteboard:this.getTemplate("main","whiteboard"),dashboardCont:this.getTemplate("dashboardCont"),multiVideo:this.getTemplate("multiVideo")})},registerHelper:function(){Handlebars.registerHelper("getString",
function(a){return virtualclass.lang.getString(a)});Handlebars.registerHelper("debug",function(a){console.log("Current Context");console.log("====================");console.log(this);a&&(console.log("Value"),console.log("===================="),console.log(a))});Handlebars.registerHelper("getVideoType",function(a){return virtualclass.gObj.meetingMode?"multiVideo":"teacherVideo"})},createMainContainer:function(){var a=document.querySelector("#"+virtualclass.html.id);this.registerHelper();this.registerPartial();
var b=this.getTemplate("main"),g={isPlay:virtualclass.isPlayMode,hasControls:roles.hasControls(),meetingMode:virtualclass.gObj.meetingMode};b=b(g);a.insertAdjacentHTML("afterbegin",b)},makeReadyTemplate:function(a,b){Handlebars.registerPartial(a,(0,JST[virtualclass.gObj.tempPrefix+"/"+a+".hbs"])(b))},getTemplate:function(a,b){return"undefined"==typeof b?JST[virtualclass.gObj.tempPrefix+"/"+a+".hbs"]:JST[virtualclass.gObj.tempPrefix+"/"+b+"/"+a+".hbs"]}}}})(window);(function(d,b){d.Vcan=function(){var a={create:function(c){if("#"==c.charAt(0)){var b=c.substring(1,c.length);a.utility.canvasCalcOffset(b);return new a.main(c)}console.log("there is a problem with canvas id")},main:function(c){a.main.children=[];a.main.id=0;a.main.uid=0;a.main.canvas=b.querySelector(c);a.main.canid=c.substring(1,c.length);a.main.currentTransform="";a.main.replayObjs=[];a.main.dragMode=!1;a.main.scaleMode=!1;a.main.usrCurrAction="";a.main.currObj="";a.main.textObj=!1;a.main.action=
"create";a.wb={};a.wb.sentPack=!1;a.activMouse=new a.mouse;a.activMouse.init()},extend:function(a,b){if("object"==typeof a&&"object"==typeof b){for(var c in b)a[c]=b[c];return a}console.log("it seems that the arguments you passed are not object")},transform:function(a,b,g){a.translate(b.x,b.y);a.rotate(b.theta);g||a.scale(b.scaleX*(b.flipX?-1:1),b.scaleY*(b.flipY?-1:1))},getStates:function(c){return a.main[c]},setValInMain:function(c,b){return a.main[c]=b},ArrayIndexOf:function(a,b){if(!b||"function"!=
typeof b||!a||!a.length||1>a.length)return-1;for(var c=0;c<a.length;c++)if(b(a[c]))return c;return-1},renderAll:function(c){"object"!=typeof c&&(c=a.main.canvas.getContext("2d"));a.clearContext(c);this.displayPdfWhiteboard()},normalDisplay:function(c){console.log("Whiteboard index "+c);"freeDrawing"==a.main.children[c].type?a.fhdRender(ctx,a.main.children[c]):a.render(ctx,a.main.children[c])},displayPdfWhiteboard:function(){var c=a.main.children.length;if(c)for(var b=a.main.canvas.getContext("2d"),
g=0;g<c;++g)"pdf"==a.main.children[g].type?console.log("Pdf, Render the data, that should not be a"):"freeDrawing"==a.main.children[g].type?a.fhdRender(b,a.main.children[g]):a.render(b,a.main.children[g])},clearContext:function(c){var b=a.main.canvas;c.clearRect(0,0,b.width,b.height);return b},deactivateAll:function(){for(var c=a.main.children,b=0,g=c.length;b<g;b++)c[b].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,c){this.addEventListener("on"+a,c)}}},remove:function(c){var b=
a.main.canvas,g=a.ArrayIndexOf(a.main.children,function(a){return a.id==c.id&&(a.mt==c.mt||1==c.multiuser)});0<=g&&a.main.children.splice(g,1);g=b.height;var k=b.width;b=b.getContext("2d");b.beginPath();b.clearRect(0,0,k,g);b.closePath();a.renderAll()},render:function(c,b,g,k){c.beginPath();c.save();c.lineWidth=void 0!==c.lineWidth?b.lineWidth:2;g||a.transform(c,b,k);c.strokeStyle=void 0!=b.borderColor?b.borderColor:"#000000";"rectangle"==b.type?a.objRect.draw(c,b,g):"line"==b.type?a.objLine.draw(c,
b,g):"oval"==b.type?a.objOval.draw(c,b,g):"triangle"==b.type?a.objTri.draw(c,b,g):"text"==b.type&&a.objTxt.draw(c,b,g);b.active&&!g&&(b.drawBorders(c),b.hideCorners||b.drawCorners(c));c.closePath();c.restore()},fhdRender:function(c,b,g){c.save();var f=b.transformMatrix;f&&c.transform(f[0],f[1],f[2],f[3],f[4],f[5]);g||a.transform(c,b);b.overlayFill?c.fillStyle=b.overlayFill:b.fill&&(c.fillStyle=b.fill);b.stroke&&(c.strokeStyle=b.stroke);c.beginPath();for(var d,n=-(b.width/2),p=-(b.height/2),v=0,u=
b.path.length;v<u;++v)switch(d=b.path[v],d[0]){case "L":f=d[1];d=d[2];c.lineTo(f+n,d+p);break;case "M":f=d[1],d=d[2],c.moveTo(f+n,d+p)}b.fill&&c.fill();b.stroke&&(c.strokeStyle=b.stroke,c.lineWidth=b.strokeWidth,c.lineCap=c.lineJoin="round",c.stroke());!g&&b.active&&(b.drawBorders(c),b.hideCorners||b.drawCorners(c));c.restore()},makeStackObj:function(a,b,g,k){return{mt:a,ac:b,x:g,y:k}}};return a}})(window,document);(function(d,b){d.whiteboard=function(a,c){console.log("Whiteboard new one");var f=a.hasOwnProperty("id")?a.id:"appWhitebaordCont";a=a.hasOwnProperty("class");"object"!=typeof virtualclass.wb[c].vcan&&(virtualclass.wb[c].vcan=new d.Vcan,d.vcanUtility(c),d.vcanMain(c),d.Events(c),d.Virtualbox(c),d.Interact(c),d.Rectangle(c),d.Oval(c),d.Triangle(c),d.Text(c),d.Line(c),d.FreeHandDrawing(c),d.Path(c),d.Mouse(c),d.Optimize(c));return{id:f,classes:a,tool:"",obj:{},prvObj:"",replayTime:0,uid:0,lt:"",view:{},
lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],queue:[],virtualWindow:!1},vcan:virtualclass.wb[c].vcan,init:function(a){var c=virtualclass.wb[a].vcan;virtualclass.wb[a].canvas=c.create("#canvas"+a);c=c.main.canvas;c.className+=" whiteboards";c.setAttribute("tabindex","0");var f=b.createElement("canvas");f.id="canvas"+a+"_pdf";f.className="pdfs";f.width=c.width;f.height=c.height;virtualclass.vutil.insertAfter(f,c);d.onkeydown=virtualclass.wb[a].utility.keyOperation;
virtualclass.system.setAppDimension(a);"undefined"!==typeof Storage&&(d.virtualclass.wb[a]=virtualclass.wb[a]);this.arrowInit();this._init(a)},_init:function(a){virtualclass.wb[a].oTeacher=roles.hasAdmin();virtualclass.vutil.chkValueInLocalStorage("rcvdPackId")?virtualclass.wb[a].gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):virtualclass.wb[a].gObj.rcvdPackId=0;d.addEventListener("click",function(){virtualclass.view.disappearBox("WebRtc");virtualclass.view.disappearBox("Canvas");virtualclass.view.disappearBox("drawArea")});
virtualclass.wb[a].utility.crateCanvasDrawMesssage(a)},UI:{mainContainer:function(a,c){a=b.querySelector("#"+a);if(null!=a){var f=b.createElement("div");f.id="vcanvas"+c;f.className="vcanvas";f.dataset.wbId=c;var g=b.createElement("div");g.id="containerWb"+c;g.className="containerWb";f.appendChild(g);a.appendChild(f)}else alert("container is null")}},arrowInit:function(){this.arrImg=new Image;this.arrImg.src="https://cdn.congrea.net/resources/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=
function(){a.arrImgDraw=!0}},createCommand:function(a,c){if((a=virtualclass.wb[c].utility.alreadyExistToolBar(c))||null!=localStorage.getItem("educator")&&localStorage.reclaim)return!0;a=virtualclass.getTemplate("toolbar","whiteboard")({cn:c});c=b.getElementById("containerWb"+c);null!=c&&c.insertAdjacentHTML("afterbegin",a)},createCommandWrapper:function(){var a=b.createElement("div");a.id=virtualclass.gObj.commandToolsWrapperId;var c=b.getElementById(vcan.canvasWrapperId);null!=c?b.getElementById("containerWb").insertBefore(a,
c):b.getElementById("containerWb").appendChild(a);return a},createCanvas:function(a){virtualclass.wb[a].vcan.canvasWrapperId=cmdToolsWrapper.id},initActiveElement:function(a,c){a=b.querySelector(a);"undefined"==typeof virtualclass.gObj.wbTool[virtualclass.gObj.currWb]&&(virtualclass.gObj.wbTool[virtualclass.gObj.currWb]={});"undefined"==typeof virtualclass.gObj.wbTool[virtualclass.gObj.currWb][c.type]&&(a.addEventListener("click",this.activeElementHandler.bind(this,c)),virtualclass.gObj.wbTool[virtualclass.gObj.currWb][c.type]=
!0)},activeElementHandler:function(a,c){this.activeElement(c,a)},activeElement:function(a,c){var f=b.querySelector("#t_"+c.type+virtualclass.gObj.currWb+" .selected");null!=f&&f.classList.remove("selected");f=a.target.dataset[c.prop];null!=f&&(a.target.classList.add("selected"),virtualclass.wb[virtualclass.gObj.currWb].changeToolProperty(c.type,f))},objInit:function(a){var c=virtualclass.vutil.getWhiteboardId(this.parentNode);if(a.target.classList.contains("icon-shapes")||a.target.parentNode.classList.contains("shapes_icon")){var f=
b.querySelector("#shapes"+c);f.classList.contains("open")?(f.classList.remove("open"),f.classList.add("close")):(f.classList.contains("close")&&f.classList.remove("close"),f.classList.add("open"),virtualclass.wb[c].closeElem(b.querySelector("#t_strk"+c+" .strkSizeList")),virtualclass.wb[c].closeElem(b.querySelector("#t_font"+c+" .fontSizeList")))}else if(this.parentNode.id=="t_color"+c)virtualclass.wb[c].closeElem(b.querySelector("#shapes"+virtualclass.gObj.currWb)),virtualclass.wb[c].closeElem(b.querySelector("#t_strk"+
c+" .strkSizeList")),virtualclass.wb[c].closeElem(b.querySelector("#t_font"+c+" .fontSizeList")),virtualclass.wb[c].toggleDisplay(this.parentNode.id,c),virtualclass.wb[c].initActiveElement("#colorList"+c,{type:"color",prop:"color"});else if(this.parentNode.id=="t_strk"+c)virtualclass.wb[c].closeElem(b.querySelector("#shapes"+virtualclass.gObj.currWb)),virtualclass.wb[c].toggleDisplay(this.parentNode.id,c),virtualclass.wb[c].initActiveElement("#t_strk"+c+" ul",{type:"strk",prop:"stroke"});else if(this.parentNode.id==
"t_font"+c)virtualclass.wb[c].closeElem(b.querySelector("#shapes"+virtualclass.gObj.currWb)),virtualclass.wb[c].toggleDisplay(this.parentNode.id,c),virtualclass.wb[c].initActiveElement("#t_font"+c+" ul",{type:"font",prop:"font"});else{"undefined"!=typeof virtualclass.wb[virtualclass.gObj.currWb]&&""!=virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj&&"undefined"!=typeof virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj&&0>this.parentNode.id.indexOf("t_text")&&0<b.querySelectorAll(".canvasWrapper .textBoxContainer").length&&
virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny();a=virtualclass.wb[c].vcan;roles.hasControls()&&this.parentNode.id!="t_clearall"+c&&virtualclass.wb[c].utility.makeActiveTool(this.parentNode.id);this.parentNode.id=="t_replay"+c?(virtualclass.wb[c].utility.clearAll(!1),virtualclass.vutil.beforeSend({replayAll:!0,cf:replayAll})):virtualclass.wb[c].toolInit(this.parentNode.id,c);if(this.parentNode.id=="t_rectangle"+c||this.parentNode.id=="t_line"+c||this.parentNode.id=="t_oval"+
c||this.parentNode.id=="t_triangle"+c){var g=this.parentNode.id.slice(2,this.parentNode.id.split(/_doc_*/)[0].length);b.querySelector("#tool_wrapper"+c).dataset.currtool=this.parentNode.dataset.tool;b.querySelector("#shapeIcon"+c+" a").dataset.title=g.charAt(0).toUpperCase()+g.slice(1)}else b.querySelector("#tool_wrapper"+c).dataset.currtool="shapes",b.querySelector("#shapeIcon"+c+" a").dataset.title="Shapes",virtualclass.wb[c].closeElem(b.querySelector("#shapes"+virtualclass.gObj.currWb)),virtualclass.wb[c].closeElem(b.querySelector("#t_strk"+
virtualclass.gObj.currWb+" .strkSizeList")),virtualclass.wb[c].closeElem(b.querySelector("#t_font"+virtualclass.gObj.currWb+" .fontSizeList")),virtualclass.wb[c].closeElem(b.querySelector("#colorList"+virtualclass.gObj.currWb));this.parentNode.id!="t_replay"+c&&this.parentNode.id!="t_clearall"+c&&this.parentNode.id!="t_reclaim"+c&&this.parentNode.id!="t_assign"+c&&(f=(new Date).getTime(),virtualclass.wb[c].lt=this.parentNode.id,f={cmd:this.parentNode.id.split(/_doc_*/)[0],mt:f},virtualclass.wb[c].uid++,
f.uid=virtualclass.wb[c].uid,a.main.replayObjs.push(f),virtualclass.storage.store(JSON.stringify(a.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[f],cf:"repObj"}));this.parentNode.id!="t_clearall"+c&&(virtualclass.wb[c].prvTool=this.parentNode.id,virtualclass.wb[c].prvToolInfo=f);f=b.querySelector("#t_font"+c);a=b.querySelector("#t_strk"+c);this.parentNode.id=="t_text"+c?(f.classList.contains("hide")&&(f.classList.remove("hide"),f.classList.add("show")),a.classList.add("hide")):(a.classList.contains("hide")&&
(a.classList.remove("hide"),a.classList.add("show")),f.classList.add("hide"))}},toggleDisplay:function(a,c){var f=b.querySelector("#colorList"+c);if(a=="t_color"+c)f.classList.contains("open")?(f.classList.remove("open"),f.classList.add("close")):(f.classList.contains("close")&&f.classList.remove("close"),f.classList.add("open"));else if(a=="t_strk"+c||a=="t_font"+c)virtualclass.wb[c].closeElem(f),a=a=="t_strk"+c?b.querySelector("#"+a+" .strkSizeList"):b.querySelector("#"+a+" .fontSizeList"),a.classList.contains("open")?
(a.classList.remove("open"),a.classList.add("close")):(a.classList.contains("close")&&a.classList.remove("close"),a.classList.add("open"))},changeToolProperty:function(a,c){var f=(new Date).getTime();if("color"==a){var g=b.querySelector("#colorList"+virtualclass.gObj.currWb+" .selected").id;virtualclass.wb[virtualclass.gObj.currWb].activeToolColor=c;b.querySelector("#t_color"+virtualclass.gObj.currWb+" .disActiveColor").style.backgroundColor=virtualclass.wb[virtualclass.gObj.currWb].activeToolColor;
g={color:c,elem:g,mt:f}}else"strk"==a?(g=b.querySelector("#t_strk"+virtualclass.gObj.currWb+" .selected").id,virtualclass.wb[virtualclass.gObj.currWb].currStrkSize=c,g={strkSize:c,elem:g,mt:f}):"font"==a&&(g=b.querySelector("#t_font"+virtualclass.gObj.currWb+" .selected").id,virtualclass.wb[virtualclass.gObj.currWb].textFontSize=c,g={fontSize:c,elem:g,mt:f});c=virtualclass.wb[virtualclass.gObj.currWb].vcan;virtualclass.wb[virtualclass.gObj.currWb].uid++;g.uid=virtualclass.wb[virtualclass.gObj.currWb].uid;
c.main.replayObjs.push(g);virtualclass.storage.store(JSON.stringify(c.main.replayObjs));virtualclass.vutil.beforeSend({repObj:[g],cf:"repObj"})},closeElem:function(a){a.classList.contains("open")&&(a.classList.remove("open"),a.classList.add("close"))},attachToolFunction:function(a,c,f){virtualclass.wb[f].createCommand(c,f);a=b.getElementById(a).getElementsByTagName("div");for(c=0;c<a.length;c++)a[c].getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb[f].objInit)},toolInit:function(a,
c,f,d){var g,k=virtualclass.gObj.currWb;-1>=a.indexOf("_doc_")&&(a+=k);var m=virtualclass.wb[k].vcan;"object"==typeof virtualclass.wb[k].obj.drawTextObj&&1==virtualclass.wb[k].obj.drawTextObj.wmode&&m.main.canvas.getContext("2d");0<m.getStates("children").length?a!="t_clearall"+k&&("undefined"!=typeof f&&a=="t_replay"+k||virtualclass.wb[k].utility.deActiveFrmDragDrop(),1!=f&&"t_replay"!=a&&m.renderAll()):m.main.action="create";virtualclass.wb[k].utility.IsObjEmpty(virtualclass.wb[k].obj.freeDrawObj&&
0==f)||(virtualclass.wb[k].obj.freeDrawObj.freesvg=!1);m.main.currUserCommand=a+"Init";a=="t_activeall"+k?(console.log("command active"),virtualclass.wb[k].utility.t_activeallInit()):a=="t_replay"+k?("undefined"==typeof f&&m.setValInMain("id",0),"undefined"!=typeof d?virtualclass.wb[k].t_replayInit(c,d):virtualclass.wb[k].t_replayInit(c)):a=="t_clearall"+k?("Whiteboard"==virtualclass.currApp?g=virtualclass.lang.getString("clearAllWarnMessageW"):"DocumentShare"==virtualclass.currApp&&(g=virtualclass.lang.getString("clearAllWarnMessageD")),
virtualclass.popup.confirmInput(g,function(c){if(!c)return!0;console.log("Whiteboard clear init "+k);virtualclass.wb[k].utility.t_clearallInit();virtualclass.wb[k].utility.makeDefaultValue(a);virtualclass.storage.wbDataRemove(k);virtualclass.vutil.beforeSend({clearAll:!0,cf:"clearAll"});delete virtualclass.gObj.wbTool[virtualclass.gObj.currWb];roles.hasControls()&&(virtualclass.wb[k].currStrkSize=virtualclass.gObj.defalutStrk,virtualclass.wb[k].textFontSize=virtualclass.gObj.defalutFont,virtualclass.wb[k].activeToolColor=
virtualclass.gObj.defaultcolor,b.querySelector("#t_color"+k+" .disActiveColor").style.backgroundColor=virtualclass.wb[k].activeToolColor,c=b.querySelector("#tool_wrapper"+k).dataset.currtool,"triangle"!=c&&"line"!=c&&"oval"!=c&&"rectangle"!=c||delete b.querySelector("#tool_wrapper"+k).dataset.currtool,b.querySelector("#shapeIcon"+k+" a"),c=b.querySelector("#t_strk"+k),null!=c&&c.classList.remove("show"),c=b.querySelector("#t_font"+k),null!=c&&c.classList.remove("show"),c=b.querySelector("#colorList"+
virtualclass.gObj.currWb+" .selected"),null!=c&&c.classList.remove("selected"),c=b.querySelector("#t_strk"+virtualclass.gObj.currWb+" .selected"),null!=c&&(c.classList.remove("selected"),b.querySelector(".strkSizeList #strk-1"+k).classList.add("selected")),c=b.querySelector("#t_font"+virtualclass.gObj.currWb+" .selected"),null!=c&&(c.classList.remove("selected"),b.querySelector(".fontSizeList #font-1"+k).classList.add("selected")),b.querySelector("#tool_wrapper"+virtualclass.gObj.currWb+".shapesToolbox").classList.remove("active"),
localStorage.removeItem("activeTool"))})):a=="t_assign"+k?(c=localStorage.getItem("toolHeight"),null!=c?virtualclass.vutil.beforeSend({assignRole:!0,toolHeight:c,socket:virtualclass.wb[k].socketOn}):virtualclass.vutil.beforeSend({assignRole:!0,socket:virtualclass.wb[k].socketOn,cf:"assignRole"})):"t_reclaim"==a&&virtualclass.wb[k].utility._reclaimRole();a!="t_replay"+k&&a!="t_clearallInit"+k&&a!="t_assign"+k&&a!="t_reclaim"+k&&(virtualclass.wb[k].tool=new virtualclass.wb[k].tool_obj(a),virtualclass.wb[k].utility.attachEventHandlers(k))},
tool_obj:function(a){if(-1<a.indexOf("_doc_")){var c=b.querySelector("#"+a);c=null==c?virtualclass.gObj.currWb:virtualclass.vutil.getWhiteboardId(c)}else c=virtualclass.gObj.currWb,a+=c;this.cmd=a;a!="t_freeDrawing"+c&&(virtualclass.wb[c].obj.freeDrawObj="");a=="t_text"+c||virtualclass.vutil.exitTextWrapper()||(virtualclass.wb[c].obj.drawTextObj="");a=="t_freeDrawing"+c?(virtualclass.wb[c].obj.freeDrawObj=new virtualclass.wb[c].readyFreeHandObj("#424240","3"),virtualclass.wb[c].obj.freeDrawObj.init()):
a=="t_text"+c&&(virtualclass.wb[c].obj.drawTextObj=new virtualclass.wb[c].readyTextObj,virtualclass.wb[c].obj.drawTextObj.init("canvasWrapper"+c));a=a.slice(2,a.length);-1<a.indexOf("_doc_")&&(a=a.substring(0,a.indexOf("_")));virtualclass.wb[c].draw_object(a,virtualclass.wb[c].canvas,this)},t_replayInit:function(a,c){var b=virtualclass.gObj.currWb;"fromFile"==a?(virtualclass.gObj.chat.removeAllChat(),virtualclass.wb[b].recordAudio=!0,virtualclass.recorder.init()):(virtualclass.wb[b].replay=virtualclass.wb[b]._replay(),
"undefined"!=typeof c?(virtualclass.wb[b].replay.init(a,c),virtualclass.wb[b].replay.renderObj(c)):(virtualclass.wb[b].replay.init(a),virtualclass.wb[b].replay.renderObj()))}}}})(window,document);(function(d){d.utility=function(){return{userIds:[],isObjExistRE:function(b){var a=virtualclass.gObj.currWb;if(0<=virtualclass.wb[a].replay.removeElements.length&&(a=virtualclass.wb[a].vcan.ArrayIndexOf(virtualclass.wb[a].replay.removeElements,function(a){return a.id==b.id}),0<=a))return a},IsObjEmpty:function(b){for(var a in b)if(b.hasOwnProperty(a))return!1;return!0},stringToNumber:function(b){" "==b[b.length-1]&&(b=b.substring(0,b.length-1));return b=Number(b)},clickOutSidebox:function(b){return 1!=
b%2?!0:!1},keyOperation:function(b){var a=virtualclass.gObj.currWb;8==b.keyCode||46==b.keyCode?(b=virtualclass.wb[a].vcan,""!=b.main.currObj&&roles.hasControls()&&(console.log("Delete whiteboard obj:- Invoke the command"),a=virtualclass.wb[a].utility.removeSelectedItem(b.main.currObj),virtualclass.vutil.beforeSend({repObj:[a],cf:"repObj"}))):27==b.keyCode&&("Whiteborad"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||"object"!=typeof virtualclass.wb[a]||virtualclass.wb[a].obj.drawTextObj.finalizeTextIfAny())},
removeSelectedItem:function(b,a,c){var f=virtualclass.gObj.currWb,g=virtualclass.wb[f].vcan;virtualclass.wb[f].canvas.removeObject(g.main.currObj);b={mt:(new Date).getTime(),ac:"del"};"undefined"==typeof a&&virtualclass.wb[f].uid++;b.uid=virtualclass.wb[f].uid;roles.hasControls()?"undefined"==typeof c&&(console.log("Delete:- Saving the delete command with id "+b.uid),g.main.replayObjs.push(b),virtualclass.storage.store(JSON.stringify(g.main.replayObjs))):virtualclass.storage.store(JSON.stringify(virtualclass.wb[f].gObj.replayObjs));
g.main.currObj="";console.log("Delete:- Removing the whitboard object");return b},attachEventHandlers:function(b){virtualclass.wb[b].canvas.bind("mousedown",virtualclass.wb[b].utility.ev_canvas);virtualclass.wb[b].canvas.bind("mousemove",virtualclass.wb[b].utility.ev_canvas);virtualclass.wb[b].canvas.bind("mouseup",virtualclass.wb[b].utility.ev_canvas);virtualclass.wb[b].canvas.bind("touchstart",virtualclass.wb[b].utility.ev_canvas);virtualclass.wb[b].canvas.bind("touchmove",virtualclass.wb[b].utility.ev_canvas);
virtualclass.wb[b].canvas.bind("touchend",virtualclass.wb[b].utility.ev_canvas)},t_clearallInit:function(){virtualclass.wb[virtualclass.gObj.currWb].currStrkSize=virtualclass.gObj.defalutStrk;virtualclass.wb[virtualclass.gObj.currWb].textFontSize=virtualclass.gObj.defalutFont;virtualclass.wb[virtualclass.gObj.currWb].activeToolColor=virtualclass.gObj.defaultcolor;virtualclass.wb[virtualclass.gObj.currWb].utility.clearAll(!0)},clearAll:function(b,a){a=virtualclass.gObj.currWb;console.log("Whiteboard clear "+
a);virtualclass.wb[a].uid=0;virtualclass.wb[a].lt="";for(var c=virtualclass.wb[virtualclass.gObj.currWb].vcan;0<c.main.children.length;)virtualclass.wb[a].canvas.removeObject(c.main.children[0]);1==b&&c.main.replayObjs.splice(0,c.main.replayObjs.length);void 0!=virtualclass.wb[a].replay&&(virtualclass.wb[a].replay.objNo=0);"move"==c.getStates("action")&&c.setValInMain("action","create");b=document.getElementById("sendPackCont");if(null!=b&&(b=b.getElementsByClassName("numbers"),0<b.length))for(a=
0;a<b.length;a++)b[a].innerHTML=0;b=document.getElementById("serverErrorCont");null!=b&&(b.parentNode.removeChild(b),console.log("Some ERROR removed."));virtualclass.vutil.removeAllTextWrapper();virtualclass.wb[virtualclass.gObj.currWb].currStrkSize=virtualclass.gObj.defalutStrk;virtualclass.wb[virtualclass.gObj.currWb].textFontSize=virtualclass.gObj.defalutFont;virtualclass.wb[virtualclass.gObj.currWb].activeToolColor=virtualclass.gObj.defaultcolor},deActiveFrmDragDrop:function(){var b=virtualclass.wb[virtualclass.gObj.currWb].vcan,
a=b.main.children;if("move"==b.getStates("action")){b.setValInMain("action","create");for(b=0;b<a.length;b++)a[b].dragDrop(!1),a[b].setActive(!1);return!0}return!1},getOffset:function(b){for(var a=b.target,c=y=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,y+=a.offsetTop-a.scrollTop,a=a.offsetParent;c=b.clientX-c;y=b.clientY-y;return{x:c,y:y}},ev_canvas:function(b){var a=virtualclass.gObj.currWb,c=virtualclass.wb[a].vcan.utility.getReltivePoint(b);b.currX=c.x;b.currY=
c.y;if(a=virtualclass.wb[a].tool[b.type])return a(b),this.ev_canvas},t_activeallInit:function(){var b=virtualclass.wb[virtualclass.gObj.currWb].vcan,a=b.getStates("children");if(1<=a.length)for(b.setValInMain("action","move"),b=0;b<a.length;b++)a[b].dragDrop(!0)},drawArrowImg:function(b,a){var c=virtualclass.wb[virtualclass.gObj.currWb].vcan,f=c.main.canvas.getContext("2d");f.clearRect(0,0,c.main.canvas.width,c.main.canvas.height);c.renderAll();f.save();f.beginPath();f.translate(a.mp.x,a.mp.y);f.drawImage(b,
-3,-3,18,24);f.closePath();f.restore()},assignRole:function(b){var a=virtualclass.gObj.currWb;virtualclass.wb[a].tool="";"move"==vcan.main.action&&virtualclass.wb[a].utility.deActiveFrmDragDrop();if("undefined"!=typeof b)roles.isEducator()&&(b=document.getElementById(virtualclass.gObj.commandToolsWrapperId),b.parentNode.removeChild(b)),virtualclass.gObj.uRole="p",localStorage.setItem("uRole",virtualclass.gObj.uRole),virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.currApp),vcan.utility.canvasCalcOffset(vcan.main.canid),
"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.inputURL(),virtualclass.yts.seekChangeInterval());else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));virtualclass.gObj.uRole="s";b=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=b)for(;b.hasChildNodes();)b.removeChild(b.lastChild);virtualclass.wb[a].utility.makeCanvasDisable();roles.hasAdmin()?(virtualclass.vutil.createReclaimButton(b),
virtualclassCont=document.getElementById("virtualclassCont"),virtualclassCont.className+=" educator"):null!=b&&b.parentNode.removeChild(b);localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.wb[a].utility.uniqueArrOfObjsToStudent()}},reclaimRole:function(){var b=virtualclass.gObj.currWb;virtualclass.gObj.controlAssign=!1;virtualclass.wb[b].response.assignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},dispQueuePacket:function(b){b=virtualclass.gObj.currWb;(roles.hasControls()||
roles.isEducator())&&virtualclass.wb[b].utility.toolWrapperEnable();virtualclass.wb[b].drawMode=!1;roles.hasControls()&&(virtualclass.wb[b].utility.makeCanvasEnable(),virtualclass.wb[b].utility.enableAppsBar())},makeCanvasDisable:function(){virtualclass.wb[virtualclass.gObj.currWb].vcan.main.canvas.style.pointerEvents="none"},makeCanvasEnable:function(){var b=virtualclass.gObj.currWb,a=virtualclass.wb[b].vcan;!roles.hasControls()||virtualclass.wb[b].hasOwnProperty("canvasDisable")&&virtualclass.wb[b].canvasDisable||
(a.main.canvas.style.pointerEvents="visible")},removeToolBox:function(b){b=document.getElementById("commandToolsWrapper"+b);b.parentNode.removeChild(b)},createReclaimButton:function(b){var a=virtualclass.gObj.currWb;virtualclass.vutil.createDiv("t_reclaim","reclaim",b);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb[a].objInit)},chkValueInLocalStorage:function(b){return null===localStorage.getItem(b)?!1:localStorage[b]},uniqueArrOfObjsToStudent:function(){var b=
virtualclass.gObj.currWb,a=virtualclass.wb[b].vcan;virtualclass.wb[b].gObj.replayObjs=[];for(var c=0;c<a.main.replayObjs.length;c++){var f=a.extend({},a.main.replayObjs[c]);virtualclass.wb[b].gObj.replayObjs.push(f)}},uniqueArrOfObjsToTeacher:function(){var b=virtualclass.gObj.currWb,a=virtualclass.wb[b].vcan;a.main.replayObjs=[];for(var c,f=0;f<virtualclass.wb[b].gObj.replayObjs.length;f++)c=a.extend({},virtualclass.wb[b].gObj.replayObjs[f]),a.main.replayObjs.push(c)},makeDefaultValue:function(b){var a=
virtualclass.gObj.currWb;"undefined"!=typeof b&&"t_clearall"==b||virtualclass.wb[a].utility.makeDeActiveTool();virtualclass.wb[a].gObj.myrepObj=[];virtualclass.wb[a].gObj.replayObjs=[];virtualclass.wb[a].gObj.rcvdPackId=0;virtualclass.wb[a].gObj.displayedObjId=0;virtualclass.wb[a].gObj.packQueue=[];virtualclass.wb[a].gObj.queue=[];virtualclass.wb[a].uid=0;localStorage.setItem("rcvdPackId",0);virtualclass.vutil.chkValueInLocalStorage("wbrtcMsg");virtualclass.vutil.chkValueInLocalStorage("canvasDrwMsg");
virtualclass.vutil.chkValueInLocalStorage("toolHeight");JSON.parse(virtualclass.vutil.chkValueInLocalStorage("prvUser"));JSON.parse(virtualclass.vutil.chkValueInLocalStorage("tc"));virtualclass.media.audio.bufferSize=0;virtualclass.media.audio.encMode="alaw";virtualclass.media.audio.rec="";virtualclass.media.audio.audioNodes=[];b=virtualclass.wb[a].vcan;"undefined"!=typeof b.objTxt&&b.objTxt.removeTextNode();"undefined"!=typeof b.main.currentTransform&&(b.main.currentTransform="");virtualclass.media.audio.updateInfo()},
clearCurrentTool:function(){var b=virtualclass.gObj.currWb;virtualclass.wb[b].hasOwnProperty("tool")&&(virtualclass.wb[b].tool="")},setOrginalTeacherContent:function(){localStorage.setItem("canvasDrwMsg",!0)},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(b){var a=virtualclass.gObj.currWb;virtualclass.wb[a].gObj.virtualWindow=!0;var c=document.createElement("div");
virtualclass.wb[a].utility.removeVirtualWindow("virtualWindow");c.setAttribute("id","virtualWindow");c.style.width=b.width+"px";"undefined"!=typeof assignRoleAtStudent?a=0:(a=parseInt(localStorage.getItem("toolHeight")),a=null!=a?a:0);roles.hasAdmin()?c.style.height=b.height+a+"px":roles.hasControls()?c.style.height=b.height+"px":c.style.height=b.height-a+"px";b=document.getElementById("containerWb");b.insertBefore(c,b.firstChild)},removeVirtualWindow:function(b){var a=virtualclass.gObj.currWb;b=
document.getElementById(b);null!=b&&(virtualclass.wb[a].gObj.virtualWindow=!1,b.parentNode.removeChild(b))},getWideValueAppliedByCss:function(b,a){b=document.getElementById(b);if(null!=b){a=d.getComputedStyle(b);if("undefined"!=typeof a.marginTop){var c=parseInt(a.marginTop.match(/\d+/));null==c&&(c=0)}return b.clientHeight+c}return!1},isNumber:function(b){return isNaN(+b)?!1:+b},setCommandToolHeights:function(b,a){var c=document.getElementById("virtualWindow");if(null!=c){var f=parseInt(c.style.height.match(/\d+/));
c.style.height="decrement"==a?f-parseInt(b)+"px":f+parseInt(b)+"px"}},setClass:function(b,a){b=document.getElementById(b);var c=b.classList,f="";0<c.length&&(f=2>f.length?c[0]+" ":c.join(" ")+" ");b.setAttribute("class",f+a)},setStyleUserConnetion:function(b,a,c){b=document.getElementsByClassName(b)[0];null!=b&&b.setAttribute("class",a+" controlCmd")},existUserLikeMe:function(b){if(b.fromUser.userid!=wbUser.id){if(b.message.checkUser.hasOwnProperty("role")){var a=b.message.checkUser.role;if(a){if(null==
localStorage.getItem("otherRole")){var c=[];if(a!=virtualclass.gObj.uRole)c.push(a);else return existUser=!0}else c=JSON.parse(localStorage.getItem("otherRole")),-1==c.indexOf(a)&&c.push(a);"undefined"!=typeof c&&(localStorage.setItem("otherRole",JSON.stringify(c)),console.log("Other Browser "+a+" "+b.fromUser.userid))}return virtualclass.gObj.uRole==a?!0:!1}}else{if("undefined"!=typeof existUser)return!0;b=JSON.parse(localStorage.getItem("otherRole"));if(null!=b){for(c=0;c<b.length;c++)if(virtualclass.gObj.uRole==
b[c])return!0;return!1}}},existUserWithSameId:function(b){var a=virtualclass.gObj.currWb;this.userIds.push(b.fromUser.userid);if(1<this.userIds.length&&virtualclass.wb[a].utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable:function(){var b=virtualclass.gObj.currWb;null==localStorage.getItem("repObjs")&&(virtualclass.wb[b].utility.toolWrapperEnable(),null!=vcan.main.canvas&&virtualclass.wb[b].utility.makeCanvasEnable())},displayCanvas:function(b){virtualclass.wb[b].vcan.canvasWrapperId=
"canvasWrapper"+b;null==document.getElementById("canvas"+b)&&virtualclass.wb[b].createCanvas(b);d.virtualclass.wb[b].init(b);virtualclass.wb[b].utility.makeCanvasDisable();virtualclass.wb[b].utility.toolWrapperDisable();roles.hasControls()||roles.hasAdmin();roles.hasControls()||"Whiteboard"!=virtualclass.currApp||"undefined"!==typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currSlide)},removeWhiteboardMessage:function(){var b=document.getElementById("whiteBoardMsg");
null!=b&&b.parentNode.removeChild(b)},createWhiteboardMessage:function(){if(null==document.getElementById("whiteBoardMsg")){var b=document.createElement("div");b.id="whiteBoardMsg";b.innerHTML=virtualclass.lang.getString("msgForWhiteboard");var a=document.getElementById("canvasWrapper"+virtualclass.gObj.currWb);null!=a&&a.appendChild(b)}},initAll:function(b){b=virtualclass.gObj.currWb;roles.hasControls()&&virtualclass.wb[b].utility.makeCanvasDisable();virtualclass.system.measureResoultion({width:d.outerWidth,
height:d.innerHeight})},alreadyExistToolBar:function(b){b=document.getElementById("t_rectangle"+b);return null!=b?4<=b.parentNode.getElementsByClassName("tool").length?!0:!1:!1},toolWrapperDisable:function(b){var a=document.getElementById("commandToolsWrapper");if(null!=a)if("undefined"!=typeof b)for(b=a.getElementsByTagName("a"),a=0;a<b.length;a++)b[a].style.pointerEvents="none";else a=document.getElementById("commandToolsWrapper"),null!=a&&(a.style.pointerEvents="none")},toolWrapperEnable:function(b){var a=
document.getElementById("commandToolsWrapper");if(null!=a)if("undefined"!=typeof b)for(b=a.getElementsByTagName("a"),a=0;a<b.length;a++)b[a].style.pointerEvents="visible";else null==a||virtualclass.gObj.hasOwnProperty("errNotDesktop")||(a.style.pointerEvents="visible")},replayFromLocalStroage:function(b){console.log("PDF, Whiteboard is intializing");var a=virtualclass.gObj.currWb;"undefined"!==typeof Storage&&(!1===virtualclass.storage.reclaim&&virtualclass.vutil.disableAppsBar(),virtualclass.wb[a].utility.clearAll(!1,
"dontClear"),virtualclass.wb[a].gObj.tempRepObjs=b,0<b.length&&(virtualclass.wb[a].utility.makeCanvasDisable(),virtualclass.wb[a].utility.toolWrapperDisable(),virtualclass.wb[a].gObj.displayedObjId=0,virtualclass.wb[a].utility.replayObjsByFilter(b,"fromBrowser")))},setUserStatus:function(b,a){var c=virtualclass.gObj.currWb;b||a?virtualclass.wb[c].utility.setClass("vcanvas","teacher"):(virtualclass.wb[c].utility.removeToolBox(c),virtualclass.wb[c].utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(b){roles.hasControls()&&
null==localStorage.getItem("canvasDrwMsg")&&(localStorage.canvasDrwMsg=!0)},arrayContainsSameValue:function(b,a){for(var c=0;c<a.length;c++)if(a[c]!==b)return!1;return!0},actionAfterRemovedUser:function(){var b=virtualclass.gObj.currWb;virtualclass.wb[b].utility.makeCanvasDisable();virtualclass.wb[b].utility.setStyleUserConnetion("con","coff");virtualclass.wb[b].utility.removeVirtualWindow("virtualWindow");virtualclass.wb[b].user.connected=!1;wb[b];localStorage.removeItem("otherRole");"undefined"!=
typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"})},updateSentInformation:function(b,a){if(roles.hasAdmin()){b=JSON.parse(b);a="undefined"!=typeof a?b:b.repObj[0];b="";for(var c in a)b+=c+" : "+a[c]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=b)}},beforeSend:function(b,a){var c=virtualclass.gObj.currWb;if(b.hasOwnProperty("createArrow")){var f=
JSON.stringify(b);virtualclass.wb[c].vcan.optimize.sendPacketWithOptimization(f,300)}else{if(b.hasOwnProperty("repObj")){if("undefined"==typeof b.repObj[b.repObj.length-1])return;virtualclass.wb[c].gObj.rcvdPackId=b.repObj[b.repObj.length-1].uid;virtualclass.wb[c].gObj.displayedObjId=virtualclass.wb[c].gObj.rcvdPackId}f=JSON.stringify(b);io.webSocketConnected()&&("undefined"==typeof a?ioAdapter.mustSend(b):ioAdapter.mustSendUser(b,a));JSON.parse(f).hasOwnProperty("repObj")&&virtualclass.wb[c].utility.updateSentInformation(f)}},
checkCanvasHasParents:function(){for(var b=document.getElementById("vcanvas");"BODY"!=b.parentNode.tagName;)"vcanvas"!=b.id&&(b.style.margin="0",b.style.padding="0"),b=b.parentNode;"vcanvas"!=b.id&&(b.style.margin="0",b.style.padding="0")},lockvirtualclass:function(){var b=virtualclass.gObj.currWb;d.earlierWidth!=d.innerWidth&&(virtualclass.wb[b].canvasDisable=!0,virtualclass.wb[b].utility.makeCanvasDisable(),virtualclass.wb[b].utility.toolWrapperDisable(),virtualclass.vutil.disableAppsBar(),null==
document.getElementById("divForReloadMsg")&&(b=roles.hasControls()?"msgForReload":"msgStudentForReload",d.virtualclass.view.displayMsgBox("divForReloadMsg",b),d.earlierWidth=d.innerWidth))},getElementRightOffSet:function(b){var a=20;null!=b.parentNode&&(b=b.parentNode,a=vcan.utility.getElementOffset(b),a=d.innerWidth-(b.clientWidth+(a.x-0)));return a},objPutInContainer:function(b){vcan.main.replayObjs.push(b);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))},makeActiveTool:function(b){var a=
virtualclass.gObj.currWb,c=document.getElementById(b);if(virtualclass.wb[a].hasOwnProperty("prvTool")&&virtualclass.wb[a].prvTool!="t_reclaim"+a){var f=virtualclass.vutil.removeClassFromElement(virtualclass.wb[a].prvTool,"active");document.getElementById(virtualclass.wb[a].prvTool).className=f}else f=c.className;virtualclass.wb[a].utility.themeColorShapes(b);c.className=f+" active";localStorage.activeTool=c.id},themeColorShapes:function(b){b=b.split(/_doc_*/)[0];var a=document.querySelector("#tool_wrapper"+
virtualclass.gObj.currWb+".shapesToolbox");"t_line"==b||"t_oval"==b||"t_rectangle"==b||"t_triangle"==b?a.classList.add("active"):a.classList.remove("active")},makeDeActiveTool:function(){virtualclass.wb[virtualclass.gObj.currWb].tool="";document.getElementById("commandToolsWrapper");var b=document.getElementsByClassName("tool active");0<b.length&&b[0].classList.remove("active")},createAudioTransmitIcon:function(b){var a=document.cteateElement("div");a.id="audioTransmit"+uuserId;a.className="audioTransmit";
document.getElementById(b+"ControlContainer")},_reclaimRole:function(){var b=virtualclass.gObj.currWb;virtualclass.wb[b].utility.reclaimRole();virtualclass.wb[b].utility.sendRequest();virtualclass.user.control.changeAttrToAssign("enable")},enableAppsBar:function(){var b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.pointerEvents="visible")},replayObjsByFilter:function(b,a){for(var c=virtualclass.gObj.currWb,f=0;f<b.length;f++){virtualclass.wb[c].bridge.makeQueue(b[f]);if(b[f].hasOwnProperty("cmd")){if(roles.hasControls()){var g=
b[f].cmd.slice(2,b[f].cmd.length),k=document.querySelector("#tool_wrapper"+c),d=document.querySelector("#tool_wrapper"+virtualclass.gObj.currWb+".shapesToolbox");"triangle"==g||"line"==g||"oval"==g||"rectangle"==g?(document.querySelector("#shapeIcon"+c+" a").dataset.title=g.charAt(0).toUpperCase()+g.slice(1),k.dataset.currtool=g,d.classList.add("active")):(document.querySelector("#shapeIcon"+c+" a").dataset.title="Shapes",k.dataset.currtool="shapes",d.classList.remove("active"))}}else b[f].hasOwnProperty("color")?
(virtualclass.wb[c].activeToolColor=b[f].color,roles.hasControls()&&(document.querySelector("#t_color"+c+" .disActiveColor").style.backgroundColor=virtualclass.wb[c].activeToolColor,virtualclass.wb[c].utility.selectElem("#colorList"+c,b[f].elem))):b[f].hasOwnProperty("strkSize")?(virtualclass.wb[c].currStrkSize=b[f].strkSize,roles.hasControls()&&(document.querySelector("#t_strk"+c+" ul").dataset.stroke=virtualclass.wb[c].currStrkSize,virtualclass.wb[c].utility.selectElem("#t_strk"+c,b[f].elem))):
b[f].hasOwnProperty("fontSize")&&(virtualclass.wb[c].textFontSize=b[f].fontSize,roles.hasControls()&&(document.querySelector("#t_font"+c+" ul").dataset.font=virtualclass.wb[c].textFontSize,virtualclass.wb[c].utility.selectElem("#t_font"+c,b[f].elem)));b[f].uid==virtualclass.wb[c].gObj.displayedObjId+1&&(virtualclass.wb[c].uid=b[f].uid,this.executeWhiteboardData(b[f]),"undefined"!=typeof a&&(virtualclass.wb[c].gObj.rcvdPackId=virtualclass.wb[c].uid))}0<virtualclass.wb[c].gObj.replayObjs.length&&virtualclass.storage.store(JSON.stringify(virtualclass.wb[c].gObj.replayObjs));
roles.hasControls()&&(b=document.querySelector("#t_font"+c),a=document.querySelector("#t_strk"+c),virtualclass.wb[c].tool.cmd=="t_text"+c?(b.classList.contains("hide")&&(b.classList.remove("hide"),b.classList.add("show")),a.classList.add("hide")):b.classList.contains("hide")||b.classList.add("hide"))},selectElem:function(b,a){var c=document.querySelector(b+" .selected");null!=c&&c.classList.remove("selected");b=document.querySelector(b+" #"+a);null!=b&&b.classList.add("selected")},executeWhiteboardData:function(b){var a=
virtualclass.gObj.currWb;virtualclass.wb[a].gObj.replayObjs.push(b);virtualclass.wb[a].response.replayObj([b]);this.checkNextQueue(b)},checkNextQueue:function(b){(b=this.findPacketInQueue(b))&&this.executeWhiteboardData(b)},findPacketInQueue:function(b){var a=virtualclass.gObj.currWb;b.hasOwnProperty("color")?virtualclass.wb[a].activeToolColor=b.color:b.hasOwnProperty("strkSize")?virtualclass.wb[a].currStrkSize=b.strkSize:b.hasOwnProperty("fontSize")&&(virtualclass.wb[a].textFontSize=b.fontSize);
return virtualclass.wb[a].gObj.queue.hasOwnProperty(b.uid+1)?virtualclass.wb[a].gObj.queue[b.uid+1]:!1},putScrollWithCevent:function(b){return b=this.scaleCordinate(b)},scaleCordinate:function(b){b.detail.cevent.x*=virtualclass.zoom.canvasScale;b.detail.cevent.y*=virtualclass.zoom.canvasScale;return b},scaleMoveCordinate:function(b){b.x=ev.detail.cevent.x/virtualclass.zoom.canvasScale;b.y=ev.detail.cevent.y/virtualclass.zoom.canvasScale;return b}}}})(window);(function(d){d.message={ActiveAll:"Active all",Addoption:"Add option",addnew:"Add new",adminusr:"Admin user",appPrerequites:"Validate app prerequisites",assign:"Assign",assignDisable:"Reclaim controls",askplayMessage:'<span id="askplaymsg"> Should we start playing the session?</span><br /><span id="remaingmsg">Remaining data will be downloaded in the background.</span>',askplaymsg:'<span id="askplaymsg"> "Downloading in progress, click Play to begin </span>"',audioInput:"Audio input",audiolatency:"Audio latency",
audioOutput:"Audio output",audioDisable:"Unmute",audioEnable:"Mute",audioTest:"Your voice will be recorded and played back to you. \n Press Ok and speak something for few seconds.",Back:"Back",bandfast:"Bandwidth is high",bandmedium:"Bandwidth is medium",bandslow:"Bandwidth is low",becomeTeacher:"Become teacher",Binary_Limit_Exeed:"Warning: High BN usage",bulkUserActions:"Bulk user actions",ByInstructor:"By instructor",ByTimer:"By timer",cancel:"Cancel",canvasDrawMsg:"You can click on any tool for drawingclick and hold the left mouse button to draw",
canvasmissing:"Canvas is missing in your browser. Please update your browser to the latest version.",chatEnable:"Disable chat",Chatroom:"Chatroom",ClearAll:"Clear all",clickheretoplay:"Click Here To Play",clicktoplay:"Play",chatDisable:"Enable chat",chFireBrowsersIssue:"Your browser {virtualclass1} {virtualclass2} needs updation, Congrea support Chrome 40+ and Firefox 35+.",clearAllWarnMessageW:"Do you really want to clear this whiteboard?",clearAllWarnMessageD:"Do you really want to clear this drawings?",
closedsDbheading:"Close document dashboard",closeSharePresentationdbHeading:"Close presentation dashboard",closevideoDashboard:"Close video dashboard",closeVoting:"Close voting",cnmissing:"Chunk number is missing",CodeEditor:"Code editor",cof:"Connection off",collaborate:"Collaborate",commonChat:"Common chat",commonBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is not supported, Congrea support Chrome and Firefox.",congreainchrome:"Your browser is compatible.",confirmCancel:"No",confirmOk:"Yes",
Controls:"Controls",coursePoll:"Course level poll",Cpoll:"Course poll",Cquiz:"Close quiz",createnewpoll:"Create new poll",Creator:"Creator",dap:"false","delete":"Delete",delblank:"Remove the blank option",Delete:"Delete",DevicesNotFoundError:"Webcam is not available, or not connected properly.",deletepopup:"Are you sure to delete ?",disable:"Disable",disabled:"disabled",disableAllVideo:"Disable all video",dltDisabled:"Can be deleted  by creator of the poll",documentShare:"Share document",DocumentSharing:"Document sharing",
DocumentSharedbHeading:"Document dashboard",docUploadSuccess:"Document uploaded successfully",download:"Download",downloadFile:"Download file",downloadsession:"Please wait while the recording is downloaded",drawArea:"Draw area",dropfilehere:"Drop files here",duplicateUploadMsg:"This file already exists, please upload new file.",edit:"Edit",editorCode:"Code editor",edittitle:"Edit title",editorRichDisable:"Write mode",editorRichEnable:"Read only",educator:"Educator",EHTMLPresentUrl:"Enter HTML5 presentation URL",
enable:"Enable",enablehistory:'"Browser history" should be enabled during the session.',enableAllVideo:"Enable all video",enteryouryoutubeurl:"Enter YouTube/online video URL",etDisabledA:"Can\u2019t edit, poll attempted",etDisabledCr:"Can be edited by creator of the poll",ETime:"Elapsed time",FF2:"Fast forward 2",FF8:"Fast forward 8",filenotsave:"Your file could not be saved.",filetsaveTS:"The session is ready to save.",Finish:"Finish",fitToScreen:"Fit to screen",Freehand:"Free hand",general:"General",
Greport:"Grade report",highBandWidthSpeed:"Your bandwidth is good enough.",httpsmissing:"Only secure origins(https) are allowed for screen sharing.",ieBrowserIssue:"Internet Explorer is not supported, Congrea fully support Chrome  and Firefox.",ios7support:"For Apple, Virtual Class supports iOS 8 and higher versions.",iosAudEnable:"Tap here to enable the audio",InternalError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications. ",invalidcmid:"Invalid course module Id.",
invalidurl:"Invalid URL",indvprogress:"Current task",InsertimageURL:"Insert image URL",JoinClassMsg:"Join ClassRoom",JoinSession:"Join session",keymissing:"Your software(LMS/CMS)'s key is is missing",Line:"Line",lowBandWidthSpeed:"Your bandwidth is too low, we are stopping video playback. You will still be able to hear audio and view screen.",maxCommonChat:"Show chat window",Max_rooms:"Error: Max rooms limit reached",Max_users:"Error: Max users limit reached",media:"Media",mediumBandWidthSpeed:"Your bandwidth is limited, we are reducing video quality based on your available bandwidth.",
minCommonChat:"Hide chat window",minoption:"Enter at least two options",mictesting:"Microphone is working, if above audio bar fluctuates <br />and you are able to hear your own voice, while you speak",minute:"Minute",ModeclosingPoll:"Mode of closing Poll :",msgForDownloadStart:"Unable to save data. <br /> Preparing data for download",msgForReload:"Please reload this page to continue editing.",msgForWhiteboard:"Empty whiteboard.",msgStudentForReload:"Please reload this page.",Multiple_login:"Error: Access denied, multiple logins",
muteAll:"Mute all",muteAllAudio:"Mute all audio",mybsharedoc:"Document will shared shortly",NAME:"NAME",Next:"Next",nomdlroot:"There is no url for momodle root.",noResultStd:"You are not permitted to see the result",NotAllowedError:"Webcam is disabled",NotFoundError:"Webcam is not available, or not connected properly.",NotReadableError:"Please ensure that same webcam is not being used <br /> in multiple browsers or multiple applications.",notSupportBrowser:"Firefox {virtualclass1} does not support Screen sharing.",
notsupportbrowser:"{virtualclass1} is not fully compatible. For the best experience, use Google Chrome.",NotSupportedError:"Only secure origins(https) are allowed for audio and video",notSupportIphone:"Sorry. Virtual class doesn't support mobile phones.",noPoll:"There is no question available for poll. Go to \u2018Add new\u2019 to create question.",noPollNoAdmin:"There is no question available for site poll .Only admin can create site level poll.",noQuiz:"No quiz available. Congrea supports only mutliple choice questions",
Novote:"No vote received for this poll",nowebcam:"Webcam is not available, or not connected properly.",offcollaboration:"Collaboration off",oncollaboration:"Collaboration on",opendsDbheading:"Document dashboard",openSharePresentationdbHeading:"Presentation dashboard",openvideoDashboard:"Video dashboard",operaBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is partially supported. You will not be able to share your screen, Congrea fully support chrome and Firefox",Options:"Options",optselectd:"OPTION SELECTED",
Oval:"Oval",overallprogress:"Overall progress",Pause:"Pause",pclosetag:"<span>Are you sure to close this poll?  </span>",pclose:"Are you sure to close voting?",Pclosed:"Poll closed",pdfnotrender:"There is problem with loading window, please reload browser.",Pdsuccess:"Poll deleted successfully",PEdit:"Poll edit",PermissionDeniedError:"Webcam access has been denied.",PERMISSION_DENIED:"You denied access to your Webcam(camera/microphone).",Play:"Play",playsessionmsg:"Click \u2018play\u2019 to start the session.",
pleasewaitWhSynNewCont:"Please wait a while. Syncing new content.",plswaitwhile:"Please wait....",poll:"Poll",pollblank:"Question can not be left blank",pollCancel:"Close",pollDel:"Are you sure to delete this poll?",pollHead:"Vote this poll",pollmaybeshown:"Poll will be published",pollmybpublish:"Poll will be published shortly",pollresult:"Previous result",ppoll:"Publish poll",PQuestions:"Poll questions",PQuiz:"Publish quiz",Precheck:"Precheck",precheckStart:"Start",prechkcmplt:"Precheck complete",
Presult:"Poll result",preWllBshortly:"Presentation will be shared shortly",Prev:"Prev",proposedspeed:"Proposed speed",PSetting:"Poll setting",Publish:"Publish",QClosed:"Quiz closed",Question:"Question",Quiz:"Quiz","Quiz/page":"Quiz / page",Quizes:"Quizzes",quizmayshow:"Get ready for a quiz",quizreviewpublish:"Review & publish quiz",RaiseHandStdDisabled:"Undo raise hand",RaiseHandEnable:"Hand raised",raiseHandNotify:"Student(s) raised hand",RaiseHandStdEnabled:"Raise hand",readonlymode:"Read only",
receivedVotes:"Received votes",reclaim:"Reclaim",Rectangle:"Rectangle",rejected:"Another application on your computer might be using your webcam. Kindly close all other applications",reload:"Reload",reloadDoc:"Reload document",replay:"Re-play",Replay:"Replay from start.",replay_message:"Thanks for watching.",requestScreenShare:"Request screen share",Reset:"Reset",Rtime:"Remaining time",rusureCquiz:"<span>Are you sure to close this quiz? </span>",rvtu:"Votes received/ total users",safariBrowserIssue:"Your browser Safari {virtualclass1} is not supported, We fully support Chrome  and Firefox",
Save:"Save",savesession:"Do you want to save current session?",savesessionTechSupport:"Do you want to save current session? <br /> Once you download the session, Updates won't be available on re-downloading of same session.",screensharealready:"The screen is being shared.",ScreenShare:"Screen share",screensharemsg:"The above screen is being shared.",second:"Second",selfview:"Self view",SetTimer:"Set timer",sesseionkeymissing:"Session key is missing from Front End.",sentPackets:"Sent <br/><span>Packets</span>",
SessionEnd:"Session end",sessionendmsg:"Session has been closed. You may now close your browser.",setting:"Setting",Searchuser:"Search user",share:"Share",ShareVideo:"Share video",shareAnotherYouTubeVideo:"Share another YouTube video",SharePresentation:"Share presentation",SharePresentationdbHeading:"Presentation dashboard",sharetoall:"Share to all",Showresulttostudents:"Show result to students",sitePoll:"Site level poll",Skip:"Close",someproblem:"There is some problem in uploading file. Please try again.",
SourceUnavailableError:"Please ensure that same webcam is not being used in multiple browsers or multiple applications.",speakerTest:"If you can hear music, speakers are working.",Spoll:"Site poll",ssBtn:"Stop sharing",ssStop:"Stop screen sharing",startnewsession:"Do you really want to end this session?",status:"Status",stdPublish:"stdPublish",stdscreenshare:"Do you want to share your screen ?",studentAudEnable:"Student audio enabled",studentSafariBrowserIssue:"Your browser {virtualclass1} {virtualclass2} cannot  share your webcam with other users, Congrea fully support Chrome  and Firefox.",
supportDesktop:"Virtual Class does not support tablets or mobiles. To present please use a desktop.",supportDesktopOnly:"Sorry, presenter mode only supports desktops. Tablets and Mobile devices are not supported.",teacherSafariBrowserIssue:"Safari does not support presenter functionality. Please switch to Chrome or Firefox.",techsupport:"Tech support",testingbrowser:"Testing browser compatibility",testinginternetspeed:"Testing internet speed",testingmichrophone:"Testing microphone",testingspeaker:"Testing speaker",
testingwebcam:"Testing webcam",Text:"Text",Text_Limit_Exeed:"Warning: High TX usage",TextEditor:"Text editor",Time:"Time",Tmyclose:"Teacher may close this poll at any time",total:"Total",totalprogress:"Total progress",tpAudioTest:"Test audio",transferControls:"Transfer controls",Triangle:"Triangle",Udocument:"Upload document",Unauthenticated:"Error: Access invalid",unmuteAll:"Unmute all",uploadsession:"Please wait until processing is complete",uploadvideo:"Upload video",uploadedsession:"Your session has ended. You may now close the window  or close this popup to start a new session.",
usermissing:"User is missing",userList:"User's list",validateurlmsg:"Invalid URL",VCE2:"No permission to recording session",VCE4:"Record data is missing",VCE5:"Unable to Record Data.",VCE6:"Course module is missing.",VideodbHeading:"Video dashboard",videoInput:"Video input",videooff:"Video off",videoon:"Video on",videoquality:"Video quality",VotedSoFar:"Votes received so far",votesuccess:"Your vote has been submitted successfully. Result will be displayed shortly.",votesuccessPbt:"Vote submitted successfully, you are not permitted to see the result.",
Vwllbshrshortly:"Video will be shared shortly",waitmsgconnect:"Please wait a while. Application is trying to connect.",watstdrespo:"Waiting for student\u2019s response",wbrtcMsgChrome:"You can click the deny button for not sharing your microphone and camera  with Congrea.or click allow button to share them.",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your mic and camera feed with other users',webcamerainfo:"If video is visible, webcam is working.",Whiteboard:"Whiteboard",
writemode:"Write mode",youtubeshare:"YouTube video share",youTubeUrl:"Enter YouTube video URL",zoomIn:"Zoom in",zoomOut:"Zoom out",noain:"No audio input",noaout:"No audio output",novideo:"No video",enableAllAudio:"Unmute All",disableAllAudio:"Mute All",colorSelector:"Color",strk:"Stroke size",font:"Font size",black:"black","dark-gray-4":"dark gray 4","dark-gray-3":"dark gray 3","dark-gray-2":"dark gray 2","dark-gray-1":"dark gray 1",gray:"gray","light-gray-1":"light gray 1","light-gray-2":"light gray 2",
"light-gray-3":"light gray 3",white:"white","red-berry":"red berry",red:"red",orange:"orange",yellow:"yellow",green:"green",cyan:"cyan","cornflower-blue":"cornflower blue",blue:"blue",purple:"purple",magenta:"magenta","light-red-berry-3":"light red berry 3","light-red-berry-2":"light red berry 2","light-red-berry-1":"light red berry 1","dark-red-berry-1":"dark red berry 1","dark-red-berry-2":"dark red berry 2","dark-red-berry-3":"dark red berry 3","light-red-3":"light red 3","light-red-2":"light red 2",
"light-red-1":"light red 1","dark-red-1":"dark red 1","dark-red-2":"dark red 2","dark-red-3":"dark red 3","light-orange-3":"light orange 3","light-orange-2":"light orange 2","light-orange-1":"light orange 1","dark-orange-1":"dark orange 1","dark-orange-2":"dark orange 2","dark-orange-3":"dark orange 3","light-yellow-3":"light yellow 3","light-yellow-2":"light yellow 2","light-yellow-1":"light yellow 1","dark-yellow-1":"dark yellow 1","dark-yellow-2":"dark yellow 2","dark-yellow-3":"dark yellow 3",
"light-green-3":"light green 3","light-green-2":"light green 2","light-green-1":"light green 1","dark-green-1":"dark green 1","dark-green-2":"dark green 2","dark-green-3":"dark green 3","light-cyan-3":"light cyan 3","light-cyan-2":"light cyan 2","light-cyan-1":"light cyan 1","dark-cyan-1":"dark cyan 1","dark-cyan-2":"dark cyan 2","dark-cyan-3":"dark cyan 3","light-cornflower-blue-3":"light cornflower blue 3","light-cornflower-blue-2":"light cornflower blue 2","light-cornflower-blue-1":"light cornflower blue 1",
"dark-cornflower-blue-1":"dark cornflower blue 1","dark-cornflower-blue-2":"dark cornflower blue 2","dark-cornflower-blue-3":"dark cornflower blue 3","light-blue-3":"light blue 3","light-blue-2":"light blue 2","light-blue-1":"light blue 1","dark-blue-1":"dark blue 1","dark-blue-2":"dark blue 2","dark-blue-3":"dark blue 3","light-purple-3":"light purple 3","light-purple-2":"light purple 2","light-purple-1":"light purple 1","dark-purple-1":"dark purple 1","dark-purple-2":"dark purple 2","dark-purple-3":"dark purple 3",
"light-magenta-3":"light magenta 3","light-magenta-2":"light magenta 2","light-magenta-1":"light magenta 1","dark-magenta-1":"dark magenta 1","dark-magenta-2":"dark magenta 2","dark-magenta-3":"dark magenta 3",Shapes:"Shapes",PermissionDeniedErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
SecurityErrorExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExt:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top right of the screen <br /> Click on "Always allow..." option and select the camera option <br />  Click on done and refresh the screen  </div> <div class="screenImages"> <figure class="chrome" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-video.png" > <figcaption>Chrome</figcaption> </figure></div>',
chromeExtMiss:"Congrea needs 'Desktop Selector' plugin to share the Screen.<br />You can download this from <a href='https://chrome.google.com/webstore/detail/desktop-selector/ijhofagnokdeoghaohcekchijfeffbjl' target='_blank'>HERE.</a>",PermissionDeniedErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
screensharereload:"Screen is not being shared. Please reload for the sharing.",SecurityErrorExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',nopermissionExtFF:'<div class="errorMsg"> Camera access has been blocked.To provide webcam access, kindly follow below procedure <br />Go to camera icon on top left of the screen <br /> Click on "Share Selected Device." option.<div class="screenImages"><figure class="firefox" > <img src="https://www.congrea.com/wp-content/uploads/2016/10/ff-screnshare.png" > <figcaption>Chrome</figcaption> </figure></div>',
TypeError:"Your webcam is not initialized properly. Please reload the page.",newPage:"Insert page"}})(window);(function(d){d.getString=function(b,a){b=d.virtualclass.lang.message[b];if("undefined"!=typeof a&&0<a.length)for(var c=0;c<a.length;c++)b=b.replace(new RegExp("{virtualclass"+(c+1)+"}"),a[c]);return b}})(window);(function(d){var b,a={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(a,b,g,k,d,n){a="undefined"==typeof d?this.createMsgBox(a,b,g):this.createMsgBox(a,b,g,d);b=document.getElementById("vcanvas"+n);"undefined"!=typeof k?document.getElementById(k+n).appendChild(a):b.insertBefore(a,b.childNodes[0])},createErrorMsg:function(a,b,g,k){var c="error";var f=document.getElementById(b);if(null==f)f=document.createElement("div"),f.id=b;else if(null!=
k&&k.hasOwnProperty("className")){var d=document.querySelector("#"+b+"."+k.className);null!=d&&d.parentNode.removeChild(d);c+=" "+k.className}f.innerHTML='<span className="'+c+'">'+a+"</span>";a=document.querySelector("#closeMsg");null==a&&(a=document.createElement("span"),a.id="closeMsg",a.innerHTML="X",f.appendChild(a));a.onclick=function(){var a=document.querySelector("#"+b);a.parentNode.removeChild(a)};g=document.getElementById(g);g.parentNode.insertBefore(f,g);return f.id},removeErrorMsg:function(a,
b){a=document.getElementById(a);if("undefined"!=typeof b&&(b=a.innerHTML.split(/<br>|<br\\>/),1<b.length)){b.shift();a.innerHTML=b.join();return}a.parentNode.removeChild(a)},removeErrorContainer:function(a){a=document.getElementById(a);a.parentNode.removeChild(a)},customCreateElement:function(a,b,g){a=document.createElement(a);"undefined"!=typeof b&&""!=b&&(a.id=b);"undefined"!=typeof g&&(a.className=g);return a},createMsgBox:function(a,b,g,k){var c=this.customCreateElement("div",b,g);"undefined"==
typeof k&&(g=this.customCreateElement("div",b+"img",g+"img"),c.appendChild(g));b=this.customCreateElement("p",b+"Para");b.innerHTML=a;c.appendChild(b);return c},disappearBox:function(a){a=document.getElementsByClassName(this.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])},multiMediaMsg:function(a){"Firefox"==virtualclass.system.mybrowser.name?virtualclass.lang.getString("wbrtcMsgFireFox"):"Chrome"==virtualclass.system.mybrowser.name&&virtualclass.lang.getString("wbrtcMsgChrome")},canvasDrawMsg:function(a,
b){document.getElementById("vcanvas"+b).classList.add("canvasMsgBoxParent");if("Firefox"==virtualclass.system.mybrowser.name){var c=virtualclass.lang.getString("canvasDrawMsg");this.displayMessage(c,"canvasDrawMsgContFirefox",this.msgBoxClass+a,"containerWb")}else"Chrome"==virtualclass.system.mybrowser.name&&(c=virtualclass.lang.getString("canvasDrawMsg"),this.displayMessage(c,"canvasDrawMsgContChrome",this.msgBoxClass+a,"containerWb",null,b))},drawLabel:function(a,b){var c=virtualclass.lang.getString("drawArea");
this.displayMessage(c,"canvasDrawArea",this.msgBoxClass+a,"containerWb",!1,b)},displayMsgBox:function(a,b){var c=this.customCreateElement("div",a),f=this.customCreateElement("p",a+"Para");f.innerHTML=virtualclass.lang.getString(b);c.appendChild(f);b=this.customCreateElement("a",a+"Anchor");b.href="#";b.innerHTML=virtualclass.lang.getString("reload");b.onclick=function(){d.location.reload()};c.appendChild(b);a=document.getElementById("divForReloadMsg"==a?"virtualclassCont":"virtualclassAppLeftPanel");
a.insertBefore(c,a.firstChild)},displayServerError:function(a,b){a=this.customCreateElement("div",a);a.innerHTML=b;b=document.getElementById("vcanvas");b.parentNode.insertBefore(a,b)},removeElement:function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)},disableSSUI:function(){var a=document.getElementById("virtualclassScreenShareTool");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},disableLeftAppBar:function(){var a=document.getElementById("virtualclassOptionsCont");
null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")}};a=a.init();count=0;a.window.resizeFinished=function(){var a=0;return function(c,b){clearTimeout(a);a=setTimeout(c,b)}}();a.window.resize=function(c){c=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});"DocumentShare"==virtualclass.currApp&&(c.width-=10,roles.hasControls()?c.height-=100:c.height-=40);virtualclass.vutil.setContainerWidth(c,virtualclass.currApp);c=virtualclass.gObj.currWb;"undefined"!=typeof c&&
"undefined"!=typeof virtualclass.wb[c]&&virtualclass.wb[c].hasOwnProperty("vcan")&&virtualclass.wb[c].vcan.renderAll();a.windowResizeFinished()};a.windowResizeFinished=function(){clearTimeout(b);b=setTimeout(function(){a._windowResizeFinished()},100)};a._windowResizeFinished=function(){"mobTab"==virtualclass.system.device&&vhCheck();"Whiteboard"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||null==virtualclass.gObj.currWb||"undefined"==typeof virtualclass.gObj.currWb||(virtualclass.gObj.hasOwnProperty("fitToScreenOnResize")&&
clearTimeout(virtualclass.gObj.fitToScreenOnResize),virtualclass.gObj.fitToScreenOnResize=setTimeout(function(){var a=document.querySelector(".zoomControler .fitScreen");null!=a&&a.click()},700))};a.virtualWindow.manupulation=function(a){var c=a.message.virtualWindow;if(c.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&virtualclass.wb[virtualclass.gObj.currWb].utility.removeVirtualWindow("virtualWindow");else if(c.hasOwnProperty("createVirtualWindow"))c.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",c.toolHeight),a.fromUser.userid!=wbUser.id&&virtualclass.wb[virtualclass.gObj.currWb].utility.createVirtualWindow(c.createVirtualWindow);else if(c.hasOwnProperty("shareBrowserWidth")){c.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",c.toolHeight);if(roles.hasControls()){var b=virtualclass.wb[virtualclass.gObj.currWb].utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",b)}a.fromUser.userid!=wbUser.id?(roles.hasControls()&&
virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasEnable(),otherBrowser=c.browserRes):myBrowser=virtualclass.system.measureResoultion({width:d.outerWidth,height:d.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>otherBrowser.width?virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow||(virtualclass.wb[virtualclass.gObj.currWb].utility.createVirtualWindow(otherBrowser),virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow=!0):myBrowser.width<
otherBrowser.width&&!virtualclass.wb[virtualclass.gObj.currWb].gObj.virtualWindow&&(a=document.getElementById("vcanvas"),a=virtualclass.wb[virtualclass.gObj.currWb].utility.getElementRightOffSet(a),roles.hasControls()?virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a,toolHeight:b}}):virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}})))}};d.view=a})(window);(function(d){var b={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(a,c,b){console.log("is canvas support");console.log(a);console.log(c);return"MSIE"==c?9!=b?!1:!0:d.CanvasRenderingContext2D?!0:!1},isWebSocketSupport:function(a,c,b){return"undefined"==typeof d.WebSocket||"function"!=typeof d.WebSocket&&"object"!=typeof d.WebSocket||!d.WebSocket.hasOwnProperty("OPEN")?!1:!0},isLocalStorageSupport:function(){return void 0!==Storage},
isGetUserMediaSupport:function(a,c){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return navigator.getUserMedia?!0:!1},isIndexedDbSupport:function(){return d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.msIndexedDB?!0:!1},isWorkerSupport:function(){return!!d.Worker},isAudioApiSupport:function(){return d.AudioContext||d.webkitAudioContext?!0:!1},isTypedArraySupport:function(){return!!("ArrayBuffer"in d)},isScreenShareSupport:function(a,
c){return"Firefox"==a?34<=c:"Chrome"==a?39<=c?!0:!1:!1},setValue:function(a,c){this[a]=c},checkBrowserFunctions:function(a,c){this.setValue("canvas",this.isCanvasSupport());this.setValue("webSocket",this.isWebSocketSupport());this.setValue("getusermedia",this.isGetUserMediaSupport());this.setValue("indexeddb",this.isIndexedDbSupport());this.setValue("webworker",this.isWorkerSupport());this.setValue("webaudio",this.isAudioApiSupport());this.setValue("typedarray",this.isTypedArraySupport());this.setValue("screenshare",
this.isScreenShareSupport(a,c));this.setValue("localstorage",this.isLocalStorageSupport())},measureResoultion:function(a){if(!virtualclass.gObj.hasOwnProperty("measureDimension")){var c=document.getElementById("virtualclassCont");c=virtualclass.vutil.getElementOffset(c);var b=c.x;b=1024>a.width?1024-(b+10):a.width-(b+350);virtualclass.gObj.measureDimension={width:b,height:a.height-c.y}}return virtualclass.gObj.measureDimension},setAppDimension:function(a,c){},setDocCanvasDimension:function(a,c,b){b=
document.querySelector("#canvas"+b);null!=b&&(b.width=a,b.height=c)},setCanvasDimension:function(a,c){if("object"==typeof virtualclass.wb[c]){var b=virtualclass.wb[c].vcan;if("undefined"!=typeof b.main.canvas){var g=b.main.canvas;ctx=b.main.canvas.getContext("2d");g.width=a.width;var k=document.querySelector("#canvasWrapper"+virtualclass.gObj.currWb);k.style.width=g.width+"px";var d=virtualclass.isPlayMode?85:15;d=roles.hasControls()||roles.hasAdmin()?100:"Whiteboard"==virtualclass.currApp?d+30:d;
g.height=a.height-d;k.style.height=g.height-30+"px";console.log("canvasWrapper height"+k.style.height);console.log("canvas width "+g.width);a=b.utility.getElementOffset(document.getElementById("canvas"+c));b.main.offset.x=a.x;console.log("canvas offset x="+b.main.offset.x+" canvas offset y="+a.y)}}},setCanvasWrapperDimension:function(a,c){console.log("Width of canvas wrapper, not seeting ")},getResoultion:function(a){var c={};1280>a?(c.width=1024,c.height=768):1280<=a&&1366>a?(c.width=1280,c.height=
1024):1366<=a&&1920>a?(c.width=1366,c.height=768):1920<=a&&(c.width=1920,c.height=1080);return c},reportBrowser:function(a){a=this.getErrors(a);1<a.length?virtualclass.error.push(a.join(",")+" are disabled in your browser."):1==a.length&&virtualclass.error.push(a+" is disabled in your browser.")},getErrors:function(a){var c=[],b="canvas webSocket getusermedia webaudio indexeddb localstorage typedarray".split(" ");"t"!=a&&"e"!=a||b.push("webworker","screenshare");for(a=0;a<b.length;a++)this[b[a]]||
("screenshare"==b[a]&&(virtualclass.gObj.errNotScreenShare=!0),c.push(virtualclass.lang.getString("err"+b[a])));return c},isiOSDevice:function(){return parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},isAndroid:function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")},isIPad:function(){return/(iPad)/g.test(navigator.userAgent)},setBrowserDetails:function(){var a=
this.isiOSDevice();this.device="desktop";if(a){var c="iOS";this.device="mobTab"}else a=this.mybrowser.detection(),c=a[0],a=parseFloat(a[1]);this.mybrowser.name=c;this.mybrowser.version=a},check:function(){var a=this.isiOSDevice();this.device="desktop";var c=document.getElementById("virtualclassCont");if(a){var b="iOS";this.device="mobTab"}else{var g=this.isAndroid();a=this.mybrowser.detection();b=a[0];a=parseFloat(a[1])}this.mybrowser.name=b;this.mybrowser.version=a;this.checkBrowserFunctions(b,a);
"undefined"!=typeof g&&g?(this.device="mobTab",c.setAttribute("device","mobile"),c.classList.add("android"),g&&("Chrome"==b?40>a?(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[b,a]))),virtualclass.vutil.initDisableVirtualClass()):40<=a&&67>a&&virtualclass.vutil.initDisableAudVid():(virtualclass.error.push(virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[b,a]))),virtualclass.vutil.initDisableVirtualClass()))):"Chrome"==
b&&40<=a||"Firefox"==b&&35<=a||roles.isStudent()&&b=="OPR">a>=26?this.reportBrowser(virtualclass.gObj.uRole):"Chrome"==b&&40>a||"Firefox"==b&&35>a||roles.isStudent()&&"OPR"==b&&26>a?(this.reportBrowser(virtualclass.gObj.uRole),virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[b,a]))):"OPR"==b&&26<=a?(this.reportBrowser(virtualclass.gObj.uRole),roles.hasControls()&&virtualclass.error.push(virtualclass.lang.getString("operaBrowserIssue",[b,a]))):"SafarisupportedOld"==b?8<=a?
roles.hasControls()?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("teacherSafariBrowserIssue",[b,a]))):(virtualclass.vutil.initDisableAudVid(),virtualclass.error.push(virtualclass.lang.getString("studentSafariBrowserIssue",[b,a])),virtualclass.user.control.mediaWidgetDisable()):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("safariBrowserIssue",[b,a]))):"iOS"==b?(c.setAttribute("device","mobile"),
c.classList.add("ios"),this.isIPad()&&roles.isStudent()&&(8<=a?console.log("do nothing"):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("ios7support"))))):this.mybrowser.detectIE()&&(virtualclass.gObj.errIE=!0,virtualclass.error.push(virtualclass.lang.getString("ieBrowserIssue")),virtualclass.vutil.initDisableVirtualClass())},mediaDevices:{webcamErr:[],getMediaDeviceInfo:function(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&
(navigator.enumerateDevices=function(a){navigator.mediaDevices.enumerateDevices().then(a)});var a=[],c="https:"===location.protocol,b=!1;"undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?b=!0:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(b=!0);var g=this.hasWebcam=this.hasSpeakers=this.hasMicrophone=!1,k=!1,m=this;(function(f){b&&(!navigator.enumerateDevices&&d.MediaStreamTrack&&d.MediaStreamTrack.getSources&&(navigator.enumerateDevices=d.MediaStreamTrack.getSources.bind(d.MediaStreamTrack)),
!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(a=[],navigator.enumerateDevices(function(b){b.forEach(function(b){var f={},d;for(d in b)f[d]=b[d];"audio"===f.kind&&(f.kind="audioinput");"video"===f.kind&&(f.kind="videoinput");var p;a.forEach(function(a){a.id===f.id&&a.kind===f.kind&&(p=!0)});p||(f.deviceId||(f.deviceId=f.id),f.id||(f.id=f.deviceId),f.label?("videoinput"!==f.kind||k||(k=!0),
"audioinput"!==f.kind||g||(g=!0)):(f.label="Please invoke getUserMedia once.",c||(f.label="HTTPs is required to get label of this "+f.kind+" device.")),"audioinput"===f.kind&&(m.hasMicrophone=!0),"audiooutput"===f.kind&&(m.hasSpeakers=!0),"videoinput"===f.kind&&(m.hasWebcam=!0),a.push(f))});f&&f()})):f&&f())})()}},webpInit:function(){virtualclass.modernizr.on("webp",function(a){virtualclass.system.webpSupport=a?!0:!1})},initResize:function(){virtualclass.gObj.hasOwnProperty("measureDimension")&&delete virtualclass.gObj.measureDimension;
virtualclass.gObj.hasOwnProperty("initResize")&&clearTimeout(virtualclass.gObj.initResize);virtualclass.gObj.initResize=setTimeout(function(){virtualclass.vutil.addClass("virtualclassCont","resizeWindow");b.setAppDimension(null,"resize");virtualclass.view.window.resize()},50)},_initResize:function(){virtualclass.vutil.addClass("virtualclassCont","resizeWindow");b.setAppDimension(null,"resize");virtualclass.view.window.resize()}};b=b.init();d.addEventListener("resize",function(){b.initResize()});b.mybrowser.detectIE=
function(){var a=d.navigator.userAgent,c=a.indexOf("MSIE ");if(0<c)return parseInt(a.substring(c+5,a.indexOf(".",c)),10);if(0<a.indexOf("Trident/"))return c=a.indexOf("rv:"),parseInt(a.substring(c+3,a.indexOf(".",c)),10);c=a.indexOf("Edge/");return 17<=c?!1:parseInt(a.substring(c+5,a.indexOf(".",c)),10)};b.mybrowser.detection=function(){var a=navigator.userAgent,c=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(c[1])){var b=/\brv[ :]+(\d+)/g.exec(a)||
[];var g={name:"IE",version:b[1]||""}}"Chrome"===c[1]&&(b=a.match(/\b(OPR|Edge)\/(\d+)/),null!=b&&(g={name:b[1].replace("OPR","Opera"),version:b[2]}));c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(b=a.match(/version\/(\d+)/i))&&(c.splice(1,1,b[1]),g={name:c[0],version:c[1]});return"undefined"!=typeof g?[g.name,g.version]:c};d.system=b})(window);(function(d){d.packContainer=function(){return{createPacketContDiv:function(b,a){var c=document.createElement("div");"undefined"!=typeof b&&(c.id=b);"undefined"!=typeof a&&(c.clasName=a);return c},togglePacketCont:function(b){for(var a=this.className.split(" "),c=0;c<a.length;c++)if("display"==a[c]){this.className="hide";this.innerHTML="+";b._togglePacketCont(a[c]);break}else if("hide"==a[c]){this.className="display";this.innerHTML="-";b._togglePacketCont(a[c]);break}},_togglePacketCont:function(b){b=
"display"==b?"none":"block";document.getElementById("dataInfoHeading").style.display=b;var a=document.getElementById("packetContainer");a.style.display=b;a=document.getElementById("informationCont");a.style.display=b}}}})(window);(function(d){d.draw_object=function(b,a,c){var f=this;c.started=!1;var g,k,d=[],n=virtualclass.wb[virtualclass.gObj.currWb].vcan;c.mousedown=function(a,b){c._mousedown(a,b)};c.mousemove=function(a,b){c._mousemove(a,b)};c.mouseup=function(a,b){c._mouseup(a,b)};c.touchstart=function(a,b){c._mousedown(a,b);a.preventDefault()};c.touchmove=function(a,b){c._mousemove(a,b);a.preventDefault()};c.touchend=function(a,b){c._mouseup(a,b);a.preventDefault()};c._mousedown=function(a,g){var k=virtualclass.gObj.currWb;
(new Date).getTime();a.detail.hasOwnProperty("cevent")&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.scaleCordinate(a),a.clientX=a.detail.cevent.x+f.vcan.main.offset.x,a.clientY=a.detail.cevent.y+f.vcan.main.offset.y,a.x=a.detail.cevent.x+f.vcan.main.offset.x,a.y=a.detail.cevent.y+f.vcan.main.offset.y,a.pageX=a.detail.cevent.x+f.vcan.main.offset.x,a.pageY=a.detail.cevent.y+f.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);g=f.vcan;lastmousemovetime=null;c.startPosX=
a.currX;c.startPosY=a.currY;virtualclass.wb[k].gObj.spx=c.startPosX;virtualclass.wb[k].gObj.spy=c.startPosY;if("create"==g.getStates("action")){var d=(new Date).getTime();if("text"!=b&&f.tool.cmd!="t_clearall"+k){if(k=g.getStates("currentTransform"),""==k||null==k)a.detail.hasOwnProperty("cevent")||g.optimize.calculatePackets(d,"d",c.startPosX,c.startPosY),c.started=!0}else f.obj.drawTextObj.muser=!1,a.detail.hasOwnProperty("cevent")||f.tool.cmd=="t_clearall"+k?f.obj.drawTextObj.muser=!0:f.utility.clickOutSidebox(f.obj.drawTextObj.textWriteMode)&&
(g=virtualclass.wb[virtualclass.gObj.currWb].vcan,void 0!=g.main.currentTransform&&""!=g.main.currentTransform?g.optimize.calculatePackets(d,"d",c.startPosX,c.startPosY,"foundtext"):g.optimize.calculatePackets(d,"d",c.startPosX,c.startPosY)),a.detail.hasOwnProperty("cevent")?a.detail.cevent.hasOwnProperty("mtext")?f.obj.drawTextObj.textUtility(c.startPosX,c.startPosY,a.detail.cevent.mtext):f.obj.drawTextObj.textUtility(c.startPosX,c.startPosY):"object"==typeof f.obj.drawTextObj&&f.obj.drawTextObj.textUtility(c.startPosX,
c.startPosY)}"freeDrawing"==b&&1==f.obj.freeDrawObj.freesvg&&f.obj.freeDrawObj.drawStart(a)};c._mousemove=function(a,m){a.detail.hasOwnProperty("cevent")&&(a=virtualclass.wb[virtualclass.gObj.currWb].utility.scaleCordinate(a),a.clientX=a.detail.cevent.x+f.vcan.main.offset.x,a.clientY=a.detail.cevent.y+f.vcan.main.offset.y,a.x=a.detail.cevent.x+f.vcan.main.offset.x,a.y=a.detail.cevent.y+f.vcan.main.offset.y,a.pageX=a.detail.cevent.x+f.vcan.main.offset.x,a.pageY=a.detail.cevent.y+f.vcan.main.offset.y,
a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);if(c.started&&"t_clearall"!=f.tool.cmd)if(void 0!=f.obj.freeDrawObj&&1==f.obj.freeDrawObj.freesvg){if(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&(f.obj.freeDrawObj.wb_draw(a),!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))){"undefined"!=typeof m||"undefined"!=typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),n.optimize.calculatePackets(lastmousemovetime,
"m",a.currX,a.currY));var p=(new Date).getTime();a=n.makeStackObj(p,"m",a.currX/virtualclass.zoom.canvasScale,a.currY/virtualclass.zoom.canvasScale);d.push(a);if("undefined"==typeof m&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-lastmousemovetime)){for(a=0;a<d.length;a++)f.uid++,d[a].uid=f.uid,n.main.replayObjs.push(d[a]);virtualclass.vutil.beforeSend({repObj:d,cf:"repObj"});virtualclass.storage.store(JSON.stringify(n.main.replayObjs));d=[];lastmousemovetime=(new Date).getTime()}}}else{g=
a.currX;k=a.currY;""!=f.prvObj&&f.canvas.removeObject(f.prvObj);m=f.makeobj(c.startPosX,c.startPosY,g,k,b);m=f.canvas.readyObject(m);f.canvas.addObject(m);m.coreObj.usrCurrAction="create";p=(new Date).getTime();if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&"text"!=b&&"t_clearall"!=f.tool.cmd&&n.optimize.calculatePackets(p,"m",g,k);
presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&"text"!=b&&"t_clearall"!=f.tool.cmd&&n.optimize.calculatePackets(p,"m",g,k),lastmousemovetime=(new Date).getTime());f.prvObj=m.coreObj}else"move"==f.vcan.main.action&&(""!=n.main.currentTransform&&null!=n.main.currentTransform||"move"!=f.vcan.main.action)||virtualclass.vutil.beforeSend({createArrow:!0,
x:a.currX/virtualclass.zoom.canvasScale,y:a.currY/virtualclass.zoom.canvasScale,cf:"createArrow"})};c._mouseup=function(a,m){a.detail.hasOwnProperty("cevent")&&(a.clientX=a.detail.cevent.x+f.vcan.main.offset.x,a.clientY=a.detail.cevent.y+f.vcan.main.offset.y,a.x=a.detail.cevent.x+f.vcan.main.offset.x,a.y=a.detail.cevent.y+f.vcan.main.offset.y,a.pageX=a.detail.cevent.x+f.vcan.main.offset.x,a.pageY=a.detail.cevent.y+f.vcan.main.offset.y,a.currX=a.detail.cevent.x,a.currY=a.detail.cevent.y);g=a.currX;
k=a.currY;lastmousemovetime=null;if(c.started&&"text"!=b){c.mousemove(a,"up");(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&"freeDrawing"!=b&&(m=(new Date).getTime(),n.optimize.calculatePackets(m,"u",g,k));if(void 0!=f.obj.freeDrawObj&&1==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&f.obj.freeDrawObj.finalizeDraw(a),(!a.detail.hasOwnProperty("cevent")||a.detail.hasOwnProperty("cevent")&&a.detail.hasOwnProperty("broadCast"))&&
0<d.length)){m=(new Date).getTime();a=n.makeStackObj(m,"u",g/virtualclass.zoom.canvasScale,k/virtualclass.zoom.canvasScale);d.push(a);for(a=0;a<d.length;a++)f.uid++,d[a].uid=f.uid,n.main.replayObjs.push(d[a]);virtualclass.vutil.beforeSend({repObj:d,cf:"repObj"});virtualclass.storage.store(JSON.stringify(n.main.replayObjs));d=[]}""!=f.prvObj&&(f.prvObj="");f.prvObj="";c.started=!1}f.vcan.wb.sentPack&&(f.vcan.wb.sentPack=!1)}}})(window);(function(d){d.makeobj=function(b,a,c,f,g){var k={mp:{}};k.mp.x=c;k.mp.y=f;var d=2*virtualclass.zoom.canvasScale;if(b>c){var n=c,p=f;c=b;f=a;b=n;a=p;k.dRoad="b2t"}else k.dRoad="t2b";k.type=g;if("rectangle"==g||"triangle"==g)k.sx=b,k.sy=a,k.ex=c,k.ey=f;if("line"==g)k.lineColor="#424240",k.lineWidth=d,k.start={x:b,y:a},k.end={x:c,y:f};else if("rectangle"==g)k.width=c-b,k.height=f-a,k.borderColor="#424240",k.lineWidth=d;else if("oval"==g)k.lineWidth=d,k.borderColor="#424240",k.width=c-b,k.height=f-a,
k.x=c-k.width/2,k.y=f-k.height/2,k.rx=k.width/2,k.ry=k.height/2;else if("triangle"==g)k.lineWidth=d,k.borderColor="#424240";else if("text"==g)return;return k}})(window);newScrollVal=0;
(function(d){d.vcanUtility=function(b){var a=virtualclass.wb[b].vcan;a.utility={canvasCalcOffset:function(c){var b=a.main;c=document.getElementById(c);c=a.utility.getElementOffset(c);roles.hasControls()&&0==c.x&&(c.x=53,c.y=48);return b.offset=c},getElementOffset:function(a){var c=0,b=0;do c+=a.offsetTop||0,b+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:b,y:c}},setVal:function(c,b,g){("scaleX"===b||"scaleY"===b)&&g<c.MIN_SCALE_LIMIT&&(g=c.MIN_SCALE_LIMIT);if("object"==typeof b)for(var f in b)a.utility.setVal(c,f,
b[f]);else"angle"===b?a.utility.setAngle(c,g):c[b]=g;return c},getVal:function(a,b){return a[b]},setAngle:function(a,b){a.theta=b/180*Math.PI;a.angle=b;return a},actualPointer:function(c){var b;var g=b=0;null!=virtualclass.gObj.currWb&&(b="undefined"==typeof virtualclass.pdfRender[virtualclass.gObj.currWb].topPosY?0:virtualclass.pdfRender[virtualclass.gObj.currWb].topPosY,g="undefined"==typeof virtualclass.pdfRender[virtualclass.gObj.currWb].leftPosX?0:virtualclass.pdfRender[virtualclass.gObj.currWb].leftPosX);
return{x:a.utility.pointerX(c)+g,y:a.utility.pointerY(c)+b}},pointerX:function(a){var c=0<=a.type.indexOf("touch")?"touch":"mouse",b=document.documentElement,k=document.body||{scrollLeft:0};return"mouse"==c?("undefined"!=typeof a.clientX?a.clientX:0)+(b.scrollLeft||k.scrollLeft)-(b.clientLeft||0):(a.type="touchend",(a.changedTouches[0]&&"undefined"!=typeof a.changedTouches[0].clientX?a.changedTouches[0].clientX:0)+(b.scrollLeft||k.scrollLeft)-(b.clientLeft||0))},pointerYOld:function(a){var c=document.documentElement,
b=document.body||{scrollTop:0};return("unknown"!=typeof a.clientY?a.clientY:0)+(c.scrollTop||b.scrollTop)-(c.clientTop||0)},pointerY:function(a){var c=0<=a.type.indexOf("touch")?"touch":"mouse",b=document.documentElement,k=document.body||{scrollTop:0};newScrollVal=(b.scrollTop||k.scrollTop)-(b.clientTop||0);return"mouse"==c?("undefined"!=typeof a.clientY?a.clientY:0)+newScrollVal:(a.type="touchend",(a.changedTouches[0]&&"undefined"!=typeof a.changedTouches[0].clientY?a.changedTouches[0].clientY:0)+
newScrollVal)},getReltivePoint:function(c){var b=a.main.offset;c=a.utility.actualPointer(c);return{x:c.x-b.x,y:c.y-b.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(c){a.main.activeObject&&a.main.activeObject.setActive(!1);a.main.activeObject=c;c.setActive(!0);return c},updateObj:function(a){var c={};for(prop in a)"oCoords"!=prop?c[prop]=a[prop]:(c.start={},c.end={},c.start.x=a[prop].tl.x,c.start.y=a[prop].tl.y,c.end.x=a[prop].br.x,c.end.y=a[prop].br.y);return c},setCursorFromEvent:function(a,
b,g){var c=a.upperCanvasEl.style;if(g)if(b=g.findTargetCorner(b))if(b in a.cursorMap)c.cursor=a.cursorMap[b];else if("mtr"===b&&g.hasRotatingPoint)c.cursor=a.rotationCursor;else return c.cursor=this.defaulCursor,!1;else c.cursor=a.hoverCursor;else return c.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return a.main.children},isCeventExist:function(a){return a.hasOwnProperty("detail")?a.hasOwnProperty("cevent"):!1},updateCordinate:function(c){c=a.utility.actualPointer(c);var b={detail:{}};
b.clientX=c.x;b.clientY=c.y;return b}}}})(window);(function(d){d.vcanMain=function(b){var a=virtualclass.wb[b].vcan;a.main.prototype={addObject:function(c){if("object"==typeof c.coreObj){"freehand"!=c.coreObj.type&&a.main.children.push(c.coreObj);var b=a.main.canvas.getContext("2d");a.render(b,c.coreObj)}},removeObject:function(c){a.remove(c)},bind:function(c,b){a.events().bind(a.main.canvas,c,b)},readyObject:function(c,b){c=a.extend({},c);b||void 0!=c.id||(a.main.id++,c.id=a.main.id);c.rotatingPointOffset=40;c.selectable=!0;c.downObj=!1;c.active=
!1;c.cornersize=12;c.padding=0;c.hasControls=!0;c.cornerColor="rgba(102,153,255,0.5)";void 0==c.borderColor&&(c.borderColor="#000");c.flipX=!1;c.flipY=!1;c.draggable=!1;c.hasBorders=!0;c.hasRotatingPoint=!1;c.hideCorners=!1;c.lockRotation=!1;c.MIN_SCALE_LIMIT=.1;c.borderOpacityWhenMoving=.4;c.color=void 0==virtualclass.wb[virtualclass.gObj.currWb].activeToolColor?virtualclass.gObj.defaultcolor:virtualclass.wb[virtualclass.gObj.currWb].activeToolColor;c.stroke=void 0==virtualclass.wb[virtualclass.gObj.currWb].currStrkSize?
virtualclass.gObj.defalutStrk:virtualclass.wb[virtualclass.gObj.currWb].currStrkSize;c.fontSize=void 0==virtualclass.wb[virtualclass.gObj.currWb].textFontSize?virtualclass.gObj.defalutFont:virtualclass.wb[virtualclass.gObj.currWb].textFontSize;c.hasOwnProperty("theta")||(c.theta=0);c.hasOwnProperty("scaleX")||(c.scaleX=1);c.hasOwnProperty("scaleY")||(c.scaleY=1);"line"==c.type?(a.objLine=new a.line,a.objLine.init(c)):"rectangle"==c.type?(a.objRect=new a.rectangle,a.objRect.init(c)):"oval"==c.type?
(a.objOval=new a.oval,a.objOval.init(c)):"triangle"==c.type?(a.objTri=new a.triangle,a.objTri.init(c)):"text"==c.type&&(a.objTxt=new a.text,a.objTxt.init(c));c.getWidth=function(){return this.width*this.scaleX};c.getHeight=function(){return this.height*this.scaleY};c.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);var b=this.theta=this.theta,f=Math.sin(b);b=Math.cos(b);var d={x:this.x-Math.cos(this.angle+this.theta)*this.hypotenuse,y:this.y-Math.sin(this.angle+this.theta)*this.hypotenuse},n={x:d.x+this.currentWidth*b,y:d.y+this.currentWidth*f},p={x:d.x-this.currentHeight*f,y:d.y+this.currentHeight*b};this.oCoords={tl:d,tr:n,br:{x:n.x-this.currentHeight*f,y:n.y+this.currentHeight*b},bl:p,ml:{x:d.x-this.currentHeight/2*f,y:d.y+this.currentHeight/2*b},mt:{x:d.x+this.currentWidth/2*b,y:d.y+this.currentWidth/
2*f},mr:{x:n.x-this.currentHeight/2*f,y:n.y+this.currentHeight/2*b},mb:{x:p.x+this.currentWidth/2*b,y:p.y+this.currentWidth/2*f},mtr:{x:d.x+this.currentWidth/2*b,y:d.y+this.currentWidth/2*f}};this.setCornerCoords();c.findTargetCorner=function(b){var f=a.main.offset;if(!this.hasControls)return!1;var g=a.utility.actualPointer(b);b=g.x-f.x;f=g.y-f.y;for(var d in this.oCoords){if("mtr"===d&&!this.hasRotatingPoint)break;g=a.virtual_box.getImageLines(this.oCoords[d].corner,d);g=a.virtual_box.findCrossPoints(b,
f,g);if(1==g%2&&0!=g)return c.corner=d}return!1};return this};c.drawBorders=function(a){if(this.hasBorders){var c=this.padding,b=2*c;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var f=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),g=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(f,g);f=this.getWidth();g=this.getHeight();a.strokeRect(~~(-(f/2)-c)+.5,~~(-(g/
2)-c)+.5,~~(f+b),~~(g+b));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(c=(this.flipY?g:-g)/2,a.beginPath(),a.moveTo(0,c),a.lineTo(0,c+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};c.drawCorners=function(a){if(this.hasControls){var c=8*virtualclass.zoom.canvasScale,b=c/2,f=this.padding,g=-(this.width/2),d=-(this.height/2),u=c/this.scaleX,q=c/this.scaleY,r=(f+b)/this.scaleY,t=(f+b)/this.scaleX,B=(f+b-c)/this.scaleX;
b=(f+b-c)/this.scaleY;f=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(g-t,d-r,u,q);c=g+this.width-t;a.fillRect(c,d-r,u,q);a.fillRect(g-t,d+f+b,u,q);c=g+this.width+B;a.fillRect(c,d+f+b,u,q);c=g+this.width/2-t;a.fillRect(c,d-r,u,q);c=g+this.width/2-t;a.fillRect(c,d+f+b,u,q);c=g+this.width+B;a.fillRect(c,d+f/2-r,u,q);a.fillRect(g-t,d+f/2-r,u,q);this.hasRotatingPoint&&(c=g+this.width/2-t,g=this.flipY?d+f+this.rotatingPointOffset/this.scaleY-q/2:d-this.rotatingPointOffset/this.scaleY-q/
2,a.fillRect(c,g,u,q));a.restore();return this}};c.setActive=function(a){this.active=!!a;return this};c.dragDrop=function(a){this.draggable=void 0!=a?a:!1};c.setCornerCoords=function(){var c=this.oCoords,b=a.utility.degreesToRadians(45-this.getAngle()),f=Math.sqrt(2*Math.pow(this.cornersize,2))/2,d=f*Math.cos(b);b=f*Math.sin(b);f=Math.sin(this.theta);var p=Math.cos(this.theta);c.tl.corner={tl:{x:c.tl.x-b,y:c.tl.y-d},tr:{x:c.tl.x+d,y:c.tl.y-b},bl:{x:c.tl.x-d,y:c.tl.y+b},br:{x:c.tl.x+b,y:c.tl.y+d}};
c.tr.corner={tl:{x:c.tr.x-b,y:c.tr.y-d},tr:{x:c.tr.x+d,y:c.tr.y-b},br:{x:c.tr.x+b,y:c.tr.y+d},bl:{x:c.tr.x-d,y:c.tr.y+b}};c.bl.corner={tl:{x:c.bl.x-b,y:c.bl.y-d},bl:{x:c.bl.x-d,y:c.bl.y+b},br:{x:c.bl.x+b,y:c.bl.y+d},tr:{x:c.bl.x+d,y:c.bl.y-b}};c.br.corner={tr:{x:c.br.x+d,y:c.br.y-b},bl:{x:c.br.x-d,y:c.br.y+b},br:{x:c.br.x+b,y:c.br.y+d},tl:{x:c.br.x-b,y:c.br.y-d}};c.ml.corner={tl:{x:c.ml.x-b,y:c.ml.y-d},tr:{x:c.ml.x+d,y:c.ml.y-b},bl:{x:c.ml.x-d,y:c.ml.y+b},br:{x:c.ml.x+b,y:c.ml.y+d}};c.mt.corner={tl:{x:c.mt.x-
b,y:c.mt.y-d},tr:{x:c.mt.x+d,y:c.mt.y-b},bl:{x:c.mt.x-d,y:c.mt.y+b},br:{x:c.mt.x+b,y:c.mt.y+d}};c.mr.corner={tl:{x:c.mr.x-b,y:c.mr.y-d},tr:{x:c.mr.x+d,y:c.mr.y-b},bl:{x:c.mr.x-d,y:c.mr.y+b},br:{x:c.mr.x+b,y:c.mr.y+d}};c.mb.corner={tl:{x:c.mb.x-b,y:c.mb.y-d},tr:{x:c.mb.x+d,y:c.mb.y-b},bl:{x:c.mb.x-d,y:c.mb.y+b},br:{x:c.mb.x+b,y:c.mb.y+d}};c.mtr.corner={tl:{x:c.mtr.x-b+f*this.rotatingPointOffset,y:c.mtr.y-d-p*this.rotatingPointOffset},tr:{x:c.mtr.x+d+f*this.rotatingPointOffset,y:c.mtr.y-b-p*this.rotatingPointOffset},
bl:{x:c.mtr.x-d+f*this.rotatingPointOffset,y:c.mtr.y+b-p*this.rotatingPointOffset},br:{x:c.mtr.x+b+f*this.rotatingPointOffset,y:c.mtr.y+d-p*this.rotatingPointOffset}}};c.getAngle=function(){return 180*this.theta/Math.PI};c.setZindex=function(){for(var c,b=0;b<a.main.children.length;b++)if(this.id==a.main.children[b].id){c=a.main.children[b];a.main.children.splice(b,1);break}return" "!=c?(a.main.children.push(c),!0):!1};c.setupCurrentTransform=function(c){var b=a.main,f="drag",g=a.utility.actualPointer(c);
if(c=this.findTargetCorner(c))f="ml"===c||"mr"===c?"scaleX":"mt"===c||"mb"===c?"scaleY":"mtr"===c?"rotate":this.hasRotatingPoint?"scale":"rotate";b.currentTransform={target:this,action:f,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:g.x-this.x,offsetY:g.y-this.y,ex:g.x,ey:g.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};b.currentTransform.original={x:this.x,y:this.y}};"text"!=c.type&&c.setCoords();return a.makeDispObject(c)}}}})(window);(function(d){d.Events=function(b){var a=virtualclass.wb[b].vcan;a.events=function(){return{bind:function(a,b,g){a["on"+b]=g},findTarget:function(c){for(var b,g=a.main.children,d=g.length;d--;)if(g[d]&&a.virtual_box.containsPoint(c,g[d])){b=g[d];break}if(b&&b.selectable)return b}}}}})(window);(function(d){d.Virtualbox=function(b){var a=virtualclass.wb[b].vcan;a.virtual_box={findCrossPoints:function(a,b,g){var c=0,f;for(f in g){var d=g[f];if(!(d.o.y<b&&d.d.y<b||d.o.y>=b&&d.d.y>=b)){if(d.o.x==d.d.x&&d.o.x>=a)var p=d.o.x;else{p=(d.d.y-d.o.y)/(d.d.x-d.o.x);var v=b-0*a;d=d.o.y-p*d.o.x;p=-(v-d)/(0-p)}p>=a&&(c+=1);if(2==c)break}}return c},getImageLines:function(a,b){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(c,
b){var f=a.utility.getReltivePoint(c),d=f.x;f=f.y;var m=a.virtual_box.getImageLines(b.oCoords);return(d=a.virtual_box.findCrossPoints(d,f,m))&&1===d%2||b.findTargetCorner(c)?!0:!1}}}})(window);(function(d){d.Interact=function(b){var a=virtualclass.wb[b].vcan;a.interact={rotateObject:function(c,b){var f=a.main.currentTransform,d=a.main.offset;f.target.lockRotation||a.utility.setVal(f.target,"theta",Math.atan2(b-f.y-d.y,c-f.x-d.x)-Math.atan2(f.ey-f.y-d.y,f.ex-f.x-d.x)+f.theta)},scaleObject:function(c,b,g){var f=a.main.currentTransform,d=a.main.offset;target=f.target;if(!target.lockScalingX||!target.lockScalingY){var n=Math.sqrt(Math.pow(f.ey-f.y-d.y,2)+Math.pow(f.ex-f.x-d.x,2));c=Math.sqrt(Math.pow(b-
f.y-d.y,2)+Math.pow(c-f.x-d.x,2));target.scaling=!0;g?"x"!==g||target.lockUniScaling?"y"!==g||target.lockUniScaling||target.lockScalingY||a.utility.setVal(target,"scaleY",f.scaleY*c/n):target.lockScalingX||a.utility.setVal(target,"scaleX",f.scaleX*c/n):(target.lockScalingX||a.utility.setVal(target,"scaleX",f.scaleX*c/n),target.lockScalingY||a.utility.setVal(target,"scaleY",f.scaleY*c/n))}},translateObject:function(c,b){var f=a.main.currentTransform.target;f.lockMovementX||a.utility.setVal(f,"x",c-
a.main.currentTransform.offsetX);f.lockMovementY||a.utility.setVal(f,"y",b-a.main.currentTransform.offsetY);return f}}}})(window);(function(d){d.Rectangle=function(b){virtualclass.wb[b].vcan.rectangle=function(){return{type:"rectangle",init:function(a){void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,c,b){b=-c.width/2;var f=-c.height/2,d=c.width,m=c.height;a.beginPath();a.strokeStyle=void 0!=c.borderColor?'"'+c.strokeColor+'"':"#000";a.moveTo(b,f);a.stroke();a.strokeStyle=c.color;a.stroke();a.lineWidth=c.stroke;a.stroke();a.lineTo(b+d,f);a.stroke();a.lineTo(b+d,f+m);a.stroke();a.lineTo(b,
f+m);a.stroke();a.lineTo(b,f);a.stroke();a.fillStyle=void 0!=c.fillColor?c.fillColor:" ";a.closePath();a.stroke();void 0!=c.fillColor&&(a.fillStyle=c.fillColor,a.fill())}}}}})(window);(function(d){d.Oval=function(b){virtualclass.wb[b].vcan.oval=function(){return{type:"oval",init:function(a){void 0==a.width&&(a.width=2*a.rx);void 0==a.height&&(a.height=2*a.ry);void 0==a.borderColor&&(a.borderColor="#000000");void 0!=a.fillColor&&(a.fillStyle=a.fillColor);return a},draw:function(a,c,b){a.beginPath();a.save();var f=2*Math.PI;a.lineWidth=c.stroke;var d=c.ry/c.rx;d=d.toFixed(3);0==d&&(d=.01);a.transform(1,0,0,d,0,0);a.arc(b?c.x:0,b?c.y:0,c.rx,0,f,!1);a.strokeStyle=c.color;a.closePath();
void 0!=c.fillStyle&&(a.fillStyle=c.fillStyle,a.fill());void 0!=c.borderColor&&(a.fillStyle=c.borderColor,a.stroke());a.restore()}}}}})(window);(function(d){d.Triangle=function(b){virtualclass.wb[b].vcan.triangle=function(){return{type:"triangle",init:function(a){a.fillStyle=a.fillColor;void 0==a.dRoad&&(a.dRoad="ltr");void 0==a.width&&(a.width=a.ex-a.sx);void 0==a.height&&(a.height=a.ey-a.sy);void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,c,b){a.beginPath();if("t2b"==c.dRoad){var f=c.width/2;b=c.height/2}else f=-c.width/2,b=-c.height/2;a.lineWidth=c.lineWidth;void 0!=c.borderColor&&(a.strokeStyle=
c.borderColor);a.moveTo(-f,b);a.lineTo(0,-b);a.lineTo(f,b);a.lineWidth=c.stroke;a.strokeStyle=c.color;a.closePath();void 0!=c.fillStyle&&(a.fillStyle=c.fillStyle,a.fill());a.stroke()}}}}})(window);(function(d){d.Line=function(b){virtualclass.wb[b].vcan.line=function(){return{type:"line",init:function(a){var c=a.start.x,b=a.start.y,g=a.end.x,d=a.end.y;void 0==a.width&&(a.width=g-c,a.height=d-b);a.x=c+(g-c)/2;a.y=b+(d-b)/2;return a},draw:function(a,c,b){a.beginPath();b=1===c.width?0:c.width/2;var f=1===c.height?0:c.height/2;a.moveTo(1===c.width?0:-c.width/2,1===c.height?0:-c.height/2);a.lineTo(b,f);a.lineWidth=c.stroke;void 0!=c.lineColor&&(a.strokeStyle=c.lineColor);a.strokeStyle=c.color;a.closePath();
a.stroke()}}}}})(window);(function(d){d.Text=function(b){virtualclass.wb[b].vcan.text=function(){return{type:"text",init:function(a){a.lineHeight=1.3;void 0==a.fontSize&&(a.fontSize=30);a.fontSize*=virtualclass.zoom.canvasScale;a.font=a.fontSize+"px Times New Roman";return a},draw:function(a,c,b){a.font=c.fontSize+"px Times New Roman";a.fillStyle=c.color;b=c.text.split(/\r?\n/);c.height=this.getTextHeight(a,b,c);c.width=this.getTextWidth(a,b);a.beginPath();for(var f=0,d=b.length;f<d;f++)a.fillText(b[f],-c.width/2,-c.height/
2+f*c.fontSize*c.lineHeight+c.fontSize);a.closePath();c.setCoords()},getTextWidth:function(a,c){for(var b=a.measureText(c[0]).width,g=1,d=c.length;g<d;g++){var m=a.measureText(c[g]).width;m>b&&(b=m)}return b},getTextHeight:function(a,c,b){return b.fontSize*c.length*b.lineHeight},removeTextNode:function(){for(var a=document.getElementsByClassName("textBoxContainer"),c=0;c<a.length;c++)a[c].parentNode.removeChild(a[c])}}}}})(window);(function(d){d.FreeHandDrawing=function(b){var a=virtualclass.wb[b].vcan;a.main.freeHandDrawing=function(c){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==c.borderColor?"#0000ff":void 0!=virtualclass.wb[virtualclass.gObj.currWb].activeToolColor?virtualclass.wb[virtualclass.gObj.currWb].activeToolColor:"#0000ff";this.freeDrawingLineWidth=virtualclass.wb[virtualclass.gObj.currWb].currStrkSize*
virtualclass.zoom.canvasScale;return this},fhdStart:function(a,c,b){b=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(c.x);this.freeDrawingYPoints.push(c.y);this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(c.x,c.y);this.mdTime.push(b);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,c){c=(new Date).getTime();
this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(c)},finalizeDrawingPath:function(b,g,d){(new Date).getTime();this.contextTop.closePath();this.isCurrentlyDrawing=!1;var f=this.utility.min(this.freeDrawingXPoints);g=this.utility.min(this.freeDrawingYPoints);var k=this.utility.max(this.freeDrawingXPoints);d=this.utility.max(this.freeDrawingYPoints);var p=[],v,u,q,r=this.freeDrawingXPoints,t=this.freeDrawingYPoints,
B=this.mdTime;p.push("M ",r[0]-f," ",t[0]-g," ",B[0]," ");for(var A=1;v=r[A],u=t[A],q=B[A];A++)p.push("L ",v-f," ",u-g," ",q," ");p=p.join("");if("M 0 0 L 0 0 "!==p)return v=this.freeDrawingXPoints[this.freeDrawingXPoints.length-1],u=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],q=new a.Path(p,this),q.mp={},q.mp.x=v,q.mp.y=u,q.init(p),q=b.readyObject(q),q.coreObj.type="freeDrawing",q=q.coreObj,q.fill=null,q.stroke=this.freeDrawingColor,q.strokeWidth=this.freeDrawingLineWidth,q.minX=f,
q.minY=g,this.utility.objAdd(q),b=a.utility.setVal(q,"x",f+(k-f)/2),b=a.utility.setVal(b,"y",g+(d-g)/2),b.setCoords(),"object"==typeof c&&this.contextTop.restore(),a.renderAll(this.contextTop),b},utility:{max:function(a,c){if(a&&0!==a.length){var b=a.length-1,f=c?a[b][c]:a[b];if(c)for(;b--;)a[b][c]>=f&&(f=a[b][c]);else for(;b--;)a[b]>=f&&(f=a[b]);return f}},min:function(a,c){if(a&&0!==a.length){var b=a.length-1,f=c?a[b][c]:a[b];if(c)for(;b--;)a[b][c]<f&&(f=a[b][c]);else for(;b--;)a[b]<f&&(f=a[b]);
return f}},objAdd:function(c){a.main.children.push(c);return this}}}}}})(window);(function(d){d.Path=function(b){var a=virtualclass.wb[b].vcan;a.Path=function(c,b){return{objectType:"path",init:function(a,c){c=c||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(c),this},initializeFromArray:function(a){var c="width"in a,b="height"in a;this.path=this._parsePath();c&&b||(this.utility.extend(this,this._parseDimensions()),c&&(this.width=
a.width),b&&(this.height=a.height))},_render:function(a){for(var c,b,f=-(this.width/2),g=-(this.height/2),d=0,u=this.path.length;d<u;++d)switch(c=this.path[d],c[0]){case "L":b=c[1];c=c[2];a.lineTo(b+f,c+g);break;case "M":b=c[1],c=c[2],a.moveTo(b+f,c+g)}},replay_render:function(a,c,b,f){var g=y=0;switch(c[0]){case "L":g+=c[1];y+=c[2];a.lineTo(g+b,y+f);a.stroke();break;case "M":g+=c[1],y+=c[2],a.moveTo(g+b,y+f)}},render:function(c,b){c.save();var f=this.transformMatrix;f&&c.transform(f[0],f[1],f[2],
f[3],f[4],f[5]);b||a.transform(c,this);this.overlayFill?c.fillStyle=this.overlayFill:this.fill&&(c.fillStyle=this.fill);this.stroke&&(c.strokeStyle=this.stroke);c.beginPath();this._render(c);this.fill&&c.fill();this.stroke&&(c.strokeStyle=this.stroke,c.lineWidth=this.strokeWidth,c.lineCap=c.lineJoin="round",c.stroke());!b&&this.active&&(this.drawBorders(c),this.hideCorners||this.drawCorners(c));c.restore()},_parsePath:function(){for(var a=[],c,b,f,d=0,v,u=this.path.length;d<u;d++){var q=/\d+\s$/.exec(this.path[d]);
null!=q&&(c=this.path[d].indexOf(q),this.path[d]=this.path[d].substring(0,c));c=this.path[d];b=c.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);c=[c.charAt(0)];v=0;for(var r=b.length;v<r;v++)f=parseFloat(b[v]),isNaN(f)||c.push(f);b=c[0].toLowerCase();b=this.commandLengths[b];if(c.length-1>b)for(f=1,v=c.length;f<v;f+=b)null==q?a.push([c[0]].concat(c.slice(f,f+b))):(a.push([c[0]].concat(c.slice(f,f+b))),c.push(q),a.push(c));else null!=q&&c.push(q[0]),a.push(c)}return a},_parseDimensions:function(){var a=
[],c=[],f,d,p=!1,v,u;this.path.forEach(function(b,g){var k;" "!=b[3]&&(k=b.splice(3));"H"!==b[0]&&(f=0===g?this.utility.getX(b):this.utility.getX(this.path[g-1]));"V"!==b[0]&&(d=0===g?this.utility.getY(b):this.utility.getY(this.path[g-1]));b[0]===b[0].toLowerCase()&&(p=!0);v=p?f+this.utility.getX(b):"V"===b[0]?f:this.utility.getX(b);u=p?d+this.utility.getY(b):"H"===b[0]?d:this.utility.getY(b);g=parseInt(v,10);isNaN(g)||a.push(g);g=parseInt(u,10);isNaN(g)||c.push(g);void 0!=k&&1<=k.length&&b.push(k[0])},
this);var q=b.utility.min(a);q={y:b.utility.min(c)-0,x:q-0,bottom:b.utility.max(c)-0,right:b.utility.max(a)-0};q.width=q.right-q.x;q.height=q.bottom-q.y;return q},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,c){for(var b in c)a[b]=c[b];return a}}}}}})(window);(function(d){d.Mouse=function(b){var a=virtualclass.wb[b].vcan;a.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){console.log("Whiteboard ");canvasElement=a.main.canvas;var c={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup",touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend"},b;for(b in c)"mousedown"==b?canvasElement.addEventListener(b,this._mousedown,!1):"mousemove"==b?canvasElement.addEventListener(b,this._mousemove,!1):"mouseup"==
b?canvasElement.addEventListener(b,this._mouseup,!1):"touchstart"==b?canvasElement.addEventListener(b,this._touchstart,!1):"touchmove"==b?canvasElement.addEventListener(b,this._touchmove,!1):"touchend"==b&&canvasElement.addEventListener(b,this._touchend,!1)},_mousedown:function(c,b){a.activMouse.mousedown(c,b)},_mousemove:function(c){a.activMouse.mousemove(c)},_mouseup:function(c){a.activMouse.mouseup(c)},_touchstart:function(c,b){a.activMouse.mousedown(c,b);c.preventDefault()},_touchmove:function(c){a.activMouse.mousemove(c);
c.preventDefault()},_touchend:function(c){a.activMouse.mouseup(c);c.preventDefault()},mousedown:function(c,b){document.getElementById("congrealogo").classList.add("disbaleOnmousedown");c.detail.hasOwnProperty("cevent")&&"create"!=a.main.action&&(c=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(c),c.clientX=a.main.offset.x+c.detail.cevent.x,c.clientY=a.main.offset.y+c.detail.cevent.y,c.x=a.main.offset.x+c.detail.cevent.x,c.y=a.main.offset.y+c.detail.cevent.y,c.pageX=a.main.offset.x+
c.detail.cevent.x,c.pageY=a.main.offset.y+c.detail.cevent.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];"move"==a.main.action?a.main.currentTransform||((b=a.events().findTarget(c))?(0<a.main.children.length&&b.setZindex(),b.downObj=!0,b.setupCurrentTransform(c),a.utility.setActiveObject(b),a.main.currObj=b):a.deactivateAll(),void 0!=b&&a.renderAll(),c.detail.hasOwnProperty("cevent")||(roles.hasControls()&&(c=a.utility.updateCordinate(c)),b=(new Date).getTime(),
c=a.makeStackObj(b,"d",c.clientX-a.main.offset.x,c.clientY-a.main.offset.y),c.x/=virtualclass.zoom.canvasScale,c.y/=virtualclass.zoom.canvasScale,virtualclass.wb[virtualclass.gObj.currWb].uid++,console.log("uid "+virtualclass.wb[virtualclass.gObj.currWb].uid),c.uid=virtualclass.wb[virtualclass.gObj.currWb].uid,a.main.replayObjs.push(c),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"}))):"create"==a.main.action&&(c.detail.hasOwnProperty("cevent")&&(c.detail.hasOwnProperty("foundText")&&(c=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(c)),
c.clientX=c.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,c.clientY=c.detail.cevent.y+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,c.x=c.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,c.y=c.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,c.pageX=c.detail.cevent.x+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.x,c.pageY=c.detail.cevent.y+virtualclass.wb[virtualclass.gObj.currWb].vcan.main.offset.y,
c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y),(b=a.events().findTarget(c))&&"text"==b.type&&virtualclass.wb[virtualclass.gObj.currWb].tool.cmd=="t_text"+virtualclass.gObj.currWb&&b.setupCurrentTransform(c))},mousemove:function(c){c.detail.hasOwnProperty("cevent")&&("move"==a.main.action&&(c=virtualclass.wb[virtualclass.gObj.currWb].utility.putScrollWithCevent(c)),c.clientX=a.main.offset.x+c.detail.cevent.x,c.clientY=a.main.offset.y+c.detail.cevent.y,c.x=a.main.offset.x+c.detail.cevent.x,c.y=
a.main.offset.y+c.detail.cevent.y,c.pageX=a.main.offset.x+c.detail.cevent.x,c.pageY=a.main.offset.y+c.detail.cevent.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);if("move"==a.main.action){var b=a.main;if(b.currentTransform){var g=a.utility.actualPointer(c);var d=g.x;g=g.y;b.currentTransform.target.isMoving=!0;"rotate"===b.currentTransform.action?(a.interact.rotateObject(d,g),b.currentTransform.target.hasRotatingPoint||a.interact.scaleObject(d,g),c.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(c)):
"scale"===b.currentTransform.action?(c.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(c),a.interact.scaleObject(d,g)):"scaleX"===b.currentTransform.action?(c.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(c),a.interact.scaleObject(d,g,"x")):"scaleY"===b.currentTransform.action?(c.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(c),a.interact.scaleObject(d,g,"y")):b.currentTransform.target.draggable&&(a.extend({},a.main.currentTransform.target),(new Date).getTime(),1==b.currentTransform.target.downObj&&
(a.main.dragMode=!0,b.currentTransform.target.downObj=!1),d=a.interact.translateObject(d,g),c.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(c),d.setActive(!0),d.setCoords());if("scaleX"===b.currentTransform.action||"scaleY"===b.currentTransform.action||"rotate"===b.currentTransform.action&&!b.currentTransform.target.hasRotatingPoint)a.main.scaleMode=!0,(new Date).getTime(),b.currentTransform.target.downObj&&(b.currentTransform.target.downObj=!1),d=a.extend({},a.main.currentTransform.target),
d.setCoords();a.renderAll()}}},mouseup:function(c){document.getElementById("congrealogo").classList.remove("disbaleOnmousedown");c.detail.hasOwnProperty("cevent")&&(c.clientX=a.main.offset.x+c.detail.cevent.x,c.clientY=a.main.offset.y+c.detail.cevent.y,c.x=a.main.offset.x+c.detail.cevent.x,c.y=a.main.offset.y+c.detail.cevent.y,c.pageX=a.main.offset.x+c.detail.cevent.x,c.pageY=a.main.offset.y+c.detail.cevent.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);lastmousemovetime=null;if("move"==a.main.action){a.activMouse.mousemove(c);
var b=a.main;if(b.currentTransform){var g=b.currentTransform.target;g.scaling&&(g.scaling=!1);for(g=b.children.length;g--;)b.children[g].setCoords()}b.currentTransform=null;a.renderAll();if(1==a.main.dragMode||1==a.main.scaleMode){roles.hasControls()&&(c=a.utility.updateCordinate(c));var d=(new Date).getTime();(!c.detail.hasOwnProperty("cevent")||c.detail.hasOwnProperty("cevent")&&c.detail.hasOwnProperty("broadCast"))&&a.optimize.calculatePackets(d,"u",c.clientX-a.main.offset.x,c.clientY-a.main.offset.y);
a.main.dragMode&&(a.main.dragMode=!1);a.main.scaleMode&&(a.main.scaleMode=!1)}else!c.detail.hasOwnProperty("cevent")&&c.detail.hasOwnProperty("cevent")&&c.detail.hasOwnProperty("broadCast")&&a.optimize.calculatePackets(d,"u",c.clientX-a.main.offset.x,c.clientY-a.main.offset.y);a.wb.sentPack=!0}}}}}})(window);(function(d){d.readyFreeHandObj=function(b,a){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=b;this.freeDrawingLineWidth=a},drawStart:function(a){var c=virtualclass.wb[virtualclass.gObj.currWb].vcan;if(1==virtualclass.wb[virtualclass.gObj.currWb].obj.freeDrawObj.freesvg){var b=c.main.canvas.getContext("2d");this.fdObj=c.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=c.utility.getReltivePoint(a);this.fdObj.fhdStart(b,
pointer)}},wb_draw:function(a){a=virtualclass.wb[virtualclass.gObj.currWb].vcan.utility.getReltivePoint(a);this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=virtualclass.wb[virtualclass.gObj.currWb].vcan;virtualclass.wb[virtualclass.gObj.currWb].prvObj=this.fdObj.finalizeDrawingPath(virtualclass.wb[virtualclass.gObj.currWb].canvas);a.main.children[a.main.children.length-1].mt=virtualclass.wb[virtualclass.gObj.currWb].utility.stringToNumber(virtualclass.wb[virtualclass.gObj.currWb].prvObj.path[virtualclass.wb[virtualclass.gObj.currWb].prvObj.path.length-
1][3])}}}})(window);(function(d){_replay=function(){return{init:function(b,a){var c=virtualclass.wb[virtualclass.gObj.currWb].vcan;this.objs="undefined"!=typeof a?c.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=b;this.callBkfunc="";this.rendering=!1},makeCustomEvent:function(b,a){b=b.hasOwnProperty("mtext")?{detail:{cevent:{x:b.x,y:b.y,mtext:b.mtext}}}:{detail:{cevent:{x:b.x,y:b.y}}};"undefined"!=typeof a&&(b.detail.broadCast=!0);a=new CustomEvent(event,b);vcan.main.canvas.dispatchEvent(a)},renderObj:function(b){var a=
virtualclass.wb[virtualclass.gObj.currWb].vcan;if("undefined"==typeof this.objs[this.objNo])console.log(this.objs+"is undefined cannot continue play.");else{this.rendering=virtualclass.wb[virtualclass.gObj.currWb].drawMode=!0;"undefined"!=typeof b&&(this.callBkfunc=b);if(this.objs[this.objNo].hasOwnProperty("cmd"))virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId=this.objs[this.objNo].uid,virtualclass.wb[virtualclass.gObj.currWb].toolInit(this.objs[this.objNo].cmd,"fromFile",!0);else{var c=
"";if("del"==this.objs[this.objNo].ac)""!=a.main.currObj&&(virtualclass.wb[virtualclass.gObj.currWb].utility.removeSelectedItem(a.main.currObj,!0,!0),console.log("Whiteboard Delete:-  Performing delete operation:-"));else{"d"==this.objs[this.objNo].ac?c="mousedown":"m"==this.objs[this.objNo].ac?c="mousemove":"u"==this.objs[this.objNo].ac&&(c="mouseup");var f=this.objs[this.objNo];f.hasOwnProperty("mtext")?b={detail:{cevent:{x:f.x,y:f.y,mtext:f.mtext}}}:(b={detail:{cevent:{x:f.x,y:f.y}}},f.hasOwnProperty("scy")&&
(b.detail.cevent.scy=f.scy),f.hasOwnProperty("scx")&&(b.detail.cevent.scx=f.scx));f.hasOwnProperty("foundText")&&(b.detail.foundText=!0);b=new CustomEvent(c,b);a.main.canvas.dispatchEvent(b)}virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId=this.objs[this.objNo].uid}this.objs[this.objs.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId&&("function"==typeof this.callBkfunc&&this.callBkfunc("callBkfunc"),this.rendering=!1);roles.hasControls()&&virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs[virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs.length-
1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId&&(a.main.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.tempRepObjs);if("object"==typeof this.objs[this.objNo+1]){virtualclass.wb[virtualclass.gObj.currWb].replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?0:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;var g=this;setTimeout(function(){g.renderObj.call(g)},virtualclass.wb[virtualclass.gObj.currWb].replayTime)}}}}};
d._replay=_replay})(window);(function(d){d.readyTextObj=function(){return{init:function(b){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=b;this.muser=!1},textUtility:function(b,a,c){console.log("Text position x="+b+" y="+a);this.startPosX=b;this.startPosY=a;var f=virtualclass.wb[virtualclass.gObj.currWb].vcan,g=f.main.canvas.getContext("2d");this.textWriteMode++;this.wmode=!0;void 0!=f.main.currentTransform&&
""!=f.main.currentTransform?(this.currObject=f.main.currentTransform.target,void 0!=this.currObject&&"text"==this.currObject.type&&(b={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)||virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(b,this.currObject.id),f.main.currentTransform=""),virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)&&
virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,g),void 0!=this.currObject&&"text"==this.currObject.type&&(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):virtualclass.wb[virtualclass.gObj.currWb].utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof c?virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.currObject,
this.prvModTextObj,g,c):virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,g):(this.totalBox++,b={x:b,y:a,width:300,height:100},"undefined"==typeof c?virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(b,this.totalBox):virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.drawTextBoxWrapper(b,this.totalBox,c))},drawTextBoxWrapper:function(b,a,c){virtualclass.vutil.removeAllTextWrapper();c=document.createElement("div");
c.id="box"+a;c.className="textBoxContainer";c.style.position="absolute";c.style.left=b.x-virtualclass.leftPosX+"px";c.style.top=b.y-virtualclass.topPosY+"px";if(void 0!=b.x){var f=document.createElement("textarea");f.id=c.id+"textarea";f.className="whiteBoardTextBox";f.rows=8;f.cols=41;void 0!=b.text&&""!=b.text&&(f.value=b.text);c.appendChild(f);document.getElementById(this.boxContainer).appendChild(c)}this.prevTextObj=c;this.currTextObjWrapper=b;this.prevTextObj.measure=b;virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperDisable(!0);
roles.hasControls()||(f.style.display="none",roles.hasAdmin()&&virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperEnable(!0));console.log("Text Command:- Create text wrapper box")},renderText:function(b,a,c,f){var g=virtualclass.wb[virtualclass.gObj.currWb].vcan;if(""!=this.prevTextObj){if(!virtualclass.wb[virtualclass.gObj.currWb].utility.IsObjEmpty(b))for(var d=0;d<g.main.children.length;d++)if(b.id==g.main.children[d].id){g.main.children.splice(d,1);this.currObject="";break}virtualclass.wb[virtualclass.gObj.currWb].utility.IsObjEmpty(b)?
"undefined"!=typeof f?this.finalizeText(c,this.prevTextObj,"undefined",f):this.finalizeText(c,this.prevTextObj):"undefined"!=typeof f?this.finalizeText(c,this.prevTextObj,a,f):this.finalizeText(c,this.prevTextObj,a);virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.wmode=!1}},finalizeText:function(b,a,c,f){c=virtualclass.wb[virtualclass.gObj.currWb].vcan;var g=document.getElementById(a.id),d="";if("undefined"==typeof f){f=g.getElementsByTagName("textarea");for(var m=0;m<f.length;m++)if(f[m].id==
g.id+"textarea"){d=f[m].value;break}}else d=f;b.font="20px Times New Roman";b.fillStyle=this.prvCurrTransform.color;var n=d.split(/\r?\n/);var p=b.measureText(n[0]).width+20;f=15;for(m=1;m<n.length;m++){f+=15;var v=b.measureText(n[m]).width;v>p&&(p=v)}p/=2;m=(new Date).getTime();b={type:"text",text:d,x:a.measure.x+p*virtualclass.zoom.canvasScale,y:a.measure.y+f*virtualclass.zoom.canvasScale,fontSize:20,fontWidth:b.measureText(d).width,mp:{x:a.measure.x,y:a.measure.y}};0==virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.muser&&
(d={mt:m,ac:"d",x:this.startPosX,y:this.startPosY,mtext:b.text},virtualclass.wb[virtualclass.gObj.currWb].uid++,d.uid=virtualclass.wb[virtualclass.gObj.currWb].uid,c.main.replayObjs.push(d),virtualclass.storage.store(JSON.stringify(c.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[d],cf:"repObj"}));b=virtualclass.wb[virtualclass.gObj.currWb].canvas.readyObject(b);console.log("Whiteboard text "+b);virtualclass.wb[virtualclass.gObj.currWb].canvas.addObject(b);c.main.children[c.main.children.length-
1].mt=m;g.parentNode.removeChild(a);c.renderAll();virtualclass.wb[virtualclass.gObj.currWb].utility.toolWrapperEnable(!0)},finalizeTextIfAny:function(b){var a=document.getElementById("canvasWrapper"+virtualclass.gObj.currWb);null!=a&&0<a.getElementsByClassName("whiteBoardTextBox").length&&("undefined"==typeof b||"undefined"!=typeof b&&0!=virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textWriteMode%2)&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textUtility()}}}})(window);(function(d){d.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(b){b.shiftKey&&(virtualclass.wb[virtualclass.gObj.currWb].keyBoard.skey=!0,virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool=virtualclass.wb[virtualclass.gObj.currWb].tool.cmd,virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_activeall"),b={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(b),virtualclass.vutil.beforeSend({repObj:[b],cf:"repObj"}),virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action=
"move")},triggerdeActiveAll:function(b){virtualclass.wb[virtualclass.gObj.currWb].keyBoard.skey&&(b=(new Date).getTime(),virtualclass.wb[virtualclass.gObj.currWb].utility.deActiveFrmDragDrop(),virtualclass.wb[virtualclass.gObj.currWb].toolInit(virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool),b={cmd:virtualclass.wb[virtualclass.gObj.currWb].keyBoard.prvTool,mt:b},vcan.main.replayObjs.push(b),virtualclass.vutil.beforeSend({repObj:[b],cf:"repObj"}))}}})(window);(function(d){(function(b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define([],b):("undefined"!==typeof d?d:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=b()})(function(){return function a(c,f,g){function d(k,n){if(!f[k]){if(!c[k]){var p="function"==typeof require&&require;if(!n&&p)return p(k,!0);if(m)return m(k,!0);n=Error("Cannot find module '"+k+"'");throw n.code="MODULE_NOT_FOUND",n;}n=f[k]=
{exports:{}};c[k][0].call(n.exports,function(a){var f=c[k][1][a];return d(f?f:a)},n,n.exports,a,c,f,g)}return f[k].exports}for(var m="function"==typeof require&&require,n=0;n<g.length;n++)d(g[n]);return d}({1:[function(a,c,f){function g(a,c,f,g,d){c=t.writeRtpDescription(a.kind,c);c+=t.writeIceParameters(a.iceGatherer.getLocalParameters());c+=t.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===f?"actpass":d||"active");c+="a=mid:"+a.mid+"\r\n";c=a.rtpSender&&a.rtpReceiver?c+"a=sendrecv\r\n":
a.rtpSender?c+"a=sendonly\r\n":a.rtpReceiver?c+"a=recvonly\r\n":c+"a=inactive\r\n";a.rtpSender&&(f="msid:"+g.id+" "+a.rtpSender.track.id+"\r\n",c=c+("a="+f)+("a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+f),a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+f,c+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));c+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&
(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n");return c}function k(a,c){var f=!1;a=JSON.parse(JSON.stringify(a));return a.filter(function(a){if(a&&(a.urls||a.url)){var g=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var d="string"===typeof g;d&&(g=[g]);g=g.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||f?0===a.indexOf("stun:")&&14393<=c&&-1===a.indexOf("?transport=udp"):
f=!0});delete a.url;a.urls=d?g[0]:g;return!!g.length}})}function m(a,c){var f={codecs:[],headerExtensions:[],fecMechanisms:[]},g=function(a,c){a=parseInt(a,10);for(var f=0;f<c.length;f++)if(c[f].payloadType===a||c[f].preferredPayloadType===a)return c[f]},d=function(a,c,f,d){a=g(a.parameters.apt,f);c=g(c.parameters.apt,d);return a&&c&&a.name.toLowerCase()===c.name.toLowerCase()};a.codecs.forEach(function(g){for(var k=0;k<c.codecs.length;k++){var m=c.codecs[k];if(g.name.toLowerCase()===m.name.toLowerCase()&&
g.clockRate===m.clockRate&&("rtx"!==g.name.toLowerCase()||!g.parameters||!m.parameters.apt||d(g,m,a.codecs,c.codecs))){m=JSON.parse(JSON.stringify(m));m.numChannels=Math.min(g.numChannels,m.numChannels);f.codecs.push(m);m.rtcpFeedback=m.rtcpFeedback.filter(function(a){for(var c=0;c<g.rtcpFeedback.length;c++)if(g.rtcpFeedback[c].type===a.type&&g.rtcpFeedback[c].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(function(a){for(var g=0;g<c.headerExtensions.length;g++){var d=
c.headerExtensions[g];if(a.uri===d.uri){f.headerExtensions.push(d);break}}});return f}function n(a,c,f){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[c][a].indexOf(f)}function p(a,c){var f=a.getRemoteCandidates().find(function(a){return c.foundation===a.foundation&&c.ip===a.ip&&c.port===
a.port&&c.priority===a.priority&&c.protocol===a.protocol&&c.type===a.type});f||a.addRemoteCandidate(c);return!f}function v(a,c){c.addTrack(a);var f=new Event("addtrack");f.track=a;c.dispatchEvent(f)}function u(a,c){c.removeTrack(a);var f=new Event("removetrack");f.track=a;c.dispatchEvent(f)}function q(a,c,f,g){var k=new Event("track");k.track=c;k.receiver=f;k.transceiver={receiver:f};k.streams=g;d.setTimeout(function(){a._dispatchEvent("track",k)})}function r(a,c){c=Error(c);c.name=a;return c}var t=
a("sdp");c.exports=function(a,c){var f=function(f){var g=this,d=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){g[a]=d[a].bind(d)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this.remoteDescription=this.localDescription=null;this.signalingState="stable";this.iceGatheringState=this.iceConnectionState="new";f=JSON.parse(JSON.stringify(f||{}));this.usingBundle="max-bundle"===f.bundlePolicy;
if("negotiate"===f.rtcpMuxPolicy)throw r("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");f.rtcpMuxPolicy||(f.rtcpMuxPolicy="require");switch(f.iceTransportPolicy){case "all":case "relay":break;default:f.iceTransportPolicy="all"}switch(f.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:f.bundlePolicy="balanced"}f.iceServers=k(f.iceServers||[],c);this._iceGatherers=[];if(f.iceCandidatePoolSize)for(var m=f.iceCandidatePoolSize;0<m;m--)this._iceGatherers=
new a.RTCIceGatherer({iceServers:f.iceServers,gatherPolicy:f.iceTransportPolicy});else f.iceCandidatePoolSize=0;this._config=f;this.transceivers=[];this._sdpSessionId=t.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};f.prototype.onicecandidate=null;f.prototype.onaddstream=null;f.prototype.ontrack=null;f.prototype.onremovestream=null;f.prototype.onsignalingstatechange=null;f.prototype.oniceconnectionstatechange=null;f.prototype.onicegatheringstatechange=null;
f.prototype.onnegotiationneeded=null;f.prototype.ondatachannel=null;f.prototype._dispatchEvent=function(a,c){if(!this._isClosed&&(this.dispatchEvent(c),"function"===typeof this["on"+a]))this["on"+a](c)};f.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)};f.prototype.getConfiguration=function(){return this._config};f.prototype.getLocalStreams=function(){return this.localStreams};f.prototype.getRemoteStreams=function(){return this.remoteStreams};
f.prototype._createTransceiver=function(a){var c=0<this.transceivers.length;a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&c?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(c=this._createIceAndDtlsTransports(),
a.iceTransport=c.iceTransport,a.dtlsTransport=c.dtlsTransport);this.transceivers.push(a);return a};f.prototype.addTrack=function(c,f){if(this.transceivers.find(function(a){return a.track===c}))throw r("InvalidAccessError","Track already exists.");if("closed"===this.signalingState)throw r("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");for(var g,d=0;d<this.transceivers.length;d++)this.transceivers[d].track||this.transceivers[d].kind!==c.kind||(g=this.transceivers[d]);
g||(g=this._createTransceiver(c.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(f)&&this.localStreams.push(f);g.track=c;g.stream=f;g.rtpSender=new a.RTCRtpSender(c,g.dtlsTransport);return g.rtpSender};f.prototype.addStream=function(a){var f=this;if(15025<=c)a.getTracks().forEach(function(c){f.addTrack(c,a)});else{var g=a.clone();a.getTracks().forEach(function(a,c){var f=g.getTracks()[c];a.addEventListener("enabled",function(a){f.enabled=a.enabled})});g.getTracks().forEach(function(a){f.addTrack(a,
g)})}};f.prototype.removeTrack=function(c){if(!(c instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var f=this.transceivers.find(function(a){return a.rtpSender===c});if(!f)throw r("InvalidAccessError","Sender was not created by this connection.");var g=f.stream;f.rtpSender.stop();f.rtpSender=null;f.track=null;f.stream=null;-1===this.transceivers.map(function(a){return a.stream}).indexOf(g)&&-1<this.localStreams.indexOf(g)&&
this.localStreams.splice(this.localStreams.indexOf(g),1);this._maybeFireNegotiationNeeded()};f.prototype.removeStream=function(a){var c=this;a.getTracks().forEach(function(a){var f=c.getSenders().find(function(c){return c.track===a});f&&c.removeTrack(f)})};f.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})};f.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})};
f.prototype._createIceGatherer=function(c,f){var g=this;if(f&&0<c)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(d,"state",{value:"new",writable:!0});this.transceivers[c].candidates=[];this.transceivers[c].bufferCandidates=function(a){var f=!a.candidate||0===Object.keys(a.candidate).length;d.state=f?"completed":
"gathering";null!==g.transceivers[c].candidates&&g.transceivers[c].candidates.push(a.candidate)};d.addEventListener("localcandidate",this.transceivers[c].bufferCandidates);return d};f.prototype._gather=function(c,f){var g=this,d=this.transceivers[f].iceGatherer;if(!d.onlocalcandidate){var k=this.transceivers[f].candidates;this.transceivers[f].candidates=null;d.removeEventListener("localcandidate",this.transceivers[f].bufferCandidates);d.onlocalcandidate=function(a){if(!(g.usingBundle&&0<f)){var k=
new Event("icecandidate");k.candidate={sdpMid:c,sdpMLineIndex:f};var m=a.candidate;if(a=!m||0===Object.keys(m).length){if("new"===d.state||"gathering"===d.state)d.state="completed"}else"new"===d.state&&(d.state="gathering"),m.component=1,k.candidate.candidate=t.writeCandidate(m);m=t.splitSections(g.localDescription.sdp);m[k.candidate.sdpMLineIndex+1]=a?m[k.candidate.sdpMLineIndex+1]+"a=end-of-candidates\r\n":m[k.candidate.sdpMLineIndex+1]+("a="+k.candidate.candidate+"\r\n");g.localDescription.sdp=
m.join("");m=g.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==g.iceGatheringState&&(g.iceGatheringState="gathering",g._emitGatheringStateChange());a||g._dispatchEvent("icecandidate",k);m&&(g._dispatchEvent("icecandidate",new Event("icecandidate")),g.iceGatheringState="complete",g._emitGatheringStateChange())}};a.setTimeout(function(){k.forEach(function(a){var c=new Event("RTCIceGatherEvent");c.candidate=a;d.onlocalcandidate(c)})},0)}};f.prototype._createIceAndDtlsTransports=
function(){var c=this,f=new a.RTCIceTransport(null);f.onicestatechange=function(){c._updateConnectionState()};var g=new a.RTCDtlsTransport(f);g.ondtlsstatechange=function(){c._updateConnectionState()};g.onerror=function(){Object.defineProperty(g,"state",{value:"failed",writable:!0});c._updateConnectionState()};return{iceTransport:f,dtlsTransport:g}};f.prototype._disposeIceAndDtlsTransports=function(a){var c=this.transceivers[a].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[a].iceGatherer);
if(c=this.transceivers[a].iceTransport)delete c.onicestatechange,delete this.transceivers[a].iceTransport;if(c=this.transceivers[a].dtlsTransport)delete c.ondtlsstatechange,delete c.onerror,delete this.transceivers[a].dtlsTransport};f.prototype._transceive=function(a,f,g){var d=m(a.localCapabilities,a.remoteCapabilities);f&&a.rtpSender&&(d.encodings=a.sendEncodingParameters,d.rtcp={cname:t.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(d.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),
a.rtpSender.send(d));g&&a.rtpReceiver&&0<d.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>c&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),a.recvEncodingParameters.length&&(d.encodings=a.recvEncodingParameters),d.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(d.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(d.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(d))};f.prototype.setLocalDescription=function(a){var c=
this;if(!n("setLocalDescription",a.type,this.signalingState)||this._isClosed)return Promise.reject(r("InvalidStateError","Can not set local "+a.type+" in state "+c.signalingState));if("offer"===a.type){var f=t.splitSections(a.sdp);var g=f.shift();f.forEach(function(a,f){a=t.parseRtpParameters(a);c.transceivers[f].localCapabilities=a});this.transceivers.forEach(function(a,f){c._gather(a.mid,f)})}else if("answer"===a.type){f=t.splitSections(c.remoteDescription.sdp);g=f.shift();var d=0<t.matchPrefix(g,
"a=ice-lite").length;f.forEach(function(a,f){var k=c.transceivers[f],p=k.iceGatherer,n=k.iceTransport,v=k.dtlsTransport,q=k.localCapabilities,u=k.remoteCapabilities;if(!(t.isRejected(a)&&0===t.matchPrefix(a,"a=bundle-only").length||k.isDatachannel)){var r=t.getIceParameters(a,g);a=t.getDtlsParameters(a,g);d&&(a.role="server");c.usingBundle&&0!==f||(c._gather(k.mid,f),"new"===n.state&&n.start(p,r,d?"controlling":"controlled"),"new"===v.state&&v.start(a));f=m(q,u);c._transceive(k,0<f.codecs.length,
!1)}})}this.localDescription={type:a.type,sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}return Promise.resolve()};f.prototype.setRemoteDescription=function(f){var g=this;if(!n("setRemoteDescription",f.type,this.signalingState)||this._isClosed)return Promise.reject(r("InvalidStateError","Can not set remote "+f.type+" in state "+g.signalingState));
var d={};this.remoteStreams.forEach(function(a){d[a.id]=a});var k=[],m=t.splitSections(f.sdp),B=m.shift(),A=0<t.matchPrefix(B,"a=ice-lite").length,D=0<t.matchPrefix(B,"a=group:BUNDLE ").length;this.usingBundle=D;var F=t.matchPrefix(B,"a=ice-options:")[0];this.canTrickleIceCandidates=F?0<=F.substr(14).split(" ").indexOf("trickle"):!1;m.forEach(function(m,n){var q=t.splitLines(m),r=t.getKind(m),F=t.isRejected(m)&&0===t.matchPrefix(m,"a=bundle-only").length,E=q[0].substr(2).split(" ")[2];q=t.getDirection(m,
B);var H=t.parseMsid(m),z=t.getMid(m)||t.generateIdentifier();if("application"===r&&"DTLS/SCTP"===E)g.transceivers[n]={mid:z,isDatachannel:!0};else{var G=t.parseRtpParameters(m);if(!F){var L=t.getIceParameters(m,B);var K=t.getDtlsParameters(m,B);K.role="client"}E=t.parseRtpEncodingParameters(m);var J=t.parseRtcpParameters(m),C=0<t.matchPrefix(m,"a=end-of-candidates",B).length,O=t.matchPrefix(m,"a=candidate:").map(function(a){return t.parseCandidate(a)}).filter(function(a){return 1===a.component});
("offer"===f.type||"answer"===f.type)&&!F&&D&&0<n&&g.transceivers[n]&&(g._disposeIceAndDtlsTransports(n),g.transceivers[n].iceGatherer=g.transceivers[0].iceGatherer,g.transceivers[n].iceTransport=g.transceivers[0].iceTransport,g.transceivers[n].dtlsTransport=g.transceivers[0].dtlsTransport,g.transceivers[n].rtpSender&&g.transceivers[n].rtpSender.setTransport(g.transceivers[0].dtlsTransport),g.transceivers[n].rtpReceiver&&g.transceivers[n].rtpReceiver.setTransport(g.transceivers[0].dtlsTransport));
if("offer"!==f.type||F)"answer"!==f.type||F||(I=g.transceivers[n],T=I.iceGatherer,r=I.iceTransport,z=I.dtlsTransport,R=I.rtpReceiver,F=I.sendEncodingParameters,m=I.localCapabilities,g.transceivers[n].recvEncodingParameters=E,g.transceivers[n].remoteCapabilities=G,g.transceivers[n].rtcpParameters=J,O.length&&"new"===r.state&&(!A&&!C||D&&0!==n?O.forEach(function(a){p(I.iceTransport,a)}):r.setRemoteCandidates(O)),D&&0!==n||("new"===r.state&&r.start(T,L,"controlling"),"new"===z.state&&z.start(K)),g._transceive(I,
"sendrecv"===q||"recvonly"===q,"sendrecv"===q||"sendonly"===q),!R||"sendrecv"!==q&&"sendonly"!==q?delete I.rtpReceiver:(q=R.track,H?(d[H.stream]||(d[H.stream]=new a.MediaStream),v(q,d[H.stream]),k.push([q,R,d[H.stream]])):(d.default||(d.default=new a.MediaStream),v(q,d.default),k.push([q,R,d.default]))));else{var I=g.transceivers[n]||g._createTransceiver(r);I.mid=z;I.iceGatherer||(I.iceGatherer=g._createIceGatherer(n,D));O.length&&"new"===I.iceTransport.state&&(!C||D&&0!==n?O.forEach(function(a){p(I.iceTransport,
a)}):I.iceTransport.setRemoteCandidates(O));m=a.RTCRtpReceiver.getCapabilities(r);15019>c&&(m.codecs=m.codecs.filter(function(a){return"rtx"!==a.name}));F=I.sendEncodingParameters||[{ssrc:1001*(2*n+2)}];L=!1;if("sendrecv"===q||"sendonly"===q){L=!I.rtpReceiver;var R=I.rtpReceiver||new a.RTCRtpReceiver(I.dtlsTransport,r);if(L){q=R.track;if(!H||"-"!==H.stream)if(H){d[H.stream]||(d[H.stream]=new a.MediaStream,Object.defineProperty(d[H.stream],"id",{get:function(){return H.stream}}));Object.defineProperty(q,
"id",{get:function(){return H.track}});var T=d[H.stream]}else d.default||(d.default=new a.MediaStream),T=d.default;T&&(v(q,T),I.associatedRemoteMediaStreams.push(T));k.push([q,R,T])}}else I.rtpReceiver&&I.rtpReceiver.track&&(I.associatedRemoteMediaStreams.forEach(function(a){var c=a.getTracks().find(function(a){return a.id===I.rtpReceiver.track.id});c&&u(c,a)}),I.associatedRemoteMediaStreams=[]);I.localCapabilities=m;I.remoteCapabilities=G;I.rtpReceiver=R;I.rtcpParameters=J;I.sendEncodingParameters=
F;I.recvEncodingParameters=E;g._transceive(g.transceivers[n],!1,L)}}});void 0===this._dtlsRole&&(this._dtlsRole="offer"===f.type?"active":"passive");this.remoteDescription={type:f.type,sdp:f.sdp};switch(f.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+f.type+'"');}Object.keys(d).forEach(function(c){var f=d[c];if(f.getTracks().length){if(-1===g.remoteStreams.indexOf(f)){g.remoteStreams.push(f);
var m=new Event("addstream");m.stream=f;a.setTimeout(function(){g._dispatchEvent("addstream",m)})}k.forEach(function(a){f.id===a[2].id&&q(g,a[0],a[1],[f])})}});k.forEach(function(a){a[2]||q(g,a[0],a[1],[])});a.setTimeout(function(){g&&g.transceivers&&g.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},
4E3);return Promise.resolve()};f.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};f.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};f.prototype._maybeFireNegotiationNeeded=function(){var c=
this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(function(){if(!1!==c.needNegotiation){c.needNegotiation=!1;var a=new Event("negotiationneeded");c._dispatchEvent("negotiationneeded",a)}},0))};f.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(c){a[c.iceTransport.state]++;a[c.dtlsTransport.state]++});a.connected+=a.completed;
var c="new";if(0<a.failed)c="failed";else if(0<a.connecting||0<a.checking)c="connecting";else if(0<a.disconnected)c="disconnected";else if(0<a.new)c="new";else if(0<a.connected||0<a.completed)c="connected";c!==this.iceConnectionState&&(this.iceConnectionState=c,c=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",c))};f.prototype.createOffer=function(f){var d=this;if(this._isClosed)return Promise.reject(r("InvalidStateError","Can not call createOffer after close"));
var k=this.transceivers.filter(function(a){return"audio"===a.kind}).length,m=this.transceivers.filter(function(a){return"video"===a.kind}).length;if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==f.offerToReceiveAudio&&(k=!0===f.offerToReceiveAudio?1:!1===f.offerToReceiveAudio?0:f.offerToReceiveAudio);void 0!==f.offerToReceiveVideo&&(m=!0===f.offerToReceiveVideo?1:!1===f.offerToReceiveVideo?0:f.offerToReceiveVideo)}for(this.transceivers.forEach(function(a){"audio"===
a.kind?(k--,0>k&&(a.wantReceive=!1)):"video"===a.kind&&(m--,0>m&&(a.wantReceive=!1))});0<k||0<m;)0<k&&(this._createTransceiver("audio"),k--),0<m&&(this._createTransceiver("video"),m--);var p=t.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(f,g){var k=f.track,m=f.kind,p=t.generateIdentifier();f.mid=p;f.iceGatherer||(f.iceGatherer=d._createIceGatherer(g,d.usingBundle));p=a.RTCRtpSender.getCapabilities(m);15019>c&&(p.codecs=p.codecs.filter(function(a){return"rtx"!==
a.name}));p.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});g=f.sendEncodingParameters||[{ssrc:1001*(2*g+1)}];k&&15019<=c&&"video"===m&&!g[0].rtx&&(g[0].rtx={ssrc:g[0].ssrc+1});f.wantReceive&&(f.rtpReceiver=new a.RTCRtpReceiver(f.dtlsTransport,m));f.localCapabilities=p;f.sendEncodingParameters=g});"max-compat"!==this._config.bundlePolicy&&(p+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+
"\r\n");p+="a=ice-options:trickle\r\n";this.transceivers.forEach(function(a,c){p+=g(a,a.localCapabilities,"offer",a.stream,d._dtlsRole);p+="a=rtcp-rsize\r\n";!a.iceGatherer||"new"===d.iceGatheringState||0!==c&&d.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1;p+="a="+t.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(p+="a=end-of-candidates\r\n"))});f=new a.RTCSessionDescription({type:"offer",sdp:p});return Promise.resolve(f)};f.prototype.createAnswer=
function(){var f=this;if(this._isClosed)return Promise.reject(r("InvalidStateError","Can not call createAnswer after close"));var d=t.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(d+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");var k=t.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(a,p){if(!(p+1>k))if(a.isDatachannel)d+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+
a.mid+"\r\n";else{if(a.stream){var n;"audio"===a.kind?n=a.stream.getAudioTracks()[0]:"video"===a.kind&&(n=a.stream.getVideoTracks()[0]);n&&15019<=c&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}p=m(a.localCapabilities,a.remoteCapabilities);!p.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx;d+=g(a,p,"answer",a.stream,f._dtlsRole);
a.rtcpParameters&&a.rtcpParameters.reducedSize&&(d+="a=rtcp-rsize\r\n")}});var p=new a.RTCSessionDescription({type:"answer",sdp:d});return Promise.resolve(p)};f.prototype.addIceCandidate=function(a){if(a&&""!==a.candidate)if(void 0!==a.sdpMLineIndex||a.sdpMid)if(this.remoteDescription){var c=a.sdpMLineIndex;if(a.sdpMid)for(var f=0;f<this.transceivers.length;f++)if(this.transceivers[f].mid===a.sdpMid){c=f;break}var g=this.transceivers[c];if(g){if(g.isDatachannel)return Promise.resolve();f=0<Object.keys(a.candidate).length?
t.parseCandidate(a.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port)||f.component&&1!==f.component)return Promise.resolve();if((0===c||0<c&&g.iceTransport!==this.transceivers[0].iceTransport)&&!p(g.iceTransport,f))return Promise.reject(r("OperationError","Can not add ICE candidate"));g=a.candidate.trim();0===g.indexOf("a=")&&(g=g.substr(2));a=t.splitSections(this.remoteDescription.sdp);a[c+1]+="a="+(f.type?g:"end-of-candidates")+"\r\n";this.remoteDescription.sdp=a.join("")}else return Promise.reject(r("OperationError",
"Can not add ICE candidate"))}else return Promise.reject(r("InvalidStateError","Can not add ICE candidate without a remote description"));else throw new TypeError("sdpMLineIndex or sdpMid required");else for(c=0;c<this.transceivers.length&&(this.transceivers[c].isDatachannel||(this.transceivers[c].iceTransport.addRemoteCandidate({}),a=t.splitSections(this.remoteDescription.sdp),a[c+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=a.join(""),!this.usingBundle));c++);return Promise.resolve()};
f.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(c){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){c[f]&&a.push(c[f].getStats())})});return new Promise(function(c){var f=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(c){var g=a[c];a[c].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||
g.type;f.set(c,a[c])})});c(f)})})};var d=["createOffer","createAnswer"];d.forEach(function(a){var c=f.prototype[a];f.prototype[a]=function(){var a=arguments;return"function"===typeof a[0]||"function"===typeof a[1]?c.apply(this,[arguments[2]]).then(function(c){"function"===typeof a[0]&&a[0].apply(null,[c])},function(c){"function"===typeof a[1]&&a[1].apply(null,[c])}):c.apply(this,arguments)}});d=["setLocalDescription","setRemoteDescription","addIceCandidate"];d.forEach(function(a){var c=f.prototype[a];
f.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]||"function"===typeof a[2]?c.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)},function(c){"function"===typeof a[2]&&a[2].apply(null,[c])}):c.apply(this,arguments)}});["getStats"].forEach(function(a){var c=f.prototype[a];f.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]?c.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)}):c.apply(this,arguments)}});
return f}},{sdp:2}],2:[function(a,c,f){var g={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};g.localCName=g.generateIdentifier();g.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})};g.splitSections=function(a){return a.split("\nm=").map(function(a,c){return(0<c?"m="+a:a).trim()+"\r\n"})};g.matchPrefix=function(a,c){return g.splitLines(a).filter(function(a){return 0===a.indexOf(c)})};g.parseCandidate=function(a){a=0===a.indexOf("a=candidate:")?
a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),type:a[7]},f=8;f<a.length;f+=2)switch(a[f]){case "raddr":c.relatedAddress=a[f+1];break;case "rport":c.relatedPort=parseInt(a[f+1],10);break;case "tcptype":c.tcpType=a[f+1];break;case "ufrag":c.ufrag=a[f+1];c.usernameFragment=a[f+1];break;default:c[a[f]]=a[f+1]}return c};g.writeCandidate=function(a){var c=
[];c.push(a.foundation);c.push(a.component);c.push(a.protocol.toUpperCase());c.push(a.priority);c.push(a.ip);c.push(a.port);var f=a.type;c.push("typ");c.push(f);"host"!==f&&a.relatedAddress&&a.relatedPort&&(c.push("raddr"),c.push(a.relatedAddress),c.push("rport"),c.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(c.push("tcptype"),c.push(a.tcpType));a.ufrag&&(c.push("ufrag"),c.push(a.ufrag));return"candidate:"+c.join(" ")};g.parseIceOptions=function(a){return a.substr(14).split(" ")};
g.parseRtpMap=function(a){a=a.substr(9).split(" ");var c={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");c.name=a[0];c.clockRate=parseInt(a[1],10);c.numChannels=3===a.length?parseInt(a[2],10):1;return c};g.writeRtpMap=function(a){var c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);return"a=rtpmap:"+c+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"};g.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<
a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};g.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"};g.parseFmtp=function(a){for(var c={},f=a.substr(a.indexOf(" ")+1).split(";"),g=0;g<f.length;g++)a=f[g].trim().split("="),c[a[0].trim()]=a[1];return c};g.writeFmtp=function(a){var c="",f=a.payloadType;void 0!==a.preferredPayloadType&&(f=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){var g=
[];Object.keys(a.parameters).forEach(function(c){g.push(c+"="+a.parameters[c])});c+="a=fmtp:"+f+" "+g.join(";")+"\r\n"}return c};g.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};g.writeRtcpFb=function(a){var c="",f=a.payloadType;void 0!==a.preferredPayloadType&&(f=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){c+="a=rtcp-fb:"+f+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:
"")+"\r\n"});return c};g.parseSsrcMedia=function(a){var c=a.indexOf(" "),f={ssrc:parseInt(a.substr(7,c-7),10)},g=a.indexOf(":",c);-1<g?(f.attribute=a.substr(c+1,g-c-1),f.value=a.substr(g+1)):f.attribute=a.substr(c+1);return f};g.getMid=function(a){if(a=g.matchPrefix(a,"a=mid:")[0])return a.substr(6)};g.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};g.getDtlsParameters=function(a,c){return{role:"auto",fingerprints:g.matchPrefix(a+c,"a=fingerprint:").map(g.parseFingerprint)}};
g.writeDtlsParameters=function(a,c){var f="a=setup:"+c+"\r\n";a.fingerprints.forEach(function(a){f+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return f};g.getIceParameters=function(a,c){a=g.splitLines(a);a=a.concat(g.splitLines(c));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}};g.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+
a.password+"\r\n"};g.parseRtpParameters=function(a){for(var c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},f=g.splitLines(a)[0].split(" "),d=3;d<f.length;d++){var k=f[d],u=g.matchPrefix(a,"a=rtpmap:"+k+" ")[0];if(u){u=g.parseRtpMap(u);var q=g.matchPrefix(a,"a=fmtp:"+k+" ");u.parameters=q.length?g.parseFmtp(q[0]):{};u.rtcpFeedback=g.matchPrefix(a,"a=rtcp-fb:"+k+" ").map(g.parseRtcpFb);c.codecs.push(u);switch(u.name.toUpperCase()){case "RED":case "ULPFEC":c.fecMechanisms.push(u.name.toUpperCase())}}}g.matchPrefix(a,
"a=extmap:").forEach(function(a){c.headerExtensions.push(g.parseExtmap(a))});return c};g.writeRtpDescription=function(a,c){var f="";f+="m="+a+" ";f+=0<c.codecs.length?"9":"0";f+=" UDP/TLS/RTP/SAVPF ";f+=c.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n";f+="c=IN IP4 0.0.0.0\r\n";f+="a=rtcp:9 IN IP4 0.0.0.0\r\n";c.codecs.forEach(function(a){f+=g.writeRtpMap(a);f+=g.writeFmtp(a);f+=g.writeRtcpFb(a)});var d=0;c.codecs.forEach(function(a){a.maxptime>
d&&(d=a.maxptime)});0<d&&(f+="a=maxptime:"+d+"\r\n");f+="a=rtcp-mux\r\n";c.headerExtensions.forEach(function(a){f+=g.writeExtmap(a)});return f};g.parseRtpEncodingParameters=function(a){var c=[],f=g.parseRtpParameters(a),d=-1!==f.fecMechanisms.indexOf("RED"),k=-1!==f.fecMechanisms.indexOf("ULPFEC"),u=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),q=0<u.length&&u[0].ssrc,r;u=g.matchPrefix(a,"a=ssrc-group:FID").map(function(a){a=
a.split(" ");a.shift();return a.map(function(a){return parseInt(a,10)})});0<u.length&&1<u[0].length&&u[0][0]===q&&(r=u[0][1]);f.codecs.forEach(function(a){"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:q,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:r}},c.push(a),d&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:r,mechanism:k?"red+ulpfec":"red"},c.push(a)))});0===c.length&&q&&c.push({ssrc:q});var t=g.matchPrefix(a,"b=");t.length&&(t=0===t[0].indexOf("b=TIAS:")?parseInt(t[0].substr(7),
10):0===t[0].indexOf("b=AS:")?950*parseInt(t[0].substr(5),10)-16E3:void 0,c.forEach(function(a){a.maxBitrate=t}));return c};g.parseRtcpParameters=function(a){var c={},f=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];f&&(c.cname=f.value,c.ssrc=f.ssrc);f=g.matchPrefix(a,"a=rtcp-rsize");c.reducedSize=0<f.length;c.compound=0===f.length;a=g.matchPrefix(a,"a=rtcp-mux");c.mux=0<a.length;return c};g.parseMsid=function(a){var c=g.matchPrefix(a,
"a=msid:");if(1===c.length)return a=c[0].substr(7).split(" "),{stream:a[0],track:a[1]};a=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});if(0<a.length)return a=a[0].value.split(" "),{stream:a[0],track:a[1]}};g.generateSessionId=function(){return Math.random().toString().substr(2,21)};g.writeSessionBoilerplate=function(a,c){c=void 0!==c?c:2;return"v=0\r\no=thisisadapterortc "+(a?a:g.generateSessionId())+" "+c+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};
g.writeMediaSection=function(a,c,f,d){c=g.writeRtpDescription(a.kind,c);c+=g.writeIceParameters(a.iceGatherer.getLocalParameters());c+=g.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===f?"actpass":"active");c+="a=mid:"+a.mid+"\r\n";c=a.direction?c+("a="+a.direction+"\r\n"):a.rtpSender&&a.rtpReceiver?c+"a=sendrecv\r\n":a.rtpSender?c+"a=sendonly\r\n":a.rtpReceiver?c+"a=recvonly\r\n":c+"a=inactive\r\n";a.rtpSender&&(f="msid:"+d.id+" "+a.rtpSender.track.id+"\r\n",c=c+("a="+f)+("a=ssrc:"+
a.sendEncodingParameters[0].ssrc+" "+f),a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+f,c+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));c+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+g.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+g.localCName+"\r\n");return c};g.getDirection=function(a,c){a=g.splitLines(a);for(var f=
0;f<a.length;f++)switch(a[f]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return a[f].substr(2)}return c?g.getDirection(c):"sendrecv"};g.getKind=function(a){return g.splitLines(a)[0].split(" ")[0].substr(2)};g.isRejected=function(a){return"0"===a.split(" ",2)[1]};g.parseMLine=function(a){a=g.splitLines(a)[0].split(" ");return{kind:a[0].substr(2),port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};"object"===typeof c&&(c.exports=g)},{}],3:[function(a,c,f){f=
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof d?d:{};a=a("./adapter_factory.js");c.exports=a({window:f.window})},{"./adapter_factory.js":4}],4:[function(a,c,f){var g=a("./utils");c.exports=function(c,f){c=c&&c.window;var d={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(k in f)hasOwnProperty.call(f,k)&&(d[k]=f[k]);f=g.log;var k=g.detectBrowser(c);var m=a("./chrome/chrome_shim")||null,u=a("./edge/edge_shim")||null,q=a("./firefox/firefox_shim")||
null,r=a("./safari/safari_shim")||null,t=a("./common_shim")||null,B={browserDetails:k,commonShim:t,extractVersion:g.extractVersion,disableLog:g.disableLog,disableWarnings:g.disableWarnings};switch(k.browser){case "chrome":if(!m||!m.shimPeerConnection||!d.shimChrome){f("Chrome shim is not included in this adapter release.");break}f("adapter.js shimming chrome.");B.browserShim=m;t.shimCreateObjectURL(c);m.shimGetUserMedia(c);m.shimMediaStream(c);m.shimSourceObject(c);m.shimPeerConnection(c);m.shimOnTrack(c);
m.shimAddTrackRemoveTrack(c);m.shimGetSendersWithDtmf(c);t.shimRTCIceCandidate(c);t.shimMaxMessageSize(c);t.shimSendThrowTypeError(c);break;case "firefox":if(!q||!q.shimPeerConnection||!d.shimFirefox){f("Firefox shim is not included in this adapter release.");break}f("adapter.js shimming firefox.");B.browserShim=q;t.shimCreateObjectURL(c);q.shimGetUserMedia(c);q.shimSourceObject(c);q.shimPeerConnection(c);q.shimOnTrack(c);q.shimRemoveStream(c);t.shimRTCIceCandidate(c);t.shimMaxMessageSize(c);t.shimSendThrowTypeError(c);
break;case "edge":if(!u||!u.shimPeerConnection||!d.shimEdge){f("MS edge shim is not included in this adapter release.");break}f("adapter.js shimming edge.");B.browserShim=u;t.shimCreateObjectURL(c);u.shimGetUserMedia(c);u.shimPeerConnection(c);u.shimReplaceTrack(c);t.shimMaxMessageSize(c);t.shimSendThrowTypeError(c);break;case "safari":if(!r||!d.shimSafari){f("Safari shim is not included in this adapter release.");break}f("adapter.js shimming safari.");B.browserShim=r;t.shimCreateObjectURL(c);r.shimRTCIceServerUrls(c);
r.shimCallbacksAPI(c);r.shimLocalStreamsAPI(c);r.shimRemoteStreamsAPI(c);r.shimTrackEventTransceiver(c);r.shimGetUserMedia(c);r.shimCreateOfferLegacy(c);t.shimRTCIceCandidate(c);t.shimMaxMessageSize(c);t.shimSendThrowTypeError(c);break;default:f("Unsupported browser!")}return B}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(a,c,f){var g=a("../utils.js"),d=g.log;c.exports={shimGetUserMedia:a("./getusermedia"),
shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)"RTCRtpTransceiver"in a||g.wrapPeerConnectionEvent(a,"track",function(a){a.transceiver||(a.transceiver={receiver:a.receiver});return a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack);
this.addEventListener("track",this._ontrack=a)}});var c=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var f=this;f._ontrackpoly||(f._ontrackpoly=function(c){c.stream.addEventListener("addtrack",function(g){var d=a.RTCPeerConnection.prototype.getReceivers?f.getReceivers().find(function(a){return a.track&&a.track.id===g.track.id}):{track:g.track};var k=new Event("track");k.track=g.track;k.receiver=d;k.transceiver={receiver:d};k.streams=
[c.stream];f.dispatchEvent(k)});c.stream.getTracks().forEach(function(g){var d=a.RTCPeerConnection.prototype.getReceivers?f.getReceivers().find(function(a){return a.track&&a.track.id===g.id}):{track:g};var k=new Event("track");k.track=g;k.receiver=d;k.transceiver={receiver:d};k.streams=[c.stream];f.dispatchEvent(k)})},f.addEventListener("addstream",f._ontrackpoly));return c.apply(f,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"===typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&
"createDTMFSender"in a.RTCPeerConnection.prototype){var c=function(a,c){return{track:c,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===c.kind?a.createDTMFSender(c):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var f=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,g){var d=f.apply(this,arguments);d||(d=c(this,
a),this._senders.push(d));return d};var g=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){g.apply(this,arguments);var c=this._senders.indexOf(a);-1!==c&&this._senders.splice(c,1)}}var d=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var f=this;f._senders=f._senders||[];d.apply(f,[a]);a.getTracks().forEach(function(a){f._senders.push(c(f,a))})};var k=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=
function(a){var c=this;c._senders=c._senders||[];k.apply(c,[a]);a.getTracks().forEach(function(a){var f=c._senders.find(function(c){return c.track===a});f&&c._senders.splice(c._senders.indexOf(f),1)})}}else if("object"===typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var m=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=
this,c=m.apply(a,[]);c.forEach(function(c){c._pc=a});return c};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}},shimSourceObject:function(a){var c=a&&a.URL;"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var f=
this;this._srcObject=a;this.src&&c.revokeObjectURL(this.src);a?(this.src=c.createObjectURL(a),a.addEventListener("addtrack",function(){f.src&&c.revokeObjectURL(f.src);f.src=c.createObjectURL(a)}),a.addEventListener("removetrack",function(){f.src&&c.revokeObjectURL(f.src);f.src=c.createObjectURL(a)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(c){return a._shimmedLocalStreams[c][0]})};
var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,f){if(!f)return c.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var g=c.apply(this,arguments);this._shimmedLocalStreams[f.id]?-1===this._shimmedLocalStreams[f.id].indexOf(g)&&this._shimmedLocalStreams[f.id].push(g):this._shimmedLocalStreams[f.id]=[f,g];return g};var f=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;this._shimmedLocalStreams=
this._shimmedLocalStreams||{};a.getTracks().forEach(function(a){if(c.getSenders().find(function(c){return c.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});var g=c.getSenders();f.apply(this,arguments);var d=c.getSenders().filter(function(a){return-1===g.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(d)};var g=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||
{};delete this._shimmedLocalStreams[a.id];return g.apply(this,arguments)};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var c=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(function(f){var g=c._shimmedLocalStreams[f].indexOf(a);-1!==g&&c._shimmedLocalStreams[f].splice(g,1);1===c._shimmedLocalStreams[f].length&&delete c._shimmedLocalStreams[f]});return d.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function c(a,
c){var f=c.sdp;Object.keys(a._reverseStreams||[]).forEach(function(c){c=a._reverseStreams[c];f=f.replace(new RegExp(a._streams[c.id].id,"g"),c.id)});return new RTCSessionDescription({type:c.type,sdp:f})}function f(a,c){var f=c.sdp;Object.keys(a._reverseStreams||[]).forEach(function(c){c=a._reverseStreams[c];f=f.replace(new RegExp(c.id,"g"),a._streams[c.id].id)});return new RTCSessionDescription({type:c.type,sdp:f})}var d=g.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=d.version)return this.shimAddTrackRemoveTrackWithNative(a);
var k=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,c=k.apply(this);a._reverseStreams=a._reverseStreams||{};return c.map(function(c){return a._reverseStreams[c.id]})};var m=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(c){var f=this;f._streams=f._streams||{};f._reverseStreams=f._reverseStreams||{};c.getTracks().forEach(function(a){if(f.getSenders().find(function(c){return c.track===a}))throw new DOMException("Track already exists.",
"InvalidAccessError");});if(!f._reverseStreams[c.id]){var g=new a.MediaStream(c.getTracks());f._streams[c.id]=g;f._reverseStreams[g.id]=c;c=g}m.apply(f,[c])};var r=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};r.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=
function(c,f){var g=this;if("closed"===g.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(function(a){return a===c}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(g.getSenders().find(function(a){return a.track===c}))throw new DOMException("Track already exists.",
"InvalidAccessError");g._streams=g._streams||{};g._reverseStreams=g._reverseStreams||{};(d=g._streams[f.id])?(d.addTrack(c),Promise.resolve().then(function(){g.dispatchEvent(new Event("negotiationneeded"))})):(d=new a.MediaStream([c]),g._streams[f.id]=d,g._reverseStreams[d.id]=f,g.addStream(d));return g.getSenders().find(function(a){return a.track===c})};["createOffer","createAnswer"].forEach(function(f){var g=a.RTCPeerConnection.prototype[f];a.RTCPeerConnection.prototype[f]=function(){var a=this,
f=arguments;return arguments.length&&"function"===typeof arguments[0]?g.apply(a,[function(g){g=c(a,g);f[0].apply(null,[g])},function(a){f[1]&&f[1].apply(null,a)},arguments[2]]):g.apply(a,arguments).then(function(f){return c(a,f)})}});var t=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type)return t.apply(this,arguments);arguments[0]=f(this,arguments[0]);return t.apply(this,arguments)};var B=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,
"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=B.get.apply(this);return""===a.type?a:c(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){var c=this;if("closed"===c.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==
c)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");c._streams=c._streams||{};var f;Object.keys(c._streams).forEach(function(g){c._streams[g].getTracks().find(function(c){return a.track===c})&&(f=c._streams[g])});f&&(1===f.getTracks().length?c.removeStream(c._reverseStreams[f.id]):f.removeTrack(a.track),c.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(a){var c=g.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection)a.RTCPeerConnection=
function(c,f){d("PeerConnection");c&&c.iceTransportPolicy&&(c.iceTransports=c.iceTransportPolicy);return new a.webkitRTCPeerConnection(c,f)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}});else{var f=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var d=[],k=0;k<a.iceServers.length;k++){var m=
a.iceServers[k];!m.hasOwnProperty("urls")&&m.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),m=JSON.parse(JSON.stringify(m)),m.urls=m.url,d.push(m)):d.push(a.iceServers[k])}a.iceServers=d}return new f(a,c)};a.RTCPeerConnection.prototype=f.prototype;Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return f.generateCertificate}})}var k=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,f){var g=this,d=
arguments;if(0<arguments.length&&"function"===typeof a)return k.apply(this,arguments);if(0===k.length&&(0===arguments.length||"function"!==typeof arguments[0]))return k.apply(this,[]);var m=function(a){var c={};a.result().forEach(function(a){var f={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(c){f[c]=a.stat(c)});c[f.id]=f});return c},p=function(a){return new Map(Object.keys(a).map(function(c){return[c,
a[c]]}))};return 2<=arguments.length?k.apply(this,[function(a){d[1](p(m(a)))},arguments[0]]):(new Promise(function(a,c){k.apply(g,[function(c){a(p(m(c)))},c])})).then(c,f)};51>c.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){var f=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=arguments,c=this,g=new Promise(function(g,d){f.apply(c,[a[0],g,d])});return 2>a.length?g:g.then(function(){a[1].apply(null,[])},function(c){3<=
a.length&&a[2].apply(null,[c])})}});52>c.version&&["createOffer","createAnswer"].forEach(function(c){var f=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var c=1===arguments.length?arguments[0]:void 0;return new Promise(function(g,d){f.apply(a,[g,d,c])})}return f.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){var f=a.RTCPeerConnection.prototype[c];
a.RTCPeerConnection.prototype[c]=function(){arguments[0]=new ("addIceCandidate"===c?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return f.apply(this,arguments)}});var m=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?m.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":13,"./getusermedia":6}],6:[function(a,c,f){var g=a("../utils.js"),d=g.log;c.exports=function(a){var c=
g.detectBrowser(a),f=a&&a.navigator,k=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var c={};Object.keys(a).forEach(function(f){if("require"!==f&&"advanced"!==f&&"mediaSource"!==f){var g="object"===typeof a[f]?a[f]:{ideal:a[f]};void 0!==g.exact&&"number"===typeof g.exact&&(g.min=g.max=g.exact);var d=function(a,c){return a?a+c.charAt(0).toUpperCase()+c.slice(1):"deviceId"===c?"sourceId":c};if(void 0!==g.ideal){c.optional=c.optional||[];var k={};"number"===typeof g.ideal?(k[d("min",
f)]=g.ideal,c.optional.push(k),k={},k[d("max",f)]=g.ideal):k[d("",f)]=g.ideal;c.optional.push(k)}void 0!==g.exact&&"number"!==typeof g.exact?(c.mandatory=c.mandatory||{},c.mandatory[d("",f)]=g.exact):["min","max"].forEach(function(a){void 0!==g[a]&&(c.mandatory=c.mandatory||{},c.mandatory[d(a,f)]=g[a])})}});a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced));return c},m=function(a,g){if(61<=c.version)return g(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===typeof a.audio){var m=function(a,
c,f){c in a&&!(f in a)&&(a[f]=a[c],delete a[c])};a=JSON.parse(JSON.stringify(a));m(a.audio,"autoGainControl","googAutoGainControl");m(a.audio,"noiseSuppression","googNoiseSuppression");a.audio=k(a.audio)}if(a&&"object"===typeof a.video){var p=a.video.facingMode;p=p&&("object"===typeof p?p:{ideal:p});m=66>c.version;if(!(!p||"user"!==p.exact&&"environment"!==p.exact&&"user"!==p.ideal&&"environment"!==p.ideal||f.mediaDevices.getSupportedConstraints&&f.mediaDevices.getSupportedConstraints().facingMode&&
!m)){delete a.video.facingMode;if("environment"===p.exact||"environment"===p.ideal)var n=["back","rear"];else if("user"===p.exact||"user"===p.ideal)n=["front"];if(n)return f.mediaDevices.enumerateDevices().then(function(c){c=c.filter(function(a){return"videoinput"===a.kind});var f=c.find(function(a){return n.some(function(c){return-1!==a.label.toLowerCase().indexOf(c)})});!f&&c.length&&-1!==n.indexOf("back")&&(f=c[c.length-1]);f&&(a.video.deviceId=p.exact?{exact:f.deviceId}:{ideal:f.deviceId});a.video=
k(a.video);d("chrome: "+JSON.stringify(a));return g(a)})}a.video=k(a.video)}d("chrome: "+JSON.stringify(a));return g(a)},q=function(a){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,
toString:function(){return this.name+(this.message&&": ")+this.message}}};f.getUserMedia=function(a,c,g){m(a,function(a){f.webkitGetUserMedia(a,c,function(a){g&&g(q(a))})})};var r=function(a){return new Promise(function(c,g){f.getUserMedia(a,c,g)})};f.mediaDevices||(f.mediaDevices={getUserMedia:r,enumerateDevices:function(){return new Promise(function(c){var f={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){c(a.map(function(a){return{label:a.label,kind:f[a.kind],
deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});if(f.mediaDevices.getUserMedia){var t=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){return m(a,function(a){return t(a).then(function(c){if(a.audio&&!c.getAudioTracks().length||a.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");
return c},function(a){return Promise.reject(q(a))})})}}else f.mediaDevices.getUserMedia=function(a){return r(a)};"undefined"===typeof f.mediaDevices.addEventListener&&(f.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof f.mediaDevices.removeEventListener&&(f.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(a,c,f){var g=a("sdp"),d=a("./utils");c.exports=
{shimRTCIceCandidate:function(a){if(!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var c=a.RTCIceCandidate;a.RTCIceCandidate=function(a){"object"===typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2));var f=new c(a);a=g.parseCandidate(a.candidate);var d=Object.assign(f,a);d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}};return d};
d.wrapPeerConnectionEvent(a,"icecandidate",function(c){c.candidate&&Object.defineProperty(c,"candidate",{value:new a.RTCIceCandidate(c.candidate),writable:"false"});return c})}},shimCreateObjectURL:function(a){var c=a&&a.URL;if("object"===typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&c.createObjectURL&&c.revokeObjectURL){var f=c.createObjectURL.bind(c),g=c.revokeObjectURL.bind(c),k=new Map,m=0;c.createObjectURL=function(a){if("getTracks"in a){var c="polyblob:"+ ++m;k.set(c,
a);d.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return c}return f(a)};c.revokeObjectURL=function(a){g(a);k.delete(a)};var r=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return r.get.apply(this)},set:function(a){this.srcObject=k.get(a)||null;return r.set.apply(this,[a])}});var t=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){2===arguments.length&&
"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=k.get(arguments[1])||null);return t.apply(this,arguments)}}},shimMaxMessageSize:function(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var c=d.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var f=function(a){a=g.splitSections(a.sdp);a.shift();return a.some(function(a){return(a=g.parseMLine(a))&&"application"===
a.kind&&-1!==a.protocol.indexOf("SCTP")})},k=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},m=function(a){var f=65536;"firefox"===c.browser&&(f=57>c.version?-1===a?16384:2147483637:57===c.version?65535:65536);return f},q=function(a,f){var d=65536;"firefox"===c.browser&&57===c.version&&(d=65535);a=g.matchPrefix(a.sdp,"a=max-message-size:");0<a.length?d=parseInt(a[0].substr(19),10):"firefox"===c.browser&&-1!==f&&(d=
2147483637);return d},r=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if(f(arguments[0])){var a=k(arguments[0]),c=m(a);a=q(arguments[0],a);var g=0===c&&0===a?Number.POSITIVE_INFINITY:0===c||0===a?Math.max(c,a):Math.min(c,a);c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return g}});this._sctp=c}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(a){var c=a.RTCPeerConnection.prototype.createDataChannel;
a.RTCPeerConnection.prototype.createDataChannel=function(){var a=this,f=c.apply(a,arguments),g=f.send;f.send=function(){var c=arguments[0];if((c.length||c.size||c.byteLength)>a.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)","TypeError");return g.apply(this,arguments)};return f}}}},{"./utils":13,sdp:2}],8:[function(a,c,f){var g=a("../utils"),d=a("rtcpeerconnection-shim");c.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection:function(a){var c=
g.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),15025>c.version)){var f=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){f.set.call(this,a);var c=new Event("enabled");c.enabled=a;this.dispatchEvent(c)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,
"dtmf",{get:function(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null));return this._dtmf}});a.RTCPeerConnection=d(a,c.version)},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(a,c,f){c.exports=function(a){a=a&&a.navigator;var c=
function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},f=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(a){return f(a).catch(function(a){return Promise.reject(c(a))})}}},{}],10:[function(a,c,f){var g=a("../utils");c.exports={shimGetUserMedia:a("./getusermedia"),shimOnTrack:function(a){"object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||
Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(c){var f=new Event("track");f.track=c;f.receiver={track:c};f.transceiver={receiver:f.receiver};f.streams=[a.stream];
this.dispatchEvent(f)}.bind(this))}.bind(this))}});"object"===typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},
set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var c=g.detectBrowser(a);if("object"===typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(f,g){if(38>c.version&&f&&f.iceServers){for(var d=[],k=0;k<f.iceServers.length;k++){var m=f.iceServers[k];if(m.hasOwnProperty("urls"))for(var p=0;p<m.urls.length;p++){var n={url:m.urls[p]};0===m.urls[p].indexOf("turn")&&(n.username=m.username,n.credential=m.credential);d.push(n)}else d.push(f.iceServers[k])}f.iceServers=
d}return new a.mozRTCPeerConnection(f,g)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){var f=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=
function(){arguments[0]=new ("addIceCandidate"===c?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return f.apply(this,arguments)}});var f=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?f.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var d=function(a){var c=new Map;Object.keys(a).forEach(function(f){c.set(f,a[f]);c[f]=a[f]});return c},k={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",
candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},u=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,f,g){return u.apply(this,[a||null]).then(function(a){48>c.version&&(a=d(a));if(53>c.version&&!f)try{a.forEach(function(a){a.type=k[a.type]||a.type})}catch(A){if("TypeError"!==A.name)throw A;a.forEach(function(c,f){a.set(f,Object.assign({},c,{type:k[c.type]||c.type}))})}return a}).then(f,g)}}},shimRemoveStream:function(a){!a.RTCPeerConnection||
"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var c=this;g.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(f){f.track&&-1!==a.getTracks().indexOf(f.track)&&c.removeTrack(f)})})}}},{"../utils":13,"./getusermedia":11}],11:[function(a,c,f){var g=a("../utils"),d=g.log;c.exports=function(a){var c=g.detectBrowser(a),f=a&&a.navigator;a=a&&a.MediaStreamTrack;var k=function(a){return{name:{InternalError:"NotReadableError",
NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},m=function(a,g,m){var p=function(a){if("object"!==typeof a||a.require)return a;var c=[];Object.keys(a).forEach(function(f){if("require"!==
f&&"advanced"!==f&&"mediaSource"!==f){var g=a[f]="object"===typeof a[f]?a[f]:{ideal:a[f]};void 0===g.min&&void 0===g.max&&void 0===g.exact||c.push(f);void 0!==g.exact&&("number"===typeof g.exact?g.min=g.max=g.exact:a[f]=g.exact,delete g.exact);if(void 0!==g.ideal){a.advanced=a.advanced||[];var d={};d[f]="number"===typeof g.ideal?{min:g.ideal,max:g.ideal}:g.ideal;a.advanced.push(d);delete g.ideal;Object.keys(g).length||delete a[f]}}});c.length&&(a.require=c);return a};a=JSON.parse(JSON.stringify(a));
38>c.version&&(d("spec: "+JSON.stringify(a)),a.audio&&(a.audio=p(a.audio)),a.video&&(a.video=p(a.video)),d("ff37: "+JSON.stringify(a)));return f.mozGetUserMedia(a,g,function(a){m(k(a))})},q=function(a){return new Promise(function(c,f){m(a,c,f)})};f.mediaDevices||(f.mediaDevices={getUserMedia:q,addEventListener:function(){},removeEventListener:function(){}});f.mediaDevices.enumerateDevices=f.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",
label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>c.version){var r=f.mediaDevices.enumerateDevices.bind(f.mediaDevices);f.mediaDevices.enumerateDevices=function(){return r().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}if(49>c.version){var t=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){return t(a).then(function(c){if(a.audio&&!c.getAudioTracks().length||a.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(function(a){a.stop()}),
new DOMException("The object can not be found here.","NotFoundError");return c},function(a){return Promise.reject(k(a))})}}if(!(55<c.version&&"autoGainControl"in f.mediaDevices.getSupportedConstraints())){var B=function(a,c,f){c in a&&!(f in a)&&(a[f]=a[c],delete a[c])},A=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){"object"===typeof a&&"object"===typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),B(a.audio,"autoGainControl","mozAutoGainControl"),B(a.audio,
"noiseSuppression","mozNoiseSuppression"));return A(a)};if(a&&a.prototype.getSettings){var F=a.prototype.getSettings;a.prototype.getSettings=function(){var a=F.apply(this,arguments);B(a,"mozAutoGainControl","autoGainControl");B(a,"mozNoiseSuppression","noiseSuppression");return a}}if(a&&a.prototype.applyConstraints){var E=a.prototype.applyConstraints;a.prototype.applyConstraints=function(a){"audio"===this.kind&&"object"===typeof a&&(a=JSON.parse(JSON.stringify(a)),B(a,"autoGainControl","mozAutoGainControl"),
B(a,"noiseSuppression","mozNoiseSuppression"));return E.apply(this,[a])}}}f.getUserMedia=function(a,d,k){if(44>c.version)return m(a,d,k);g.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");f.mediaDevices.getUserMedia(a).then(d,k)}}},{"../utils":13}],12:[function(a,c,f){var g=a("../utils");c.exports={shimLocalStreamsAPI:function(a){if("object"===typeof a&&a.RTCPeerConnection){"getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=
function(){this._localStreams||(this._localStreams=[]);return this._localStreams});"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var c=null;this._localStreams&&this._localStreams.forEach(function(f){f.id===a&&(c=f)});this._remoteStreams&&this._remoteStreams.forEach(function(f){f.id===a&&(c=f)});return c});if(!("addStream"in a.RTCPeerConnection.prototype)){var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=
function(a){this._localStreams||(this._localStreams=[]);-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);var f=this;a.getTracks().forEach(function(g){c.call(f,g,a)})};a.RTCPeerConnection.prototype.addTrack=function(a,f){f&&(this._localStreams?-1===this._localStreams.indexOf(f)&&this._localStreams.push(f):this._localStreams=[f]);return c.call(this,a,f)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=
[]);var c=this._localStreams.indexOf(a);if(-1!==c){this._localStreams.splice(c,1);var f=this,g=a.getTracks();this.getSenders().forEach(function(a){-1!==g.indexOf(a.track)&&f.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){"object"===typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,
"onaddstream",{get:function(){return this._onaddstream},set:function(a){var c=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){c._remoteStreams||(c._remoteStreams=[]);if(!(0<=c._remoteStreams.indexOf(a))){c._remoteStreams.push(a);var f=new Event("addstream");f.stream=
a;c.dispatchEvent(f)}})})}}))},shimCallbacksAPI:function(a){if("object"===typeof a&&a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;var c=a.createOffer,f=a.createAnswer,g=a.setLocalDescription,d=a.setRemoteDescription,k=a.addIceCandidate;a.createOffer=function(a,f){var g=c.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!f)return g;g.then(a,f);return Promise.resolve()};a.createAnswer=function(a,c){var g=f.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!c)return g;
g.then(a,c);return Promise.resolve()};var q=function(a,c,f){a=g.apply(this,[a]);if(!f)return a;a.then(c,f);return Promise.resolve()};a.setLocalDescription=q;q=function(a,c,f){a=d.apply(this,[a]);if(!f)return a;a.then(c,f);return Promise.resolve()};a.setRemoteDescription=q;q=function(a,c,f){a=k.apply(this,[a]);if(!f)return a;a.then(c,f);return Promise.resolve()};a.addIceCandidate=q}},shimGetUserMedia:function(a){var c=a&&a.navigator;c.getUserMedia||(c.webkitGetUserMedia?c.getUserMedia=c.webkitGetUserMedia.bind(c):
c.mediaDevices&&c.mediaDevices.getUserMedia&&(c.getUserMedia=function(a,f,g){c.mediaDevices.getUserMedia(a).then(f,g)}.bind(c)))},shimRTCIceServerUrls:function(a){var c=a.RTCPeerConnection;a.RTCPeerConnection=function(a,f){if(a&&a.iceServers){for(var d=[],k=0;k<a.iceServers.length;k++){var m=a.iceServers[k];!m.hasOwnProperty("urls")&&m.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),m=JSON.parse(JSON.stringify(m)),m.urls=m.url,delete m.url,d.push(m)):d.push(a.iceServers[k])}a.iceServers=
d}return new c(a,f)};a.RTCPeerConnection.prototype=c.prototype;"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return c.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"===typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var c=
a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){var f=this.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&f?"sendrecv"===f.direction?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":"recvonly"===f.direction&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):!0!==a.offerToReceiveAudio||f||this.addTransceiver("audio");f=this.getTransceivers().find(function(a){return a.sender.track&&
"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&f?"sendrecv"===f.direction?f.setDirection("sendonly"):"recvonly"===f.direction&&f.setDirection("inactive"):!0!==a.offerToReceiveVideo||f||this.addTransceiver("video")}return c.apply(this,arguments)}}}},{"../utils":13}],13:[function(a,c,f){function g(a,c,f){return(a=a.match(c))&&a.length>=f&&parseInt(a[f],10)}var k=!0,m=!0;c.exports={extractVersion:g,wrapPeerConnectionEvent:function(a,c,f){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;
var g=a.addEventListener;a.addEventListener=function(a,d){if(a!==c)return g.apply(this,arguments);var k=function(a){d(f(a))};this._eventMap=this._eventMap||{};this._eventMap[d]=k;return g.apply(this,[a,k])};var d=a.removeEventListener;a.removeEventListener=function(a,f){if(a!==c||!this._eventMap||!this._eventMap[f])return d.apply(this,arguments);var g=this._eventMap[f];delete this._eventMap[f];return d.apply(this,[a,g])};Object.defineProperty(a,"on"+c,{get:function(){return this["_on"+c]},set:function(a){this["_on"+
c]&&(this.removeEventListener(c,this["_on"+c]),delete this["_on"+c]);a&&this.addEventListener(c,this["_on"+c]=a)}})}},disableLog:function(a){return"boolean"!==typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(k=a)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(a){if("boolean"!==typeof a)return Error("Argument type: "+typeof a+". Please use a boolean.");m=!a;return"adapter.js deprecation warnings "+(a?"disabled":"enabled")},log:function(){"object"!==
typeof d||k||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)},deprecated:function(a,c){m&&console.warn(a+" is deprecated, please use "+c+" instead.")},detectBrowser:function(a){var c=a&&a.navigator,f={browser:null,version:null};if("undefined"===typeof a||!a.navigator)return f.browser="Not a browser.",f;c.mozGetUserMedia?(f.browser="firefox",f.version=g(c.userAgent,/Firefox\/(\d+)\./,1)):c.webkitGetUserMedia?(f.browser="chrome",f.version=g(c.userAgent,
/Chrom(e|ium)\/(\d+)\./,2)):c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/)?(f.browser="edge",f.version=g(c.userAgent,/Edge\/(\d+).(\d+)$/,2)):c.mediaDevices&&c.userAgent.match(/AppleWebKit\/(\d+)\./)?(f.browser="safari",f.version=g(c.userAgent,/AppleWebKit\/(\d+)\./,1)):f.browser="Not a supported browser.";return f}}},{}]},{},[3])(3)});d.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(b){virtualclass.system.getusermedia&&(b.mozGetUserMedia?(this.attachMediaStream=
function(a,c){this.videoAdd=!0;var b=d.URL||d.webkitURL;a.src=b?b.createObjectURL(c):c;a.play()},reattachMediaStream=function(a,c){console.log("Reattaching media stream");a.mozSrcObject=c.mozSrcObject;a.play()}):b.webkitGetUserMedia?(console.log("This appears to be Chrome"),this.attachMediaStream=function(a,c){var b=d.URL||d.webkitURL;a.src=b?b.createObjectURL(c):c;a.play();this.videoAdd=!0},reattachMediaStream=function(a,c){a.src=c.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=
function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):b.mediaDevices?this.attachMediaStream=function(a,c){var b=d.URL||d.webkitURL;a.src=b?b.createObjectURL(c):c;a.play()}:console.log("Browser does not appear to be WebRTC-capable"));
return b}}}})(window);function Resampler(d,b,a,c,f){this.fromSampleRate=d;this.toSampleRate=b;this.channels=a|0;this.outputBufferSize=c;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};
Resampler.prototype.compileLinearInterpolationFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = this.lastWeight;\t\t\tvar firstWeight = 0;\t\t\tvar secondWeight = 0;\t\t\tvar sourceOffset = 0;\t\t\tvar outputOffset = 0;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tfor (; weight < 1; weight += ratioWeight) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;",b=
0;b<this.channels;++b)d+="outputBuffer[outputOffset++] = (this.lastOutput["+b+"] * firstWeight) + (buffer["+b+"] * secondWeight);";d+="}\t\t\tweight -= 1;\t\t\tfor (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;";for(b=0;b<this.channels;++b)d+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(0<b?" + "+b:"")+"] * firstWeight) + (buffer[sourceOffset + "+
(this.channels+b)+"] * secondWeight);";d+="weight += ratioWeight;\t\t\t\tsourceOffset = Math.floor(weight) * "+this.channels+";\t\t\t}";for(b=0;b<this.channels;++b)d+="this.lastOutput["+b+"] = buffer[sourceOffset++];";this.resampler=Function("buffer",d+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.compileMultiTapFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = 0;",b=0;b<this.channels;++b)d+="var output"+b+" = 0;";d+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";
for(b=0;b<this.channels;++b)d+="output"+b+" = 0;";d+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(b=0;b<this.channels;++b)d+="output"+b+" = this.lastOutput["+b+"];";d+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(b=0;b<this.channels;++b)d+="output"+b+" += buffer[actualPosition++] * amountToNext;";d+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";
for(b=0;b<this.channels;++b)d+="output"+b+" += buffer[actualPosition"+(0<b?" + "+b:"")+"] * weight;";d+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(b=0;b<this.channels;++b)d+="outputBuffer[outputOffset++] = output"+b+" / ratioWeight;";d+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(b=0;b<this.channels;++b)d+="this.lastOutput["+b+"] = output"+b+";";this.resampler=Function("buffer",d+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(d){return this.noReturn?(this.outputBuffer=d,d.length):d};Resampler.prototype.bufferSlice=function(d){if(this.noReturn)return d;try{return this.outputBuffer.subarray(0,d)}catch(b){try{return this.outputBuffer.length=d,this.outputBuffer}catch(a){return this.outputBuffer.slice(0,d)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(d){this.outputBuffer=[],this.lastOutput=[]}};(function(d){var b={},a={},c={},f,g=[],k=0,m=repMode=!1,n;d.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",CONFIG:{width:{max:268},height:{max:142},frameRate:{max:6}},audioPlayerNode:null,audioCreatorNode:null,util:{imageReplaceWithVideo:function(a,c){var b=chatContainerEvent.elementFromShadowDom("#ml"+a);chatContainerEvent.elementFromShadowDom("#ml"+
a)&&b.classList.remove("userImg");if(null!=b){a=b.getElementsByTagName("a")[0];b=a.getElementsByTagName("span")[0]||a.getElementsByTagName("img")[0];a.classList.contains("hasVideo")||(a.className+=" hasVideo");var f=a.querySelector(".videoWrapper");null==b&&void 0==b&&null!=f?(a.removeChild(f),a.appendChild(c)):a.replaceChild(c,b)}else console.log("chatUser is Null")}},audioVisual:{init:function(){this.audioCtx=new (d.AudioContext||d.webkitAudioContext);this.analyser=this.audioCtx.createAnalyser();
this.analyser.minDecibels=-90;this.analyser.maxDecibels=-10;this.analyser.smoothingTimeConstant=.85;this.distortion=this.audioCtx.createWaveShaper();this.gainNode=this.audioCtx.createGain();this.biquadFilter=this.audioCtx.createBiquadFilter();this.convolver=this.audioCtx.createConvolver()},readyForVisual:function(a){this.source=this.audioCtx.createMediaStreamSource(a);this.source.connect(this.analyser);this.analyser.connect(this.distortion);this.distortion.connect(this.biquadFilter);this.biquadFilter.connect(this.convolver);
this.convolver.connect(this.gainNode);this.gainNode.connect(this.audioCtx.destination)}},workerAudioSendOnmessage:function(){workerAudioSend.onmessage=function(a){a.data.hasOwnProperty("cmd")&&("adStatus"===a.data.cmd?(virtualclass.media.audio.setAudioStatus(a.data.msg),virtualclass.gObj.sendAudioStatus||"sending"!=a.data.msg||(ioAdapter.send({cf:"ya"}),virtualclass.gObj.sendAudioStatus=!0)):"ioAdapterSend"===a.data.cmd?(virtualclass.gObj.sendAudioStatus="na"===a.data.msg.cf?!1:!0,ioAdapter.send(a.data.msg)):
"muteAudio"===a.data.cmd?cthis.audio.notifiyMuteAudio():"unMuteAudio"===a.data.cmd&&cthis.audio.notifiyUnmuteAudio())}},audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",snode:[],workletAudioRec:!1,aChunksPlay:!1,audioContextReady:!1,init:function(){var a=document.getElementById("speakerPressOnce").dataset.audioPlaying;virtualclass.gObj.audMouseDown="true"==a?!0:!1;this.graph={height:56,
width:4,average:0,display:function(){var a=cthis.video;roles.hasControls()&&this._display(a.tempVidCont,this.height-this.height*this.average/100)},_display:function(a,c){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,c);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()}};this.attachFunctionsToAudioWidget()},initAudiocontext:function(){this.hasOwnProperty("Html5Audio")||virtualclass.gObj.meetingMode||(this.Html5Audio={audioContext:new (d.AudioContext||
d.webkitAudioContext)},null==virtualclass.media.audio.Html5Audio.audioContext&&alert("audio context is null"),this.resampler=new Resampler(virtualclass.media.audio.Html5Audio.audioContext.sampleRate,8E3,1,4096),this.audioContextReady=virtualclass.gObj.isAudioContextReady=!0,virtualclass.system.mediaDevices.hasMicrophone&&!virtualclass.isPlayMode&&null!=cthis.video.tempStream&&(virtualclass.media.stream=cthis.video.tempStream,virtualclass.media.audio._maniPulateStream()))},initScriptNode:function(){for(var a=
0;a<this.snode.length;a++)this._playWithFallback(this.snode[a]);this.snode=[]},attachAudioStopHandler:function(a){audioTrack=a.getAudioTracks()[0];null!=audioTrack&&(audioTrack.onended=this.notifiyMuteAudio,audioTrack.onmute=this.notifiyMuteAudio,audioTrack.onunmute=this.notifiyUnmuteAudio)},notifiyMuteAudio:function(){this.notifyAudioMute=!0;virtualclass.gObj.audMouseDown&&(virtualclass.gObj.mutedomop?virtualclass.gObj.hasOwnProperty("mutedomopto")&&null!==virtualclass.gObj.mutedomopto||(virtualclass.gObj.mutedomopto=
setTimeout(function(){cthis.audio.notifiyMuteAudioDom()},2E3)):cthis.audio.notifiyMuteAudioDom())},notifiyUnmuteAudio:function(){this.notifyAudioMute=!1;virtualclass.gObj.mutedomop=!0;virtualclass.gObj.hasOwnProperty("mutedomopto")&&(clearTimeout(virtualclass.gObj.mutedomopto),virtualclass.gObj.mutedomopto=null);cthis.audio.notifiyUnmuteAudioDom()},notifiyUnmuteAudioDom:function(){this.hasOwnProperty("speakerPressOnce")&&null!=this.speakerPressOnce&&this.speakerPressOnce.classList.contains("audioMute")&&
this.speakerPressOnce.classList.remove("audioMute")},notifiyMuteAudioDom:function(){this.hasOwnProperty("speakerPressOnce")||(this.speakerPressOnce=document.querySelector("#speakerPressOnce"));null==this.speakerPressOnce||this.speakerPressOnce.classList.contains("audioMute")||this.speakerPressOnce.classList.add("audioMute")},muteButtonToogle:function(){var a=document.querySelector("#speakerPressOnce");null!=a&&a.dataset.audioPlaying&&"true"==a.dataset.audioPlaying&&a.click()},audioSend:function(a,
c){if(virtualclass.gObj.audMouseDown&&io.webSocketConnected()){var b=virtualclass.vutil.breakintobytes(virtualclass.gObj.uid,8);b=new Int8Array([101,b[0],b[1],b[2],b[3]]);var f=new Int8Array(a.length+b.length);f.set(b);f.set(a,b.length);ioAdapter.sendBinary(f);virtualclass.media.audio.setAudioStatus(c)}else virtualclass.media.audio.setAudioStatus("stop")},setAudioStatus:function(a){var c;"undefined"==typeof c&&(c=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0]);c.setAttribute("data-silence-detect",
a)},makeIconNotDraggable:function(a,c){var b=document.getElementById(a,c).getContext("2d"),f=new Image;f.onload=function(){b.drawImage(f,0,0)};f.src=d.whiteboardPath+"images/"+c},attachFunctionsToAudioWidget:function(){for(var a=document.getElementById("audioWidget").getElementsByClassName("audioTool"),c=0;c<a.length;c++)"speakerPressOnce"!==a[c].id&&"speakerPressing"===a[c].id&&this.attachSpeakToStudent(a[c].id),"speakerPressing"!==a[c].id&&a[c].addEventListener("click",this.audioToolInit)},audioToolInit:function(){if(virtualclass.gObj.meetingMode){var a=
document.getElementById(this.id);"false"==a.getAttribute("data-audio-playing")&&"undefined"==typeof alwaysDisable?(virtualclass.vutil.audioStatus(a,"true"),a=!0):(virtualclass.vutil.audioStatus(a,"false"),a=!1);virtualclass.multiVideo.setAudioStatus(a)}else a=virtualclass.media.audio,"speakerPressOnce"===this.id?a.clickOnceSpeaker(this.id):"silenceDetect"===this.id&&(this.getElementsByTagName("a"),a.sd?(a.sd=!1,this.className+=" sdDisable"):(a.sd=!0,this.className+=" sdEnable"))},attachSpeakToStudent:function(a){var c=
this,b=document.getElementById(a),f=!1;b.addEventListener("mousedown",function(){if(!virtualclass.gObj.audMouseDown){c.studentSpeak(b);f=!0;var a=document.getElementById("speakerPressonceLabel");null!=a&&virtualclass.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),0>=a.classList.length&&a.removeAttribute("class"),a=a.getElementsByTagName("i")[0],null!=a&&(a.setAttribute("data-silence-detect",
"stop"),a.className+=" silenceDetect"))}});b.addEventListener("mouseup",function(){if(f){c.studentNotSpeak(b);f=!1;var a=document.getElementById("speakerPressonceLabel"),g=a.getElementsByTagName("i")[0];"undefined"!=typeof g.classList&&g.classList.contains("silenceDetect")&&(g.classList.remove("silenceDetect"),0>=g.classList.length&&g.removeAttribute("class"),a.removeAttribute("data-silence-detect"));null!==a&&(a.setAttribute("data-silence-detect","stop"),a.className=g.className+" silenceDetect")}})},
attachAudioPressOnce:function(){var a=document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");var c=this;a.addEventListener("click",function(){c.clickOnceSpeaker.call(c,a.id)})},clickOnceSpeaker:function(a,c){a=document.getElementById(a);document.getElementById("speakerPressing");var b=a.getElementsByClassName("congtooltip")[0];"false"===a.getAttribute("data-audio-playing")&&"undefined"==typeof c?(this.studentSpeak(),a.setAttribute("data-audio-playing","true"),b.setAttribute("data-title",
virtualclass.lang.getString("audioEnable")),a.className="audioTool active"):(this.studentNotSpeak(),a.setAttribute("data-audio-playing","false"),b&&b.setAttribute("data-title",virtualclass.lang.getString("audioDisable")),a.className="audioTool deactive")},initProcessorEvent:function(){virtualclass.gObj.hasOwnProperty("initProcessorTime")&&clearInterval(virtualclass.gObj.initProcessorTime);virtualclass.gObj.initProcessorTime=setInterval(function(){cthis.audio.notifyAudioMute&&cthis.audio.notifiyMuteAudio()},
2E3)},studentSpeak:function(a){this.notifyAudioMute=!0;this.initProcessorEvent();"undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("deactive"),a.classList.add("active"));virtualclass.gObj.audMouseDown=!0;workerAudioSend.postMessage({cmd:"audioMouseDown",msg:{adMouseDown:virtualclass.gObj.audMouseDown}});virtualclass.vutil.beforeSend({sad:!0,cf:"sad"})},studentNotSpeak:function(a){virtualclass.gObj.hasOwnProperty("audMouseDown")&&virtualclass.gObj.audMouseDown&&("undefined"!=
typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",virtualclass.gObj.audMouseDown=!1,workerAudioSend.postMessage({cmd:"audioMouseDown",msg:{audMouseDown:virtualclass.gObj.audMouseDown}}),virtualclass.media.audio.setAudioStatus("stop"),virtualclass.vutil.beforeSend({sad:!1,cf:"sad"},null,!0))},ab2str:function(a){return String.fromCharCode.apply(null,
new Int8Array(a))},str2ab:function(a){var c=new ArrayBuffer(a.length);c=new Int8Array(c);for(var b=0,f=a.length;b<f;b++)c[b]=a.charCodeAt(b);return c},recorderProcess:function(a){(new Date).getTime();if(!repMode&&(this.recordAudio||(this.recordingLength+=this.bufferSize),virtualclass.gObj.audMouseDown&&io.webSocketConnected())){a=this.resampler.resampler(a);l=a.length;for(buf=new Int16Array(l);l--;)buf[l]=32767*Math.min(1,a[l]);a=buf;var c=this.encodeAudio(a);this.silenceDetection(c,a)}},recorderProcessFallback:function(a){workerAudioSend.postMessage({cmd:"rawAudio",
msg:a.inputBuffer.getChannelData(0)})},encodeAudio:function(a){return G711.encode(a,{alaw:"alaw"===this.encMode?!0:!1})},audioForTesting:function(a){a=G711.encode(a,{alaw:"alaw"===this.encMode?!0:!1});virtualclass.gObj.audioForTest.push(a);virtualclass.gObj[virtualclass.gObj.uid]=!1},initPlayWithFallback:function(){this.hasOwnProperty("Html5Audio")||this.Html5Audio||(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)});if(!m){var a=new MessageChannel;workerIO.postMessage({cmd:"workerAudioRec"},
[a.port1]);workerAudioRec.postMessage({cmd:"workerIO",sampleRate:this.Html5Audio.audioContext.sampleRate},[a.port2]);workerAudioRec.postMessage({cmd:"audioWorklet",msg:!1});workerAudioRec.onmessage=function(a){switch(a.data.cmd){case "noAudioWorklet":virtualclass.media.audio.queueWithFalback(a.data.msg.data,a.data.msg.uid);virtualclass.media.audio.playWithFallback(a.data.msg.uid);break;default:console.log("do nothing")}};m=!0;virtualclass.gObj.audioRecWorkerReady=!0}},initPlay:function(){this.hasOwnProperty("Html5Audio")||
this.Html5Audio||(this.Html5Audio={audioContext:new (d.AudioContext||d.webkitAudioContext)});"object"!=typeof workletAudioRec&&cthis.audio.Html5Audio.audioContext.audioWorklet.addModule(workletAudioRecBlob).then(function(){if("undefined"==typeof initchannel){workletAudioRec=new AudioWorkletNode(cthis.audio.Html5Audio.audioContext,"worklet-audio-rec");cthis.audio.Html5Audio.MediaStreamDest=cthis.audio.Html5Audio.audioContext.createMediaStreamDestination();workletAudioRec.connect(cthis.audio.Html5Audio.audioContext.destination);
"Chrome"===virtualclass.system.mybrowser.name&&(console.log("==== Chrome after change"),cthis.audio.bug_687574_callLocalPeers());var a=new MessageChannel;workerIO.postMessage({cmd:"workerAudioRec"},[a.port1]);workerAudioRec.postMessage({cmd:"workerIO",sampleRate:cthis.audio.Html5Audio.audioContext.sampleRate},[a.port2]);a=new MessageChannel;workerAudioRec.postMessage({cmd:"workletAudioRec"},[a.port1]);workletAudioRec.port.postMessage({cmd:"workerAudioRec"},[a.port2]);workerAudioRec.postMessage({cmd:"audioWorklet",
msg:!0});initchannel=!0;virtualclass.gObj.audioRecWorkerReady=!0}})},playWithFallback:function(a){var c=this;"suspended"===this.Html5Audio.audioContext.state?(this.hasOwnProperty("audioSuspendTime")&&clearTimeout(this.audioSuspendTime),this.audioSuspendTime=setTimeout(function(){"suspended"===c.Html5Audio.audioContext.state&&(c.snode.push(a),null===virtualclass.gObj.requestToScriptNode&&(c.Html5Audio.audioContext.resume(),virtualclass.gesture.initAudioResume(a),virtualclass.gObj.requestToScriptNode=
!0))},2E3)):this._playWithFallback()},_playWithFallback:function(){var a=this;if(null===virtualclass.media.audioPlayerNode||"closed"===virtualclass.media.audioPlayerNode.context.state)console.log("script processor node is created"),null!==virtualclass.media.audioPlayerNode&&virtualclass.media.audioPlayerNode.disconnect(),virtualclass.media.audioPlayerNode=this.Html5Audio.audioContext.createScriptProcessor(4096,1,1),n=0,virtualclass.media.audioPlayerNode.onaudioprocess=function(c){c=c.outputBuffer.getChannelData(0);
var b=a.getMergedAudio();if(null!==b&&void 0!==b){for(i=0;i<b.length;i++)c[i]=b[i];n=b[4095]}else for(i=0;i<c.length;i++)c[i]=n},virtualclass.media.audioPlayerNode.connect(this.Html5Audio.audioContext.destination)},queueWithFalback:function(a,f){null==b[f]&&(b[f]=[]);null==c[f]&&(c[f]=[]);for(var g=0;g<a.length;g++)c[f].push(a[g]);for(;4096<=c[f].length;)a=c[f].splice(0,4096),b[f].push(new Float32Array(a))},getMergedAudio:function(){g=[];k=0;for(f in b){var a=this.getAudioChunks(f);if(null!=a)if(k++,
1===k)for(var c=0;4096>c;c++)g[c]=a[c];else for(c=0;4096>c;c++)g[c]+=a[c]}if(1===k)return g;if(1<k){for(a=0;4096>a;a++)g[a]/=k;return g}},getAudioChunks:function(c){if(null!==b){if(9<=b[c].length){for(;3<=b[c].length;)b[c].shift();a[c]=!0;return b[c].shift()}if(2<=b[c].length||0<b[c].length&&!0===a[c])return a[c]=!0,b[c].shift();a[c]=!1;0===b[c].length&&delete b[c]}},_maniPulateStream:function(){console.log("Manipulate stream");this.triggermaniPulateStream=!0;var a=virtualclass.media;setTimeout(function(){a.detectAudioWorklet()?
a.audio.maniPulateStream():a.audio.maniPulateStreamWithFallback()},1E3)},maniPulateStream:function(){var a=this,c=cthis.stream;"undefined"!=typeof workletAudioSend&&workletAudioSend.disconnect();"undefined"!=typeof c&&null!=c&&(console.log("Audio worklet init add module"),cthis.audio.Html5Audio.audioContext.audioWorklet.addModule(workletAudioSendBlob).then(function(){var b=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(c);filter=cthis.audio.Html5Audio.audioContext.createBiquadFilter();
filter.type="lowpass";filter.frequency.value=2E3;b.connect(filter);workletAudioSend=new AudioWorkletNode(cthis.audio.Html5Audio.audioContext,"worklet-audio-send");workletAudioSend.onprocessorerror=function(a){cthis.audio.notifiyMuteAudio()};filter.connect(workletAudioSend);workletAudioSend.connect(cthis.audio.Html5Audio.audioContext.destination);b=new MessageChannel;workerAudioSend.postMessage({cmd:"workerIO",sampleRate:a.Html5Audio.audioContext.sampleRate,uid:virtualclass.gObj.uid},[b.port1]);workerIO.postMessage({cmd:"workerAudioSend"},
[b.port2]);b=new MessageChannel;workerAudioSend.postMessage({cmd:"audioWorkletSend",msg:{repMode:repMode}},[b.port1]);workletAudioSend.port.postMessage({cmd:"workerAudioSend"},[b.port2]);cthis.workerAudioSendOnmessage();console.log("Audio worklet ready audio worklet module")}).catch(function(a){cthis.audio.notifiyMuteAudio()}))},maniPulateStreamWithFallback:function(){if("undefined"!=typeof cthis.stream&&null!=cthis.stream){var a=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(cthis.stream);
cthis.audio.bufferSize=4096;virtualclass.media.audioCreatorNode=cthis.audio.Html5Audio.audioContext.createScriptProcessor(cthis.audio.bufferSize,1,1);virtualclass.media.audioCreatorNode.onaudioprocess=cthis.audio.recorderProcessFallback.bind(cthis.audio);filter=cthis.audio.Html5Audio.audioContext.createBiquadFilter();filter.type="lowpass";filter.frequency.value=2E3;a.connect(filter);filter.connect(virtualclass.media.audioCreatorNode);virtualclass.media.audioCreatorNode.connect(cthis.audio.Html5Audio.audioContext.destination);
a=new MessageChannel;workerAudioSend.postMessage({cmd:"workerIO",uid:virtualclass.gObj.uid,sampleRate:cthis.audio.Html5Audio.audioContext.sampleRate},[a.port1]);workerIO.postMessage({cmd:"workerAudioSend"},[a.port2]);cthis.workerAudioSendOnmessage()}else console.log("No stream is found")},updateInfo:function(){this.audioStreamArr=[];repMode=this.recordAudio=!1},extractData:function(a){a=new Int8Array(a);return[virtualclass.vutil.numValidateFour(a[1],a[2],a[3],a[4]),a.subarray(5,a.length)]},removeAudioFromLocalStorage:function(){console.log("Remove audio from local storage");
localStorage.removeItem("audEnable")},bug_687574_callLocalPeers:function(){return $jscomp.executeAsyncGenerator(function(){function a(){console.log("PEER fallback");try{workletAudioRec.connect(cthis.audio.Html5Audio.audioContext.destination),H.close(),D.close(),D=H=null}catch(z){D=H=null}}function c(c,b){return $jscomp.executeAsyncGenerator(function(){function f(f,d){for(;;)switch(g){case 0:if(!b.candidate){g=1;break}if("host"!==b.candidate.type){g=2;break}try{return g=5,{value:(c===H?D:H).addIceCandidate(b.candidate),
done:!1}}catch(I){g=3;break}case 5:try{if(void 0===d){g=6;break}g=-1;throw d;}catch(I){g=3;break}case 6:try{g=4;break}catch(I){g=3;break}case 3:a();case 4:case 2:case 1:g=-1;default:return{value:void 0,done:!0}}}var g=0,d={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())}function b(c){return $jscomp.executeAsyncGenerator(function(){function b(b,
g){for(;;)switch(f){case 0:try{return f=3,{value:D.setLocalDescription(c),done:!1}}catch(C){f=1;break}case 3:try{if(void 0===g){f=4;break}f=-1;throw g;}catch(C){f=1;break}case 4:try{return f=5,{value:H.setRemoteDescription(c),done:!1}}catch(C){f=1;break}case 5:try{if(void 0===g){f=6;break}f=-1;throw g;}catch(C){f=1;break}case 6:try{f=2;break}catch(C){f=1;break}case 1:a();case 2:f=-1;default:return{value:void 0,done:!0}}}var f=0,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,
a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())}function f(c){return $jscomp.executeAsyncGenerator(function(){function f(f,m){for(;;)switch(g){case 0:try{return g=3,{value:H.setLocalDescription(c),done:!1}}catch(Q){g=1;break}case 3:try{if(void 0===m){g=4;break}g=-1;throw m;}catch(Q){g=1;break}case 4:try{return g=5,{value:D.setRemoteDescription(c),done:!1}}catch(Q){g=1;break}case 5:try{if(void 0===m){g=
6;break}g=-1;throw m;}catch(Q){g=1;break}case 6:try{g=2;break}catch(Q){g=1;break}case 1:a();case 2:try{return g=9,{value:D.createAnswer(),done:!1}}catch(Q){g=7;break}case 9:try{if(void 0===m){g=10;break}g=-1;throw m;}catch(Q){g=7;break}case 10:try{return d=k=f,g=11,{value:b(d),done:!1}}catch(Q){g=7;break}case 11:try{if(void 0===m){g=12;break}g=-1;throw m;}catch(Q){g=7;break}case 12:try{g=8;break}catch(Q){g=7;break}case 7:a();case 8:g=-1;default:return{value:void 0,done:!0}}}var g=0,d,k,m={next:function(a){return f(a,
void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}())}function g(a){var c=document.createElement("audio");c.srcObject=a.streams[0];c.autoplay=!0}function d(a,c){if("connected"===c.currentTarget.connectionState)try{console.log("PEER connected webrtc"),workletAudioRec.disconnect(cthis.audio.Html5Audio.audioContext.destination),workletAudioRec.connect(cthis.audio.Html5Audio.MediaStreamDest)}catch(L){}else if("disconnected"===
c.currentTarget.connectionState){console.log("PEER disconnected");H.close();D.close();D=H=null;try{workletAudioRec.disconnect(cthis.audio.Html5Audio.MediaStreamDest),workletAudioRec.connect(cthis.audio.Html5Audio.audioContext.destination),console.log("PEER connected normal audio api")}catch(L){}cthis.audio.bug_687574_callLocalPeers()}}function k(b,k){for(;;)switch(m){case 0:H=new RTCPeerConnection;H.count=0;H.addEventListener("icecandidate",function(a){return c(H,a)});H.addEventListener("connectionstatechange",
function(a){return d(H,a)});D=new RTCPeerConnection;D.count=0;D.addEventListener("icecandidate",function(a){return c(D,a)});D.addEventListener("connectionstatechange",function(a){return d(D,a)});D.addEventListener("track",g);cthis.audio.Html5Audio.MediaStreamDest.stream.getTracks().forEach(function(a){return H.addTrack(a,cthis.audio.Html5Audio.MediaStreamDest.stream)});try{return m=3,{value:H.createOffer(),done:!1}}catch(L){m=1;break}case 3:try{if(void 0===k){m=4;break}m=-1;throw k;}catch(L){m=1;
break}case 4:try{return n=E=b,m=5,{value:f(n),done:!1}}catch(L){m=1;break}case 5:try{if(void 0===k){m=6;break}m=-1;throw k;}catch(L){m=1;break}case 6:try{m=2;break}catch(L){m=1;break}case 1:a();case 2:m=-1;default:return{value:void 0,done:!0}}}var m=0,n,E,D,H,G={next:function(a){return k(a,void 0)},throw:function(a){return k(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();G[Symbol.iterator]=function(){return this};return G}())}},video:{width:75,height:56,
tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser:function(a){a=document.getElementById("user"+a);null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var c=document.createElement("div");c.className="videoWrapper";
var b=document.createElement("div");b.className="videoSubWrapper";b.id="user"+a.id;c.appendChild(b);vidId=a.id;var f=document.createElement("canvas");f.id="video"+vidId;f.className="userVideos";f.width=this.width;f.height=this.height;f.muted="muted";b.appendChild(f);virtualclass.media.util.imageReplaceWithVideo(a.id,c)},updateHightInSideBar:function(a){var c=document.getElementById("widgetRightSide").offsetHeight;document.getElementById("chatContainer").style.height=c-a+"px"},sendInBinary:function(a){var c=
{name:virtualclass.gObj.uName,id:virtualclass.gObj.uid};io.webSocketConnected()&&(virtualclass.vutil.beforeSend({videoByImage:c,cf:"videoByImage"},null,!0),ioAdapter.sendBinary(a))},send:function(){function a(){c.tempVidCont.clearRect(0,0,c.tempVid.width,c.tempVid.height);c.tempVidCont.drawImage(c.myVideo,0,0,c.width,c.height);roles.hasControls();if(virtualclass.system.webpSupport){var g=c.tempVid.toDataURL("image/webp",.6);var d=1}else g=c.tempVid.toDataURL("image/jpeg",.3),d=0;g=virtualclass.videoHost.convertDataURIToBinary(g);
if(!virtualclass.videoHost.gObj.stdStopSmallVid&&!roles.hasControls()||roles.hasControls()&&virtualclass.videoHost.gObj.videoSwitch){var k=virtualclass.gObj.uid.toString();for(var m=k.length;8>m;m++)k="0"+k;k=k.match(/[\S]{1,2}/g)||[];d=new Uint8ClampedArray([11,k[0],k[1],k[2],k[3],d]);k=new Uint8ClampedArray(g.length+d.length);k.set(d);k.set(g,d.length);f.sendInBinary(k)}clearInterval(virtualclass.media.smallVid);if(virtualclass.hasOwnProperty("connectedUsers"))if(g=randomTime+2500*virtualclass.connectedUsers.length,
b!=virtualclass.connectedUsers.length){b=virtualclass.connectedUsers.length;d=-1;for(k=0;k<virtualclass.connectedUsers.length;k++)virtualclass.connectedUsers[0].userid==virtualclass.gObj.uid&&(d=k);k=g/b;0>d&&(d=0);virtualclass.media.smallVid=setInterval(a,g+d*k)}else virtualclass.media.smallVid=setInterval(a,g)}virtualclass.media.hasOwnProperty("smallVid")&&clearInterval(virtualclass.media.smallVid);var c=this;randomTime=Math.floor(5001*Math.random()+3E3);var b=-1,f=this;virtualclass.media.smallVid=
setInterval(a,randomTime)},startToStream:function(){cthis.video.calcDimension();cthis.video.send()},playWithoutSlice:function(a,c,b){this.remoteVid=document.getElementById("video"+a);null!=this.remoteVid&&(this.remoteVidCont=this.remoteVid.getContext("2d"),this.remoteVidCont.putImageData(imgData,0,0))},drawReceivedImage:function(a,c,b,f){this.remoteVid=chatContainerEvent.elementFromShadowDom("#video"+f);if(null!=this.remoteVid)if(this.remoteVidCont=this.remoteVid.getContext("2d"),virtualclass.system.webpSupport||
"jpeg"===c){var g=new Image,d=this;g.onload=function(){d.remoteVidCont.drawImage(g,b.x,b.y)};g.src=a}else loadfile(a,this.remoteVid,this.videoPartCont)},justForDemo:function(){var a=0,c=document.getElementById("allVideosCont");c.style.maxHeight="250px";setInterval(function(){if(20>=++a){c=document.getElementById("allVideosCont");var b=document.createElement("div");b.className="videoWrapper";var f=document.createElement("div");f.className="videoSubWrapper";f.setAttribute("data-uname",+a);b.appendChild(f);
var g=document.createElement("video");g.className="userVideo";g.muted="muted";g.src="http://html5demos.com/assets/dizzy.mp4";f.appendChild(g);c.appendChild(b);250<=c.offsetHeight&&"undefined"!=c.style.overflowY&&"scroll"!=c.style.overflowY&&(c.style.overflowY="scroll",document.getElementById(virtualclass.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement:function(){var a=document.createElement("div");a.className="videoWrapper";var c=document.createElement("div");
c.className="videoSubWrapper";a.appendChild(c);var b=document.createElement("video");b.id="video"+virtualclass.gObj.uid;b.autoplay=!0;c.appendChild(b);return a},insertTempVideo:function(a){var c=document.createElement("canvas");c.id="tempVideo";a.parentNode.insertBefore(c,a)},tempVideoInit:function(){cthis.video.tempVid=chatContainerEvent.elementFromShadowDom("#tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")},
process:function(a){var c=new Uint8ClampedArray(a);a=virtualclass.vutil.numValidateFour(c[1],c[2],c[3],c[4]);var b=c.subarray(6,c.length);1===c[5]?(b="data:image/webp;base64,"+btoa(virtualclass.videoHost.Uint8ToString(b)),c="webp"):(b="data:image/jpeg;base64,"+btoa(virtualclass.videoHost.Uint8ToString(b)),c="jpeg");virtualclass.media.video.drawReceivedImage(b,c,{x:0,y:0},a)}},sessionConstraints:function(){var a=virtualclass.system.mediaDevices.hasWebcam?!0:!1;virtualclass.gObj.meetingMode&&a&&(a=
"mobTab"===virtualclass.system.device&&"iOS"===virtualclass.system.mybrowser.name||"Firefox"===virtualclass.system.mybrowser.name||"Safari"===virtualclass.system.mybrowser.name?!0:{width:{max:268},height:{max:142},frameRate:{max:6}});return[a,{video:a,audio:virtualclass.system.mediaDevices.hasMicrophone?{echoCancellation:!0,autoGainControl:!0,channelCount:1,noiseSuppression:!0}:!1}]},init:function(a){console.log("Video second, normal video");cthis=this;virtualclass.gObj.oneExecuted=!0;virtualclass.gesture.classJoin&&
(virtualclass.gesture.attachHandler(),delete virtualclass.gesture.classJoin);var c=$jscomp.makeIterator(this.sessionConstraints());var b=c.next().value;c=c.next().value;cthis.video.init();var f=this;virtualclass.user.control.audioDisable();virtualclass.user.control.videoDisable();if(!virtualclass.vutil.isPlayMode()){null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter);if(null!=virtualclass.media.video.tempStream)for(var g=virtualclass.media.video.tempStream.getTracks(),d=0;d<g.length;d++)g[d].stop();
virtualclass.adpt.init(navigator).mediaDevices.getUserMedia(c).then(function(c){f.handleUserMedia(c);virtualclass.gObj.meetingMode&&virtualclass.multiVideo.init();"undefined"!=typeof a&&a("success")}).catch(function(a){f.handleUserMediaError(a)})}virtualclass.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(virtualclass.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0);0==b&&(virtualclass.user.control.videoDisable(),virtualclass.vutil.addClass("virtualclassCont","nowebcam"))},
handleUserMedia:function(a){localStorage.removeItem("dvid");document.getElementById("audioWidget");var c=localStorage.getItem("audEnable");if(roles.isStudent()&&virtualclass.system.mediaDevices.hasMicrophone)!1===virtualclass.settings.info.disableAttendeeAudio?(virtualclass.gObj.audioEnable=!1,virtualclass.user.control.audioDisable(!0)):!0===virtualclass.settings.info.disableAttendeeAudio?(virtualclass.gObj.audioEnable=!0,virtualclass.user.control.audioWidgetEnable(!0)):!0!==virtualclass.settings.info.disableAttendeeAudio&&
virtualclass.user.control.audioDisable();else if(virtualclass.system.mediaDevices.hasMicrophone)if(null!=c)if(c=JSON.parse(c),"false"===c.ac||!1===c.ac)virtualclass.gObj.audioEnable=!1,virtualclass.user.control.audioDisable(!0);else{if("true"===c.ac||!0===c.ac)virtualclass.gObj.audioEnable=!0,virtualclass.user.control.audioWidgetEnable(!0)}else"undefined"!=typeof a&&virtualclass.user.control.audioWidgetEnable(!0);else virtualclass.user.control.audioDisable();c=a.getVideoTracks()[0];"undefined"!=typeof c?
c.onended=function(){virtualclass.system.mediaDevices.webcamErr.push("webcambusy")}:virtualclass.system.mediaDevices.webcamErr.push("nopermission");cthis.video.tempStream=a;cthis.audio.init();cthis.audio.attachAudioStopHandler(a);c=chatContainerEvent.elementFromShadowDom("#ml"+virtualclass.gObj.uid);null!=c&&null!=c.getElementsByTagName("video")&&cthis._handleUserMedia(virtualclass.gObj.uid);roles.hasAdmin()&&virtualclass.videoHost.isDomReady(function(){virtualclass.videoHost.renderSelfVideo(a)});
!1===virtualclass.settings.info.disableAttendeeVideo&&roles.isStudent()?virtualclass.user.control.videoDisable():(roles.isStudent()&&!0!==virtualclass.settings.info.disableAttendeeVideo?(virtualclass.vutil.videoHandler("off"),virtualclass.videoHost.toggleVideoMsg("disable")):(virtualclass.user.control.videoEnable(),roles.isStudent()&&virtualclass.vutil.videoHandler("off")),!0===virtualclass.settings.info.disableAttendeeVideo&&virtualclass.user.control.videoEnable());null==localStorage.getItem("prevApp")&&
(roles.hasControls()?virtualclass.vutil.videoHandler("off"===virtualclass.vutil.selfVideoStatus()?"on":"off"):virtualclass.gObj.meetingMode&&virtualclass.vutil.videoHandler("off"));cthis.audio.audioContextReady&&!cthis.audio.hasOwnProperty("triggermaniPulateStream")&&(cthis.stream=cthis.video.tempStream,cthis.audio._maniPulateStream())},addUserRole:function(a,c){a.dataset.role=c;if("undefined"!=typeof c){var b="s"===c?"student":"teacher";a.classList.add(b)}else a.classList.add("student");"t"===virtualclass.gObj.uRole&&
"student"===b&&document.getElementById("virtualclassCont").classList.remove("student")},_handleUserMedia:function(a){if("undefined"!=typeof cthis){if(a=cthis.video.tempStream,"undefined"!=typeof a&&virtualclass.system.mediaDevices.hasWebcam){var c=cthis.video.createVideoElement();virtualclass.media.util.imageReplaceWithVideo(virtualclass.gObj.uid,c);cthis.video.insertTempVideo(c);cthis.video.tempVideoInit();cthis.video.myVideo=chatContainerEvent.elementFromShadowDom("#video"+virtualclass.gObj.uid);
virtualclass.adpt.attachMediaStream(cthis.video.myVideo,a);cthis.video.myVideo.muted=!0;cthis.stream=cthis.video.tempStream;cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()}}}else console.log("Media: it seems media is not ready")},updateVideoContHeight:function(){console.log("Updating User");var a=document.getElementById("virtualclassCont");virtualclass.vutil.getElementOffset(a);a=virtualclass.chat.boxHeight;var c=document.getElementById("chat_div");c.scrollHeight>=a+1&&
(c.style.overflowY="scroll");c.style.maxHeight=a+"px";console.log("Chat height "+c.offsetHeight);console.log("Max height "+c.style.maxHeight);virtualclass.isPlayMode&&(c.style.maxHeight=a+64+"px")},close:function(){virtualclass.media.hasOwnProperty("smallVid")&&clearInterval(virtualclass.media.smallVid)},dispAllVideo:function(a){setTimeout(function(){var c=document.getElementById(a);if(null!=c){c=c.getElementsByTagName("video");for(var b=0;b<c.length;b++)c[b].play()}},1040)},existVideoContainer:function(a){for(var c=
chatContainerEvent.elementFromShadowDom(".userVideos","all"),b=0;b<c.length;b++)if(c[b].id==="video"+a.id)return!0;return!1},handleUserMediaError:function(a){var c="object"==typeof a?virtualclass.lang.getString(a.name):virtualclass.lang.getString(a);null==c?virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget"):virtualclass.view.createErrorMsg(c,"errorContainer","chatWidget");virtualclass.user.control.mediaWidgetDisable("vd");virtualclass.view.disappearBox("WebRtc");localStorage.setItem("dvid",
!0);console.log("navigator.getUserMedia error: ",a);switch(a.name){case "NotFoundError":case "DevicesNotFoundError":a="nowebcam";break;case "SourceUnavailableError":a="webcambusy";break;case "PermissionDeniedError":case "SecurityError":a="nopermission";virtualclass.gObj.disableCamByUser=!0;break;case "NotAllowedError":a="nopermission";virtualclass.gObj.disableCamByUser=!0;break;default:a="rejected"}virtualclass.system.mediaDevices.webcamErr.push(a);cthis.audio.notifiyMuteAudio()},detectAudioWorklet:function(){if("undefined"==
typeof OfflineAudioContext)return!1;var a=new OfflineAudioContext(1,1,44100);return!(!a.audioWorklet||"function"!==typeof a.audioWorklet.addModule)}}}})(window);(function(d){d.sharePt=function(){var b=!1;return{pptUrl:"",state:{},urlValue:"",localStoragFlag:!1,eventsObj:[],autoSlideTime:0,viewFlag:0,controlFlag:0,autoSlideFlag:0,autoSlideResumed:0,studentPpt:0,startFromFlag:0,startFrom:0,currId:"",order:[],init:function(a,c){this.pages={};this.order=[];this.autoSlideResumed=this.autoSlideTime=this.autoSlideFlag=0;"undefined"!=typeof virtualclass.previous&&"undefined"!=typeof c&&"byclick"==c&&roles.hasControls()&&virtualclass.vutil.beforeSend({ppt:!0,init:"makeAppReady",
cf:"ppt"});a=document.getElementById("virtualclassSharePresentation");null!=a&&a.parentNode.removeChild(a);this.UI.container();c=document.getElementById("pptMessageLayout");roles.hasControls()?(a=document.getElementById("urlcontainer"),null!=c&&(c.style.display="none"),a&&(a.style.display="block"),virtualclass.vutil.requestOrder("presentation",function(a){console.log(a);virtualclass.vutil.isResponseAvailable(a)?virtualclass.sharePt.order=a:console.log("Order response is not available")})):roles.hasView()&&
(a=document.getElementById("urlcontainer"),this.UI.messageDisplay(),c&&(c.style.display="block"),a&&(a.style.display="none"));this.findInStorage();roles.hasControls()&&!b&&(this.getPptList(),b=!0);virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler)},createPageModule:function(){virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach(function(a,c){virtualclass.sharePt.pages[a.fileuuid]=new virtualclass.page("pptListContainer",
"ppt","virtualclassSharePresentation","sharePt",a.status)})},findInStorage:function(){var a=localStorage.getItem("prevApp");console.log("test pApp"+typeof a);console.log(a);null!=a&&(a=JSON.parse(a),"SharePresentation"==a.name&&(a=a.metaData,null!=a&&a.init&&(this.localStoragFlag=!0,this.pptUrl=JSON.parse(localStorage.getItem("pptUrl")),null!=a.startFrom&&(virtualclass.sharePt.stateLocalStorage=a.startFrom),null!=a.currId&&(virtualclass.sharePt.currId=a.currId)),this.localStoragFlag&&this.fromLocalStorage(virtualclass.sharePt.state)));
virtualclass.previrtualclass="virtualclass"+virtualclass.currApp},fromLocalStorage:function(a){null==document.getElementById("iframecontainer")&&this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";a=document.getElementById("pptiframe");var c=0>this.pptUrl.search("postMessage")?this.pptUrl+"?postMessage=true&postMessageEvents=true":this.pptUrl;a.setAttribute("src",c);this.setAutoSlideConfig();a=document.getElementById("pptMessageLayout");null!=a&&(console.log("message block"),
a.style.display="none");a=document.getElementById(this.UI.id);a.classList.contains("pptSharing")||a.classList.add("pptSharing")},_rearrange:function(a){this.order=a;this.reArrangeElements(a);virtualclass.vutil.sendOrder("presentation",a)},sendOrder:function(a){virtualclass.vutil.xhrSendWithForm({content_order:a.toString(),content_order_type:"3",live_class_id:virtualclass.gObj.congCourse},"congrea_page_order",function(a){})},reArrangeElements:function(a){var c=document.getElementById("listppt"),b=
document.createElement("div");b.id="listppt";b.className="ppts";for(var g=!1,d=0;d<virtualclass.sharePt.activeppts.length;d++)-1>=a.indexOf(virtualclass.sharePt.activeppts[d].fileuuid)&&(a.push(virtualclass.sharePt.activeppts[d].fileuuid),g=!0);for(d=0;d<a.length;d++){var m=document.getElementById("linkppt"+a[d]);m&&b.appendChild(m)}c.parentNode.replaceChild(b,c);g&&(virtualclass.sharePt.order=a,virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order))},_delete:function(a){var c=this;
virtualclass.xhrn.sendData({uuid:a,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,function(b){c.afterDeletePtCallback(b,a)})},afterDeletePtCallback:function(a,c){"ERROR"!=a&&(a=document.getElementById("linkppt"+c))&&(a.parentNode.removeChild(a),virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.ppts.forEach(function(a,b){a.fileuuid==c&&(b=virtualclass.sharePt.ppts.indexOf(a),0<=b&&(virtualclass.sharePt.ppts.splice(b,1),console.log(virtualclass.sharePt.ppts)))}),a=virtualclass.sharePt.order.indexOf(c),
0<=a&&(virtualclass.sharePt.order.splice(a,1),console.log(virtualclass.sharePt.order),virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order)),(a=document.querySelector(".congrea #pptiframe"))&&a.getAttribute("src")?virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn()),virtualclass.sharePt.currId==c&&(a=document.querySelector("#pptiframe")))&&(a.removeAttribute("src"),ioAdapter.mustSend({pptMsg:"deletePrt",cf:"ppt",currId:virtualclass.sharePt.currId}),virtualclass.sharePt.currId=
null,virtualclass.sharePt.pptUrl=null,virtualclass.vutil.removeFinishBtn())},_delete1:function(a){var c=this;virtualclass.xhrn.sendData({uuid:a,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,function(b){c.afterDeleteCallback(b,a)})},pptMessageEventHandler:function(a){if("SharePresentation"==virtualclass.currApp){var c=document.getElementById("pptiframe");var b=a.data;b="string"==typeof b?JSON.parse(a.data):a.data;"undefined"!=typeof b&&(b.hasOwnProperty("namespace")&&"reveal"==b.namespace&&
(virtualclass.sharePt.state=b.state),"ready"==b.eventName&&(virtualclass.sharePt.localStoragFlag&&!virtualclass.sharePt.startFromFlag?(a=virtualclass.sharePt.stateLocalStorage,c.contentWindow.postMessage(JSON.stringify({method:"slide",args:[a.indexh,a.indexv,a.indexf]}),"*"),virtualclass.sharePt.localStoragFlag=0):virtualclass.sharePt.startFromFlag&&c.contentWindow.postMessage(JSON.stringify({method:"slide",args:virtualclass.sharePt.startFrom}),"*"),setTimeout(function(){null!=c&&null!=c.contentWindow&&
c.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*")},1500)),roles.hasView()?"ready"==b.eventName&&(setTimeout(function(){virtualclass.sharePt.removeControls()},100),virtualclass.sharePt.studentPpt&&(virtualclass.sharePt.setSlideState(virtualclass.sharePt.studentPpt),virtualclass.sharePt.studentPpt=0)):roles.hasControls()&&(console.log(b.eventName),"undefined"!=typeof b.eventName&&(virtualclass.sharePt[b.eventName].call(virtualclass.sharePt,b),virtualclass.sharePt.state=b.state)))}else null!=
c&&c.removeAttribute("src")},setAutoSlideConfig:function(){localStorage.getItem("autoSlideTime")&&(virtualclass.sharePt.autoSlideTime=JSON.parse(localStorage.getItem("autoSlideTime")),virtualclass.sharePt.autoSlideFlag=JSON.parse(localStorage.getItem("autoSlideFlag")))},onmessage:function(a){a.hasOwnProperty("autoSlide")&&(this.autoSlideTime=a.autoSlide);"undefined"!=typeof virtualclass.sharePt&&(virtualclass.system.setAppDimension(virtualclass.currApp),this.onPptMsgReceive(a),a=document.getElementById(virtualclass.sharePt.UI.id),
a.classList.contains("pptSharing")||a.classList.add("pptSharing"))},ready:function(a){console.log("teacher ready for ppt ");ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},slidechanged:function(a){this.autoSlideFlag&&this.autoSlideResumed&&!this.autoSlideTime&&this.calculateAutoSlideTime(a);ioAdapter.mustSend({pptMsg:a,cf:"ppt",autoSlide:this.autoSlideTime,cfpt:"setPEvent"})},calculateAutoSlideTime:function(a){this.eventsObj.push({name:a.eventName,time:Date.now()});2<=this.eventsObj.length&&
("slidechanged"==this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name?(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,console.log("auto slide time withoutpause"+this.autoSlideTime)):"autoslideresumed"==this.eventsObj[0].name&&"slidechanged"==this.eventsObj[1].name&&(this.autoSlideTime=this.eventsObj[1].time-this.eventsObj[0].time,console.log("withpause"+this.autoSlideTime)),console.log(this.eventsObj),console.log(this.autoSlideTime))},autoslidepaused:function(a){this.autoSlideFlag=
1;this.autoSlideResumed=0;console.log(this.pause);ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},autoslideresumed:function(a){this.autoSlideResumed=this.autoSlideFlag=1;this.eventsObj=[];this.eventsObj.push({name:a.eventName,time:Date.now()});ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},fragmentshown:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},fragmenthidden:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},overviewshown:function(a){ioAdapter.mustSend({pptMsg:a,
cf:"ppt",cfpt:"setPEvent"})},overviewhidden:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},paused:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},resumed:function(a){ioAdapter.mustSend({pptMsg:a,cf:"ppt",cfpt:"setPEvent"})},removeControls:function(){setTimeout(function(){document.getElementById("pptiframe").contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,keyboard:!1,progress:!1,touch:!1}]}),"*")},100)},cfpt:{displayFrame:function(){this.displayFrame()},
setUrl:function(a){virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.stateLocalStorage={};virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};this.setSlideUrl(a);var c=document.getElementById("pptiframe");c.onload=function(){roles.hasView()&&null!=c.contentWindow&&"undefined"!=typeof a.pptMsg.state&&c.contentWindow.postMessage(JSON.stringify({method:"setState",args:[a.pptMsg.state]}),"*")}},setPEvent:function(a){null!=document.getElementById("pptiframe")&&virtualclass.sharePt.setSlideState(a.pptMsg);
this.state=a.pptMsg.state}},onPptMsgReceive:function(a){if("undefined"!=typeof a.ppt&&"undefined"!=typeof a.ppt.startFrom){virtualclass.sharePt.startFromFlag=1;var c=document.getElementById("pptiframe");null!=c&&(0>a.ppt.init.search("postMessage")?c.setAttribute("src",a.ppt.init+"?postMessage=true&postMessageEvents=true"):c.setAttribute("src",a.ppt.init),virtualclass.sharePt.startFrom=[a.ppt.startFrom.indexh,a.ppt.startFrom.indexv,a.ppt.startFrom.indexf])}if("undefined"!=typeof a.pptMsg){if("deletePrt"==
a.pptMsg){var b=document.querySelector("#pptiframe");b&&(b.removeAttribute("src"),virtualclass.sharePt.currId=null,virtualclass.sharePt.pptUrl=null,b=document.querySelector("#virtualclassCont.congrea #virtualclassSharePresentation #pptMessageLayout"))&&(b.style.display="block")}else{c=document.getElementById("pptiframe");var g=document.getElementById("pptMessageLayout");null!=c&&(c.onload=function(){roles.hasView()&&null!=c.contentWindow&&"undefined"!=typeof a.pptMsg.state&&c.contentWindow.postMessage(JSON.stringify({method:"setState",
args:[a.pptMsg.state]}),"*")})}null!=g&&(g.style.display="none");a.hasOwnProperty("cfpt")&&"undefined"!=typeof a.cfpt&&"undefined"!=typeof virtualclass.sharePt.cfpt[a.cfpt]&&virtualclass.sharePt.cfpt[a.cfpt].call(virtualclass.sharePt,a)}},displayFrame:function(){virtualclass.system.setAppDimension(virtualclass.currApp);var a=document.getElementById(virtualclass.sharePt.UI.id);a.classList.contains("pptSharing")||a.classList.add("pptSharing")},setSlideUrl:function(a){if(null!=a.pptMsg&&""!=a.pptMsg){virtualclass.sharePt.studentPpt=
0;console.log("PPT:- invoke setSlideUrl");this.autoSlideTime=this.autoSlideFlag=this.viewFlag=0;var c=document.getElementById("pptiframe");null!=c&&c.parentNode.removeChild(c);console.log("create iframe from setslide url");this.UI.createIframe();document.getElementById("iframecontainer").style.display="block";c=document.getElementById("pptiframe");c.setAttribute("src",0>a.pptMsg.search("postMessage")?a.pptMsg+"?postMessage=true&postMessageEvents=true":a.pptMsg);console.log("test url is set");this.pptUrl=
a.pptMsg}virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.startFromFlag=0},setSlideState:function(a){var c=document.getElementById("pptiframe").contentWindow,b=[a.state.indexh,a.state.indexv,a.state.indexf],g=[a.state];switch(a.eventName){case "ready":c.postMessage(JSON.stringify({method:"setState",args:g}),"*");break;case "slidechanged":virtualclass.sharePt.studentPpt=a;console.log("test PPt:-  changed");c.postMessage(JSON.stringify({method:"slide",args:b}),"*");break;case "autoslidepaused":this.autoSlideFlag=
1;c.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "autoslideresumed":this.autoSlideFlag=1;c.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*");break;case "fragmentshown":c.postMessage(JSON.stringify({method:"slide",args:b}),"*");break;case "fragmenthidden":c.postMessage(JSON.stringify({method:"slide",args:b}),"*");break;case "overviewshown":c.postMessage(JSON.stringify({method:"setState",args:g}),"*");break;case "overviewhidden":c.postMessage(JSON.stringify({method:"setState",
args:g}),"*"),c.postMessage(JSON.stringify({method:"slide",args:b}),"*");default:console.log("There is no event is occured")}},toProtocolRelativeUrl:function(){var a=virtualclass.sharePt.urlValue;return 0<=a.indexOf("http")?a.replace(/http:\/\/|https:\/\//,"//"):"//"+a},validUrl:function(){return virtualclass.sharePt.isUrlip(virtualclass.sharePt.urlValue)?virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue):0<virtualclass.sharePt.urlValue.search("<iframe")?virtualclass.sharePt.extractUrl(virtualclass.sharePt.urlValue):
virtualclass.sharePt.validURLWithDomain(virtualclass.sharePt.urlValue)?virtualclass.sharePt.completeUrl(virtualclass.sharePt.cleanupUrl(virtualclass.sharePt.urlValue)):!1},initNewPpt:function(){virtualclass.sharePt.urlValue=document.getElementById("presentationurl").value;virtualclass.sharePt.urlValue=virtualclass.sharePt.toProtocolRelativeUrl();var a=virtualclass.sharePt.validUrl();a?(virtualclass.sharePt.savePptUrl(a),document.getElementById("presentationurl").value=""):virtualclass.popup.validateurlPopup("presentation")},
savePptUrl:function(a){var c=virtualclass.vutil.createHashString(a)+virtualclass.vutil.randomString(32).slice(1,-1),b={};b.uuid=c;b.URL=a;b.title=a;a=virtualclass.api.addURL;b.type="presentation";var g=this;virtualclass.xhrn.sendData(b,a,function(a){virtualclass.sharePt.hasOwnProperty("activeppts")&&(a=virtualclass.sharePt.activeppts.map(function(a){return a.fileuuid}),a.length!=virtualclass.sharePt.order.length&&(virtualclass.sharePt.order=a));virtualclass.sharePt.order.push(b.uuid);virtualclass.vutil.sendOrder("presentation",
virtualclass.sharePt.order);virtualclass.sharePt.getPptList();g.fetchAllData()})},fetchAllData:function(){virtualclass.serverData.fetchAllData(function(){virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt)})},awsPresentationList:function(a){virtualclass.sharePt.ppts=[];virtualclass.sharePt.ppts=a;document.querySelector("#SharePresentationDashboard .dbContainer")&&(virtualclass.sharePt.createPageModule(),virtualclass.sharePt.showPpts(),virtualclass.vutil.requestOrder("presentation",
function(a){virtualclass.vutil.isResponseAvailable(a)?(virtualclass.sharePt.order=a,virtualclass.sharePt.order&&0<virtualclass.sharePt.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.sharePt.order)):console.log("Order response is not available")}))},afterPptSaved:function(a){var c=a.fileuuid;a.hasOwnProperty("disabled")?a.status=0:a.status=1;this.pages[c]=new virtualclass.page("pptListContainer","ppt","virtualclassSharePresentation","sharePt",a.status);this.pages[c].init(c,a.URL);
this.pptClickHandler(a);c=document.getElementById("linkppt"+a.fileuuid);var b=document.getElementById("pptTitle"+a.fileuuid),g=this.extractTitle(a.URL);b&&(g||(g=("https:"+a.URL).match(/^(?:https?:\/\/)?(?:w{3}\.)?([a-z\d\.-]+)\.(?:[a-z\.]{2,10})(?:[/\w\.-]*)*/)[1]),b.innerHTML=g);b.setAttribute("data-toogle","tooltip");b.setAttribute("data-placement","bottom");b.setAttribute("title",a.URL);a.hasOwnProperty("disabled")?(this._disable(a.fileuuid),c&&c.classList.add("disable")):(this._enable(a.fileuuid),
c&&c.classList.add("enable"));virtualclass.sharePt.currId==a.fileuuid&&c.classList.add("playing")},extractTitle:function(a){return-1<a.indexOf("//")?a.split("/")[4]:a.split("/")[2]},pptClickHandler:function(a){var c=document.getElementById("mainpppt"+a.fileuuid);c&&c.addEventListener("click",function(){virtualclass.sharePt.playPptUrl(a.URL,a.fileuuid);virtualclass.dashBoard.close();virtualclass.sharePt.currId=a.fileuuid;virtualclass.sharePt.activePrs(a.fileuuid)})},activePrs:function(a){for(var c=
document.querySelectorAll("#virtualclassCont.congrea .linkppt"),b=0;b<c.length;b++)c[b].classList.contains("playing")&&c[b].classList.remove("playing");(a=document.querySelector("#virtualclassCont.congrea #linkppt"+a))&&!a.classList.contains("playing")&&a.classList.add("playing")},_disable:function(a){var c=document.getElementById("mainpppt"+a);c.style.opacity=.3;c.style.pointerEvents="none";c=document.querySelector("#linkppt"+a);c.classList.contains("enable")&&c.classList.remove("enable");c.classList.add("disable");
virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach(function(c,b){c.fileuuid==a&&(c.disabled=0,c.status=0)})},_enable:function(a){var c=document.querySelector("#linkppt"+a);c.classList.contains("disable")&&c.classList.remove("diable");c.classList.add("enable");if(c=document.getElementById("mainpppt"+a))c.style.opacity=1,c.style.pointerEvents="auto",virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&virtualclass.sharePt.ppts.forEach(function(c,b){c.fileuuid==
a&&(delete c.disabled,c.status=1)})},getPptList:function(){virtualclass.gObj.fetchedData?virtualclass.sharePt.awsPresentationList(virtualclass.serverData.rawData.ppt):this.fetchAllData()},showPpts:function(a){if(a=document.getElementById("listppt"))for(var c=0;c<a.childNodes.length-1;c++)a.childNodes[c].parentNode.removeChild(a.childNodes[c]);virtualclass.sharePt.ppts&&virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.activeppts=[],virtualclass.sharePt.ppts.forEach(function(a,c){a.hasOwnProperty("deleted")||
(virtualclass.sharePt.activeppts.push(a),c=document.querySelector("#linkppt"+a.fileuuid),null!=c&&c.classList.remove("noPpt"),virtualclass.sharePt.afterPptSaved(a))}),virtualclass.vutil.sendOrder("presentation",virtualclass.sharePt.order));(a=document.querySelector(".congrea #pptiframe"))&&a.getAttribute("src")&&virtualclass.vutil.showFinishBtn();virtualclass.vutil.makeElementActive("#listvideo")},retrieveOrder:function(){var a=new FormData;a.append("live_class_id",virtualclass.gObj.congCourse);a.append("content_order_type",
"3");this.requestOrder(a)},requestOrder:function(a){virtualclass.vutil.requestOrder("presentation",function(a){console.log(a);virtualclass.vutil.isResponseAvailable(a)&&(virtualclass.sharePt.order=a,0<virtualclass.sharePt.order.length&&virtualclass.sharePt.reArrangeElements(virtualclass.sharePt.order))})},playPptUrl:function(a){virtualclass.sharePt.autoSlideTime=0;virtualclass.sharePt.autoSlideFlag=0;virtualclass.sharePt.localStoragFlag=0;virtualclass.sharePt.startFromFlag=0;virtualclass.sharePt.eventsObj=
[];virtualclass.sharePt.state={indexh:0,indexv:0,indexf:0};virtualclass.sharePt.stateLocalStorage={};localStorage.removeItem("autoSlideTime");localStorage.removeItem("autoSlideFlag");null==document.getElementById("iframecontainer")&&(console.log("call of iframe creater from onclick event handler"),virtualclass.sharePt.UI.createIframe());var c=document.getElementById(virtualclass.sharePt.UI.id);c.classList.contains("pptSharing")||c.classList.add("pptSharing");virtualclass.sharePt.setPptUrl(a);virtualclass.system.setAppDimension()},
cleanupUrl:function(a){var c=a.search("#");0<c&&(a=a.slice(0,c));return a},setPptUrl:function(a){console.log("test+set ppt url function");document.getElementById("iframecontainer").style.display="block";var c=document.getElementById("pptiframe");console.log("completeurl"+a);virtualclass.sharePt.pptUrl=a+"?postMessage=true&postMessageEvents=true";c.setAttribute("src",virtualclass.sharePt.pptUrl);ioAdapter.mustSend({pptMsg:"displayframe",cf:"ppt",user:"all",cfpt:"displayframe"});ioAdapter.mustSend({pptMsg:a,
cf:"ppt",user:"all",cfpt:"setUrl"});c.style.display="visible";document.querySelector(".congrea  #dashboardContainer .modal-header button.enable")||virtualclass.vutil.showFinishBtn()},validURLWithDomain:function(a){return/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/.test(a)},completeUrl:function(a){0<a.search("slides.com")&&0>a.search("embed")&&(a+="/embed");return a},extractUrl:function(a){if(0<a.search("src")){var c=a.match(/"(.*?)"/);if(0<c.length)return JSON.parse(c[0])}return a},isUrlip:function(a){a.slice(0,
2);return/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/.test(a)},saveIntoLocalStorage:function(a){if(this.validURLWithDomain(a.metaData.init)||this.isUrlip(a.metaData.init))localStorage.setItem("prevApp",JSON.stringify(a)),console.log("ppt_state",a.metaData.startFrom),localStorage.setItem("ppt_state",JSON.stringify(a.metaData.startFrom)),console.log("savinlocal"),localStorage.setItem("pptUrl",
JSON.stringify(a.metaData.init)),localStorage.setItem("autoSlideTime",JSON.stringify(virtualclass.sharePt.autoSlideTime)),localStorage.setItem("autoSlideFlag",JSON.stringify(virtualclass.sharePt.autoSlideFlag))},initTeacherLayout:function(){var a=document.getElementById("pptiframe");if(null!=document.getElementById("pptiframe")){var c={controls:!0,keyboard:!0,progress:!0,touch:!0},b;virtualclass.sharePt.autoSlideTime&&virtualclass.sharePt.autoSlideFlag?b=virtualclass.sharePt.autoSlideTime:virtualclass.sharePt.autoSlideFlag&&
(b=6E3);"undefined"!=typeof b&&1E3<b&&(c.autoSlide=b);a.contentWindow.postMessage(JSON.stringify({method:"configure",args:[c]}),"*");a.contentWindow.postMessage(JSON.stringify({method:"toggleAutoSlide"}),"*")}a=document.getElementById("pptMessageLayout");null!=a&&(a.style.display="none");document.getElementById("urlcontainer")&&(document.getElementById("urlcontainer").style.display="block");virtualclass.sharePt.eventsObj=[]},initStudentLayout:function(){var a=document.getElementById("pptiframe");
virtualclass.sharePt.eventsObj=[];virtualclass.sharePt.UI.messageDisplay();null!=document.getElementById("pptiframe")?(""!=a.src&&virtualclass.sharePt.hideElement("pptMessageLayout"),a.contentWindow.postMessage(JSON.stringify({method:"configure",args:[{controls:!1,autoSlide:0,autoSlideStoppable:!0,keyboard:!1,progress:!1,touch:!1}]}),"*")):virtualclass.sharePt.displayElement("pptMessageLayout");virtualclass.sharePt.hideElement("urlcontainer")},hideElement:function(a){a=document.getElementById(a);
null!=a&&(a.style.display="none")},displayElement:function(a){a=document.getElementById(a);null!=a&&(a.style.display="block")},attachEvent:function(a,c,b){document.getElementById(a);a=document.getElementById(a);null!=a&&a.addEventListener(c,b)},attachMessageEvent:function(a,c){d.addEventListener(a,c)},UI:{id:"virtualclassSharePresentation",class:"virtualclass",container:function(){var a={control:roles.hasControls()?!0:!1},c=virtualclass.getTemplate("ppt","ppt");virtualclass.vutil.insertAppLayout(c(a))},
createIframe:function(){var a=document.getElementById("iframecontainer");null!=a&&a.parentNode.removeChild(a);a=virtualclass.getTemplate("pptiframe","ppt");document.querySelector("#virtualclassSharePresentation").insertAdjacentHTML("beforeend",a())},messageDisplay:function(){var a=document.getElementById("pptMessageLayout");a&&a.parentNode.removeChild(a);a=virtualclass.getTemplate("mszdisplay","ppt");document.querySelector("#virtualclassSharePresentation").insertAdjacentHTML("beforeend",a())},removeIframe:function(){var a=
document.getElementById("pptiframe");a&&a.parentNode.removeChild(a)}}}}})(window);(function(d){var b={requestPackets:function(a){1<a.length&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr=a);virtualclass.wb[virtualclass.gObj.currWb].sentReq=!0;return[0==virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId?0:virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId,a[0].uid]},makeQueue:function(a){virtualclass.wb[virtualclass.gObj.currWb].gObj.queue[a.uid]=a},sendPackets:function(a,c){if(0==a.message.getMsPckt[0])var b=-1;else for(b=0;b<virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj.length&&
a.message.getMsPckt[0]!=virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj[b].uid;b++);for(b+=1;b<a.message.getMsPckt[1];b++)c.push(virtualclass.wb[virtualclass.gObj.currWb].gObj.myrepObj[b]);return c},handleMissedPackets:function(a,c,f){f=this.removeDupObjs(f);virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs.concat(f);b.sortingReplyObjs();a!=c&&virtualclass.storage.store(JSON.stringify(virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs));
this.containsIfQueuePacks(a,c,virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId,f)},removeDupObjs:function(a){0<virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr.length&&(a[a.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr[0].uid&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr[0].hasOwnProperty("cmd")||virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr.shift()),a=a.concat(virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr),virtualclass.wb[virtualclass.gObj.currWb].gObj.myArr=
[]);return a},containsIfQueuePacks:function(a,c,b,g){a!=c&&b+1!=g[0].uid&&0<virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue.length&&g[g.length-1].uid==virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue[0].uid&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue=g.concat(virtualclass.wb[virtualclass.gObj.currWb].gObj.packQueue))},sortingReplyObjs:function(){virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs.sort(function(a,
c){return a.uid-c.uid})}};d.bridge=b})(window);(function(d){d.Optimize=function(b){var a=virtualclass.wb[b].vcan;a.optimize={sendPacketWithOptimization:function(a,b){var c=virtualclass.gObj.currWb;"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),io.webSocketConnected()&&virtualclass.vutil.beforeSend(JSON.parse(a)),virtualclass.wb[c].utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=b&&(io.webSocketConnected()&&(b=JSON.parse(a),b.hasOwnProperty("createArrow")?
ioAdapter.send(b):ioAdapter.mustSend(b)),virtualclass.wb[c].utility.updateSentInformation(a,!0),this.lastarrowtime=(new Date).getTime())},doOptiMize:function(c){"move"==a.main.action&&roles.hasControls()&&(c=a.utility.updateCordinate(c));if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),c.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(lastmousemovetime,"m",c.clientX-a.main.offset.x,c.clientY-a.main.offset.y);presentmousemovetime=
(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),c.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(lastmousemovetime,"m",c.clientX-a.main.offset.x,c.clientY-a.main.offset.y),a.optimize.calculatePackets(lastmousemovetime,"m",c.clientX-a.main.offset.x,c.clientY-a.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(c,b,g,d,m){g/=virtualclass.zoom.canvasScale;d/=virtualclass.zoom.canvasScale;var f=virtualclass.gObj.currWb;
c=a.makeStackObj(c,b,g,d);"undefined"!=typeof m&&(c.foundText=!0);virtualclass.wb[f].uid++;c.uid=virtualclass.wb[f].uid;a.main.replayObjs.push(c);virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"});virtualclass.storage.store(JSON.stringify(a.main.replayObjs))}}}})(window);(function(d){d.response={reclaimRole:function(b,a){b!=a&&(virtualclass.user.control._assign(a,"notsent",b),virtualclass.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),virtualclass.user.control.removeAudioFromParticipate(b),"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0)))},assignRole:function(b,a,c){if(b!=a||"undefined"!=typeof c)if(virtualclass.vutil.assignRole(a),virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())b=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=b&&virtualclass.user.control.removeCurrTeacherFromControl(b.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();a=chatContainerEvent.elementFromShadowDom("#ml"+b);c=["assign"];
var f=document.getElementById(b+"ControlContainer");null!=f?virtualclass.user.createAssignControl(f,b,!0):(c=virtualclass.user.createControl(b,c),a.appendChild(c));localStorage.setItem("aId",b)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},checkUser:function(b,a,c){"undefined"!=typeof vcan.teacher||c||virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasDisable();
virtualclass.vutil.initDefaultInfo(b,wbUser.role,virtualclass.currApp);virtualclass.wb[virtualclass.gObj.currWb].utility.makeUserAvailable(b.message.checkUser.e.clientLen)},clearAll:function(b,a,c,f){b!=a&&(virtualclass.wb[virtualclass.gObj.currWb].tool=new virtualclass.wb[virtualclass.gObj.currWb].tool_obj("t_clearall"),virtualclass.wb[virtualclass.gObj.currWb].utility.t_clearallInit(),virtualclass.wb[virtualclass.gObj.currWb].utility.makeDefaultValue(),virtualclass.storage.wbDataRemove(virtualclass.gObj.currWb))},
replayAll:function(){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=virtualclass.wb[virtualclass.gObj.currWb].gObj.replayObjs;virtualclass.wb[virtualclass.gObj.currWb].utility.clearAll(!1);virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromFile")},createArrow:function(b){var a=virtualclass.gObj.currWb,c=virtualclass.wb[a].arrImg,f={};f.mp={x:b.x*virtualclass.zoom.canvasScale,y:b.y*virtualclass.zoom.canvasScale};document.querySelector("#canvasWrapper"+a);virtualclass.posY=
f.mp.y;virtualclass.posX=f.mp.x;virtualclass.wb[virtualclass.gObj.currWb].utility.drawArrowImg(c,f);null!=virtualclass.pdfRender[a].scroll.Y&&virtualclass.pdfRender[a].customMoustPointer({y:virtualclass.posY},"Y",virtualclass.posY);null!=virtualclass.pdfRender[a].scroll.X&&virtualclass.pdfRender[a].customMoustPointer({x:virtualclass.posX},"X",virtualclass.posX)},replayObj2:function(b){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=[];0<b.length&&(virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId+
1==b[0].uid?(d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=b,console.log("Whiteboard:-  recieved "+b[b.length-1].uid),virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromBrowser",!0,virtualclass.wb[virtualclass.gObj.currWb].utility.dispQueuePacket)):console.log("Whiteboard:- Problem between display id "+virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId+" and recived first packet"+b[0].uid))},replayObj:function(b){d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=
[];0<b.length&&(d.virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs=b,virtualclass.wb[virtualclass.gObj.currWb].toolInit("t_replay","fromBrowser",!0,virtualclass.wb[virtualclass.gObj.currWb].utility.dispQueuePacket))},chunk:function(b,a,c){virtualclass.wb[virtualclass.gObj.currWb].bridge.handleMissedPackets(b,a,c)},repObjForMissedPkts:function(b){(0!==virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId||0<virtualclass.wb[virtualclass.gObj.currWb].uid&&0===virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId)&&
("object"===typeof b||b instanceof Array)&&b[0].hasOwnProperty("uid")&&!b.hasOwnProperty("chunk")&&(Number(virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId+1)<Number(b[0].uid)||virtualclass.wb[virtualclass.gObj.currWb].gObj.rcvdPackId!=virtualclass.wb[virtualclass.gObj.currWb].gObj.displayedObjId)&&(b=virtualclass.wb[virtualclass.gObj.currWb].bridge.requestPackets(b),virtualclass.vutil.beforeSend({getMsPckt:b,cf:"getMsPckt"}))}}})(window);var LZString={_f:String.fromCharCode,_keyStrBase64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStrUriSafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_getBaseValue:function(d,b){LZString._baseReverseDic||(LZString._baseReverseDic={});if(!LZString._baseReverseDic[d]){LZString._baseReverseDic[d]={};for(var a=0;a<d.length;a++)LZString._baseReverseDic[d][d[a]]=a}return LZString._baseReverseDic[d][b]},compressToBase64:function(d){if(null==d)return"";
d=LZString._compress(d,6,function(b){return LZString._keyStrBase64.charAt(b)});switch(d.length%4){default:case 0:return d;case 1:return d+"===";case 2:return d+"==";case 3:return d+"="}},decompressFromBase64:function(d){return null==d?"":""==d?null:LZString._decompress(d.length,32,function(b){return LZString._getBaseValue(LZString._keyStrBase64,d.charAt(b))})},compressToUTF16:function(d){return null==d?"":LZString._compress(d,15,function(b){return String.fromCharCode(b+32)})+" "},decompressFromUTF16:function(d){return null==
d?"":""==d?null:LZString._decompress(d.length,16384,function(b){return d.charCodeAt(b)-32})},compressToUint8Array:function(d){d=LZString.compress(d);for(var b=new Uint8Array(2*d.length),a=0,c=d.length;a<c;a++){var f=d.charCodeAt(a);b[2*a]=f>>>8;b[2*a+1]=f%256}return b},decompressFromUint8Array:function(d){if(null===d||void 0===d)return LZString.decompress(d);for(var b=Array(d.length/2),a=0,c=b.length;a<c;a++)b[a]=256*d[2*a]+d[2*a+1];var f=[];b.forEach(function(a){f.push(String.fromCharCode(a))});
return LZString.decompress(f.join(""))},compressToEncodedURIComponent:function(d){return null==d?"":LZString._compress(d,6,function(b){return LZString._keyStrUriSafe.charAt(b)})},decompressFromEncodedURIComponent:function(d){if(null==d)return"";if(""==d)return null;d=d.replace(/ /g,"+");return LZString._decompress(d.length,32,function(b){return LZString._getBaseValue(LZString._keyStrUriSafe,d.charAt(b))})},compress:function(d){return LZString._compress(d,16,function(b){return String.fromCharCode(b)})},
_compress:function(d,b,a){if(null==d)return"";var c,f={},g={},k="",m=2,n=3,p=2,v=[],u=0,q=0,r;for(r=0;r<d.length;r+=1){var t=d[r];Object.prototype.hasOwnProperty.call(f,t)||(f[t]=n++,g[t]=!0);var B=k+t;if(Object.prototype.hasOwnProperty.call(f,B))k=B;else{if(Object.prototype.hasOwnProperty.call(g,k)){if(256>k.charCodeAt(0)){for(c=0;c<p;c++)u<<=1,q==b-1?(q=0,v.push(a(u)),u=0):q++;var A=k.charCodeAt(0);for(c=0;8>c;c++)u=u<<1|A&1,q==b-1?(q=0,v.push(a(u)),u=0):q++,A>>=1}else{A=1;for(c=0;c<p;c++)u=u<<
1|A,q==b-1?(q=0,v.push(a(u)),u=0):q++,A=0;A=k.charCodeAt(0);for(c=0;16>c;c++)u=u<<1|A&1,q==b-1?(q=0,v.push(a(u)),u=0):q++,A>>=1}m--;0==m&&(m=Math.pow(2,p),p++);delete g[k]}else for(A=f[k],c=0;c<p;c++)u=u<<1|A&1,q==b-1?(q=0,v.push(a(u)),u=0):q++,A>>=1;m--;0==m&&(m=Math.pow(2,p),p++);f[B]=n++;k=String(t)}}if(""!==k){if(Object.prototype.hasOwnProperty.call(g,k)){if(256>k.charCodeAt(0)){for(c=0;c<p;c++)u<<=1,q==b-1?(q=0,v.push(a(u)),u=0):q++;A=k.charCodeAt(0);for(c=0;8>c;c++)u=u<<1|A&1,q==b-1?(q=0,v.push(a(u)),
u=0):q++,A>>=1}else{A=1;for(c=0;c<p;c++)u=u<<1|A,q==b-1?(q=0,v.push(a(u)),u=0):q++,A=0;A=k.charCodeAt(0);for(c=0;16>c;c++)u=u<<1|A&1,q==b-1?(q=0,v.push(a(u)),u=0):q++,A>>=1}m--;0==m&&(m=Math.pow(2,p),p++);delete g[k]}else for(A=f[k],c=0;c<p;c++)u=u<<1|A&1,q==b-1?(q=0,v.push(a(u)),u=0):q++,A>>=1;m--;0==m&&p++}A=2;for(c=0;c<p;c++)u=u<<1|A&1,q==b-1?(q=0,v.push(a(u)),u=0):q++,A>>=1;for(;;)if(u<<=1,q==b-1){v.push(a(u));break}else q++;return v.join("")},decompress:function(d){return null==d?"":""==d?null:
LZString._decompress(d.length,32768,function(b){return d.charCodeAt(b)})},_decompress:function(d,b,a){var c=[],f=4,g=4,k=3,m=[],n,p,v=LZString._f,u=a(0),q=b,r=1;for(n=0;3>n;n+=1)c[n]=n;var t=0;var B=Math.pow(2,2);for(p=1;p!=B;){var A=u&q;q>>=1;0==q&&(q=b,u=a(r++));t|=(0<A?1:0)*p;p<<=1}switch(t){case 0:t=0;B=Math.pow(2,8);for(p=1;p!=B;)A=u&q,q>>=1,0==q&&(q=b,u=a(r++)),t|=(0<A?1:0)*p,p<<=1;var F=v(t);break;case 1:t=0;B=Math.pow(2,16);for(p=1;p!=B;)A=u&q,q>>=1,0==q&&(q=b,u=a(r++)),t|=(0<A?1:0)*p,p<<=
1;F=v(t);break;case 2:return""}n=c[3]=F;for(m.push(F);;){if(r>d)return"";t=0;B=Math.pow(2,k);for(p=1;p!=B;)A=u&q,q>>=1,0==q&&(q=b,u=a(r++)),t|=(0<A?1:0)*p,p<<=1;switch(F=t){case 0:t=0;B=Math.pow(2,8);for(p=1;p!=B;)A=u&q,q>>=1,0==q&&(q=b,u=a(r++)),t|=(0<A?1:0)*p,p<<=1;c[g++]=v(t);F=g-1;f--;break;case 1:t=0;B=Math.pow(2,16);for(p=1;p!=B;)A=u&q,q>>=1,0==q&&(q=b,u=a(r++)),t|=(0<A?1:0)*p,p<<=1;c[g++]=v(t);F=g-1;f--;break;case 2:return m.join("")}0==f&&(f=Math.pow(2,k),k++);if(c[F])F=c[F];else if(F===g)F=
n+n[0];else return null;m.push(F);c[g++]=n+F[0];f--;n=F;0==f&&(f=Math.pow(2,k),k++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);/*
 g711
 Copyright(c) 2011 Jo?o Martins <madjackoo@gmail.com>
 MIT Licensed
*/
var G711={BIAS:132,CLIP:32635,tables:{alaw:{compress:[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,
-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,
-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,
200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,624,592,944,912,1008,976,816,784,880,848]}},encode:function(d,b){d.constructor==Array&&(d.byteLength=2*d.length);b=new ArrayBuffer(d.byteLength/2);b=new Int8Array(b);for(var a=0;a<d.byteLength/2;a++){var c=new ArrayBuffer(2),f=new ArrayBuffer(1),g=new Int16Array(c);f=new Int8Array(f);c=~d[a]>>8&128;128!=c&&(g[0]=-d[a],d[a]=g[0]);d[a]>G711.CLIP&&(d[a]=G711.CLIP);if(256<=
d[a]){g=G711.tables.alaw.compress[d[a]>>8&127];var k=d[a]>>g+3&15;f[0]=g<<4|k}else f[0]=d[a]>>4;f[0]=f[0]^c^85;b[a]=f[0]}return b},decode:function(d,b){b=b||{};"undefined"==typeof d.byteLength&&(d.byteLength=d.length);var a=new ArrayBuffer(d.byteLength*(b.floating_point?4:2));b=new Float32Array(a);for(var c=0;c<d.byteLength;c++){a=new ArrayBuffer(2);a=new Int8Array(a);var f=G711.tables.alaw.decompress[d[c]&255];a[0]=f;a[1]=f>>8;a=(new Int16Array(a.buffer))[0];b[c]=a/32768}return b}};window.addEventListener("message",function(d){if(d.origin==window.location.origin)if("gotScreen"==d.data.type){if(""===d.data.sourceId){d=Error("NavigatorUserMediaError");d.name="PERMISSION_DENIED";if(virtualclass.hasOwnProperty("ss"))virtualclass.ss.onError(d);if("SharePresentation"==virtualclass.currApp||"DocumentShare"==virtualclass.currApp)d=document.querySelector("#dashboardnav button"),null!=d&&d.click();roles.hasControls()&&virtualclass.vutil.initDefaultApp()}else{var b=b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",
chromeMediaSourceId:d.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}};virtualclass.adpt=new virtualclass.adapter;navigator2=virtualclass.adpt.init(navigator);navigator2.getUserMedia(b,function(a){virtualclass.ss._init();virtualclass.ss.initializeRecorder.call(virtualclass.ss,a)},function(a){virtualclass.ss.onError.call(virtualclass.ss,a)})}if(d=document.querySelector("#virtualclassScreenShareLocalSmall"))d.style.display=
"block"}else"getScreenPending"==d.data.type?window.clearTimeout(d.data.id):"yes"==d.data.type&&(virtualclass.gObj.ext=!0)});(function(d){d.dirtyCorner={decodeRGB:function(b,a,c){a=a.createImageData(c.width,c.height);for(c=0;c<4*b.length;c++)a.data[4*c+0]=36.5*(b[c]>>5),a.data[4*c+1]=36.5*((b[c]&28)>>2),a.data[4*c+2]=85*(b[c]&3),a.data[4*c+3]=255;return a},decodeRGBSlice:function(b,a,c){a=a.createImageData(c.w,c.h);for(c=0;c<4*b.length;c++)a.data[4*c+0]=36.5*(b[c]>>5),a.data[4*c+1]=36.5*((b[c]&28)>>2),a.data[4*c+2]=85*(b[c]&3),a.data[4*c+3]=255;return a},encodeRGB:function(b){for(var a=b.length/4,c=new Uint8ClampedArray(a),
f,g,d,m=0;m<a;m++)f=b[4*m+0],g=b[4*m+1],d=b[4*m+2],f=(Math.round(f/36.5)<<5)+(Math.round(g/36.5)<<2)+Math.round(d/85),c[m]=f;return c},str2ImageData:function(b,a){a=context2.createImageData(a.w,a.h);var c=new ArrayBuffer(b.length);a.data=new Uint8Array(c);for(c=0;c<strLen;c++)a.data[c]=b.charCodeAt(c);return a},doClearCanvas:function(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(d){d.vutil={createDOM:function(b,a,c){b=document.createElement(b);"undefined"!=typeof a&&(b.id=a);if("undefined"!=typeof c){a="";if(0<c.length)for(var f=0;f<c.length;f++)a+=c[f]+" ";b.className=a}return b},ab2str:function(b){return String.fromCharCode.apply(null,new Uint8ClampedArray(b))},str2ab:function(b){var a=new ArrayBuffer(b.length);a=new Uint8ClampedArray(a);for(var c=0,f=b.length;c<f;c++)a[c]=b.charCodeAt(c);return a},sidebarHeightInit:function(){document.getElementById("widgetRightSide").style.height=
d.innerHeight+"px"},isSystemCompatible:function(){if(0<virtualclass.error.length){var b=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.view.createErrorMsg(b,"errorContainer","chatWidget");virtualclass.gObj.hasOwnProperty("errIE")&&virtualclass.vutil.disableVirtualClass();virtualclass.gObj.hasOwnProperty("audIntDisable")&&virtualclass.user.control.mediaWidgetDisable();virtualclass.gObj.hasOwnProperty("errNotDesktop")&&(virtualclass.user.control.mediaWidgetDisable(),
virtualclass.vutil.disableVirtualClass())}else(virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable"))&&virtualclass.user.control.mediaWidgetDisable()},chkValueInLocalStorage:function(b){return null===localStorage.getItem(b)?!1:localStorage[b]},setContainerWidth:function(b,a){},setScreenInnerTagsWidth:function(b){document.getElementById(b);document.getElementById(b+"Local");document.getElementById(b+"LocalVideo")},makeActiveApp:function(b,a){if(b!=a&&
"undefined"!=typeof a)a+="Tool",document.getElementById(a).className=virtualclass.vutil.removeClassFromElement(a,"active");else{a=document.getElementsByClassName("appOptions");for(var c=0;c<a.length;c++)a[c].classList.contains("active")&&a[c].classList.remove("active")}document.getElementById(b+"Tool").className+=" active"},initInstallChromeExt:function(b){"EXTENSION_UNAVAILABLE"==b.name&&(console.log("ask for inline installation"),this._inlineChomeExtensionStore())},_inlineChomeExtensionStore:function(){chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",
function(b){d.location.reload()},function(b){alert(b)})},removeAppPanel:function(){var b=document.getElementById("virtualclassOptionsCont");null!=b&&b.parentNode.removeChild(b)},removeTempVideo:function(b){b=document.getElementById(b);b.parentNode.removeChild(b)},createLocalTempVideo:function(b,a){if("string"==typeof b||"String"==typeof b)b=document.getElementById(b);var c=virtualclass.vutil.createDOM("div",a);a=virtualclass.vutil.createDOM("canvas",a+"Video");c.appendChild(a);b.appendChild(c)},initLocCanvasCont:function(b){var a=
"ScreenShare"==virtualclass.currApp?"ss":"wss";virtualclass[a].localtempCanvas=document.getElementById(b);console.log(virtualclass[a].localtempCanvas);virtualclass[a].localtempCont=virtualclass[a].localtempCanvas.getContext("2d")},videoTeacher2Student:function(b,a){var c=b,f=document.getElementById("virtualclass"+b+"LocalVideo");if(null!=f&&"VIDEO"==f.tagName){var g=document.createElement("canvas");g.id=f.id;g.width=f.offsetWidth;g.height=f.offsetHeight;f.parentNode.replaceChild(g,f);"ScreenShare"==
c&&(c="ss");"undefined"!=typeof a||"undefined"==typeof c||"ss"!=c&&"wss"!=c||(virtualclass[c].localCanvas=g,virtualclass[c].localCont=virtualclass[c].localCanvas.getContext("2d"),a=virtualclass[c].localtempCont.getImageData(0,0,virtualclass[c].localtempCanvas.width,virtualclass[c].localtempCanvas.height),virtualclass[c].localCont.putImageData(a,0,0));virtualclass.vutil.removeTempVideo("virtualclass"+b+"LocalTemp")}},clickOutSideCanvas:function(){this.exitTextWrapper()&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.textUtility(virtualclass.wb[virtualclass.gObj.currWb].gObj.spx,
virtualclass.wb[virtualclass.gObj.currWb].gObj.spy)},exitTextWrapper:function(){return 0<document.getElementsByClassName("textBoxContainer").length},attachClickOutSideCanvas:function(){function b(a){a=document.getElementById(a);null!=a&&(a.onclick=function(){roles.hasControls()&&virtualclass.vutil.clickOutSideCanvas()})}b("commandToolsWrapper");b("virtualclassOptionsCont");b("audioWidget");b("chatWidget")},dimensionMatch:function(b,a){b=document.getElementById(b).offsetWidth;var c=document.getElementById("virtualclassOptionsCont").offsetWidth;
a=document.getElementById(a);return null!=a?a.offsetWidth+c==b:!1},disableAppsBar:function(){var b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.pointerEvents="none")},isMiniFileIncluded:function(b){b=new RegExp(b+".js?=*([0-9]*)");for(var a=document.getElementsByTagName("script"),c=0;c<a.length;c++)if(b.test(a[c].src))return!0;return!1},clearAllChat:function(){localStorage.removeItem(virtualclass.gObj.uid);localStorage.clear("chatroom");null!=virtualclass.chat&&(virtualclass.chat.idList.length=
0);clearAllChatBox();var b=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<b.length)for(;null!=b[0];)b[0].parentNode.removeChild(b[0])},isObjectEmpty:function(b){for(var a in b)if(b.hasOwnProperty(a))return!1;return!0},removeSessionTool:function(){if(!roles.hasAdmin()){var b=document.getElementById("virtualclassSessionEndTool");null!=b&&b.parentNode.removeChild(b)}},Fullscreen:function(){var b=document.getElementById("virtualclassCont");b.requestFullscreen?b.requestFullscreen():
b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.msRequestFullscreen&&b.msRequestFullscreen();b.classList.add("fullScreenMode")},closeFullscreen:function(){var b=document.getElementById("virtualclassCont");document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();b.classList.remove("fullScreenMode")},
addClass:function(b,a){var c=document.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)?c.classList.add(a):c.className=a},removeClass:function(b,a){var c=document.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)&&c.classList.contains(a)&&c.classList.remove(a)},breakIntoBytes:function(b,a){b=b.toString();for(var c=b.length;c<a;c++)b="0"+b;return b.match(/[\S]{1,2}/g)||[]},numValidateFour:function(b,a,c,f){b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);c=this.preNumValidateTwo(c);
f=this.preNumValidateTwo(f);return parseInt(b+a+c+f)},numValidateTwo:function(b,a){b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);return parseInt(b+a)},preNumValidateTwo:function(b){b=b.toString();if(1==b.length)return"0"+b;if(2==b.length)return b},elemHasAnyClass:function(b){b=document.getElementById(b);return null!=b?"undefined"!=typeof b.classList:!1},userIsOrginalTeacher:function(b){return roles.hasAdmin()},isUserTeacher:function(b){return roles.hasControls()},initDisableAudVid:function(){virtualclass.gObj.audIntDisable=
!0;virtualclass.gObj.vidIntDisable=!0},initDisableVirtualClass:function(){this.initDisableAudVid();virtualclass.gObj.errNotDesktop=!0;virtualclass.gObj.errNotScreenShare=!0;virtualclass.gObj.errAppBar=!0},disableVirtualClass:function(){var b=document.getElementById("virtualclassCont");b.style.opacity=.6;b.style.pointerEvents="none"},enableVirtualClass:function(){var b=document.getElementById("virtualclassCont");b.style.opacity=1;b.style.pointerEvents="visible"},firstiOSaudioCall:function(){virtualclass.gObj.hasOwnProperty("audioPlayMessage")&&
(virtualclass.gObj.iosIpadbAudTrue=!0,virtualclass.media.audio.receivedAudioProcess(virtualclass.gObj.audioPlayMessage))},beforeLoad:function(){if("DocumentShare"==virtualclass.currApp){if(!roles.hasControls()){var b=document.querySelector("#virtualclassCont.congrea #icHr").getAttribute("data-action");if("disable"==b){var a=virtualclass.vutil.whoIsTeacher();ioAdapter.sendUser({data:{user:wbUser.id,action:b},cf:"raiseHand"},a)}}io.disconnect()}virtualclass.gObj.windowLoading=!0;if(virtualclass.recorder.hasOwnProperty("doSessionClear"))virtualclass.clearSession();
else if(0==localStorage.length)virtualclass.storage.clearStorageData();else{console.log("screen-detail init");localStorage.setItem("executedSerial",JSON.stringify(ioMissingPackets.executedSerial));localStorage.setItem("executedUserSerial",JSON.stringify(ioMissingPackets.executedUserSerial));"undefined"!=typeof virtualclass.gObj.audioEnable&&localStorage.setItem("audEnable",JSON.stringify({ac:virtualclass.gObj.audioEnable}));localStorage.removeItem("otherRole");virtualclass.gObj.hasOwnProperty("audIntDisable")||
virtualclass.media.audio.studentNotSpeak();virtualclass.vutil.clickOutSideCanvas();localStorage.setItem(wbUser.sid,JSON.stringify(virtualclass.chat.vmstorage));virtualclass.hasOwnProperty("editorRich")&&"object"==typeof virtualclass.editorRich.vcAdapter&&virtualclass.editorRich.saveIntoLocalStorage();virtualclass.hasOwnProperty("editorCode")&&"object"==typeof virtualclass.editorCode.vcAdapter&&virtualclass.editorCode.saveIntoLocalStorage();b={name:virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp)};
console.log(virtualclass.currApp);if("ScreenShare"==virtualclass.currApp){b.name=virtualclass.gObj.defaultApp;var c=virtualclass.vutil.whoIsTeacher();virtualclass.gObj.studentSSstatus.mesharing?ioAdapter.mustSendUser({cf:"rmStdScreen"},c):roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing&&virtualclass.vutil.beforeSend({unshareScreen:!0,st:"ss",cf:"unshareScreen"});if(roles.isStudent()&&!virtualclass.gObj.studentSSstatus.mesharing||roles.hasControls())console.log("screen-detail is saving into storage"),
localStorage.setItem("studentSSstatus",JSON.stringify(virtualclass.gObj.studentSSstatus))}else"Yts"==virtualclass.currApp?"undefined"!=typeof virtualclass.yts.videoId&&"object"==typeof virtualclass.yts.player&&(b.metaData={init:virtualclass.yts.videoId,startFrom:virtualclass.yts.player.getCurrentTime()}):"SharePresentation"==virtualclass.currApp?"undefined"!=typeof virtualclass.sharePt&&"object"==typeof virtualclass.sharePt&&virtualclass.sharePt.pptUrl?(console.log("beforeloadS"+virtualclass.sharePt.pptUrl),
b.metaData={init:virtualclass.sharePt.pptUrl,startFrom:virtualclass.sharePt.state,currId:virtualclass.sharePt.currId},console.log("start From"+virtualclass.sharePt.state),virtualclass.sharePt.saveIntoLocalStorage(b)):b.metaData=null:"Poll"==virtualclass.currApp?(virtualclass.poll.saveInLocalStorage(),console.log("currAppPoll")):"Video"==virtualclass.currApp?(virtualclass.videoUl.player&&(c=virtualclass.videoUl.player.currentTime()),b.metaData={init:{videoId:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl,
yts:virtualclass.videoUl.yts,online:virtualclass.videoUl.online,isPaused:virtualclass.videoUl.isPaused},startFrom:c,isAutoplay:virtualclass.videoUl.autoPlayFlag},console.log(b)):"DocumentShare"==virtualclass.currApp?(console.log("previous app success "+virtualclass.currApp),virtualclass.dts.docs.hasOwnProperty("currDoc")?(c=virtualclass.dts.docs.currDoc,console.log("currentDocument "+c),b.metaData=0<virtualclass.dts.order.length?{init:c,slideNumber:virtualclass.dts.docs.note.currNote,order:JSON.stringify(virtualclass.dts.order)}:
{init:"layout",slideNumber:null}):b.metaData={init:"layout",slideNumber:null},0<Object.keys(virtualclass.dts.pages).length&&(b.metaData.docs=virtualclass.dts.pages)):"Quiz"==virtualclass.currApp?(virtualclass.quiz.saveInLocalStorage(),console.log("quiz data saved")):"Whiteboard"==virtualclass.currApp&&(b={name:"Whiteboard",wbn:virtualclass.gObj.wbCount});localStorage.setItem("wIds",JSON.stringify(virtualclass.gObj.wIds));localStorage.setItem("wbOrder",JSON.stringify(virtualclass.wbCommon.order));
null!=virtualclass.zoom.canvasScale&&(c=+virtualclass.zoom.canvasScale,console.log("Canvas pdf scale "+c),virtualclass.vutil.isNumeric(c),virtualclass.zoom.hasOwnProperty("canvasDimension")&&localStorage.setItem("canvasDimension",JSON.stringify(virtualclass.zoom.canvasDimension)));roles.hasView()&&"Yts"==virtualclass.currApp&&(b={name:"Yts",metaData:null});virtualclass.hasOwnProperty("dts")&&null!=virtualclass.dts&&virtualclass.dts.upateInStorage();localStorage.setItem("currSlide",virtualclass.gObj.currSlide);
localStorage.setItem("currIndex",virtualclass.gObj.currIndex);roles.hasControls()||(c=document.querySelector("#virtualclassCont.congrea #congHr.disable"))&&c.click();console.dir("Previous object "+b);localStorage.setItem("prevApp",JSON.stringify(b));roles.hasControls()?localStorage.setItem("videoSwitch",virtualclass.videoHost.gObj.videoSwitch):(localStorage.setItem("stdVideoSwitch",virtualclass.videoHost.gObj.stdStopSmallVid),localStorage.setItem("allStdVideoOff",virtualclass.videoHost.gObj.allStdVideoOff));
localStorage.setItem("chatWindow",virtualclass.chat.chatWindow);this.saveWbOrder();"DocumentShare"!=virtualclass.currApp&&io.disconnect()}},initOnBeforeUnload:function(b){"iOS"==b?document.body.onunload=function(){virtualclass.vutil.beforeLoad()}:d.onbeforeunload=function(){var a=virtualclass.vutil.smallizeFirstLetter(virtualclass.currApp);virtualclass.vutil.beforeLoad();if(("editorRich"==a||"editorCode"==a)&&"Synchronized"!=virtualclass[a].cmClient.state.constructor.name)return virtualclass.lang.getString("editorinsync")}},
isPlayMode:function(){return 1==d.wbUser.virtualclassPlay},progressBar:function(b,a,c,f){a>b&&(a=b,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));b=0==b&&0==a?0:Math.round(100*a/b);document.getElementById(c).style.width=b+"%";document.getElementById(f).innerHTML=b+"%"},hidePrevIcon:function(b){var a=document.getElementById(virtualclass.previous);null!=a&&(a.style.display="none",console.log("Hide previous screen with display new "+b),"ss"==b?"object"==
typeof virtualclass[b]&&(document.getElementById(virtualclass[b].id).style.display="block"):document.getElementById(virtualclass[b].id).style.display="block")},getUserInfo:function(b,a,c){for(var f=0;f<c.length;f++)if(c[f].userid==a)return c[f][b]},getUserAllInfo:function(b,a){if("undefined"!=typeof b&&"undefined"!=typeof a)for(var c=0;c<a.length;c++){if(a[c].userid==b)return a[c]}else console.log("Error user is not found");return!1},smallizeFirstLetter:function(b){return b.charAt(0).toLowerCase()+
b.slice(1)},capitalizeFirstLetter:function(b){return b.charAt(0).toUpperCase()+b.slice(1)},initDefaultInfo:function(b,a){"t"==b&&"Whiteboard"==a?roles.hasAdmin()||(virtualclass.wb[virtualclass.gObj.currWb].utility.setOrginalTeacherContent(),virtualclass.wb[virtualclass.gObj.currWb].attachToolFunction(commandToolsWrapper+virtualclass.gObj.currWb,!0)):"s"==b&&(virtualclass.gObj.studentId=wbUser.id,roles.hasControls()||(a=localStorage.getItem("uRole"),null!=a&&"e"==a&&(b="e"),localStorage.setItem("uRole",
b)),virtualclass.vutil.removeSessionTool());virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||setTimeout(function(){virtualclass.media.init();virtualclass.media.isInitiator=!0},500);virtualclass.gObj.oneExecuted=!1},removeClassFromElement:function(b,a){if("t_reclaim"!=b){b=document.getElementById(b);if(0<b.classList.length)return b.classList.remove(a),b.className;console.log("Whiteboard Tool class:- could not remove "+a)}},beforeSend:function(b,
a,c){var f=virtualclass.gObj.currWb;if(b.hasOwnProperty("createArrow"))b=JSON.stringify(b),virtualclass.wb[f].vcan.optimize.sendPacketWithOptimization(b,300);else{if(b.hasOwnProperty("repObj")){if("undefined"==typeof b.repObj[b.repObj.length-1])return;virtualclass.wb[f].gObj.rcvdPackId=b.repObj[b.repObj.length-1].uid;virtualclass.wb[f].gObj.displayedObjId=virtualclass.wb[f].gObj.rcvdPackId}JSON.stringify(b);"undefined"!=typeof c&&!0===c?"undefined"==typeof a||!1===a||null===a?ioAdapter.send(b):ioAdapter.sendUser(b,
a):"undefined"==typeof a||!1===a||null===a?ioAdapter.mustSend(b):ioAdapter.mustSendUser(b,a)}},breakintobytes:function(b,a){b=b.toString();for(var c=b.length;c<a;c++)b="0"+b;return b.match(/[\S]{1,2}/g)||[]},createReclaimButton:function(b){this.createDiv("t_reclaim","educator",b);var a=this;document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",function(){a._reclaimRole()})},createDiv:function(b,a,c,f){var g=a;a=virtualclass.lang.getString(a);var d=document.createElement("a");
d.href="#";var m=document.createElement("div");m.id=b;"undefined"!=typeof f&&(m.className=f);m.dataset.tool=g;f=document.createElement("span");f.className="icon-"+g;d.appendChild(f);d.dataset.title=a;d.className="tooltip";m.appendChild(d);"t_reclaim"==b?(b=document.getElementById("virtualclassAppLeftPanel"),c.appendChild(m),b.insertBefore(c,b.firstChild)):c.appendChild(m)},assignRole:function(b){if("object"==typeof virtualclass.wb){var a=virtualclass.wb[virtualclass.gObj.currWb].vcan;virtualclass.wb[virtualclass.gObj.currWb].tool=
"";"move"==a.main.action&&virtualclass.wb[virtualclass.gObj.currWb].utility.deActiveFrmDragDrop()}if("undefined"!=typeof b){if(roles.isEducator()){var c=document.getElementById("commandToolsWrapper_doc_0_0");c.parentNode.removeChild(c);virtualclass.vutil.removeClass("virtualclassCont","educator")}else virtualclass.vutil.addClass("virtualclassCont","presenter");virtualclass.gObj.uRole=roles.hasAdmin()?"t":"p";localStorage.setItem("uRole",virtualclass.gObj.uRole);virtualclass.user.assignRole(virtualclass.gObj.uRole,
virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp),b);"object"==typeof virtualclass.wb&&a.utility.canvasCalcOffset(a.main.canid);"Yts"==virtualclass.currApp?(b=document.getElementById("virtualclassYts"),null!=b?null==document.getElementById("player")&&virtualclass.yts.UI.createPlayerTag(b):virtualclass.yts.UI.container(),virtualclass.yts.UI.inputURL(),"object"==typeof virtualclass.yts.player?virtualclass.yts.seekChangeInterval():console.log("Player object is not ready")):"SharePresentation"==
virtualclass.currApp&&(null!=document.getElementById("virtualclassSharePresentation")?null==document.getElementById("iframecontainer")&&virtualclass.sharePt.UI.createIframe():virtualclass.sharePt.UI.container(),roles.hasControls()&&virtualclass.sharePt.initTeacherLayout(),roles.hasView()&&(virtualclass.sharePt.eventsObj=[]),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler))}else{"Yts"==
virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));"SharePresentation"==virtualclass.currApp&&(roles.hasControls()&&virtualclass.sharePt.initStudentLayout(),roles.hasView()&&(virtualclass.sharePt.eventsObj=[],virtualclass.sharePt.hideElement("pptMessageLayout"),virtualclass.sharePt.UI.createUrlContainer(),virtualclass.sharePt.displayElement("urlcontainer")),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),
virtualclass.sharePt.attachMessageEvent("message",virtualclass.sharePt.pptMessageEventHandler));virtualclass.gObj.uRole=roles.hasAdmin()?"e":"s";c=document.getElementById("commandToolsWrapper_doc_0_0");if(null!=c)for(;c.hasChildNodes();)c.removeChild(c.lastChild);else c=virtualclass.vutil.createRoleWrapper();"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasDisable();roles.hasAdmin()?(document.getElementById("virtualclassCont"),virtualclass.vutil.createReclaimButton(c),
virtualclass.vutil.addClass("virtualclassCont","educator")):(virtualclass.vutil.removeClass("virtualclassCont","presenter"),c=document.querySelector("#commandToolsWrapper_doc_0_0"),null!=c&&c.parentNode.removeChild(c));localStorage.setItem("uRole",virtualclass.gObj.uRole);"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToStudent()}virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();roles.hasAdmin()?virtualclass.uInfo.userobj.role=
virtualclass.gObj.uRole:(io.disconnect(),setTimeout(function(){virtualclass.uInfo.userobj.role=virtualclass.gObj.uRole;io.init(virtualclass.uInfo)},500))},renderWhiteboardObjectsIfAny:function(){"object"==typeof virtualclass.wb&&0<virtualclass.wb[virtualclass.gObj.currWb].vcan.main.children.length&&virtualclass.wb[virtualclass.gObj.currWb].vcan.renderAll()},createCommandWrapper:function(b){var a=virtualclass.wb[b].vcan,c=document.createElement("div");c.id=virtualclass.gObj.commandToolsWrapperId[b];
c.className="commandToolsWrapper";a=document.getElementById(a.canvasWrapperId);null!=a?document.getElementById("containerWb"+b).insertBefore(c,a):document.getElementById("containerWb"+b).appendChild(c);return c},createRoleWrapper:function(){var b=document.createElement("div");b.id="commandToolsWrapper_doc_0_0";b.className="commandToolsWrapper";return b},_reclaimRole:function(){virtualclass.vutil.beforeSend({reclaimRole:!0,cf:"reclaimRole"});var b=document.getElementById("t_reclaim");b.style.pointerEvents=
"none";b.style.opacity="0.5";var a=this;setTimeout(function(){a.reclaimRole();virtualclass.user.control.changeAttrToAssign("enable")},2E3)},reclaimRole:function(){virtualclass.gObj.controlAssign=!1;this.vcResponseAssignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},vcResponseAssignRole:function(b,a,c){if(b!=a||"undefined"!=typeof c)if(virtualclass.vutil.assignRole(a),"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.uniqueArrOfObjsToTeacher(),roles.hasAdmin())b=
document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=b&&virtualclass.user.control.removeCurrTeacherFromControl(b.id),virtualclass.user.control.changeAttrToAssign("enable");else{virtualclass.vutil.removeSessionTool();a=chatContainerEvent.elementFromShadowDom("#ml"+b);c=["assign"];var f=document.getElementById(b+"ControlContainer");null!=f?virtualclass.user.createAssignControl(f,b,!0):(c=virtualclass.user.createControl(b,c),a.appendChild(c));localStorage.setItem("aId",
b)}virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},vcResponseAReclaimRole:function(b,a){console.log("Reclaim role :- Init");if(b!=a){if("object"==typeof virtualclass.wb){var c=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs[virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs.length-1];
if("object"==typeof c&&"del"==c.ac)console.log("Delete command:- Transferring the delete command"),virtualclass.vutil.beforeSend({repObj:[c],cf:"repObj"});else if("t_text"==virtualclass.wb[virtualclass.gObj.currWb].tool.cmd&&"create"==virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action)virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny(!0),console.log("Text command:- Transferring text command");else if(virtualclass.wb[virtualclass.gObj.currWb].tool.hasOwnProperty("started")&&
1==virtualclass.wb[virtualclass.gObj.currWb].tool.started||"move"==virtualclass.wb[virtualclass.gObj.currWb].vcan.main.action)c=vcan.extend({},virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs[virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs.length-1]),c.ac="u",c=c.hasOwnProperty("mtext")?{detail:{cevent:{x:c.x,y:c.y,mtext:c.mtext}}}:{detail:{cevent:{x:c.x,y:c.y}}},c.detail.broadCast=!0,c=new CustomEvent("mouseup",c),vcan.main.canvas.dispatchEvent(c),console.log("Whiteboard:- Transfering the assign role to Teacher");
console.log("Role assign with reclaim")}virtualclass.user.control._assign(a,"notsent",b);console.log("Reclaim role :- peforme");virtualclass.user.displayStudentSpeaker(!0);null!=localStorage.getItem("aId")&&localStorage.removeItem("aId");virtualclass.user.control.removeAudioFromParticipate(b);"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0))}},createReclaimButtonIfNeed:function(){if(roles.isEducator()){var b=virtualclass.vutil.createRoleWrapper();virtualclass.vutil.createReclaimButton(b);return!0}return!1},whoIsTeacher:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("t"==virtualclass.connectedUsers[b].role||"e"==virtualclass.connectedUsers[b].role)return virtualclass.connectedUsers[b].userid;return 0},getMySelf:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=
0;b<virtualclass.connectedUsers.length;b++)if(virtualclass.connectedUsers[b].userid==virtualclass.gObj.uid)return virtualclass.connectedUsers[b]},enablePresentatorEditors:function(b){b={toUser:b,status:!0};virtualclass.user.control.received_editorRich(b);virtualclass.user.control.received_editorCode(b)},getClassName:function(b){var a;"t"==b?a="teacher":"e"==b?a="educator":"s"==b?a="student":"p"==b&&(a="presenter");return a},isPresenterExist:function(){for(var b=0;b<virtualclass.connectedUsers.length;b++)if("p"==
virtualclass.connectedUsers[b].role)return!0;return!1},setReadModeWhenTeacherIsDisConn:function(b){if(!roles.hasAdmin()){var a=localStorage.getItem("oTDisconn");null!=a&&((a=JSON.parse(a))?virtualclass.hasOwnProperty(b)?"object"==typeof virtualclass[b].cm?virtualclass[b].cm.setOption("readOnly","nocursor"):console.log("Editor CM is notvutil defined for editor "+b):console.log("Editor type "+b+" is not ready."):console.log("Teacher is connected."))}},setReadModeWhenTeacherIsConn:function(b){localStorage.removeItem("oTDisconn");
var a=document.getElementById(virtualclass.vutil.capitalizeFirstLetter(b)+"writeModeBox");null!=a?"true"==a.getAttribute("data-write-mode")?virtualclass[b].cm.setOption("readOnly",!1):virtualclass[b].cm.setOption("readOnly","nocursor"):console.log("Editor:- writemode element is not found for "+b)},isTeacherAlreadyExist:function(b){if(virtualclass.hasOwnProperty("connectedUsers"))for(var a=0;a<virtualclass.connectedUsers.length;a++)if(("t"==virtualclass.connectedUsers[a].role||"e"==virtualclass.connectedUsers[a].role)&&
virtualclass.connectedUsers[a].userid!=b)return console.log("joni Id "+b),!0;return!1},isPresenterAlreadyExist:function(b){if(virtualclass.hasOwnProperty("connectedUsers"))for(var a=0;a<virtualclass.connectedUsers.length;a++)if("p"==virtualclass.connectedUsers[a].role&&virtualclass.connectedUsers[a].userid!=b)return console.log("joniId "+b),!0;return!1},getPresenterId:function(){if(virtualclass.hasOwnProperty("connectedUsers"))for(var b=0;b<virtualclass.connectedUsers.length;b++)if("p"==virtualclass.connectedUsers[b].role)return virtualclass.connectedUsers[b].userid;
return!1},isEducatorAlreadyExist:function(b){if(virtualclass.hasOwnProperty("connectedUsers"))for(var a=0;a<virtualclass.connectedUsers.length;a++)if("e"==virtualclass.connectedUsers[a].role&&virtualclass.connectedUsers[a].userid!=b)return console.log("joniId "+b),!0;return!1},isOrginalTeacherExist:function(b){if(virtualclass.hasOwnProperty("connectedUsers"))for(var a=0;a<virtualclass.connectedUsers.length;a++)if("t"==virtualclass.connectedUsers[a].role&&virtualclass.connectedUsers[a].userid!=b)return console.log("joniId "+
b),!0;return!1},createBecomeTeacherWidget:function(){if(null==document.getElementById("beTeacher")){var b=document.createElement("div");b.id="beTeacher";var a=document.createElement("a");a.id=b.id+"Anchor";a.innerHTML=virtualclass.lang.getString("becomeTeacher");b.appendChild(a);a=document.getElementById("virtualclassCont");a.insertBefore(b,a.firstChild);b.addEventListener("click",virtualclass.vutil.initTeacherRole);b.style.pointerEvents="none";b.style.opacity="0.5";setTimeout(function(){b.style.pointerEvents=
"visible";b.style.opacity="1"},6E4)}},removeBecomeTeacherWidget:function(){var b=document.getElementById("beTeacher");null!=b&&b.parentNode.removeChild(b)},initTeacherRole:function(){ioAdapter.send({cf:"bt"});virtualclass.vutil.removeBecomeTeacherWidget();setTimeout(function(){virtualclass.vutil.isOrginalTeacherExist(virtualclass.jId)?console.log("Already connected teacher"):(virtualclass.vutil.overrideRoles("t"),localStorage.setItem("beTeacher",!0),console.log("connected teacher"));d.location.reload()},
virtualclass.gObj.mySetTime)},overrideRoles:function(b){virtualclass.uInfo.userobj.role=b;virtualclass.gObj.uRole=virtualclass.uInfo.userobj.role;wbUser.role=virtualclass.uInfo.userobj.role;var a=document.getElementById("virtualclassCont");virtualclass.vutil.overrideRolesFromElem(a,b)},overrideRolesFromElem:function(b,a){"s"==a?(b.classList.remove("teacher"),b.classList.remove("orginalTeacher"),b.classList.remove("presenter"),b.classList.remove("educator"),virtualclassCont.classList.add("student")):
"p"==a?(b.classList.remove("teacher"),b.classList.remove("orginalTeacher"),b.classList.remove("educator"),virtualclassCont.classList.add("student"),virtualclassCont.classList.add("presenter")):"e"==a?(b.classList.add("teacher"),b.classList.remove("student"),b.classList.remove("presenter"),b.classList.add("educator"),b.classList.add("orginalTeacher")):"t"==a&&(b.classList.remove("student"),b.classList.remove("educator"),b.classList.remove("presenter"),b.classList.add("teacher"),b.classList.add("orginalTeacher"),
console.log("add Teacher"))},sesionEndMsgBoxIsExisting:function(){var b=document.getElementById("sessionEndMsgCont");return b.hasAttribute("data-displaying")&&"true"==b.dataset.displaying},removeVideoHostContainer:function(){var b=document.getElementById("videoHostContainer");null!=b&&b.parentNode.removeChild(b)},createDummyUser:function(b){b||(b=5E3);var a,c=0,f=31,g=setInterval(function(){c>b?clearInterval(g):(f+=c,a={joinUser:{key:f},message:[{lname:" ",name:"User"+f,role:"s",userid:f}],newuser:null,
type:"member_added",user:!0},c++,virtualclass.ioEventApi.readyto_member_add(a))},1)},getVisibleHeightElem:function(b){var a=$(b);b=$(d).scrollTop();var c=b+$(d).height(),f=a.offset().top;a=f+a.outerHeight();return(a>c?c:a)-(f<b?b:f)},applyHeight:function(b){b=document.getElementById("virtualclassAppRightPanel");var a=this.getVisibleHeightElem("virtualclassCont");b.style.height=a!=nul1?a:d.innerHeight},insertIntoLeftBar:function(b){var a=document.querySelector("#virtualclassApp #virtualclassAppLeftPanel");
null!=a?a.appendChild(b):alert("Error:- There is no Element to insert it.")},getWhiteboardId:function(b){b=b.closest(".vcanvas");if(null!=b)return b.dataset.wbId;alert("doc element is null")},getElementOffset:function(b){var a=0,c=0;do a+=b.offsetTop||0,c+=b.offsetLeft||0,b=b.offsetParent;while(b);return{x:c,y:a}},updateCurrentDoc:function(b){virtualclass.gObj.currWb="_doc_"+b+"_"+b},getParentTag:function(b,a){return b.closest(a)},attachEventToUploadTab:function(b,a,c){b=document.getElementById("newDocBtn");
null!=b&&(b.removeEventListener("click",virtualclass.vutil._attachEventToUploadTab),b.addEventListener("click",virtualclass.vutil._attachEventToUploadTab))},_attachEventToUploadTab:function(){var b=document.querySelector("#DocumentShareDashboard .qq-upload-button-selector.qq-upload-button input");if(null!=b){if(b.click(),b=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))b.style.display="block"}else alert("Element is null")},attachEventToUpload:function(b,
a,c){b=document.getElementById("uploadVideo");null!=b&&b.addEventListener("click",function(){var a=document.querySelector("#VideoDashboard .qq-upload-button-selector.qq-upload-button input");null!=a?a.click():alert("Element is null")})},modalPopup:function(b,a){var c={};if("video"==b){var f=document.querySelector("#listvideo .playing");f&&(this.currPlaying=f.getAttribute("data-rid"));c.validation="mp4 avi wmv mov webm mkv vob mpeg".split(" ");c.cb=virtualclass.videoUl.afterUploadVideo;c.cthis="video";
c.maxSize=512E6;c.requesteEndPoint=d.webapi+"&methodname=file_save&live_class_id="+virtualclass.gObj.congCourse+"&status=1&content_type_id=2&user="+virtualclass.gObj.uid}else c.validation="doc docx txt html csv pdf ppt pptx xls xlsx xlt png jpg gif svg tiff rtf xpm".split(" "),c.cb=virtualclass.dts.onAjaxResponse,c.cthis="docs",c.maxSize=24E6,c.requesteEndPoint=d.webapi+"&methodname=congrea_image_converter&live_class_id="+virtualclass.gObj.congCourse+"&status=1&content_type_id=1&user="+virtualclass.gObj.uid;
c.multiple=!1;c.wrapper=document.getElementById(a[0]);virtualclass.fineUploader.uploaderFn(c);"video"!=b&&(b=document.querySelector("#DocumentShareDashboard #docsUploadMsz"),a=document.createElement("div"),b&&b.appendChild(a))},xhrSendWithForm:function(b,a,c){var f=new FormData,g;for(g in b)f.append(g,b[g]);b="undefined"==typeof a?d.webapi:d.webapi+"&methodname="+a+"&user="+virtualclass.gObj.uid;"undefined"!=typeof c?virtualclass.xhr.sendFormData(f,b,c):virtualclass.xhr.sendFormData(f,b)},createSaveButton:function(){var b=
document.createElement("div");b.id="tech_support_save";var a=document.createElement("span");a.innerHTML="Save Session";b.appendChild(a);return b},setChatContHeight:function(b){},setChatHeight:function(b){},alreadyConnected:function(b){return 0<virtualclass.connectedUsers.length?0<virtualclass.connectedUsers.filter(function(a){return a.userid==b}).length:!1},UTCtoLocalTime:function(b){var a=new Date(b);b=a.getHours();a="0"+a.getMinutes();return b+":"+a.substr(-2)},UTCtoLocalTimeToSeconds:function(b){return b=
(new Date(b)).getTime()},appIsForEducator:function(b){for(var a in virtualclass.apps)if(virtualclass.apps[a]==b)return!1;return!0},initDashboardNav:function(b){if(roles.hasControls()){var a=document.querySelector("#dashboardnav button");null==a&&(a=virtualclass.getTemplate("dashboardNav")({app:virtualclass.currApp}),document.querySelector("#virtualclassAppOptionsCont").insertAdjacentHTML("beforeend",a),a=document.querySelector("#dashboardnav button"),null!=a&&(a.addEventListener("click",function(){var a=
document.querySelector(".congrea #virtualclassApp");this.classList.contains("clicked")?(virtualclass.dashBoard.close(),a&&a.classList.contains("dashboard")&&a.classList.remove("dashboard")):(a&&(a.classList.contains("dashboard")||a.classList.add("dashboard")),virtualclass.vutil.initDashboard(virtualclass.currApp),this.classList.add("clicked"),virtualclass.dashBoard.dashBoardClickTooltip("close"),"DocumentShare"==virtualclass.currApp&&virtualclass.hasOwnProperty("dts")&&(virtualclass.dts.moveProgressbar(),
null!=virtualclass.dts.docs.currNote&&virtualclass.dts.setCurrentNav(virtualclass.dts.docs.currNote),document.querySelector(".dbContainer #listnotes .linknotes")?document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable")||virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn()))}),b&&virtualclass.vutil.readyDashboard(b)));"DocumentShare"==virtualclass.currApp?virtualclass.dts.noteExist()?(virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",
["docsuploadContainer"]),document.getElementById("dashboardnav").setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading"))):this.readyDashboard():"Video"==virtualclass.currApp?("undefined"==typeof b&&this.readyDashboard(),(b=document.querySelector(".congrea #listvideo .linkvideo.playing"))||virtualclass.vutil.removeFinishBtn()):(this.readyDashboard(),(b=document.querySelector(".congrea #listppt .linkppt.playing"))||virtualclass.vutil.removeFinishBtn(),document.querySelector(".congrea .pptSharing")&&
virtualclass.modal.hideModal())}},modalCloseHandler:function(){var b=document.querySelector(".congrea .dashboardContainer .modal-header .close");b&&b.addEventListener("click",function(){var a=document.querySelector(".congrea #virtualclassApp");a.classList.contains("dashboard")&&a.classList.remove("dashboard");b.setAttribute("data-dismiss","modal");virtualclass.modal.hideModal()})},readyDashboard:function(b){console.log("Ready Dashboard");var a=virtualclass.currApp;if(null==document.querySelector("#congdashboard")){var c=
virtualclass.getTemplate("dashboard")({app:a});document.querySelector("#dashboardContainer").innerHTML=c}this.modalCloseHandler();if("DocumentShare"==a){var f=document.getElementById("dashboardnav");f.setAttribute("data-title",virtualclass.lang.getString("DocumentSharedbHeading"));if(null==document.querySelector("#"+a+"Dashboard")){var g=document.createElement("div");c=document.querySelector("#congdashboard .modal-body");c.appendChild(g);g.id=a+"Dashboard"}(f=document.querySelector("#docsDbCont"))&&
f.parentNode.removeChild(f);document.querySelector("#"+a+"Dashboard").innerHTML=this.getDocsDashBoard(a);virtualclass.dts.init();virtualclass.vutil.attachEventToUploadTab();virtualclass.dts.isUploaderExist()||virtualclass.vutil.modalPopup("docs",["docsuploadContainer"]);virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listnotes")}else"Video"==a?(document.getElementById("dashboardnav"),null==document.querySelector("#"+
a+"Dashboard")&&(g=document.createElement("div"),c=document.querySelector("#congdashboard .modal-body"),c.appendChild(g),g.id=a+"Dashboard"),document.querySelector("#videoPopup")||(c=virtualclass.getTemplate("popup","videoupload")(),document.querySelector("#VideoDashboard").insertAdjacentHTML("beforeend",c),(a=document.querySelector("#videoPopup  #uploadMsz div"))&&a.parentNode.removeChild(a),virtualclass.vutil.attachEventToUpload(),virtualclass.videoUl.UI.inputUrl()),virtualclass.videoUl.UI.popup(b),
virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listvideo"),b&&b.init.videoUrl&&(f=!0),a=document.querySelector("#dashboardnav button"),null==a||f||virtualclass.vutil.isDashboardOpened()||a.click()):"SharePresentation"==a&&(f=document.getElementById("dashboardnav"),f.setAttribute("data-title",virtualclass.lang.getString("SharePresentationdbHeading")),null==document.querySelector("#"+a+"Dashboard")&&(g=document.createElement("div"),
c=document.querySelector("#congdashboard .modal-body"),c.appendChild(g),g.id=a+"Dashboard"))},initDashboard:function(b,a){document.querySelector("#mainContainer");"SharePresentation"!=b||document.querySelector("#pptDbCont")||(null==document.querySelector(".docsDbCont")&&(document.querySelector("#SharePresentationDashboard").innerHTML=virtualclass.vutil.getPptDashBoard("SharePresentation")),virtualclass.sharePt.attachEvent("submitpurl","click",virtualclass.sharePt.initNewPpt),virtualclass.sharePt.ppts&&
virtualclass.sharePt.ppts.length&&(virtualclass.sharePt.showPpts(virtualclass.sharePt.ppts),virtualclass.sharePt.retrieveOrder()));for(var c=document.querySelectorAll("#congdashboard .dbContainer"),f=0;f<c.length;f++)c[f].style.display=c[f].dataset.app==virtualclass.currApp?"block":"none";console.log("Dashboard is created for "+virtualclass.currApp);"DocumentShare"==b?("undefined"==typeof a&&(virtualclass.modal.showModal(),virtualclass.dashBoard.clickCloseButton()),virtualclass.dts.noteExist()&&virtualclass.vutil.hideUploadMsg("docsuploadContainer")):
"Video"==b?"undefined"==typeof a&&virtualclass.modal.showModal():virtualclass.modal.showModal();virtualclass.dashBoard.actualCloseHandler();a=document.querySelector("#congdashboard .modal-header h4");null!=a&&(a.innerHTML=virtualclass.lang.getString(b+"dbHeading"))},getDocsDashBoard:function(b){var a=virtualclass.getTemplate("dashboard","documentSharing");b={app:b,hasControls:roles.hasControls()};return a(b)},getPptDashBoard:function(b){var a=virtualclass.getTemplate("dashboard","ppt");b={app:b,hasControls:roles.hasControls()};
return a(b)},removeDashboardNav:function(){var b=document.querySelector("#dashboardnav");null!=b&&b.parentNode.removeChild(b)},makeElementDeactive:function(b){console.log("drag drop Deactive element "+b);b=document.querySelector(b);null!=b&&(b.style.pointerEvents="none")},makeElementActive:function(b){console.log("drag drop Active element "+b);b=document.querySelector(b);null!=b&&(b.style.pointerEvents="visible")},initCommonSortingChat:function(){setTimeout(function(){sortCommonChat()},800)},triggerDashboard:function(b,
a){"DocumentShare"==b?null==document.querySelector("#screen-docs .note.current")&&("undefined"==typeof a?virtualclass.vutil.initDashboard(b):virtualclass.vutil.initDashboard(b,a)):"Video"==b?"undefined"==typeof a?virtualclass.vutil.initDashboard(b):virtualclass.vutil.initDashboard(b,a):virtualclass.vutil.initDashboard(b)},trimExtension:function(b){return b.replace(/\.[^/.]+$/,"")},hideUploadMsg:function(b){b=document.querySelector("#"+b+" .qq-uploader-selector.qq-uploader.qq-gallery");null!=b&&b.setAttribute("qq-drop-area-text",
"")},showUploadMsg:function(b){b=document.querySelector("#"+b+" .qq-uploader-selector.qq-uploader.qq-gallery");null!=b&&b.setAttribute("qq-drop-area-text",virtualclass.lang.getString("dropfilehere"))},audioStatus:function(b,a){var c=b.getElementsByClassName("congtooltip")[0];"true"==a?(b.setAttribute("data-audio-playing","true"),c.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),b.className="audioTool active"):(b.setAttribute("data-audio-playing","false"),c&&c.setAttribute("data-title",
virtualclass.lang.getString("audioDisable")),b.className="audioTool deactive")},selfVideoStatus:function(){var b=document.querySelector(".congrea .videoSwitchCont #videoSwitch");if(b.classList.contains("off"))return"off";if(b.classList.contains("on"))return"on"},videoController:function(){var b=document.querySelector(".congrea .videoSwitchCont");b&&b.addEventListener("click",function(){virtualclass.vutil.videoHandler("off"==virtualclass.vutil.selfVideoStatus()?"on":"off")})},videoHandler:function(b,
a){var c=document.querySelector(".congrea .videoSwitchCont #videoSwitch");if("on"==b){c.classList.remove("off");c.classList.add("on");var f="on";c=document.querySelector(".videoSwitchCont");c.dataset.title="Video off";roles.hasControls()?(virtualclass.videoHost.gObj.videoSwitch=1,console.log("videoswitch 1")):virtualclass.videoHost.gObj.stdStopSmallVid=!1;chatContainerEvent.elementFromShadowDom("#ml"+virtualclass.gObj.uid+" .user-details a span")||chatContainerEvent.elementFromShadowDom("#ml"+virtualclass.gObj.uid+
" .user-details a img")?virtualclass.videoHost.removeUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="hide";roles.hasControls()&&virtualclass.videoHost.UI.displayTeacherVideo();var g=document.querySelector("#ml"+virtualclass.gObj.uid+" video");null!=g&&setTimeout(function(){g.srcObject=virtualclass.media.stream},100)}else"off"==b&&(c.classList.remove("on"),c.classList.add("off"),f="off",c=document.querySelector(".videoSwitchCont"),c.dataset.title="Video on",roles.hasControls()?virtualclass.videoHost.gObj.videoSwitch=
0:virtualclass.videoHost.gObj.stdStopSmallVid=!0,chatContainerEvent.elementFromShadowDom("#ml"+virtualclass.gObj.uid+" .user-details a .videoWrapper")?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",roles.hasControls()&&virtualclass.videoHost.UI.hideTeacherVideo());"undefined"==typeof a&&(virtualclass.gObj.meetingMode?virtualclass.multiVideo.setVideoStatus("off"==b?!1:!0):virtualclass.gObj.uid==virtualclass.vutil.whoIsTeacher()&&ioAdapter.mustSend({congCtr:{videoSwitch:f},
cf:"congController"}),roles.hasControls()||ioAdapter.mustSend({stdVideoCtr:{videoSwitch:virtualclass.videoHost.gObj.stdStopSmallVid},cf:"stdVideoCtrl"}))},isChromeExtension:function(){d.postMessage({type:"isInstalled",id:1},"*");console.log("Chrome Extension:- Check");d.addEventListener("message",function(b){"yes"==b.data.type&&(virtualclass.gObj.chromeExt=!0)})},setWidth:function(b,a,c){a=document.querySelector("#canvas"+b);a.width=c},setHeight:function(b,a,c){a=document.querySelector("#canvas"+
b);a.height=c},getWidth:function(b){return b.width},getHeight:function(b){return b.height},getValueWithoutPixel:function(b){return parseInt(b,10)},removeDecimal:function(b){return b.toFixed(2)},getElemM:function(b,a){if("Y"==a)var c=document.querySelector("#"+b).offsetHeight;else"X"==a&&(c=document.querySelector("#"+b).offsetWidth);return this.getValueWithoutPixel(c)},getElemM2:function(b,a){if("Y"==a)var c=document.querySelector("#"+b).offsetHeight;else"X"==a&&(c=document.querySelector("#"+b).offsetWidth);
return this.getValueWithoutPixel(c)},getElemHeight:function(b){b=document.querySelector("#"+b).offsetHeight;return this.getValueWithoutPixel(b)},getElemWidth:function(b){b=document.querySelector("#"+b).offsetWidth;return this.getValueWithoutPixel(b)},visibleElementHeighOldt:function(b,a){var c=0;for(b=document.getElementById(b);b.offsetParent&&b.offsetParent.id!=a;)c+=b.offsetTop,b=b.offsetParent;return b.offsetHeight-c},elementIsVisible2:function(b){var a=b.getBoundingClientRect().top;b=b.getBoundingClientRect().bottom;
return 0<=a&&b<=d.innerHeight},elementIsVisible:function(b){b=b.getBoundingClientRect();var a=Math.max(document.documentElement.clientHeight,d.innerHeight);return!(0>b.bottom||0<=b.top-a)},getVisibleHeight:function(b){var a=$("#"+b);b=$(d).scrollTop();var c=b+$(d).height(),f=a.offset().top;a=f+a.outerHeight();return(a>c?c:a)-(f<b?b:f)},isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},setContainerDimension:function(b,a){},setDefaultScroll:function(){if(roles.hasControls()&&"Whiteboard"==
virtualclass.currApp||"DocumentShare"==virtualclass.currApp){var b=virtualclass.gObj.currWb;null!=b&&null!=virtualclass.pdfRender[b].canvasWrapper&&(virtualclass.pdfRender[b].canvasWrapper.scrollTop=1)}},createWhiteBoard:function(b){return $jscomp.executeAsyncGenerator(function(){function a(a,k){for(;;)switch(c){case 0:return g=["Whiteboard","byclick",b],c=1,{value:virtualclass.appInitiator.Whiteboard.apply(virtualclass,Array.prototype.slice.call(g)),done:!1};case 1:if(void 0===k){c=2;break}c=-1;
throw k;case 2:f=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight}),virtualclass.system.setCanvasWrapperDimension(f,b),c=-1;default:return{value:void 0,done:!0}}}var c=0,f,g,k={next:function(c){return a(c,void 0)},throw:function(c){return a(void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}())},createHashString:function(b){for(var a=0,c=b.length,f=0;f<c;f++)a=31*a+b.charCodeAt(f),
a&=a;return a},randomString:function(b){for(var a="";0<b;--b)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return a},isBulkDataFetched:function(){return 0<virtualclass.serverData.rawData.video.length||0<virtualclass.serverData.rawData.docs.length||0<virtualclass.serverData.rawData.ppt.length},sendOrder:function(b,a,c){virtualclass.gObj.docOrder[b]=a;b={order:JSON.stringify(virtualclass.gObj.docOrder)};virtualclass.xhrn.sendData(b,virtualclass.api.UpdateRoomMetaData,
c)},saveWbOrder:function(b){b&&(console.log("nirmala"+b),localStorage.setItem("wbOrder",JSON.stringify(virtualclass.wbCommon.order)))},requestOrder:function(b,a){virtualclass.xhrn.sendData({noting:!0},virtualclass.api.GetRoomMetaData,function(c){"Error"==c?console.log("page order retrieve failed"):(c=JSON.parse(c).Item,null!=c&&"undefined"!=typeof c&&void 0!=c&&c.order.S&&virtualclass.vutil.IsJsonString(c.order.S)&&(c=JSON.parse(c.order.S),virtualclass.gObj.docOrder=c,a(c[b])))})},IsJsonString:function(b){try{JSON.parse(b)}catch(a){return!1}return!0},
removeChildrens:function(b){console.log("children selector "+b);b=document.querySelectorAll(b);for(var a=0;a<b.length;a++)b[a].parentNode.removeChild(b[a])},initAcitveElement:function(){if("Video"==virtualclass.currApp){var b="#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery";var a="#listvideo"}else"DocumentShare"==virtualclass.currApp&&(b="#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery",a="#listdocs");var c=document.querySelector("#"+virtualclass.currApp+"Dashboard");
null==c||c.classList.contains("uploading")?virtualclass.vutil.makeElementDeactive(b):(virtualclass.vutil.makeElementActive(b),virtualclass.vutil.makeElementDeactive(a))},isResponseAvailable:function(b){return void 0!=b&&"undefined"!=b&&null!=b},navWhiteboard:function(b,a,c){virtualclass.vutil.isTextWrapperExist()&&virtualclass.wb[virtualclass.gObj.currWb].obj.drawTextObj.finalizeTextIfAny();"undefined"!=typeof c?a.call(b,c):a.call(b);console.log("whiteboard nav time"+virtualclass.gObj.wbNavtime)},
removeAllTextWrapper:function(){for(var b=document.querySelectorAll(".canvasWrapper .textBoxContainer"),a=0;a<b.length;a++)b[a].parentNode.removeChild(b[a])},isDashboardOpened:function(b){b=document.querySelector("#dashboardnav button");return null!=b&&b.classList.contains("clicked")},stopConnection:function(){io.webSocketConnected()&&io.disconnect();virtualclass.gObj.invalidlogin=!0},initDefaultApp:function(){var b=document.querySelector("#virtualclass"+virtualclass.gObj.defaultApp+"Tool a");null!=
b&&b.click(b)},initssSharing:function(b){virtualclass.gObj.whoIsSharing=b;b=chatContainerEvent.elementFromShadowDom("#ml"+b+" .icon-stdscreenImg");null!=b&&b.setAttribute("data-dcolor","green")},removeSSsharing:function(){var b=document.querySelector("#chat_div .controleCont.ssSharing");null!=b&&b.classList.remove("ssSharing");delete virtualclass.gObj.whoIsSharing},informIamSharing:function(){var b=virtualclass.vutil.whoIsTeacher();roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing&&ioAdapter.mustSendUser({cf:"sshare_user"},
b)},resizeWindowIfBigger:function(){var b=document.querySelector("#canvasWrapper"+virtualclass.gObj.currWb);null!=b&&60<d.innerWidth-(b.offsetWidth+320)&&(console.log("Resize event is triggered"),system.initResize())},isTextWrapperExist:function(){return 0<document.querySelectorAll(".canvasWrapper .textBoxContainer").length},insertAppLayout:function(b){document.querySelector("#virtualclassAppContainer");$("#virtualclassAppContainer").append(b)},prechkScrnShare:function(){if(localStorage.getItem("precheck")){var b=
document.getElementById("preCheckcontainer");b.style.display="none";b=document.getElementById("virtualclassApp");b.style.display="block";virtualclass.videoHost._resetPrecheck()}else virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),b=document.getElementById("preCheckcontainer"),b.style.display="none",b=document.getElementById("virtualclassApp"),b.style.display="block",localStorage.setItem("precheck",!0),virtualclass.videoHost.afterSessionJoin();virtualclass.gObj.precheckScrn=!1},showFinishBtn:function(){var b=
document.querySelector(".congrea #dashboardContainer .modal-header button");b&&b.classList.add("enable");"DocumentShare"==virtualclass.currApp&&(b=document.querySelector("#virtualclassAppLeftPanel"),b.classList.add("showZoom"),b.classList.remove("hideZoom"))},removeFinishBtn:function(){var b=document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable");b&&b.classList.remove("enable");"DocumentShare"==virtualclass.currApp&&(b=document.querySelector("#virtualclassAppLeftPanel"),
b.classList.add("hideZoom"),b.classList.remove("showZoom"))},removeSharingClass:function(){var b=document.querySelector("#virtualclassCont");""!=b&&(b.classList.remove("studentScreenSharing"),document.querySelector("#chat_div").classList.remove("studentScreenSharing"))},addNoteClass:function(){if(roles.isStudent()){var b=document.querySelector("#docScreenContainer");null!=b&&(b.classList.add("noteDisplay"),console.log("add note display"))}},calcBrightness:function(b){b=chroma(b).rgb();b=Math.round((299*
parseInt(b[0])+587*parseInt(b[1])+114*parseInt(b[2]))/1E3);console.log("brightne"+b);return b},removeStudenScreenStatus:function(){for(var b=chatContainerEvent.elementFromShadowDom(".stdscreenImg","all"),a=0;a<b.length;a++)b[a].dataset.dcolor=""},insertAfter:function(b,a){a.parentNode.insertBefore(b,a.nextSibling)},triggerMouseEvent:function(b,a){if(null!=b){var c=document.createEvent("MouseEvents");c.initEvent(a,!0,!0);b.dispatchEvent(c)}},getCookie:function(b){return(b=document.cookie.match(RegExp("(?:^|;\\s*)"+
b.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")+"=([^;]*)")))?b[1]:null},sendCurrAppOnUserJoin:function(){if("object"==typeof virtualclass.wb&&"Whiteboard"==virtualclass.currApp){var b=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.replayObjs;0<b.length?ioAdapter.sendWithDelayAndDrop({repObj:b,cf:"repObj"},null,"mustSend","repObj",1500):console.log("Could not send the whiteboard data")}},setCurrApp:function(b,a){b.dataset.currapp=a;console.log("Data set curr app "+a);b=document.getElementById("chat_div");
null!=b&&(b.dataset.currapp=a)},selfJoin:function(b){return b==virtualclass.gObj.uid?(ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED),!0):!1},getUrlVars:function(b){for(var a=[],c=b.slice(b.indexOf("?")+1).split("&"),f=0;f<c.length;f++)b=c[f].split("="),a.push(b[0]),a[b[0]]=b[1];return a},clearSyncTimeInterval:function(){virtualclass.videoUl.hasOwnProperty("syncTimeInterval")&&clearInterval(virtualclass.videoUl.syncTimeInterval)},pageVisible:function(){var b,a={hidden:"visibilitychange",
webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(b in a)if(b in document){var c=a[b];break}return function(a){a&&document.addEventListener(c,a);return!document[b]}},showZoom:function(){var b=document.querySelector("#virtualclassAppLeftPanel.hideZoom");b&&(b.classList.remove("hideZoom"),b.classList.add("showZoom"))},removeBackgroundVideoApp:function(){virtualclass.videoUl.videoId="";var b=document.getElementById("dispVideo_Youtube_api");b&&b.contentWindow&&
b.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");if(b=document.querySelector(".congrea #dispVideo"))b.style.display="none",(b=document.querySelector(".congrea #dispVideo video"))&&b.setAttribute("src","");(b=document.querySelector("#listvideo .playing"))&&b.classList.remove("playing");(b=document.querySelector("#listvideo .removeCtr"))&&b.classList.remove("removeCtr");roles.hasControls()||(virtualclass.gObj.hasOwnProperty("videoPauseTime")&&clearTimeout(virtualclass.gObj.videoPauseTime),
"object"==typeof virtualclass.videoUl.player&&null!=virtualclass.videoUl.player.player_&&virtualclass.videoUl.player.paused()&&(console.log("==== Video is paused"),virtualclass.videoUl.player.pause()));"object"==typeof virtualclass.videoUl.player&&delete virtualclass.videoUl.player}}})(window);var globalImageData={},newCanvas;
(function(d){var b,a,c,f,g,k,m,n,p,v,u=function(a){null==m&&(m=document.querySelector("#virtualclassScreenShareLocal"));null==n&&(n=document.createElement("canvas"),n.id="virtualclassScreenShareLocalVideoNew",m.appendChild(n),n=document.querySelector("#virtualclassScreenShareLocalVideoNew"));n.width=a.width;n.height=a.height;0>=virtualclass.studentScreen.base.width&&(virtualclass.studentScreen.base.width=n.width,virtualclass.studentScreen.base.height=n.height);null==p&&(p=document.querySelector("#virtualclassScreenShareLocalVideoNew").getContext("2d"));
p.putImageData(a,0,0);virtualclass.ss.localCont.save();virtualclass.ss.localCont.clearRect(0,0,d.innerWidth-300,d.innerHeight);virtualclass.ss.localCont.scale(virtualclass.studentScreen.scale,virtualclass.studentScreen.scale);virtualclass.ss.localCont.drawImage(n,0,0);virtualclass.ss.localCont.restore();"undefined"!=typeof stype&&(console.log("Screen type width "+n.width),console.log("Screen type height "+n.height))};d.Worker&&(sdworker.onmessage=function(a){"drgb"==a.data.dtype&&(v=globalImageData=
a.data.globalImageData,a.data.hasOwnProperty("stype")?(virtualclass.studentScreen.base.width=0,virtualclass.studentScreen.setDimension(),u(v),"full"==a.data.stype&&1==virtualclass.studentScreen.scale&&(virtualclass.studentScreen.scale=1,virtualclass.studentScreen.fitToScreen())):u(v,"full"))});d.studentScreen=function(){return{scale:1,SCALE_FACTOR:1.04,szoom:!1,base:{width:0,height:0},ssProcess:function(a,c,b,f){var g=a[0];a=new Uint8ClampedArray(c);switch(g){case 102:case 202:g=virtualclass.vutil.numValidateTwo(a[1],
a[2]);c=virtualclass.vutil.numValidateTwo(a[3],a[4]);a=a.subarray(5,a.length);this.initStudentScreen(a,{w:g,h:c},b,f);break;case 103:case 203:"object"==typeof virtualclass.ss&&this.drawImageThroughWorker(a);break;case 104:case 204:c=virtualclass.vutil.numValidateTwo(a[1],a[2]);g=virtualclass.vutil.numValidateTwo(a[3],a[4]);var d=virtualclass.vutil.numValidateTwo(a[5],a[6]);var k=virtualclass.vutil.numValidateTwo(a[7],a[8]);a=a.subarray(9,a.length);c={d:{w:c,h:g},vc:{w:d,h:k}};this.initStudentScreen(a,
c,b,f)}},initStudentScreen:function(c,b,f,d){g=f;f=document.getElementById("virtualclass"+virtualclass.apps.ss);"object"!=typeof virtualclass[g]||null==f?("undefined"!=typeof vtype&&(virtualclass.recorder.recImgPlay=!0),virtualclass.makeAppReady("ScreenShare")):("ScreenShare"!=virtualclass.currApp&&virtualclass.vutil.hidePrevIcon(g),virtualclass.currApp=d,d=document.getElementById("virtualclassCont"),virtualclass.vutil.setCurrApp(d,virtualclass.currApp));if(b.hasOwnProperty("d"))virtualclass[g].dimensionStudentScreenResize(b),
k=!0;else{if("undefined"==typeof k||"undefined"!=typeof a&&a!=b.w&&!b.hasOwnProperty("x"))k=!0,virtualclass[g].dimensionStudentScreen(b.w,b.h),a=b.w;!b.hasOwnProperty("w")||virtualclass[g].localCanvas.width==b.w&&virtualclass[g].localCanvas.height==b.h||(virtualclass[g].localCanvas.width=b.w,virtualclass[g].localCanvas.height=b.h)}virtualclass[g].drawImages(c);virtualclass.previous=virtualclass[g].id;this.szoom||this.initZoom()},initZoom:function(){var a=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()}),
c=document.querySelector("#virtualclass"+virtualclass.currApp);if(null!=c){c.insertAdjacentHTML("beforeend",a);a=document.querySelector("#virtualclass"+virtualclass.currApp+" .zoomIn");c=document.querySelector("#virtualclass"+virtualclass.currApp+" .zoomOut");var b=document.querySelector("#virtualclass"+virtualclass.currApp+" .fitScreen");if(null!=a){var f=this;a.onclick=function(a){f.zoomIn()}}null!=c&&(f=this,c.onclick=function(){f.zoomOut()});null!=b&&(f=this,b.onclick=function(){f.fitToScreen()})}this.szoom=
!0},zoomIn:function(){virtualclass.ss.localCanvas.width=+virtualclass.ss.localCanvas.width*this.SCALE_FACTOR;virtualclass.ss.localCanvas.height=+virtualclass.ss.localCanvas.height*this.SCALE_FACTOR;this.scale*=this.SCALE_FACTOR;u(globalImageData);this.addScroll()},zoomOut:function(){this.scale/=this.SCALE_FACTOR;virtualclass.ss.localCanvas.width=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.width;virtualclass.ss.localCanvas.height=1/this.SCALE_FACTOR*+virtualclass.ss.localCanvas.height;u(globalImageData);
this.addScroll()},addScroll:function(){var a=virtualclass.ss.localCanvas.width,c=virtualclass.ss.localCanvas.parentNode.style.width;a=virtualclass.vutil.getValueWithoutPixel(a);c=virtualclass.vutil.getValueWithoutPixel(c);a>c?virtualclass.ss.localCanvas.parentNode.classList.add("scrollX"):virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},fitToScreen:function(){var a=this.setDimension();this.scale=virtualclass.ss.getScale(this.base.width,a.width);1<=this.scale?(this.scale=1,virtualclass.ss.localCanvas.width=
globalImageData.width,virtualclass.ss.localCanvas.height=globalImageData.height):(virtualclass.ss.localCanvas.width=a.width,virtualclass.ss.localCanvas.height=a.height);u(globalImageData);virtualclass.ss.localCanvas.parentNode.classList.remove("scrollX")},setDimension:function(){var a=this.getCanvasContainerDimension(),c=a.width;a=a.height;c=virtualclass.vutil.getValueWithoutPixel(c);a=virtualclass.vutil.getValueWithoutPixel(a);this.setCanvasContainerDimension(c,a);return{width:c,height:a}},getCanvasContainerDimension:function(){var a=
document.querySelector("#virtualclass"+virtualclass.currApp),c=a.style.width,b=a.style.height;if(null==c||""==c||void 0==c)c=a.offsetWidth;if(null==b||""==b||void 0==b)b=a.offsetHeight;c=virtualclass.vutil.getValueWithoutPixel(c)-40;b=virtualclass.vutil.getValueWithoutPixel(b);return{width:c,height:b}},setCanvasContainerDimension:function(a,c){var b=document.querySelector("#virtualclassScreenShareLocal");b.style.width=a+"px";b.style.height=c+"px"},drawImageThroughWorker:function(a){d.Worker&&sdworker.postMessage({data_pack:a,
dtype:"drgbs"},[a.buffer])}}};d.screenShare=function(a){virtualclass.getSceenFirefox=function(){var a=parseInt(d.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);33<=a?(null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter),virtualclass.adpt.init(navigator).mediaDevices.getUserMedia({video:{mozMediaSource:"window",mediaSource:"window"}}).then(function(a){virtualclass.ss._init();if(roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing||virtualclass.gObj.studentSSstatus.mesharing){if(virtualclass.ss.initializeRecorder.call(virtualclass.ss,
a),"undefined"==typeof err)var c=a.currentTime,b=d.setInterval(function(){a||d.clearInterval(b);if(a.currentTime==c&&(d.clearInterval(b),a.onended))a.onended();c=a.currentTime},500)}else console.log("Set previous app as current app if teacher reclaim role during screen share"),virtualclass.ss.setCurrentApp()}).catch(function(a){var c;virtualclass.ss.setCurrentApp();"Video"==virtualclass.currApp?c=document.getElementById("virtualclassVideoTool"):"SharePresentation"==virtualclass.currApp?c=document.getElementById("virtualclassSharePresentationTool"):
"DocumentShare"==virtualclass.currApp&&(c=document.getElementById("virtualclassDocumentShareTool"));c=c.getElementsByTagName("a")[0];virtualclass.initlizer(c);"string"==typeof a?"PERMISSION_DENIED"===a&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus():"object"==typeof a&&("PermissionDeniedError"!==a.name&&"SecurityError"!=a.name||d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus());roles.hasControls()&&("Video"!=virtualclass.currApp&&"SharePresentation"!=
virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||virtualclass.ss.showDashboard())})):alert(virtualclass.lang.getString("notSupportBrowser",[a]))};return{prevStream:!1,init:function(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;!roles.hasControls()||virtualclass.recorder.recImgPlay||virtualclass.gObj.studentSSstatus.mesharing?roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing?this.readyTostart(a.app):this._init():this.readyTostart(a.app)},_init:function(){console.log("Init screen");
this.currApp=this.tempCurrApp;virtualclass.currApp=virtualclass.apps.ss;var c=document.getElementById("virtualclassCont");virtualclass.vutil.setCurrApp(c,virtualclass.currApp);virtualclass.previous!=a.id&&(document.getElementById(virtualclass.previous).style.display="none",virtualclass.previous=a.id);c=document.getElementById(a.id);null!=c&&(c.style.display="block");this.hasOwnProperty("id")||(this.dc=virtualclass.dirtyCorner,this.postFix="Cont",this.id=a.hasOwnProperty("id")?a.id:"virtualclassScreenShare",
this.className="virtualclass",this.label="Local",this.local=this.id+this.label,this.localTemp=this.id+this.label+"Temp",this.classes=a.hasOwnProperty("class")?a.classes:"",this.initPrevImage(),c=document.getElementById(this.id),null!=c&&c.parentNode.removeChild(c),this.html.UI.call(this,virtualclass.gObj.uRole),(roles.hasControls()&&!virtualclass.recorder.recImgPlay&&!virtualclass.gObj.studentSSstatus.mesharing||roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing)&&virtualclass.vutil.initLocCanvasCont(this.localTemp+
"Video"))},readyTostart:function(a){a==virtualclass.apps.ss&&this.getScreen()},onError:function(a){virtualclass.previous?(virtualclass.currApp=virtualclass.previous.split("virtualclass")[1],virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp)):virtualclass.hasOwnProperty("previousApp")&&"object"==typeof virtualclass.previousApp&&(virtualclass.currApp=virtualclass.previousApp.name,virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp));
roles.hasControls()&&("Video"!=virtualclass.currApp&&"SharePresentation"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||virtualclass.ss.showDashboard());console.log("Error "+a)},showDashboard:function(){virtualclass.vutil.initDashboardNav();"Video"==virtualclass.currApp?(ioAdapter.mustSend({videoUl:{init:"destroyPlayer"},cf:"destroyPlayer"}),ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"})):"SharePresentation"==virtualclass.currApp&&virtualclass.vutil.initDashboard()},
getScreen:function(a){"Chrome"==virtualclass.system.mybrowser.name?virtualclass.gObj.hasOwnProperty("ext")&&virtualclass.gObj.ext?d.postMessage({type:"getScreen",id:1},"*"):(virtualclass.vutil.beforeSend({ext:!0,cf:"colorIndicator"}),virtualclass.popup.chromeExtMissing(),virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp),roles.hasControls()&&("Video"!=virtualclass.currApp&&"SharePresentation"!=virtualclass.currApp&&"DocumentShare"!=virtualclass.currApp||
virtualclass.ss.showDashboard())):"Firefox"==virtualclass.system.mybrowser.name?virtualclass.getSceenFirefox():"Edge"==virtualclass.system.mybrowser.name&&navigator.getDisplayMedia().then(function(a){virtualclass.ss._init();virtualclass.ss.initializeRecorder.call(virtualclass.ss,a)},function(a){console.log("Unable to acquire screen capture",a)})},unShareScreen:function(){console.log("Unshare the screen");this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,this.localtempCanvas.height);
clearInterval(virtualclass.clear);this.initPrevImage();this.hasOwnProperty("currentStream")&&this.currentStream.getTracks()[0].stop();virtualclass.vutil.beforeSend({unshareScreen:!0,st:this.type,cf:"unshareScreen"});this.clearScreenShare()},clearScreenShare:function(){console.log("Clear the screen");"undefined"!=typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&delete virtualclass.prevScreen.currentStream;virtualclass.gObj.studentSSstatus.mesharing=!1;virtualclass.vutil.removeSharingClass();
virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;localStorage.setItem("studentSSstatus",JSON.stringify(virtualclass.gObj.studentSSstatus));var a=document.querySelector("#virtualclassScreenShare");null!=a&&a.parentNode.removeChild(a);virtualclass.vutil.removeSSsharing();delete virtualclass.ss;virtualclass.hasOwnProperty("studentScreen")&&delete virtualclass.studentScreen;virtualclass.zoom.removeZoomController();virtualclass.ss=""},removeStream:function(){virtualclass.vutil.removeClass("audioWidget",
"fixed");this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height);this.clearScreenShare()},initializeRecorder:function(a){b=1;this.prevStream&&(this.ssByClick=!1);"undefined"!=typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();this.video=document.getElementById(this.local+"Video");this.videoSmall=document.getElementById(this.local+"Videosmall");if("VIDEO"!=this.video.tagName){var c=document.getElementById(this.local+
"video");this.video.parentNode.replaceChild(c,this.video);this.video=document.getElementById(this.local+"Video");this.video.autoplay=!0;virtualclass.vutil.initLocCanvasCont(this.local+"TempVideo")}this.currentStream=a;var f=this;virtualclass.adpt.attachMediaStream(this.video,a);virtualclass.adpt.attachMediaStream(this.videoSmall,a);this.prevStream=!0;this.currentStream.getVideoTracks()[0].onended=function(a){if(f.ssByClick){if(a=document.querySelector("#virtualclassScreenShareLocalSmall"))a.style.display=
"none";f.video.src="";f.localtempCont.clearRect(0,0,f.localtempCanvas.width,f.localtempCanvas.height);clearInterval(virtualclass.clear);f.initPrevImage();f.clearScreenShare();virtualclass.vutil.beforeSend({unshareScreen:!0,st:f.type,cf:"unshareScreen"});console.log("Sending unshare screen with users "+virtualclass.gObj.totalUser);roles.hasControls()?virtualclass.gObj.hasOwnProperty("windowLoading")||virtualclass.vutil.initDefaultApp():(a=virtualclass.vutil.whoIsTeacher(),ioAdapter.mustSendUser({cf:"rmStdScreen"},
a));f.prevStream=!1;f.prevScreen="";virtualclass.prevScreen="";console.log("Stop by clicking")}else f.ssByClick=!0};a={};a.width=d.innerWidth;a.height=d.innerHeight-140;c=document.getElementById(this.local);var g=this.html.getDimension(a);c.style.width=Math.round(g.width)+"px";c.style.height=Math.round(g.height)+"px";f=this;this.video.onloadedmetadata=function(){f.width=g.width;f.height=g.height;f.localtempCanvas.width=f.video.offsetWidth;f.localtempCanvas.height=f.video.offsetHeight;virtualclass.prevScreen=
f;var a=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});f.sharing();virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);roles.hasControls()&&(virtualclass.vutil.makeActiveApp(f.id,virtualclass.previrtualclass),"virtualclassYts"==virtualclass.previrtualclass&&virtualclass.yts.destroyYT());virtualclass.previrtualclass=f.id}},sharing:function(){function a(a,c){a=a.toString();for(var b=a.length;b<c;b++)a="0"+a;return a.match(/[\S]{1,2}/g)||[]}function g(){clearInterval(virtualclass.clear);
if("undefined"!=typeof c&&"undefined"!=typeof f){if(c!=z.video.offsetWidth||f!=z.video.offsetHeight)b=1}else c=z.video.offsetWidth,f=z.video.offsetHeight;1==b?setTimeout(m,2E3):n(z.type)}function k(a){switch(!0){case 300>=a||"undefined"==typeof a:J=300;break;case 3E3>=a:J=a;break;case 5E3>=a:J=3E3;break;default:J=5E3}}function m(){console.log("RESIZE screen share");if(roles.hasControls()||virtualclass.gObj.studentSSstatus.mesharing){c=z.video.offsetWidth;f=z.video.offsetHeight;5<z.localtempCanvas.width&&
5<z.localtempCanvas.height?(p=Math.round(z.localtempCanvas.height/12),q=Math.round(z.localtempCanvas.width/12),u=p,v=q):(p=u,q=v);var m=z.type;z.localtempCanvas.width=z.video.offsetWidth;z.localtempCanvas.height=z.video.offsetHeight;z.localtempCont.drawImage(z.video,0,0,z.video.offsetWidth,z.video.offsetHeight);var n=z.localtempCont.getImageData(0,0,z.localtempCanvas.width,z.localtempCanvas.height);n=z.dc.encodeRGB(n.data);var t=Math.round(z.localtempCanvas.width/q),r=Math.round(z.localtempCanvas.height/
p);var A=z.getContainerDimension();if("undefined"!=typeof c&&"undefined"!=typeof f){var B=a(c,4);var F=a(f,4)}else B=a(z.video.offsetWidth,4),F=a(z.video.offsetHeight,4);var E=a(A.width,4);A=a(A.height,4);m=new Uint8ClampedArray(["ss"==m?104:204,B[0],B[1],F[0],F[1],E[0],E[1],A[0],A[1]]);B=new Uint8ClampedArray(n.length+m.length);B.set(m);B.set(n,m.length);d.Worker&&sworker.postMessage({img:n,resize:1,resA:p,resB:q,dw:t,dh:r,offsetWidth:z.video.offsetWidth,offsetHeight:z.video.offsetHeight},[n.buffer]);
virtualclass.vutil.informIamSharing();ioAdapter.sendBinary(B);k(B.length/128);b=0;clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,J)}}function n(a){z.localtempCanvas.width=z.video.offsetWidth;z.localtempCanvas.height=z.video.offsetHeight;z.localtempCont.drawImage(z.video,0,0,z.video.offsetWidth,z.video.offsetHeight);a=Math.round(z.localtempCanvas.width/q);var c=Math.round(z.localtempCanvas.height/p),b=z.localtempCont.getImageData(0,0,z.video.offsetWidth,z.video.offsetHeight);d.Worker&&
(sworker.postMessage({img:b.data,resA:p,resB:q,dw:a,dh:c,offsetWidth:z.video.offsetWidth,offsetHeight:z.video.offsetHeight,type:z.type},[b.data.buffer]),sworker.onmessage=function(a){if(1==a.data.needFullScreen){a=virtualclass.getDataFullScreen(z.type);virtualclass.vutil.informIamSharing();ioAdapter.sendBinary(a);var c=a.length/128}else null!=a.data.masterSlice&&(ioAdapter.sendBinary(a.data.masterSlice),c=a.data.masterSlice.length/128);k(c);clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,
J)});clearInterval(virtualclass.clear)}var p=Math.round(this.localtempCanvas.height/12),q=Math.round(this.localtempCanvas.width/12),u=p,v=q,z=this;virtualclass.hasOwnProperty("wholeImage")&&clearInterval(virtualclass.wholeImage);virtualclass.hasOwnProperty("clear")&&clearInterval(virtualclass.clear);0==p&&0==q&&virtualclass.view.createErrorMsg("screensharereload","errorContainer","chatWidget");var J=1E3;virtualclass.getDataFullScreen=function(c){z.localtempCanvas.width=z.video.offsetWidth;z.localtempCanvas.height=
z.video.offsetHeight;z.localtempCont.drawImage(z.video,0,0,z.video.offsetWidth,z.video.offsetHeight);var b=z.localtempCont.getImageData(0,0,z.localtempCanvas.width,z.localtempCanvas.height);b=z.dc.encodeRGB(b.data);var f=a(z.localtempCanvas.height,4),g=a(z.localtempCanvas.width,4);c=new Uint8ClampedArray(["ss"==c?102:202,g[0],g[1],f[0],f[1]]);f=new Uint8ClampedArray(b.length+c.length);f.set(c);f.set(b,c.length);return f};clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,J)},getContainerDimension:function(){var a=
document.getElementById(this.id+"Local");return{width:a.offsetWidth,height:a.offsetHeight}},drawImages:function(a){sdworker.postMessage({encodeArr:a,cw:virtualclass.ss.localCanvas.width,ch:virtualclass.ss.localCanvas.height,dtype:"drgb"},[a.buffer])},dimensionStudentScreen:function(a,c){this.localCanvas=document.getElementById(virtualclass[g].local+"Video");this.localCont=virtualclass[g].localCanvas.getContext("2d");this.localCanvas.width=a;this.localCanvas.height=c;console.log("normal width "+this.localCanvas.width)},
dimensionStudentScreenResize:function(a,c){this.hasOwnProperty("vac")||(this.vac=!0,this.localCanvas=document.getElementById(virtualclass[g].local+"Video"),this.localCont=virtualclass[g].localCanvas.getContext("2d"));a.hasOwnProperty("d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=a.d.h);a.hasOwnProperty("vc")&&(c=document.getElementById(virtualclass[g].local),c.style.width=a.vc.w+"px",c.style.height=a.vc.h+"px");
"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.setScreenInnerTagsWidth(virtualclass.previous)},isAbleToScreenShare:function(){return roles.isStudent()&&virtualclass.gObj.studentSSstatus.mesharing||roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing?!0:!1},html:{UI:function(a){a=virtualclass.ss.isAbleToScreenShare();var c=roles.hasControls();var b=virtualclass.recorder.recImgPlay;b=virtualclass.getTemplate("ssmainDiv")({control:a,recImg:b,scrctrl:c});virtualclass.vutil.insertAppLayout(b);
roles.hasControls()&&!virtualclass.gObj.studentSSstatus.mesharing&&(b=document.querySelector("#virtualclassCont  #stopScreenShare"))&&b.addEventListener("click",function(){virtualclass.vutil.initDefaultApp()});c&&this.html.initScreenController();c=document.querySelector(".congrea #virtualclassApp");a?c.classList.remove("zoomCtrAdd"):c.classList.contains("zoomCtr")||c.classList.add("zoomCtrAdd");if(roles.hasControls()&&virtualclass.gObj.studentSSstatus.mesharing){var f=this;setTimeout(function(){var a=
document.querySelector("#screenController .share");virtualclass.gObj.studentSSstatus.shareToAll?(f.html.changeSsInfoSelf(a),a="sToAll"):(f.html.changeSsInfoShareToAll(a),a="sview");ioAdapter.mustSend({cf:a,firstSs:!0})},2E3);(b=document.querySelector("#virtualclassCont  #stopScreenShare"))&&b.addEventListener("click",function(){virtualclass.vutil.initDefaultApp();var a=document.querySelector("#virtualclassCont.studentScreenSharing");a&&(a.classList.remove("studentScreenSharing"),document.querySelector("#chat_div").classList.remove("studentScreenSharing"));
virtualclass.vutil.removeStudenScreenStatus()})}},initScreenController:function(){var a=document.querySelector("#screenController .share");if(null!=a){var c=this;a.onclick=function(a){var b=a.currentTarget.classList;if(b.contains("selfView")){c.changeSsInfoSelf(a.currentTarget);var f="sToAll"}else b.contains("shareToAll")&&(c.changeSsInfoShareToAll(a.currentTarget),f="sview");ioAdapter.mustSend({cf:f})}}},changeSsInfoSelf:function(a){a.classList.remove("selfView");a.classList.add("shareToAll");a.children[0].innerHTML=
virtualclass.lang.getString("selfview");virtualclass.gObj.studentSSstatus.shareToAll=!0},changeSsInfoShareToAll:function(a){a.classList.remove("shareToAll");a.classList.add("selfView");a.children[0].innerHTML=virtualclass.lang.getString("sharetoall");virtualclass.gObj.studentSSstatus.shareToAll=!1},getDimension:function(a,c){return{height:a.height,width:a.width}}},initPrevImage:function(){sworker.postMessage({initPrevImg:!0})},setCurrentApp:function(){virtualclass.hasOwnProperty("previous")&&"undefined"!=
typeof virtualclass.previous&&(virtualclass.currApp=virtualclass.previous.slice(12),virtualclass.vutil.setCurrApp(document.getElementById("virtualclassCont"),virtualclass.currApp))},getScale:function(a,c){console.log("Screen type base width "+a);return c/a},initShareScreen:function(a,c){"function"==typeof virtualclass.getDataFullScreen&&(virtualclass.gObj.hasOwnProperty("sendScreen")&&clearTimeout(virtualclass.gObj.sendScreen),virtualclass.gObj.sendScreen=setTimeout(function(){a=virtualclass.getDataFullScreen(a);
var c=virtualclass.getDataFullScreen("ss");ioAdapter.sendBinary(c);virtualclass.vutil.informIamSharing();a=null;console.log("Send full-screen image")},c))}}}})(window);(function(d){function b(){console.log("Define XHR class")}b.prototype.init=function(){this.httpObj=d.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.onReadStateChange();this.httpObj.onerror=function(a){console.log("Error "+a);this.cb("ERROR")};this.httpObj.withCredentials=!0;this.httpObj.onabort=function(a){console.log("Error abort "+a)};return this.httpObj};b.prototype.onReadStateChange=function(){var a=this;this.httpObj.onreadystatechange=function(){4==a.httpObj.readyState&&
"undefined"!=typeof a.cb&&(200==a.httpObj.status?a.cb(a.httpObj.responseText):a.cb("ERROR"))}};b.prototype.send=function(){this.cb=cb;this.httpObj.open("POST",file,!0);this.httpObj.send(data)};b.prototype.loadData=function(a,c){this.cb=c;this.httpObj.open("GET",a,!0);this.httpObj.send()};d.recorder={playTime:150,tempPlayTime:150,items:[],objn:0,playTimeout:"",allFileFound:!1,playTimePreviousSeconds:0,waitServer:!1,waitPopup:!1,masterRecordings:[],alreadyAskForPlay:!1,playStart:!1,error:0,currentMin:0,
importfilepath:d.importfilepath,exportfilepath:d.exportfilepath,uploadInProcess:!1,totalRecordingFiles:[],totalPlayTimeInMin:0,totalTimeInMiliSeconds:0,subRecordings:null,attachSeekHandler:!1,rawDataQueue:{},xhr:[],session:null,elapsedPlayTime:0,prevFile:null,refrenceTime:null,totalElements:0,lastFileTime:null,lastRecordings:0,firstTimeRequest:!0,alreadyRequested:{},binarySyncMsg:null,msg:null,orginalTimes:[],startSeek:!1,initPlay:!1,isTrimRecordingNow:!1,joinRoomRecevied:!1,init:function(){if(!this.attachSeekHandler){this.attachSeekHandler=
!0;var a=document.querySelector("#virtualclassCont"),c=document.querySelector("#downloadProgressBar"),b=document.querySelector("#playProgressBar");c.addEventListener("mousedown",this.seekHandler.bind(this));b.addEventListener("mousedown",this.seekHandler.bind(this));a.addEventListener("mousemove",this.seekWithMouseMove.bind(this));d.addEventListener("mouseup",this.finalSeek.bind(this));a.addEventListener("touchmove",this.seekWithMouseMove.bind(this));a.addEventListener("touchend",this.finalSeek.bind(this));
c.addEventListener("touchstart",this.seekHandler.bind(this));b.addEventListener("touchstart",this.seekHandler.bind(this));a.addEventListener("touchmove",this.seekWithMouseMove.bind(this));a.addEventListener("touchend",this.finalSeek.bind(this));c.addEventListener("mousemove",this.handlerDisplayTime.bind(this));b.addEventListener("mousemove",this.handlerDisplayTime.bind(this));c.addEventListener("mouseleave",this.removeHandler.bind(this,c));b.addEventListener("mouseleave",this.removeHandler.bind(this,
b));virtualclass.pageVisible(this.handlPageActiveness.bind(this))}this.hasOwnProperty("prvNum")||(this.masterIndex=this.subRecordingIndex=0,this.subRecordings=this.masterRecordings[this.masterIndex],this.play(),this.prvNum=this.masterIndex)},handlPageActiveness:function(){virtualclass.pageVisible()?this.earlierPause||(this.controller._play(),delete this.earlierPause):(this.earlierPause=this.controller.pause,this.controller._pause())},removeHandler:function(a){a.removeEventListener("mousedown",this.seekHandler.bind(this));
document.getElementById("timeInHover").style.display="none";document.querySelector("#virtualclassCont").classList.remove("recordSeeking")},replayFromStart:function(){console.log("Replay from start");this.tempPlayTime=this.playTime=150;var a=this.masterRecordings;virtualclass.storage.config.endSession();virtualclass.popup.closeElem();disCommonChatInput();this.playTimeout="";this.playStart=this.waitPopup=this.waitServer=!1;this.elapsedPlayTime=this.error=0;this.controller.ff=1;this.masterRecordings=
a;this.playTimePreviousSeconds=0;this.playProgressBar(this.playTime);delete this.prvNum;this.init()},convertInto:function(a){if("string"==typeof a.data)return a;a.data=a.data.buffer;return a},playProgressBar:function(a){0<a?(virtualclass.pbar.renderProgressBar(this.totalTimeInMiliSeconds,a,"playProgressBar",void 0),a=this.convertIntoReadable(a),document.getElementById("tillRepTime").innerHTML=a.h+":"+a.m+":"+a.s,this.alreadyCalcTotTime||(this.updateTotalTime(),this.alreadyCalcTotTime=!0)):virtualclass.pbar.renderProgressBar(1E3*
this.lastTimeInSeconds,0,"playProgressBar",void 0)},updateTotalTime:function(){var a=this.convertIntoReadable(this.totalTimeInMiliSeconds);document.getElementById("totalRepTime").innerHTML=a.h+":"+a.m+":"+a.s},convertIntoReadable:function(a){a/=1E3;var c=0,b=Math.floor(a%60);a=Math.floor(a/60);60<=a&&(c=Math.floor(a/60),a%=60);10>c&&(c="0"+c);10>a&&(a="0"+a);10>b&&(b="0"+b);return{h:c,m:a,s:b}},displayWaitPopupIfNot:function(){0==this.waitPopup&&(virtualclass.popup.sendBackOtherElems(),document.getElementById("recordingContainer").style.display=
"none",virtualclass.popup.waitBlockAction("block"),virtualclass.pbar.renderProgressBar(0,0,"downloadProgressBar","downloadProgressValue"),virtualclass.popup.waitBlock(),this.waitPopup=!0)},requestDataFromServer:function(a){if(this.isFileVcp(a))if(this.alreadyRequested[a])console.log("Already requested file "+a),0<virtualclass.recorder.totalRecordingFiles.length&&(a=virtualclass.recorder.totalRecordingFiles.shift(),virtualclass.recorder.requestDataFromServer(a));else{console.log("requested file "+
a);var c="https://recording.congrea.net/"+wbUser.lkey+"/"+wbUser.room+"/"+virtualclass.recorder.session+"/"+a;virtualclass.recorder.xhr[a]=new b;virtualclass.recorder.xhr[a].init();virtualclass.recorder.xhr[a].loadData(c,this.afterDownloading.bind(this,a))}},afterDownloading:function(a,c){if("ERROR"==c)setTimeout(function(){virtualclass.recorder.requestDataFromServer(a)},500);else{if(0<virtualclass.recorder.totalRecordingFiles.length){var b=virtualclass.recorder.totalRecordingFiles.shift();virtualclass.recorder.requestDataFromServer(b)}virtualclass.recorder.rawDataQueue[a]=
{file:a,data:c};this.formatRecording(a);this.alreadyRequested[a]=!0}},isFirstPacket:function(a){a=virtualclass.recorder.orginalListOfFiles[a];return null!=a&&0==a.index},isPacketInSerial:function(a){if(null!=this.prevFile)return this.orginalListOfFiles[this.prevFile].next===a||"end"===this.orginalListOfFiles[this.prevFile].next},formatRecording:function(a){if(this.isFirstPacket(a)||this.isPacketInSerial(a)&&0<Object.keys(this.rawDataQueue).length)a=this.rawDataQueue[a],null!=a&&(this.makeRecordingQueue(a.file,
a.data),delete this.rawDataQueue[a.file],this.prevFile=a.file,a=this.orginalListOfFiles[a.file].next,"end"!==a&&this.formatRecording(a))},isFileVcp:function(a){return null!=a&&null!=a.match(/^.*\.(vcp)$/)},calculateNextTime:function(a,c){var b=c.substring(0,21);c.substring(22,c.length);c=$jscomp.makeIterator(b.split(" "));b=c.next().value;c.next();b=Math.trunc(b/1E6);return b-a},insertPacketInto:function(a,c){c=Math.trunc(c/1E3);var b=0;if(!isNaN(c)&&1<=c){this.isTrimRecordingNow||(b=1E3);for(var g=
{playTime:b,recObjs:'{"0{"user":{"userid":"2"},"m":{"app":"nothing","cf":"sync"}} ',type:"J"},d=0;d<c;d++)this.totalTimeInMiliSeconds+=b,a.push(g)}return a},makeRecordingQueue:function(a,c){console.log("File formatting "+a);var b=[],g=null,d=[];c=c.trim().split(/(?:\r\n|\r|\n)/g);for(var m=0;m<c.length;m++)if(null!=c[m]&&""!=c[m]){this.totalElements++;var n=c[m].substring(0,21);var p=c[m].substring(22,c[m].length);var v=$jscomp.makeIterator(n.split(" "));n=v.next().value;v=v.next().value;this.tempTime=
n;n=Math.trunc(n/1E6);null!=this.refrenceTime&&(g?(this.tempPlayTime=n-this.refrenceTime-g,g=null):this.tempPlayTime=n-this.refrenceTime);this.hasOwnProperty("tempRefrenceTime")?d.push(Math.trunc((this.tempTime-this.tempRefrenceTime)/1E6)):d.push(150);if(null!=p&&""!=p){!this.joinRoomRecevied&&-1<p.indexOf('"type":"joinroom"')&&(this.joinRoomRecevied=!0,p=JSON.parse(p),p.clientids=p.action,p=JSON.stringify(p));if(this.lastFileTime&&0===m){var u=Math.trunc(n-this.lastFileTime);b=this.insertPacketInto(b,
u);this.tempPlayTime=1E3<u?u%1E3:u}m===c.length-1&&(this.lastFileTime=n);this.isTrimRecordingNow?(b.push({playTime:0,recObjs:p,type:v}),console.log("==== TRIM ")):virtualclass.settings.recording.trimRecordings&&-1<p.indexOf('{"ac":false,"cf":"recs"')?(this.isTrimRecordingNow=!0,b.push({playTime:0,recObjs:p,type:v}),console.log("==== TRIM ")):b.push({playTime:this.tempPlayTime,recObjs:p,type:v});this.totalTimeInMiliSeconds+=b[b.length-1].playTime;virtualclass.settings.recording.trimRecordings&&-1<
p.indexOf('{"ac":true,"cf":"recs"')&&(this.isTrimRecordingNow=!1);"undefined"!=typeof c[m+1]&&(p=this.calculateNextTime(n,c[m+1]),b=this.insertPacketInto(b,p,!0),1E3<=p&&(g=1E3*Math.trunc(p/1E3)));this.refrenceTime=n;this.tempRefrenceTime=this.tempTime}}console.log("totalTime in seconds "+this.totalTimeInMiliSeconds/1E3);for(c=0;c<b.length;c++)"B"==b[c].type&&(g=virtualclass.dtCon.base64DecToArr(b[c].recObjs),b[c].recObjs=g);this.masterRecordings.push(b);this.orginalTimes.push(d);this.UIdownloadProgress(a);
(3<this.currentMin||this.lastFile==a)&&0<this.masterRecordings.length&&(this.playStart?(this.startToPlay(),this.updateTotalTime()):this.alreadyAskForPlay||(this.alreadyAskForPlay=!0,this.askToPlay()))},handleStartToPlay:function(a){var c=document.querySelector(".rv-vanilla-modal-overlay.is-shown");null!=c&&c.removeEventListener("click",this.handleStartToPlay.bind(this));virtualclass.gesture.clickToContinue();console.log("===== Start to play");this.startToPlay();a.currentTarget.classList.remove("askToPlayCont")},
startToPlay:function(){this.playStart?this.hasOwnProperty("isPausedByNotPresent")&&(delete this.isPausedByNotPresent,this.subRecordingIndex=0,this.subRecordings=this.masterRecordings[this.masterIndex],this.controller._play(),virtualclass.popup.closeElem()):(this.playStart=!0,this.playInt(),virtualclass.popup.closeElem())},isDownloadedAllRecordings:function(a){return 9E5<this.sessionStartTime?a>=virtualclass.recorder.lastTimeInSeconds:!1},finishRequestDataFromServer:function(a){this.isDownloadedAllRecordings(a)&&
(virtualclass.recorder.allFileFound=!0,virtualclass.recorder.alreadyAskForPlay&&(a=document.getElementById("askplayMessage"),null!=a&&(a.innerHTML=virtualclass.lang.getString("playsessionmsg"))))},UIdownloadProgress:function(a){a=virtualclass.recorder.getTimeFromFile(a);var c=(a-this.firstTimeInSeconds)/60;c>this.currentMin&&(this.currentMin=c);c=virtualclass.recorder.totalTimeInMiliSeconds/1E3/60;this.downloadInPercentage=100*this.currentMin/c;virtualclass.pbar.renderProgressBar(c,this.currentMin,
"downloadProgressBar","downloadProgressValue");this.finishRequestDataFromServer(a);virtualclass.recorder.playStart&&!virtualclass.recorder.waitServer&&virtualclass.recorder.init()},playInt:function(){console.log("=====Play init recording=====");virtualclass.popup.closeElem();virtualclass.recorder.init(virtualclass.recorder.masterRecordings);localStorage.setItem("mySession","thisismyplaymode");virtualclass.recorder.initController();virtualclass.media.audio.initAudiocontext()},askToPlay:function(){document.querySelector("#loadingWindowCont .loading");
document.querySelector("#loadingWindowCont .askToPlay");document.querySelector("#loadingWindowCont");var a=document.querySelector(".rv-vanilla-modal-overlay.is-shown");a.addEventListener("click",this.handleStartToPlay.bind(this));var c=document.querySelector("#loadingWindowCont .askToPlay");null!=c&&c.addEventListener("click",this.handleStartToPlay.bind(this));document.getElementById("popupContainer").classList.add("playPopup");a.classList.add("askToPlayCont")},playProgressOutput:function(a){console.log("Offset ",
a.offsetX)},getOffset:function(a){"touchend"==a.type?a=this.lastEvent:(a.offsetX=a.touches[0].pageX-a.touches[0].target.offsetLeft,a.offsetY=a.touches[0].pageY-a.touches[0].target.offsetTop);return this.lastEvent=a},seekHandler:function(a){void 0==a.offsetX&&(a=this.getOffset(a));this.pauseBeforeSeek=this.controller.pause;if(this.startSeek)console.log("Earlier seek start is not end yet.");else{this.startSeek=!0;var c=document.querySelector("#virtualclassCont");null!=c&&c.classList.add("recordSeeking");
c=a.offsetX;var b=this.getCustomWidth();this.seekValueInPercentage=c/b*100;console.log("====Seek start "+this.seekValueInPercentage+" ev current target="+a.currentTarget.id)}},getCustomWidth:function(){return document.getElementById("downloadProgress").clientWidth-1},seek:function(a){a=this.getSeekPoint(a);(a.master<this.masterIndex||a.master==this.masterIndex&&a.sub<this.subRecordingIndex)&&this.replayFromStart();this._seek(a);console.log("seek is finished");this.triggerSynchPacket()},selfSeek:function(){console.log("Start self seek");
this.selfStartSeek=!0;this._seek();this.triggerSynchPacket();this.controller._play()},triggerSynchPacket:function(){this.triggerPlayProgress();this.binarySyncMsg&&(this.handleSyncPacket(),this.binarySyncMsg=null);this.handleSyncStringPacket()},seekFinished:function(a){if(void 0==a&&void 0!=this.masterRecordings[this.masterIndex][this.subRecordingIndex])return-1<this.masterRecordings[this.masterIndex][this.subRecordingIndex].recObjs.indexOf('{"ac":true,"cf":"recs"')},_seek:function(a){this.controller._pause();
for(var c;;){c=null!=a?this.masterIndex!=a.master?this.masterRecordings[this.masterIndex].length:a.sub:this.masterRecordings[this.masterIndex].length;for(var b=this.subRecordingIndex;b<c;b++){try{if("B"!=this.subRecordings[this.subRecordingIndex].type)this.msg=io.cleanRecJson(this.subRecordings[this.subRecordingIndex].recObjs),-1<this.msg.indexOf('"m":{"unshareScreen"')?this.binarySyncMsg=null:-1<this.msg.indexOf('},"m":{"poll":{"pollMsg":"stdPublish",')?virtualclass.poll.recordStartTime={app:"Poll",
data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}:-1<this.msg.indexOf('"m":{"videoUl":{"content_path"')?virtualclass.videoUl.videoStartTime={app:"Video",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}:-1<this.msg.indexOf('"m":{"quiz":{"quizMsg":"stdPublish"')&&(virtualclass.quiz.quizStartTime={app:"Quiz",data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}}),io.onRecMessage(this.convertInto({data:this.msg}));else{this.msg=this.subRecordings[this.subRecordingIndex].recObjs;
if(104==this.msg[0]||204==this.msg[0]||102==this.msg[0]||202==this.msg[0])if(0==this.msg[1]||1==this.msg[1])this.binarySyncMsg={data:{masterIndex:this.masterIndex,subIndex:this.subRecordingIndex}};"ScreenShare"!=virtualclass.currApp||104!=this.msg[0]&&204!=this.msg[0]&&103!=this.msg[0]&&203!=this.msg[0]&&102!=this.msg[0]&&202!=this.msg[0]||(io.onRecMessage(this.convertInto({data:this.msg})),this.binarySyncMsg=null)}this.collectElapsedPlayTime()}catch(g){}if(virtualclass.settings.recording.trimRecordings&&
this.selfStartSeek&&this.seekFinished()){this.selfSeekFinished=!0;break}this.subRecordingIndex++}this.elapsedRecTime=this.elapsedTime=this.elapsedPlayTime;if(void 0!=a&&this.masterIndex===a.master&&a.sub===this.subRecordingIndex||this.selfSeekFinished)break;else this.subRecordingIndex=0,this.masterIndex++,this.subRecordings=this.masterRecordings[this.masterIndex]}},handleSyncStringPacket:function(){if("Poll"==virtualclass.currApp&&"object"==typeof virtualclass.poll.pollState.data&&virtualclass.poll.hasOwnProperty("recordStartTime")){var a=
this.getTotalTimeInMilSeconds(virtualclass.poll.recordStartTime.data.masterIndex,virtualclass.poll.recordStartTime.data.subIndex);virtualclass.poll.dataRec.setting.timer?this.pollUpdateTime(a,virtualclass.poll.pollState):(a=this.convertIntoReadable(this.elapsedPlayTime-a),virtualclass.poll.dataRec.newTime.min=a.m,virtualclass.poll.dataRec.newTime.sec=a.s,virtualclass.poll.elapsedTimer())}else if("Video"==virtualclass.currApp&&"object"==typeof virtualclass.videoUl&&virtualclass.videoUl.hasOwnProperty("videoStartTime"))a=
this.getTotalTimeInMilSeconds(virtualclass.videoUl.videoStartTime.data.masterIndex,virtualclass.videoUl.videoStartTime.data.subIndex),a=(this.elapsedPlayTime-a)/1E3,"object"==typeof virtualclass.videoUl.player?virtualclass.videoUl.playVideo(a):(console.log("====Video init to play start"),virtualclass.videoUl.isPaused=this.pauseBeforeSeek?!0:!1,virtualclass.videoUl.startTime=a);else if("Quiz"==virtualclass.currApp&&"object"==typeof virtualclass.quiz){a=document.querySelector("#qztime");var c=this.getTotalTimeInMilSeconds(virtualclass.quiz.quizStartTime.data.masterIndex,
virtualclass.quiz.quizStartTime.data.subIndex);0<+virtualclass.quiz.plugin.config.quizTime?(c=1E3*virtualclass.quiz.plugin.config.quizTime-(this.elapsedPlayTime-c),virtualclass.quiz.plugin.method.startTimer(c/1E3,a,"desc","vmQuiz")):(c=(this.elapsedPlayTime-c)/1E3,virtualclass.quiz.plugin.method.startTimer(c,a,"asc","vmQuiz"))}},pollUpdateTime:function(a,c){a=this.convertIntoReadable(6E4*c.data.stdPoll.newTime.min+1E3*c.data.stdPoll.newTime.sec-(this.elapsedPlayTime-a));virtualclass.poll.newTimer.sec=
a.s;virtualclass.poll.newTimer.min=a.m;virtualclass.poll.showTimer(virtualclass.poll.newTimer)},handleSyncPacket:function(){if(this.binarySyncMsg){console.log("Get full screen share");for(var a=this.binarySyncMsg.data.subIndex,c=this.binarySyncMsg.data.masterIndex;c<=this.masterIndex;){console.log("Start from master index "+c+" from Subindex "+a);var b=this.masterRecordings[c],g;for(g=this.masterIndex!=c?this.masterRecordings[this.masterIndex].length:this.subRecordingIndex;a<=g;a++){this.msg=b[a];
try{if(null!=this.msg&&"B"==this.msg.type){if(this.msg=this.msg.recObjs,104==this.msg[0]||204==this.msg[0]||103==this.msg[0]||203==this.msg[0]||102==this.msg[0]||202==this.msg[0])io.onRecMessage(this.convertInto({data:this.msg}))}else console.log("Either this.msg is null or string")}catch(k){console.log("PLAY ERROR "+k.errorCode)}}if(this.masterIndex==c&&a==this.subRecordingIndex)break;else c++,a=0}console.log("===== Elapsed time 2 ==== "+this.elapsedPlayTime);this.playProgressBar(this.elapsedPlayTime)}},
getSeekPoint:function(a){a=Math.trunc(this.totalTimeInMiliSeconds*a/100);console.log("Seek index "+a);for(var c=0,b=0;b<this.masterRecordings.length;b++)for(var g=0;g<this.masterRecordings[b].length;g++){c+=this.masterRecordings[b][g].playTime;if(c==a)return{master:b,sub:g};if(c>=a)return 0<g?g--:(b--,g=0<=b?this.masterRecordings[b].length-1:0),console.log("Seek index i = "+b+" j="+g+" totalTime="+c),{master:b,sub:g}}},play:function(){this.controller.pause||(this.config(),this.isPlayFinished()?this.allFileFound?
this.askAgainToPlay():(this.controller._pause(),this.initReplayWindow(),document.querySelector("#loadingWindowCont .loading").style.display="block",document.querySelector("#loadingWindowCont .askToPlay").style.display="none",this.isPausedByNotPresent=!0):this.executePacketToPlay())},config:function(){0==this.masterIndex&&0==this.subRecordingIndex&&(this.startTime=performance.now(),this.reserveTime=this.playTimePreviousSeconds=this.elapsedRecTime=this.elapsedTime=0,document.getElementById("recPlay"),
this.doControlActive(recPauseCont));"undefined"!=typeof this.playTimeout&&""!=this.playTimeout&&clearTimeout(this.playTimeout);this.hasOwnProperty("playTime")||(this.subRecordings=this.masterRecordings[this.masterIndex],io.cfg=JSON.parse(this.subRecordings[this.subRecordingIndex].recObjs),virtualclass.gObj.uRole="s")},executePacketToPlay:function(){var a=this;this.calcPlayTime();this.playTimeout=setTimeout(function(){a.triggerPlayProgress();try{0>a.subRecordings[a.subRecordingIndex].recObjs.indexOf('"cf":"sync"')&&
(io.onRecMessage(a.convertInto({data:a.subRecordings[a.subRecordingIndex].recObjs})),"Poll"==virtualclass.currApp&&-1<a.subRecordings[a.subRecordingIndex].recObjs.indexOf('},"m":{"poll":{"pollMsg":"stdPublish",')?virtualclass.poll.recordStartTime={app:"Poll",data:{masterIndex:a.masterIndex,subIndex:a.subRecordingIndex}}:"Video"==virtualclass.currApp&&-1<a.subRecordings[a.subRecordingIndex].recObjs.indexOf('"m":{"videoUl":{"content_path"')?(virtualclass.videoUl.videoStartTime={app:"Video",data:{masterIndex:a.masterIndex,
subIndex:a.subRecordingIndex}},console.log("Capture video")):"Quiz"==virtualclass.currApp&&-1<a.subRecordings[a.subRecordingIndex].recObjs.indexOf('"m":{"quiz":{"quizMsg":"stdPublish",')?virtualclass.quiz.quizStartTime={app:"Quiz",data:{masterIndex:a.masterIndex,subIndex:a.subRecordingIndex}}:virtualclass.settings.recording.trimRecordings&&-1<a.masterRecordings[a.masterIndex][a.subRecordingIndex].recObjs.indexOf('{"ac":false,"cf":"recs"')&&virtualclass.recorder.selfSeek())}catch(c){console.log("PLAY ERROR "+
c.errorCode)}a.calcPlayTimeNext();a.play()},this.playTime)},isPlayFinished:function(){return"undefined"==typeof this.masterRecordings[this.masterIndex]&&("undefined"==typeof this.subRecordings||"undefined"==typeof this.subRecordings[this.subRecordingIndex])||"undefined"!=typeof this.subRecordings&&"undefined"!=typeof this.subRecordings[this.subRecordingIndex]&&"J"==this.subRecordings[this.subRecordingIndex].type&&-1<this.subRecordings[this.subRecordingIndex].recObjs.indexOf('{"sEnd"')},triggerPauseVideo:function(){document.querySelector("#dispVideo");
virtualclass.videoUl&&virtualclass.videoUl.player&&(console.log("VIDEO IS PAUSED"),virtualclass.videoUl.player.pause(),virtualclass.videoUl.isPaused=!0)},triggerPlayVideo:function(){"Video"==virtualclass.currApp&&virtualclass.videoUl&&virtualclass.videoUl.player&&(console.log("VIDEO IS Played"),virtualclass.videoUl.player.play(),virtualclass.videoUl.isPaused=!1)},askAgainToPlay:function(){if(this.subRecordings&&0>this.subRecordings[this.subRecordingIndex].recObjs.indexOf("sEnd"))io.onRecMessage(this.convertInto({data:this.subRecordings[this.subRecordingIndex].recObjs}));
virtualclass.recorder.allFileFound?virtualclass.recorder.allFileFound&&this.initReplayWindow():(virtualclass.recorder.waitServer=!0,virtualclass.recorder.waitPopup=!1,this.displayWaitPopupIfNot())},initReplayWindow:function(){this.triggerPauseVideo();virtualclass.popup.replayWindow();virtualclass.popup.sendBackOtherElems();document.getElementById("replayClose").addEventListener("click",function(){d.close()});document.getElementById("replayButton").addEventListener("click",function(){virtualclass.recorder.controller.pause=
!1;virtualclass.recorder.replayFromStart.call(virtualclass.recorder)})},getCurrentPacket:function(){var a=0;if(0<this.masterIndex)for(var c=0;c<this.masterIndex;c++)a+=this.masterRecordings[c].length;return a+this.subRecordingIndex},collectElapsedPlayTime:function(){this.elapsedPlayTime+=this.subRecordings[this.subRecordingIndex].playTime},triggerPlayProgress:function(){this.collectElapsedPlayTime();0==this.masterIndex&&0==this.subRecordingIndex?this.playProgressBar(this.elapsedPlayTime):(this.playTimeNowSeconds=
Math.round(this.elapsedPlayTime/1E3),this.playTimeNowSeconds>this.playTimePreviousSeconds&&(this.playProgressBar(this.elapsedPlayTime),virtualclass.popup.sendBackOtherElems(),this.playTimePreviousSeconds=this.playTimeNowSeconds))},calcPlayTime:function(){"object"==typeof this.subRecordings[this.subRecordingIndex]&&(this.playTimePak=this.subRecordings[this.subRecordingIndex].playTime/this.controller.ff);this.timeNow=performance.now();this.diffTime=this.timeNow-this.startTime;this.startTime=this.timeNow;
this.elapsedTime+=this.diffTime;this.playTime=Math.round(this.playTimePak-(this.elapsedTime-this.elapsedRecTime));this.elapsedRecTime+=this.playTimePak;0>this.playTime&&(this.playTime=0)},calcPlayTimeNext:function(){this.subRecordingIndex+1==this.subRecordings.length?(this.masterIndex++,this.subRecordings=this.masterRecordings[this.masterIndex],this.subRecordingIndex=0):this.subRecordingIndex++},initController:function(){if(null!=document.getElementById("playControllerCont")){for(var a=this,c=document.getElementsByClassName("ff"),
b=0;b<c.length;b++)c[b].onclick=function(){var c=this.id.split("ff")[1];a.controller.fastForward(parseInt(c,10));c=document.querySelector("#dispVideo");virtualclass.videoUl&&virtualclass.videoUl.player&&c.classList.contains("vjs-paused")&&virtualclass.videoUl.player.play();"replayFromStart"!=this.parentNode.id&&a.doControlActive(this)};a=this;var g=document.getElementById("recPause");g.addEventListener("click",function(){g.parentNode.classList.contains("recordingPlay")?a.initRecPause():a.initRecPlay()})}},
initRecPause:function(){var a=document.getElementById("recPause");this.controller._pause();this.doControlActive(a);virtualclass.recorder.triggerPauseVideo();a.parentNode.classList.remove("recordingPlay");a.dataset.title="Play"},initRecPlay:function(){var a=document.getElementById("recPause");this.controller._play();this.doControlActive(a);virtualclass.videoUl&&virtualclass.videoUl.player&&virtualclass.videoUl.player.play();a.parentNode.classList.add("recordingPlay");a.dataset.title="Pause"},doControlActive:function(a){for(var c=
document.getElementById("playControllerCont").getElementsByClassName("recButton"),b=0;b<c.length;b++)c[b].classList.remove("controlActive");a.parentNode.classList.add("controlActive")},controller:{pause:!1,ff:1,_play:function(){virtualclass.recorder.startTime=performance.now();this.ff=1;this.pause=!1;virtualclass.recorder.play();console.log("====== Recording play")},_pause:function(){this.pause=!0;console.log("====== Recording pause")},fastForward:function(a){this.ff=a;this.pause=!1;virtualclass.recorder.play()}},
sendData:function(a,c,b){this.cb=b;a=JSON.stringify(a);this.httpObj.open("POST",c);this.httpObj.setRequestHeader("x-api-key",wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.setRequestHeader("Content-Type","application/json");this.httpObj.withCredentials=!1;this.httpObj.send(a)},sortingFiles:function(a){return a.sort(function(a,
b){return a<b?-1:a>b?1:0})},setOrginalListOfFiles:function(a){for(var c={},b=0;b<a.length;b++)c[a[b]]=null!=a[b+1]?{index:b,next:a[b+1]}:{index:b,next:"end"};return c},triggerDownloader:function(){var a=this;console.log("Init trigger time to request 1");this.tryNumberOfTimes=1;this.hasOwnProperty("triggerDownloaderTime")&&clearInterval(this.triggerDownloaderTime);this.hasOwnProperty("startTimeCounter")&&clearInterval(this.startTimeCounter);var c=0;this.startTimeCounter=setInterval(function(){c++;
console.log("=====Timer ==="+c)},1E3);this.triggerDownloaderTime=setInterval(function(){console.log("Init trigger time to request 2");3<a.tryNumberOfTimes?(virtualclass.recorder.allFileFound=!0,clearInterval(a.triggerDownloaderTime.triggerDownloaderTime),a.isPlayFinished()&&a.askAgainToPlay()):virtualclass.xhrn.sendData({session:a.session},virtualclass.api.recordingFiles,a.afterDownloadingList.bind(a));console.log("Time to request 180000")},18E4)},afterDownloadingList:function(a){a=JSON.parse(a);
if(null!=a&&a.hasOwnProperty("Item")){var c=+a.Item.time.N;this.sessionStartTime=(new Date).getTime()-c;c=[].concat($jscomp.arrayFromIterable(new Set(a.Item.list.L.map(function(a){return a.S}))));a=c.length;this.lastRecordings&&c.length==this.lastRecordings?this.tryNumberOfTimes=this.tryNumberOfTimes?++this.tryNumberOfTimes:1:(delete this.alreadyCalcTotTime,this.totalRecordingFiles=this.sortingFiles(c),this.lastFile=this.totalRecordingFiles[this.totalRecordingFiles.length-1],this.orginalListOfFiles=
this.setOrginalListOfFiles(this.totalRecordingFiles),this.calculateTotalPlayTime(),c=this.totalRecordingFiles.shift(),this.requestDataFromServer(c),0<this.totalRecordingFiles.length&&(c=this.totalRecordingFiles.shift(),this.requestDataFromServer(c)),9E5>this.sessionStartTime&&this.triggerDownloader());this.lastRecordings=a}else this.tryNumberOfTimes=this.tryNumberOfTimes?++this.tryNumberOfTimes:1,this.triggerDownloader()},requestListOfFiles:function(){this.session=wbUser.session;virtualclass.popup.loadingWindow();
virtualclass.xhrn.sendData({session:virtualclass.recorder.session},virtualclass.api.recordingFiles,this.afterDownloadingList.bind(this))},calculateTotalPlayTime:function(){var a=Math.trunc(+virtualclass.recorder.totalRecordingFiles[0].split("-")[0]/1E6),c=Math.trunc(+virtualclass.recorder.totalRecordingFiles[virtualclass.recorder.totalRecordingFiles.length-1].split("-")[1].split(".")[0]/1E6);this.lastTimeInSeconds=Math.trunc(c/1E3);this.firstTimeInSeconds=Math.trunc(a/1E3)},getTimeFromFile:function(a){return+a.split("-")[1].split(".")[0]/
1E9},totalPlayTime:function(){for(var a=0,c=0;c<virtualclass.recorder.masterRecordings.length;c++)for(var b=0;b<virtualclass.recorder.masterRecordings[c].length;b++)a+=virtualclass.recorder.masterRecordings[c][b].playTime;return a/1E3},getTotalTimeInMilSeconds:function(a,c){for(var b=0,g=0;b<=a;){for(var d=0;d<virtualclass.recorder.masterRecordings[b].length&&(g+=virtualclass.recorder.masterRecordings[b][d].playTime,a!=b||c!=d);d++);b++}return g},getTempTotalTimeInMilSeconds:function(a,c){for(var b=
0,g=0;b<=a;){for(var d=0;d<this.orginalTimes[b].length&&(g+=this.orginalTimes[b][d],a!=b||c!=d);d++);b++}return g},getTotalElementLength:function(){for(var a=0,c=0;c<virtualclass.recorder.masterRecordings.length;c++)a+=virtualclass.recorder.masterRecordings[c].length;return a},seekWithMouseMove:function(a){void 0==a.offsetX&&(a=this.getOffset(a));this.startSeek&&(this.controller._pause(),this.seekValueInPercentage=this.getSeekValueInPercentage(a),this.downloadInPercentage<this.seekValueInPercentage&&
(this.seekValueInPercentage=Math.trunc(this.downloadInPercentage)),this.setPlayProgressTime(this.seekValueInPercentage),virtualclass.pbar.renderProgressBar(this.totalTimeInMiliSeconds,6E4*this.seekTimeWithMove.m+1E3*this.seekTimeWithMove.s,"playProgressBar",void 0),document.querySelector("#tillRepTime").innerHTML=this.seekTimeWithMove.h+":"+this.seekTimeWithMove.m+":"+this.seekTimeWithMove.s,this.displayTimeInHover(a,this.seekValueInPercentage))},getSeekValueInPercentage:function(a){var c=this.getCustomWidth();
return a.offsetX/c*100},handlerDisplayTime:function(a){var c=this.getSeekValueInPercentage(a);this.displayTimeInHover(a,c)},displayTimeInHover:function(a,c){this.setPlayProgressTime(c);a=20>a.offsetX?3:5>d.innerWidth-a.offsetX?a.offsetX-65:30>d.innerWidth-a.offsetX?a.offsetX-60:40>d.innerWidth-a.offsetX?a.offsetX-35:a.offsetX-25;c=document.getElementById("timeInHover");c.style.display="block";c.style.marginLeft=a+"px";document.getElementById("timeInHover").innerHTML=this.seekTimeWithMove.h+":"+this.seekTimeWithMove.m+
":"+this.seekTimeWithMove.s;document.querySelector("#virtualclassCont").classList.add("recordSeeking")},setPlayProgressTime:function(a){this.seekTimeWithMove=this.convertIntoReadable(a*this.totalTimeInMiliSeconds/100)},finalSeek:function(a){a.offsetX||(a=this.getOffset(a));this.startSeek&&this.hasOwnProperty("seekValueInPercentage")&&(console.log("====Seek up "+this.seekValueInPercentage),this.downloadInPercentage<this.seekValueInPercentage&&(this.seekValueInPercentage=Math.trunc(this.downloadInPercentage)),
0<this.seekValueInPercentage&&this.seek(this.seekValueInPercentage),this.pauseBeforeSeek?(console.log("=== Video pause "),this.controller._pause(),this.triggerPauseVideo()):(console.log("=== Video play "),this.controller._play(),this.triggerPlayVideo()),document.getElementById("timeInHover").style.display="none");document.querySelector("#virtualclassCont").classList.remove("recordSeeking");console.log(a.offsetX);delete this.seekValueInPercentage;this.startSeek=!1;a=document.getElementById("congrealogo");
null!=a&&a.classList.remove("disbaleOnmousedown")}}})(window);(function(d){var b,a=!1,c=!1,f=!1;d.storage={version:7,sessionEndFlag:!1,init:function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function c(c,k){for(;;)switch(f){case 0:return a.reclaim=roles.isEducator(),b=a,a.tables="wbData chunkData config dataAdapterAll dataUserAdapterAll executedStoreAll executedUserStoreAll dstdata pollStorage quizData dstall".split(" "),d=a,f=1,{value:virtualclass.virtualclassIDBOpen("vidya_apps",b.dbVersion,{upgrade:function(a,c,f,g){b.onupgradeneeded(a)}}),
done:!1};case 1:if(void 0===k){f=2;break}f=-1;throw k;case 2:g=c;d.db=g;if("object"!==typeof a.db.objectStoreNames||null==a.db.objectStoreNames){f=3;break}f=5;return{value:a.onsuccess(),done:!1};case 5:if(void 0===k){f=6;break}f=-1;throw k;case 6:f=4;break;case 3:a.init();case 4:f=-1;default:return{value:void 0,done:!0}}}var f=0,g,d,v={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();v[Symbol.iterator]=
function(){return this};return v}())},onupgradeneeded:function(a){a.objectStoreNames.contains("wbData")||a.createObjectStore("wbData",{keyPath:"did"});a.objectStoreNames.contains("config")||a.createObjectStore("config",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("chunkData")||a.createObjectStore("chunkData",{autoIncrement:!0});a.objectStoreNames.contains("dataAdapterAll")||a.createObjectStore("dataAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dataUserAdapterAll")||
a.createObjectStore("dataUserAdapterAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedStoreAll")||a.createObjectStore("executedStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("executedUserStoreAll")||a.createObjectStore("executedUserStoreAll",{keyPath:"serialKey"});a.objectStoreNames.contains("dstdata")||a.createObjectStore("dstdata",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("pollStorage")||a.createObjectStore("pollStorage",{keyPath:"timeStamp",
autoIncrement:!0});a.objectStoreNames.contains("quizData")||a.createObjectStore("quizData",{keyPath:"quizkey"});a.objectStoreNames.contains("dstall")||a.createObjectStore("dstall",{keyPath:"timeStamp",autoIncrement:!0})},onsuccess:function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function c(c,d){for(;;)switch(f){case 0:if(!virtualclass.gObj.sessionClear){f=1;break}console.log("==== session clear endsession after room change");a.config.endSession(!0);f=2;break;case 1:return g=a.tables.indexOf("wbData"),
c=-1<g?a.tables.slice(g+1):a.tables,f=3,{value:a.getAllObjs(c,function(a){if("undefined"==typeof a)b.config.createNewSession();else{var c=a.createdDate;if(108E5<(new Date).getTime()-c||a.room!=wbUser.room)console.log("==== session clear endsession after date expire"),b.config.endSession()}}),done:!1};case 3:if(void 0===d){f=4;break}f=-1;throw d;case 4:case 2:console.log("==== Member add, config is ready"),f=-1;default:return{value:void 0,done:!0}}}var f=0,g,d={next:function(a){return c(a,void 0)},
throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())},store:function(a){var c=b.db.transaction("wbData","readwrite");c.store.put({repObjs:a,did:virtualclass.gObj.currWb,id:1});c.done.then(function(){},function(){console.log("failure")})},pollStore:function(a){var c=b.db.transaction("pollStorage","readwrite");c.store.add({pollResult:a,currTime:(new Date).getTime(),id:1});c.done.then(function(){console.log("success")},
function(){console.log("failure")})},wbDataRemove:function(a){console.log("Whiteboard data remove");b.db.transaction(["wbData"],"readwrite").store.delete(a)},dataExecutedStoreAll:function(a,c){return $jscomp.executeAsyncGenerator(function(){function f(f,k){for(;;)switch(g){case 0:d=b.db.transaction("executedStoreAll","readwrite"),d.store.put({executedData:a,id:6,serialKey:c}),d.done.then(function(){console.log("success")},function(){console.log("failure")}),g=-1;default:return{value:void 0,done:!0}}}
var g=0,d,k={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}())},dataAdapterAllStore:function(a,c){var f=b.db.transaction("dataAdapterAll","readwrite");f.store.put({adaptData:a,id:5,serialKey:c});f.done.then(function(){},function(){console.log("failure")})},dataUserAdapterAllStore:function(a,c){var f=b.db.transaction("dataUserAdapterAll",
"readwrite");f.store.put({adaptUserData:a,id:7,serialKey:c});f.done.then(function(){console.log("success")},function(){console.log("failure")})},dataExecutedUserStoreAll:function(a,c){var f=b.db.transaction("executedUserStoreAll","readwrite");f.store.put({executedUserData:a,id:8,serialKey:c});f.done.then(function(){console.log("success")},function(){console.log("failure")})},quizStorage:function(a,c){var f=b.db.transaction("quizData","readwrite");f.store.put({qzData:c,quizkey:a});f.done.then(function(){console.log("success")},
function(){console.log("failure")})},getAllObjs:function(a,c){var b=this;return $jscomp.executeAsyncGenerator(function(){function f(f,n){for(;;)switch(g){case 0:r="undefined"!==typeof c?c:"",m=0;case 1:if(!(m<a.length)){g=3;break}g=4;return{value:b.db.transaction(a[m]).store.openCursor(),done:!1};case 4:if(void 0===n){g=5;break}g=-1;throw n;case 5:d=k=f;if("function"!==typeof r){g=6;break}if("chunkData"===a[m]||"quizData"===a[m]||"pollStorage"===a[m]){g=8;break}g=9;return{value:b[a[m]].handleResult(d,
r),done:!1};case 9:if(void 0===n){g=10;break}g=-1;throw n;case 10:case 8:g=7;break;case 6:return g=11,{value:b[a[m]].handleResult(d),done:!1};case 11:if(void 0===n){g=12;break}g=-1;throw n;case 12:case 7:case 2:m++;g=1;break;case 3:g=-1;default:return{value:void 0,done:!0}}}var g=0,d,k,m,r,t={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();t[Symbol.iterator]=function(){return this};return t}())},
getAllDataOfPoll:function(a,c){return $jscomp.executeAsyncGenerator(function(){function a(a,m){for(;;)switch(f){case 0:return q=[],f=1,{value:b.db.transaction("pollStorage").store.openCursor(),done:!1};case 1:if(void 0===m){f=2;break}f=-1;throw m;case 2:d=k=a;case 3:if(!d){f=4;break}console.log(d.key,d.value);q.push(d.value);f=5;return{value:d.continue(),done:!1};case 5:if(void 0===m){f=6;break}f=-1;throw m;case 6:d=g=a;f=3;break;case 4:0<q.length?c(q):console.log("No data fetched from indexedDb"),
f=-1;default:return{value:void 0,done:!0}}}var f=0,g,d,k,q,r={next:function(c){return a(c,void 0)},throw:function(c){return a(void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();r[Symbol.iterator]=function(){return this};return r}())},wbData:{handleResult:function(a){return $jscomp.executeAsyncGenerator(function(){function c(c,d){for(;;)switch(b){case 0:case 1:if(!a){b=2;break}a.value.hasOwnProperty("repObjs")&&("object"===typeof virtualclass.wb?(console.log("Total Whiteboard Length "+
JSON.parse(a.value.repObjs).length+" From indexeddb"),virtualclass.wb[virtualclass.gObj.currWb].utility.replayFromLocalStroage(JSON.parse(a.value.repObjs))):virtualclass.gObj.tempReplayObjs._doc_0_0=JSON.parse(a.value.repObjs),f=!0);b=3;return{value:a.continue(),done:!1};case 3:if(void 0===d){b=4;break}b=-1;throw d;case 4:a=g=c;b=1;break;case 2:f||"Whiteboard"!==virtualclass.currApp||virtualclass.wb[virtualclass.gObj.currWb].utility.makeUserAvailable(),b=-1;default:return{value:void 0,done:!0}}}var b=
0,g,d={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())}},dataAdapterAll:{handleResult:function(a){return $jscomp.executeAsyncGenerator(function(){function c(c,g){for(;;)switch(b){case 0:case 1:if(!a){b=2;break}a.value.hasOwnProperty("adaptData")&&(c=JSON.parse(a.value.adaptData),parseInt(a.value.serialKey)>ioAdapter.serial&&(ioAdapter.serial=
parseInt(a.value.serialKey)),ioAdapter.adapterMustData[ioAdapter.serial]=c);b=3;return{value:a.continue(),done:!1};case 3:if(void 0===g){b=4;break}b=-1;throw g;case 4:a=f=c;b=1;break;case 2:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,g={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())}},dataUserAdapterAll:{handleResult:function(a){return $jscomp.executeAsyncGenerator(function(){function c(c,
g){for(;;)switch(b){case 0:case 1:if(!a){b=2;break}if(a.value.hasOwnProperty("adaptUserData")){c=JSON.parse(a.value.adaptUserData);var d=a.value.serialKey.split("_");g=parseInt(d[0]);d=parseInt(d[1]);ioAdapter.validateAllVariables(g);d>ioAdapter.userSerial[g]&&(ioAdapter.userSerial[g]=d);ioAdapter.userAdapterMustData[g][d]=c}b=3;return{value:a.continue(),done:!1};case 3:if(void 0===g){b=4;break}b=-1;throw g;case 4:a=f=c;b=1;break;case 2:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,g={next:function(a){return c(a,
void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())}},executedStoreAll:{handleResult:function(a){return $jscomp.executeAsyncGenerator(function(){function c(c,g){for(;;)switch(b){case 0:case 1:if(!a){b=2;break}if(a.value.hasOwnProperty("executedData")){c=JSON.parse(a.value.executedData);var d=a.value.serialKey.split("_");g=parseInt(d[0]);d=parseInt(d[1]);ioMissingPackets.validateAllVariables(g);
ioMissingPackets.executedStore[g][d]=c}b=3;return{value:a.continue(),done:!1};case 3:if(void 0===g){b=4;break}b=-1;throw g;case 4:a=f=c;b=1;break;case 2:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,g={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())}},executedUserStoreAll:{handleResult:function(a){return $jscomp.executeAsyncGenerator(function(){function c(c,
g){for(;;)switch(b){case 0:case 1:if(!a){b=2;break}if(a.value.hasOwnProperty("executedUserData")){c=JSON.parse(a.value.executedUserData);var d=a.value.serialKey.split("_");g=parseInt(d[0]);d=parseInt(d[1]);ioMissingPackets.validateAllUserVariables(g);ioMissingPackets.executedUserStore[g][d]=c}b=3;return{value:a.continue(),done:!1};case 3:if(void 0===g){b=4;break}b=-1;throw g;case 4:a=f=c;b=1;break;case 2:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,g={next:function(a){return c(a,void 0)},
throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())}},config:{handleResult:function(a,c){return $jscomp.executeAsyncGenerator(function(){function b(b,d){for(;;)switch(f){case 0:if(null==a){f=1;break}case 3:if(!a){f=4;break}if(!a){f=5;break}a.value.hasOwnProperty("myconfig")&&(b=JSON.parse(a.value.myconfig),"undefined"!=typeof c&&c(b));f=6;return{value:a.continue(),done:!1};
case 6:if(void 0===d){f=7;break}f=-1;throw d;case 7:a=g=b;case 5:f=3;break;case 4:f=2;break;case 1:"undefined"!=typeof c&&c();case 2:f=-1;default:return{value:void 0,done:!0}}}var f=0,g,d={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())},createNewSession:function(){virtualclass.makeAppReady(virtualclass.gObj.defaultApp);var a=(new Date).getTime();
if("undefined"!=typeof b.db){var c=b.db.transaction(["config"],"readwrite").objectStore("config");a=JSON.stringify({createdDate:a,room:wbUser.room});c.add({myconfig:a,timeStamp:(new Date).getTime()})}else console.log("The Datbase is not created for Applicatoin.")},endSession:function(a){delete virtualclass.connectedUsers;virtualclass.gObj.hasOwnProperty("memberUpdateDelayTimer")&&(clearTimeout(virtualclass.gObj.memberUpdateDelayTimer),virtualclass.gObj.memberlistpending.length=0,delete virtualclass.gObj.memberUpdateDelayTimer);
virtualclass.hasOwnProperty("poll")&&""!==virtualclass.poll&&(virtualclass.poll.pollState={},virtualclass.poll.dataRec={});var c=document.getElementById("congrealogo");null!=c&&c.classList.remove("disbaleOnmousedown");$("#chatroom_bt2").removeClass("ui-state-highlight");"object"==typeof virtualclass.videoUl&&virtualclass.videoUl.hasOwnProperty("player")&&"object"==typeof virtualclass.videoUl.player&&null!=virtualclass.videoUl.player.player_&&virtualclass.videoUl.destroyPlayer();"undefined"!=typeof CDTimer&&
clearInterval(CDTimer);c=document.querySelector("#virtualclass"+virtualclass.currApp);null!=c&&(c.style.display="none");virtualclass.hasOwnProperty("media")&&virtualclass.media.audio.muteButtonToogle();c=chatContainerEvent.elementFromShadowDom(".ui-memblist-usr","all");if(null!=c&&0<c.length)for(var f=0;f<c.length;f++)null!=c[f]&&c[f].parentNode.removeChild(c[f]);virtualclass.gObj.precheckScrn&&virtualclass.vutil.prechkScrnShare();virtualclass.gObj.audioEnable=roles.hasControls()?!0:virtualclass.gObj.stdaudioEnable;
virtualclass.storage.config.sessionEndFlag=!0;c=localStorage.getItem("nEd");f=localStorage.getItem("precheck");localStorage.clear();null!=virtualclass.chat&&(delete virtualclass.chat.vmstorage,virtualclass.chat.vmstorage={},virtualclass.chat.removeChatHighLight("chatrm"));virtualclass.recorder.items=[];virtualclass.recorder.totalSent=0;virtualclass.gObj.tempReplayObjs.length=0;virtualclass.wb="";delete virtualclass.gObj.currWb;virtualclass.gObj.studentSSstatus.mesharing=!1;virtualclass.vutil.removeSharingClass();
virtualclass.gObj.studentSSstatus.shareToAll=!1;virtualclass.gObj.studentSSstatus.sharing=!1;delete virtualclass.gObj.whoIsSharing;null!=virtualclass.videoHost&&(virtualclass.videoHost.gObj.stdStopSmallVid=!1,virtualclass.videoHost.gObj.allStdVideoOff=!1);virtualclass.gObj.wbTool={};virtualclass.recorder.hasOwnProperty("startUpload")&&delete virtualclass.recorder.startUpload;virtualclass.gObj.hasOwnProperty("downloadProgress")&&delete virtualclass.gObj.downloadProgress;a||("object"==typeof virtualclass.wb&&
(alert("Clear all whiteboard"),virtualclass.wb[virtualclass.gObj.currWb].utility.t_clearallInit(),virtualclass.wb[virtualclass.gObj.currWb].utility.makeDefaultValue(),"object"==typeof virtualclass.wb[virtualclass.gObj.currWb].replay&&(virtualclass.wb[virtualclass.gObj.currWb].replay.rendering=!1)),virtualclass.vutil.clearAllChat(),null!=virtualclass.editorRich&&virtualclass.editorRich.removeEditorData(),virtualclass.pdfRender={});virtualclass.vutil.removeClass("audioWidget","fixed");virtualclass.storage.clearStorageData();
virtualclass.wbCommon.removeAllContainers();virtualclass.gObj.wbCount=0;virtualclass.gObj.currSlide=0;virtualclass.currApp=virtualclass.gObj.defaultApp;virtualclass.gObj.hasOwnProperty("disableCamByUser")?virtualclass.user.control.audioDisable():virtualclass.user.control.audioWidgetEnable(!0);virtualclass.user.control.allChatEnable();virtualclass.user.control.resetmediaSetting();!virtualclass.gObj.meetingMode&&roles.isStudent()&&(document.getElementById("videoHostContainer").style.display="none",
a=document.getElementById("virtualclassAppRightPanel"),a.classList.contains("vidShow")&&a.classList.remove("vidShow"));roles.hasAdmin()&&(document.getElementById("virtualclassSessionEndTool").className=virtualclass.vutil.removeClassFromElement("virtualclassSessionEndTool","active"));"object"==typeof virtualclass.yts&&clearInterval(virtualclass.yts.tsc);"object"==typeof virtualclass.sharePt&&virtualclass.sharePt.UI.removeIframe();console.log("Session End.");virtualclass.previous="virtualclass"+virtualclass.currApp;
virtualclass.getContent=!1;virtualclass.recorder.storeDone=0;virtualclass.setPrvUser();workerIO.postMessage({cmd:"sessionEndClose"});null!=f&&localStorage.setItem("precheck",JSON.parse(f));null!=c?(console.log("Editor mode enable"),localStorage.setItem("editorRich",!0),localStorage.setItem("editorCode",!0),localStorage.removeItem("nEd")):console.log("Editor mode disable");console.log("New role before clear "+virtualclass.gObj.uRole);b.config.createNewSession();console.log("New role after clear "+
virtualclass.gObj.uRole);virtualclass.enablePreCheck||virtualclass.popup.waitMsg();"object"==typeof virtualclass.dts&&null!=virtualclass.dts&&virtualclass.dts.destroyDts();if("object"==typeof virtualclass.raiseHand&&null!=virtualclass.raiseHand)if(roles.hasControls())virtualclass.raiseHand.rhCount=0,virtualclass.raiseHand.rhCountR=0,(a=document.querySelector(".congrea .vmchat_bar_button .hand_bt.highlight"))&&a.classList.remove("highlight"),document.querySelector(".congrea .vmchat_bar_button .hand_bt #notifyText").innerHTML=
"";else if(a=document.querySelector(".congrea .handRaise.disable"))a.classList.remove("disable"),a.classList.add("enable"),a.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")),document.querySelector(".congrea .handRaise #icHr").setAttribute("data-action","enable"),virtualclass.raiseHand.stdRhEnable="enabled";(a=chatContainerEvent.elementFromShadowDom(".vmchat_room_bt.ui-state-highlight"))&&a.classList.remove("ui-state-highlight");(a=document.querySelector("#virtualclassCont.congrea.student"))&&
a.classList.contains("videoff")&&a.classList.remove("videoff");a=document.querySelector("#virtualclassCont #memlist");c=document.querySelector("#virtualclassCont #chatrm");f=document.querySelector("#user_list");var g=document.querySelector("#chatroom_bt2");a&&!a.classList.contains("enable")&&(a.classList.add("enable"),a.classList.remove("disable"),c&&(c.classList.add("disable"),c.classList.remove("enable")));null!=g&&(f.classList.contains("active")||f.classList.add("active"),g.classList.remove("active"));
null!=virtualclass.serverData&&(virtualclass.serverData.rawData={video:[],ppt:[],docs:[]},roles.hasAdmin()&&virtualclass.serverData.fetchAllData());virtualclass.gObj.wIds=[0];virtualclass.wbCommon.order=[0];virtualclass.gObj.wbCount=0;virtualclass.wbCommon.clearNavigation();delete virtualclass.wb[virtualclass.gObj.currWb].activeToolColor}},dstdata:{handleResult:function(c){return $jscomp.executeAsyncGenerator(function(){function b(b,d){for(;;)switch(f){case 0:case 1:if(!c){f=2;break}c.value.hasOwnProperty("alldocs")&&
(console.log("document share store"),a=!0,virtualclass.gObj.docs=JSON.parse(c.value.alldocs));f=3;return{value:c.continue(),done:!1};case 3:if(void 0===d){f=4;break}f=-1;throw d;case 4:c=g=b;f=1;break;case 2:a||(virtualclass.gObj.docs="init",console.log("==== Docs init ")),f=-1;default:return{value:void 0,done:!0}}}var f=0,g,d={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=
function(){return this};return d}())}},dstAllStore:function(a){var c=this.db.transaction("dstall","readwrite");c.store.clear();var b=JSON.stringify(virtualclass.dts.allNotes);c.store.add({dstalldocs:JSON.stringify(a),allNotes:b,timeStamp:(new Date).getTime(),id:10});c.done.then(function(){console.log("success")},function(){console.log("failure")})},dstall:{handleResult:function(a){return $jscomp.executeAsyncGenerator(function(){function b(b,d){for(;;)switch(f){case 0:case 1:if(!a){f=2;break}a.value.hasOwnProperty("dstalldocs")&&
(console.log("document share store"),c=!0,virtualclass.gObj.dstAll=JSON.parse(a.value.dstalldocs),virtualclass.gObj.dstAllNotes=JSON.parse(a.value.allNotes));f=3;return{value:a.continue(),done:!1};case 3:if(void 0===d){f=4;break}f=-1;throw d;case 4:a=g=b;f=1;break;case 2:c||(console.log("document share store init"),virtualclass.gObj.dstAll="init"),f=-1;default:return{value:void 0,done:!0}}}var f=0,g,d={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())}},clearSingleTable:function(a,c){this.db.transaction(a,"readwrite").store.clear();"undefined"!==typeof c&&c();"dstdata"==a&&(virtualclass.gObj.docs="init",console.log("==== Docs init "));"dstall"==a&&(virtualclass.gObj.dstall="init")},clearStorageData:function(){ioAdapter.adapterMustData=[];ioAdapter.serial=-1;ioAdapter.userSerial=[];ioAdapter.userAdapterMustData=[];ioMissingPackets.executedStore=[];ioMissingPackets.executedSerial=
{};ioMissingPackets.missRequest=[];ioMissingPackets.aheadPackets=[];ioMissingPackets.missRequestFlag=0;ioMissingPackets.executedUserStore=[];ioMissingPackets.executedUserSerial={};ioMissingPackets.missUserRequest=[];ioMissingPackets.aheadUserPackets=[];for(var a=ioMissingPackets.missUserRequestFlag=0;a<this.tables.length;a++)a+1==this.tables.length?this.clearSingleTable(this.tables[a],this.clearLastTable):this.clearSingleTable(this.tables[a])},clearLastTable:function(){virtualclass.gObj.hasOwnProperty("sessionEndResolve")&&
virtualclass.gObj.sessionEndResolve()},getQuizData:function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function c(c,k){for(;;)switch(b){case 0:return u=[],b=1,{value:a.db.transaction("quizData").store.openCursor(),done:!1};case 1:if(void 0===k){b=2;break}b=-1;throw k;case 2:g=d=c;case 3:if(!g){b=4;break}u[g.value.quizkey]=g.value.qzData;b=5;return{value:g.continue(),done:!1};case 5:if(void 0===k){b=6;break}b=-1;throw k;case 6:g=f=c;b=3;break;case 4:cb(u),b=-1;default:return{value:void 0,
done:!0}}}var b=0,f,g,d,u,q={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();q[Symbol.iterator]=function(){return this};return q}())},clearTableData:function(a){this.db.transaction(a,"readwrite").store.clear()},getWbData:function(a){var c=this;return $jscomp.executeAsyncGenerator(function(){function b(b,m){for(;;)switch(f){case 0:return f=1,{value:c.db.transaction("wbData","readwrite"),
done:!1};case 1:if(void 0===m){f=2;break}f=-1;throw m;case 2:return q=r=b,k=q.objectStore("wbData"),f=3,{value:k.get(a),done:!1};case 3:if(void 0===m){f=4;break}f=-1;throw m;case 4:g=d=b,"undefined"!==typeof g?(console.log("Whiteboard start store from local storage "+a),virtualclass.gObj.tempReplayObjs[a]=[],virtualclass.gObj.tempReplayObjs[a]=JSON.parse(g.repObjs)):virtualclass.gObj.tempReplayObjs[a]="nodata",f=-1;default:return{value:void 0,done:!0}}}var f=0,g,d,k,q,r,t={next:function(a){return b(a,
void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();t[Symbol.iterator]=function(){return this};return t}())}}})(window);(function(d,b){d.user=function(a){return{assignRole:function(a,b,g){roles.hasControls()&&(roles.isEducator()||virtualclass.html.leftAppBar(),virtualclass.attachFunction(),"Whiteboard"==b&&d.virtualclass.wb[virtualclass.gObj.currWb].attachToolFunction(virtualclass.gObj.commandToolsWrapperId[virtualclass.gObj.currWb],!0,virtualclass.gObj.currWb),virtualclass.hasOwnProperty("previrtualclass")?virtualclass.vutil.makeActiveApp("virtualclass"+b,virtualclass.previrtualclass):virtualclass.vutil.makeActiveApp("virtualclass"+
b),"object"==typeof virtualclass.wb&&virtualclass.wb[virtualclass.gObj.currWb].utility.makeCanvasEnable())},teacherIsAlreadyExist:function(){for(var a=b.getElementById("chat_div").getElementsByClassName("ui-memblist-usr"),f,g=0;g<a.length;g++)if(f=a[g].getAttribute("data-role"),"t"==f||"e"==f)return!0;return!1},createControl:function(a,f){var c=b.createElement("div");c.id=a+"ControlContainer";c.className="controls";this.createControlDivs(c,a,f);return c},createControllerElement:function(a,f){var c=
b.createElement("span");c.id=a+f+"Img";var d=b.createElement("a");d.id=a+f+"Anch";d.className="congtooltip";d.appendChild(c);var m=b.createElement("div");m.id=a+f+"Cont";m.className="controleCont";m.appendChild(d);return[m,c]},createAssignControl:function(a,f,g,d){var c=this,k=this.createControllerElement(f,"contrAssign"),p=k[0],v=k[1];k=b.getElementById(f+"ControlContainer");null!=k?0>=k.getElementsByClassName("controleCont").length?k.appendChild(p):k.insertBefore(p,k.firstChild):a.appendChild(p);
virtualclass.user.control.changeAttribute(f,v,g,"assign","aRole");"undefined"!=typeof d&&(v.className+=" currTeacher");v.addEventListener("click",function(){c.control.init.call(c,v)})},createControlDivs:function(a,b,g){var c=this,f=!1,d=localStorage.getItem("virtualclass"+b);if(null!=d&&(f=!0,d=JSON.parse(d),d.hasOwnProperty("currTeacher")))if(virtualclass.gObj[b+"currTeacher"]={},1==d.currTeacher){var p=virtualclass.user.control.currTeacherAlready=!0;virtualclass.gObj[b+"currTeacher"].ct=!0}else virtualclass.gObj[b+
"currTeacher"].ct=!1;var v=roles.isEducator()?!1:!0,u=virtualclass.vutil.userIsOrginalTeacher(b);virtualclass.vutil.isUserTeacher(b);for(var q=0;q<g.length;q++)if("assign"==g[q]&&u)"undefined"!=typeof p?this.createAssignControl(a,b,v,p):this.createAssignControl(a,b,v);else if("audio"==g[q]){var r=this.createControllerElement(b,"contrAud");var t=r[0];var B=r[1];a.appendChild(t);t=f&&d.hasOwnProperty("aud")?d.aud?!0:!1:!0;virtualclass.user.control.changeAttribute(b,B,t,"audio","aud");u&&B.addEventListener("click",
function(){c.control.init.call(c,B)});roles.hasAdmin()&&"false"==B.dataset.audioDisable&&(t=localStorage.getItem("allAudAction"),null!=t&&"disable"==t&&B.click())}else if("chat"==g[q]){r=this.createControllerElement(b,"contrChat");t=r[0];var A=r[1];a.appendChild(t);u&&A.addEventListener("click",function(){c.control.init.call(c,A)});var F=f&&d.hasOwnProperty("chat")?d.chat?!0:!1:!0;virtualclass.user.control.changeAttribute(b,A,F,"chat","chat")}else if("editorRich"==g[q]||"editorCode"==g[q]){if(roles.hasAdmin()){var E=
f&&d.hasOwnProperty(g[q])?d[g[q]]?!0:!1:!1;r=this.createControllerElement(b,"contr"+g[q]);t=r[0];r=r[1];t.className+=" controller"+g[q];a.appendChild(t);virtualclass.currApp!=virtualclass.vutil.capitalizeFirstLetter(g[q])&&(t.style.display="none");virtualclass.user.control.changeAttribute(b,r,E,g[q],g[q]);u&&r.addEventListener("click",c.closureEditor(c,r))}}else"RaiseHand"==g[q]&&(f&&d.hasOwnProperty("raiseHand"),virtualclass.user.control.changeAttribute(b,A,F,"RaiseHand","RaiseHand"))},closureEditor:function(a,
b){return function(){a.control.init.call(a,b)}},control:{toggleDisplayWriteModeMsgBox:function(a,f){var c=b.getElementById(a+"writeModeBox"),d=f?virtualclass.lang.getString("writemode"):virtualclass.lang.getString("readonlymode"),m=b.getElementById("virtualclass"+a+"Body");null==c&&null!=m&&(c=b.createElement("div"),c.id=a+"writeModeBox",m.appendChild(c));null!=c&&(c.className="writeModeBox",c.dataset.writeMode=f,c.innerHTML=d);"EditorRich"==a&&this.tooglDisplayEditorToolBar(f)},tooglDisplayEditorToolBar:function(a){var c=
b.getElementsByClassName("vceditor-toolbar"),g=c[0];0<c.length&&(a?(g.style.pointerEvents="visible",g.style.opacity="1"):(g.style.pointerEvents="none",g.style.opacity="0.5"))},received_editorRich:function(a){if(a.status){virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorRich.cm||virtualclass.isPlayMode||virtualclass.editorRich.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorRich","editorRich","editorRich");virtualclass.isPlayMode&&virtualclass.editorRich.control.toggleDisplayWriteModeMsgBox(!1);
var c=!0}else virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorRich.cm&&virtualclass.editorRich.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorRich","editorRich","editorRich"),c=!1;localStorage.setItem("editorRich",c);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorRich",c);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a.status?virtualclass.editorRich.enableEditorByOuterLayer():virtualclass.editorRich.disableEditorByOuterLayer());
virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorRich")},received_editorCode:function(a){if(a.status){virtualclass.gObj.uid==a.toUser?"object"!=typeof virtualclass.editorCode.cm||virtualclass.isPlayMode||virtualclass.editorCode.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorCode","editorCode","editorCode");virtualclass.isPlayMode&&virtualclass.editorCode.control.toggleDisplayWriteModeMsgBox(!1);var c=!0}else virtualclass.gObj.uid==a.toUser?"object"==typeof virtualclass.editorCode.cm&&
virtualclass.editorCode.cm.setOption("readOnly","nocursor"):this.disable(a.toUser,"editorCode","editorCode","editorCode"),c=!1;localStorage.setItem("editorCode",c);roles.hasAdmin()||this.toggleDisplayWriteModeMsgBox("EditorCode",c);!roles.hasAdmin()&&"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a.status?virtualclass.editorCode.enableEditorByOuterLayer():virtualclass.editorCode.disableEditorByOuterLayer());virtualclass.vutil.setReadModeWhenTeacherIsDisConn("editorCode")},
onmessage:function(a){a.message.hasOwnProperty("toUser")||(a.message.toUser=virtualclass.gObj.uid);this["received_"+a.message.control](a.message)},addCurrTeacherToControl:function(a){var c=b.getElementById(a);null!=c&&(virtualclass.vutil.elemHasAnyClass(a)?c.classList.add("currTeacher"):c.className="currTeacher")},removeCurrTeacherFromControl:function(a){var c=b.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)&&(c.classList.remove("currTeacher"),c=a.indexOf("contr"),a=a.substring(0,c),virtualclass.user.control.updateUser(a,
"currTeacher",!1))},removeAudioFromParticipate:function(a){a=b.getElementById(a+"contrAssignCont");null!=a&&a.parentNode.removeChild(a)},disable:function(a,b,g,d){g=virtualclass.gObj.testChatDiv.shadowRoot.querySelector("."+b+"Control"+a+"  .contImg");null!=g&&virtualclass.user.control._disable(g,b,a,d)},_disable:function(a,b,g,d){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Disable"));a.setAttribute("data-"+b+"-disable","true");a.className="icon-"+b+"Img block "+b+"Img";
"assign"==b?(a.parentNode.classList.remove("tooltip"),this.addCurrTeacherToControl(a.id),a=localStorage.getItem("virtualclass"+g),a=JSON.parse(a),virtualclass.gObj.hasOwnProperty(g+"currTeacher")?(virtualclass.gObj[g+"currTeacher"].ct||virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssign&&a.currTeacher)&&virtualclass.user.control.updateUser(g,"currTeacher",!0):virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssignId==g&&virtualclass.user.control.updateUser(g,
"currTeacher",!0)):"audio"==b&&(a.className="icon-"+b+"DisImg block "+b+"DisImg");virtualclass.user.control.updateUser(g,d,!1)},enable:function(a,b,g,d){g=virtualclass.gObj.testChatDiv.shadowRoot.querySelector("."+b+"Control"+a+" .contImg");null==g?console.log("Element is Null"):virtualclass.user.control._enable(g,b,a,d)},_enable:function(a,b,g,d){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Enable"));a.setAttribute("data-"+b+"-disable","false");a.className="icon-"+b+"Img enable "+
b+"Img";"RaiseHand"==b&&virtualclass.raiseHand._raiseHand(g);virtualclass.user.control.updateUser(g,d,!0)},changeAttribute:function(a,b,g,d,m){g?virtualclass.user.control._enable(b,d,a,m):virtualclass.user.control._disable(b,d,a,m)},init:function(a,b,g,d){"undefined"==typeof g&&(g="Img");var c=a.id,f=c.indexOf("contr");f=c.substring(0,f);c=c.split("contr")[1];g=c.indexOf(g);g=c.substring(0,g);if("Assign"==g)virtualclass.vutil.appIsForEducator(virtualclass.currApp)&&(virtualclass.gObj.controlAssign=
!0,virtualclass.gObj.controlAssignId=f,d="true"==a.getAttribute("data-assign-disable")?!0:!1,d||(this.control.changeAttribute(f,a,d,"assign","aRole"),virtualclass.user.control._assign(f),virtualclass.user.control.changeAttrToAssign("block")),roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(f));else{var k;"stdscreen"==g?(roles.hasControls()&&"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.initDefaultApp(),this.control._stdscreen.call(this.control,f),"Video"==
virtualclass.currApp&&virtualclass.videoUl.player&&(ioAdapter.mustSend({videoUl:{init:"destroyPlayer"},cf:"destroyPlayer"}),ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"}),virtualclass.vutil.initDashboard(),virtualclass.vutil.removeBackgroundVideoApp())):("Chat"==g?(a.className="contrChatBlock",c="chat"):c="Aud"==g?"audio":g,"undefined"!=typeof b?b=(k="enable"==b?!0:!1)?"enable":"block":"true"==a.getAttribute("data-"+c+"-disable")?(b="enable",k=!0):(b="block",k=!1),this.control.changeAttribute(f,
a,k,c,virtualclass.vutil.smallizeFirstLetter(g)),void 0==d&&this.control["_"+c].call(this.control,f,b))}},init_old:function(a){var c=a.id;var b=c.indexOf("contr");b=c.substring(0,b);c=c.split("contr")[1];var d=c.indexOf("Img");c=c.substring(0,d);"Assign"==c?(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=b,c="true"==a.getAttribute("data-assign-disable")?!0:!1,c||(this.control.changeAttribute(b,a,c,"assign","aRole"),virtualclass.user.control._assign(b),virtualclass.user.control.changeAttrToAssign("block")),
roles.hasAdmin()||virtualclass.user.control.removeAudioFromParticipate(b)):"Chat"==c?("true"==a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",c="enable",this.control.changeAttribute(b,a,!0,"chat","chat")):(c="block",this.control.changeAttribute(b,a,!1,"chat","chat")),this.control._chat(b,c)):"Aud"==c&&("true"==a.getAttribute("data-audio-disable")?(c="enable",this.control.changeAttribute(b,a,!0,"audio","aud")):(c="block",this.control.changeAttribute(b,a,!1,"audio","aud")),this.control._audio(b,
c))},_assign:function(a,f,g){virtualclass.vutil.assignRole();virtualclass.vutil.removeAppPanel();virtualclass.system.setAppDimension();virtualclass.vutil.renderWhiteboardObjectsIfAny();if(!roles.hasAdmin()){var c=b.getElementById("vcanvas");c.className=c.className.replace(/\bteacher\b/," ");c.className="student"}localStorage.setItem("canvasDrwMsg",!0);c=b.getElementById("virtualclassScreenShareLocalVideo");null!=c&&"VIDEO"==c.tagName&&virtualclass.vutil.videoTeacher2Student("ScreenShare",!0);"ScreenShare"==
virtualclass.currApp&&(virtualclass.ss.hasOwnProperty("currentStream")&&virtualclass.ss.currentStream.getTracks()[0].stop(),virtualclass.ss="");"undefined"==typeof f&&(console.log("role transfer"),virtualclass.vutil.beforeSend({assignRole:!0,toUser:a,cf:"assignRole"},a),roles.hasAdmin()&&(f=b.getElementById(a+"contreditorRichImg"),"true"==f.dataset.editorrichDisable&&virtualclass.user.control.init.call(virtualclass.user,f),f=b.getElementById(a+"contreditorCodeImg"),"true"==f.dataset.editorcodeDisable&&
virtualclass.user.control.init.call(virtualclass.user,f)));roles.hasAdmin()||("undefined"==typeof g&&(g=a),a=b.getElementById(g+"ControlContainer").getElementsByClassName("controleCont")[0],a.removeChild(a.firstChild),localStorage.removeItem("aId"))},_chat:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({enc:!0,toUser:a,cf:"enc"},a):(virtualclass.user.control.updateUser(a,"chat",!1),virtualclass.vutil.beforeSend({dic:!0,toUser:a,cf:"dic"},a))},_audioAll:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,
toUser:a,cf:"ena"},a):virtualclass.vutil.beforeSend({dia:!0,toUser:a,cf:"dia"},a)},_editorRich:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",toUser:a,cf:"control"},a)},_editorCode:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorCode",toUser:a,cf:"control"},a):virtualclass.vutil.beforeSend({status:!1,control:"editorCode",toUser:a,cf:"control"},
a)},_audio:function(a,b){"enable"==b?virtualclass.settings.applySettings(!0,"disableAttendeeAudio",a):virtualclass.settings.applySettings(!1,"disableAttendeeAudio",a)},_RaiseHand:function(a,b){virtualclass.raiseHand.disableRaiseHand(a)},_stdscreen:function(a){virtualclass.vutil.beforeSend({reqscreen:!0,toUser:a,cf:"reqscreen"},a)},audioWidgetEnable:function(a){console.log("Audio enable true");localStorage.setItem("audEnable",JSON.stringify({ac:"true"}));if(null==localStorage.getItem("dvid")){var c=
b.getElementById("speakerPressOnce");"undefined"==typeof a&&(c.className="active");c.style.opacity="1";c.style.pointerEvents="visible"}},mediaWidgetDisable:function(a){virtualclass.system.mediaDevices.hasWebcam=!1;var c={ac:"false"},g=localStorage.getItem("audEnable");null!=g?(g=JSON.parse(g),"false"!=g.ac&&"undefined"!=typeof a&&(c.r=a)):"unefined"!=typeof a&&(c.r=a);console.log("audEnable "+c);a=b.getElementById("audioWidget");a.style.opacity="1";a.style.pointerEvents="visible";a.className="deactive";
this.audioDisable();this.videoDisable();virtualclass.gObj.hasOwnProperty("video")&&(virtualclass.media.audio.studentNotSpeak(),virtualclass.media.audio.clickOnceSpeaker("speakerPressOnce","alwaysDisable"));virtualclass.vutil.addClass("virtualclassCont","nowebcam")},audioDisable:function(){var a=b.getElementById("speakerPressOnce");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents="none")},videoDisable:function(){var a=b.getElementById("congCtrBar");null!=a&&(a.style.opacity="0.5",a.style.pointerEvents=
"none")},videoEnable:function(){var a=b.getElementById("congCtrBar");null!=a&&(a.style.opacity="1",a.style.pointerEvents="visible")},allChatDisable:function(){this.disableCommonChat();this.disbaleAllChatBox();this.disableOnLineUser()},disableCommonChat:function(){var a=b.getElementById("chatrm");null!=a&&this.makeElemDisable(a);if(a=b.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.classList.add("disable"),a.disabled=!0},disbaleAllChatBox:function(){localStorage.setItem("chatEnable","false");
var a=b.querySelector("#virtualclassAppRightPanel");a.classList.add("chat_disabled");b.querySelector("#chat_div").classList.add("chat_disabled");a.classList.remove("chat_enabled");a=b.getElementById("stickybar").getElementsByClassName("ui-chatbox");for(var f=0;f<a.length;f++)this.makeElemDisable(a[f])},disableOnLineUser:function(){for(var a=b.getElementsByClassName("ui-memblist-usr"),f=0;f<a.length;f++)a[f].style.pointerEvents="none"},makeElemDisable:function(a){"chatrm"!=a.id&&(virtualclass.vutil.elemHasAnyClass(a.id)?
(a.classList.remove("enable"),a.classList.add("disable")):a.className="disable");a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!0)},allChatEnable:function(){localStorage.setItem("chatEnable","true");var a=b.querySelector("#virtualclassAppRightPanel");a.classList.remove("chat_disabled");b.querySelector("#chat_div").classList.remove("chat_disabled");a.classList.add("chat_enabled");if(a=b.querySelector("#virtualclassCont.congrea #ta_chrm2"))a.classList.remove("disable"),
a.disabled=!1;a=b.getElementById("stickycontainer").getElementsByClassName("ui-chatbox");for(var f=0;f<a.length;f++)this.makeElemEnable(a[f]);var g=b.getElementsByClassName("ui-memblist-usr");for(f=0;f<g.length;f++){g[f].classList.contains("mySelf")||(g[f].style.pointerEvents="visible");var d=g[f].querySelector(".icon-chatImg");d&&!d.classList.contains("enable")&&(d.classList.add("enable"),d.setAttribute("data-chat-disable","false"));(d=g[f].querySelector(".icon-editorRichImg"))&&d.classList.contains("enable")&&
(d.classList.remove("enable"),d.classList.add("block"),d.parentNode.setAttribute("data-title",virtualclass.lang.getString("writemode")),d.setAttribute("data-editorrich-disable","true"));(d=g[f].querySelector(".icon-editorCodeImg"))&&d.classList.contains("enable")&&(d.classList.remove("enable"),d.classList.add("block"),d.parentNode.setAttribute("data-title",virtualclass.lang.getString("editorCodeDisable")),d.setAttribute("data-editorcode-disable","true"));(d=g[f].querySelector(".icon-audioDisImg"))&&
d.classList.contains("block")&&(d.parentNode.setAttribute("data-title",virtualclass.lang.getString("audioEnable")),d.setAttribute("data-audio-disable","false"))}f=b.querySelector("#virtualclassCont #memlist.enable");g=b.querySelector("#virtualclassCont #chatrm.enable");d=b.querySelector("#user_list");var m=b.querySelector("#chatroom_bt2");f&&!d.classList.contains("active")&&(d.classList.contains("active")||d.classList.add("active"),m.classList.remove("active"),virtualclass.chat.chatWindow="private");
g&&(m.classList.contains("active")||m.classList.add("active"),d.classList.remove("active"),virtualclass.chat.chatWindow="common");b.getElementsByClassName("ui-memblist-usr");for(f=0;f<a.length;f++)this.makeElemEnable(a[f])},resetmediaSetting:function(){if(roles.isStudent()){if(virtualclass.gObj.stdaudioEnable||virtualclass.user.control.audioDisable(),virtualclass.system.mediaDevices.hasWebcam)if(virtualclass.gObj.stdvideoEnable)virtualclass.vutil.videoHandler("off"),virtualclass.videoHost.toggleVideoMsg("enable");
else{virtualclass.videoHost.toggleVideoMsg("disable");var a=b.querySelector("#videoSwitch");null!=a&&a.classList.contains("on")&&(a.classList.remove("on"),a.classList.add("off"))}}else{(a=b.getElementById("contrAudioAllImg"))&&a.classList.contains("icon-all-audio-enable")&&(a.classList.remove("icon-all-audio-enable"),a.classList.add("icon-all-audio-disable"),a.setAttribute("data-title",virtualclass.lang.getString("muteAll")),"enable"==a.dataset.action&&(a.dataset.action="disable"));a=b.getElementById("videoSwitch");
if(virtualclass.system.mediaDevices.hasWebcam&&a.classList.contains("video")){var f=b.getElementById("rightCtlr");a.classList.contains("on")&&(virtualclass.vutil.videoHandler("off"),f.parentNode.setAttribute("data-title",virtualclass.lang.getString("videoon")))}this.mediaSliderSetting("audio");this.mediaSliderSetting("video")}roles.hasAdmin()&&(virtualclass.gObj.delayVid="display")},mediaSliderSetting:function(a){var c="audio"==a?"Audio":"Video",g={action:("audio"==a?virtualclass.gObj.stdaudioEnable:
virtualclass.gObj.stdvideoEnable)?"enable":"disable",enable:"disable",disable:"enable"},d=b.querySelector(".congrea #contr"+c+"All."+g.action);d&&(d.classList.remove(g.action),d.classList.add(g[g.action]),(d=b.querySelector(".congrea #contr"+c+"All input"))&&d.removeAttribute("checked"));if(d=b.querySelector(".congrea .slider.icon-all-"+a+"-"+g.action))d.className="slider round congtooltip icon-all-"+a+"-"+g[g.action],d.setAttribute("data-action",g[g.action]),d.setAttribute("data-title",virtualclass.lang.getString(g[g.action]+
"All"+c))},makeElemEnable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},toggleAllEditorController:function(a,b){a=virtualclass.vutil.smallizeFirstLetter(a);var c=chatContainerEvent.elementFromShadowDom(".controleCont","all");if(0<c.length)for(var f=0;f<c.length;f++)if(0<c[f].id.indexOf(a)){var d=c[f].id.indexOf("Cont");0<d&&(d=c[f].id.substr(0,
d),d=chatContainerEvent.elementFromShadowDom(d+"Img",null,!0),this.control.init.call(this,d,b,void 0,"actnotSend"))}"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",cf:"control"}):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",cf:"control"})},toggleDisplayEditorController:function(a,b){a=virtualclass.vutil.smallizeFirstLetter(a);if(virtualclass.gObj.hasOwnProperty("testChatDiv")){a=chatContainerEvent.elementFromShadowDom(".controller"+a,"all");for(var c=0;c<
a.length;c++)a[c].style.display=b}},updateUser:function(a,b,g){var c=localStorage.getItem("virtualclass"+a),f={};null==c?f.id=a:f=JSON.parse(c);f[b]=g;localStorage["virtualclass"+f.id]=JSON.stringify(f);return f},audioSign2:function(a,f){if("create"==f){if(null==b.getElementById(a.id+"AudEnableSign")){f=b.createElement("div");f.id=a.id+"AudEnableSign";var c=b.createElement("img");imgName="audioenable";c.id=a.id+imgName+"Img";c.src=d.whiteboardPath+"images/"+imgName+".png";var k=b.createElement("a");
k.id=a.id+imgName+"Anch";k.className="audEnableSign tooltip controleCont";k.setAttribute("data-title",virtualclass.lang.getString("studentAudEnable"));k.appendChild(c);f.appendChild(k);b.getElementById(a.id+"ControlContainer").appendChild(f)}}else a=b.getElementById(a.id+"AudEnableSign"),a.parentNode.removeChild(a)},audioSign:function(a,b){"create"==b?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},
iconAttrManupulate:function(a,b){a=virtualclass.gObj.testChatDiv.shadowRoot.querySelector("#ml"+a+" .audioImg");if(null!=a)for(var c=0;c<a.classList.length;c++)if("icon-"==a.classList[c].substring(0,5)){a.classList.remove(a.classList[c]);a.classList.add(b);break}},shouldApply:function(a){var c=localStorage.getItem("virtualclass"+a);null!=c&&(c=JSON.parse(c),c.ad&&virtualclass.user.control.audioSign({id:a},"create"))},changeAttrToAssign:function(a){for(var c=b.getElementById("chatWidget").getElementsByClassName("assignImg"),
g=0;g<c.length;g++)"enable"==a?(c[g].classList.remove("block"),c[g].classList.add("enable"),c[g].parentNode.classList.add("tooltip"),c[g].parentNode.setAttribute("data-title",virtualclass.lang.getString("transferControls")),c[g].setAttribute("data-assign-disable","false")):(c[g].classList.remove("enable"),c[g].classList.add("block"),c[g].parentNode.classList.remove("tooltip"),c[g].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker:function(a){var c=b.getElementById("alwaysPress");
null!=c&&(c.style.display=a?"block":"none")},toggleAllAudio:function(a){var c=chatContainerEvent.elementFromShadowDom(".controleCont","all");if(0<c.length)for(var b=0;b<c.length;b++)if(0<c[b].id.indexOf("Aud")){var d=c[b].id.indexOf("Cont");0<d&&(d=c[b].id.substr(0,d),d=chatContainerEvent.elementFromShadowDom(d+"Img",null,!0),this.control.init.call(this,d,a,void 0,"actnotSend"))}},toggleAllVideo:function(a){ioAdapter.mustSend({action:a,cf:"toggleVideo"})},mediaSliderUI:function(a){var c="audio"==
a?"Audio":"Video";var g=b.querySelector(".bulkUserActions #contr"+c+"AllImg");var d=virtualclass.user.defaultSettings(a,virtualclass.settings.info);var m="enable"==d?"disable":"enable";null!=d?(g.setAttribute("data-action",m),g.className="slider round icon-all-"+a+"-"+m+" enable congtooltip cgIcon",g.dataset.title=virtualclass.lang.getString(m+"All"+c),d=b.querySelector(".bulkUserActions #contr"+c+"All input"),d.setAttribute("checked","true"),c=b.querySelector(".congrea #contr"+c+"All"),c.classList.add(m)):
(m={action:d?"enable":"disable",enable:"disable",disable:"enable"},g=b.querySelector(".bulkUserActions #contr"+c+"AllImg"),g.setAttribute("data-action",m[m.action]),g.className="slider round icon-all-"+a+"-"+m[m.action]+" congtooltip cgIcon",g.dataset.title=virtualclass.lang.getString(m[m.action]+"All"+c),d=b.querySelector(".bulkUserActions #contr"+c+"All input"),d.removeAttribute("checked"),c=b.querySelector(".congrea #contr"+c+"All"),c.classList.add(m[m.action]));if(virtualclass.isPlayMode)anchorTag.pointerEvents=
"none",anchorTag.style.cursor="default";else{var n=this;g.addEventListener("click",function(){if("audio"==a){var c=n.toogleAudioIcon();virtualclass.settings.applySettings("enable"==c?!0:!1,"disableAttendeeAudio");"undefined"!=typeof c&&(localStorage.setItem("allAudAction",c),n.toggleAllAudio.call(virtualclass.user,c))}else c=n.toggleVideoIcon(),virtualclass.settings.applySettings("enable"==c?!0:!1,"disableAttendeeVideo"),"undefined"!=typeof c&&(localStorage.setItem("allVideoAction",c),n.toggleAllVideo(c))})}},
defaultSettings:function(a,b){var c;for(c in b){var f=b[c];if("audio"===a&&"disableAttendeeAudio"===c||"video"===a&&"disableAttendeeVideo"===c)var d=!0===f?"enable":"disable"}return d},chatBoxesSwitch:function(){if(virtualclass.chat.chatroombox)toggleCommonChatBox();else if(0==$("div#chat_room").length){var a=b.createElement("ul");a.id="chat_room";b.body.appendChild(a);virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",
messageSent:function(a,c){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,c)}});virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&(a=b.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a));a=b.getElementById("cc_arrow_button");a.classList.add("icon-arrow-down");a.classList.remove("icon-arrow-up")}},toogleAudioIcon:function(){var a=b.querySelector(".bulkUserActions #contrAudioAllImg");if(null!=a)return actionToPerform=a.dataset.action,
"enable"==a.dataset.action?(a.dataset.action="disable",a.className="slider round icon-all-audio-disable congtooltip",a.dataset.title=virtualclass.lang.getString("muteAll"),a=b.querySelector(".congrea .bulkUserActions #contrAudioAll"),a.classList.add("disable"),a.classList.remove("enable")):(a.dataset.action="enable",a.className="slider round icon-all-audio-enable congtooltip",a.dataset.title=virtualclass.lang.getString("unmuteAll"),a=b.querySelector(".congrea .bulkUserActions #contrAudioAll"),a.classList.add("enable"),
a.classList.remove("disable")),actionToPerform},toggleVideoIcon:function(){var a=b.querySelector(".bulkUserActions #contrVideoAllImg");if(null!=a)return actionToPerform=a.dataset.action,"enable"==a.dataset.action?(a.dataset.action="disable",a.className="slider round icon-all-video-disable congtooltip",a.dataset.title=virtualclass.lang.getString("disableAllVideo"),a=b.querySelector(".congrea .bulkUserActions #contrVideoAll"),a.classList.add("disable"),a.classList.remove("enable")):(a.dataset.action=
"enable",a.className="slider round icon-all-video-enable congtooltip",a.dataset.title=virtualclass.lang.getString("enableAllVideo"),a=b.querySelector(".congrea .bulkUserActions #contrVideoAll"),a.classList.add("enable"),a.classList.remove("disable")),actionToPerform},changeRoleOnFooter:function(a,b){chatContainerEvent.elementFromShadowDom("#ml"+a).dataset.role=b},initControlHandler:function(a){virtualclass.vutil.userIsOrginalTeacher(a);var c=chatContainerEvent.elementFromShadowDom("#ml"+a+" .contImg",
"all"),d=!1,k=localStorage.getItem("virtualclass"+a);null!=k&&(d=!0,k=JSON.parse(k),k.hasOwnProperty("currTeacher")&&(virtualclass.gObj[a+"currTeacher"]={},1==k.currTeacher?(virtualclass.user.control.currTeacherAlready=!0,virtualclass.gObj[a+"currTeacher"].ct=!0):virtualclass.gObj[a+"currTeacher"].ct=!1));for(var m=0;m<c.length;m++)if(-1<c[m].className.indexOf("chat")){var n=d&&k.hasOwnProperty("chat")?k.chat?!0:!1:!0;virtualclass.user.control.changeAttribute(a,c[m],n,"chat","chat")}else-1<c[m].className.indexOf("aud")?
(d&&k.hasOwnProperty("aud")?n=k.aud?!0:!1:(n=b.querySelector("#contrAudioAll"),n=null!=virtualclass.jId&&n.classList.contains("disable")?!0:virtualclass.gObj.stdaudioEnable),virtualclass.user.control.changeAttribute(a,c[m],n,"audio","aud"),roles.hasAdmin()&&"false"==c[m].dataset.audioDisable&&localStorage.getItem("allAudAction")):-1<c[m].className.indexOf("RaiseHand")?(n=d&&k.hasOwnProperty("raiseHand")?k.raiseHand?!0:!1:!1,virtualclass.user.control.changeAttribute(a,c[m],n,"RaiseHand","RaiseHand")):
-1<c[m].className.indexOf("stdscreen")?virtualclass.gObj.studentSSstatus.hasOwnProperty("whoIsSharing")&&virtualclass.vutil.initssSharing(virtualclass.gObj.whoIsSharing):-1<c[m].className.indexOf("editorRich")&&"EditorRich"==virtualclass.currApp?(b.querySelector("#alleditorRichContainerAnch"),n=d&&k.hasOwnProperty("editorRich")?k.editorRich?!0:!1:!1,virtualclass.user.control.changeAttribute(a,c[m],n,"editorRich","editorRich")):-1<c[m].className.indexOf("editorCode")&&(n=d&&k.hasOwnProperty("editorCode")?
k.editorCode?!0:!1:!1,virtualclass.user.control.changeAttribute(a,c[m],n,"editorCode","editorCode"))}}}})(window,document);(function(d){d.xhr={init:function(){this.httpObj=d.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.httpObj.upload.addEventListener("progress",this.onProgress);this.onReadStateChange();this.httpObj.onerror=function(b){console.log("Error "+b)};this.httpObj.withCredentials=!0;this.httpObj.onabort=function(b){console.log("Error abort "+b)}},onProgress:function(b){virtualclass.pbar.currVal=b.loaded;""!=virtualclass.pbar.prvVal&&"undefined"!=typeof virtualclass.pbar.prvVal||
virtualclass.isPlayMode||virtualclass.pbar.progressInit();virtualclass.pbar.renderProgressBar(b.total,b.loaded,"indProgressBar","indProgressValue")},onReadStateChange:function(){var b=this;this.httpObj.onreadystatechange=function(){4==b.httpObj.readyState&&"undefined"!=typeof b.cb&&(200==b.httpObj.status?b.cb(b.httpObj.responseText):b.cb("ERROR"))}},send:function(b,a,c){this.cb=c;this.httpObj.open("POST",a,!0);this.httpObj.send(b)},sendFormData:function(b,a,c){this.cb=c;this.httpObj.open("POST",a,
!0);this.httpObj.send(b)},loadData:function(b,a){this.cb=a;this.httpObj.open("GET",b,!0);this.httpObj.send()}}})(window);(function(d){d.xhrn={init:function(){this.httpObj=d.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.httpObj.upload.addEventListener("progress",this.onProgress);this.onReadStateChange();this.httpObj.onerror=function(b){console.log("Error "+b)};this.httpObj.onabort=function(b){console.log("Error abort "+b)}},onReadStateChange:function(){var b=this;this.httpObj.onreadystatechange=function(){4==b.httpObj.readyState&&"undefined"!=typeof b.cb&&(200==b.httpObj.status?b.cb(b.httpObj.responseText):
b.cb("ERROR"))}},sendData:function(b,a,c){this.cb=c;b=JSON.stringify(b);this.httpObj.open("POST",a);this.httpObj.setRequestHeader("x-api-key",wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.setRequestHeader("Content-Type","application/json");this.httpObj.withCredentials=!1;this.httpObj.send(b)},getAcess:function(b){this.cb=
b;this.httpObj.open("GET",virtualclass.api.access);this.httpObj.setRequestHeader("x-api-key",wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.setRequestHeader("Content-Type","application/json");this.httpObj.withCredentials=!0;this.httpObj.send()}}})(window);var PopUp=function(d,b){function a(a){this.init(a);return this}function c(a,c){var b={},f;for(f in a)Object.prototype.hasOwnProperty.call(a,f)&&(b[f]=a[f]);for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&(b[f]=c[f]);return b}function f(a){var c=document.createElement("div");c.classList.add("rv-vanilla-modal-overlay");document.querySelector("body").appendChild(c);"function"===typeof a&&a()}"use strict";a.prototype.init=function(a){var b=this;this.settings=c({selector:"[data-rv-vanilla-modal]",
modalSelector:".rv-vanilla-modal",closeSelector:".rv-vanilla-modal-close",showModalClassName:"rv-vanilla-modal-is-open",showOverlay:!0},a);this.modalElements=document.querySelectorAll(this.settings.modalSelector);this.triggers=document.querySelectorAll(this.settings.selector);this.settings.showOverlay&&f(function(){b.overlayElement=document.querySelector(".rv-vanilla-modal-overlay")})};a.prototype.close=function(a){a.classList.remove(this.settings.showModalClassName);document.getElementById("popupContainer").style.display=
"none";this.settings.showOverlay&&this.overlayElement.classList.remove("is-shown")};a.prototype.open=function(a){document.getElementById("popupContainer").style.display="block";this.sendBackOtherElems();this.closeShownModal();a.classList.add(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.add("is-shown")};a.prototype.each=function(a){[].forEach.call(this.triggers,function(c){"function"===typeof a&&a(c)})};a.prototype.closeShownModal=function(){var a=this.settings.showModalClassName;
[].forEach.call(this.modalElements,function(c){c.classList.contains(a)&&c.classList.remove(a)})};a.prototype.closeElem=function(){document.getElementById("popupContainer").classList.remove("playPopup","loading");console.log("close popup");if(0==virtualclass.recorder.waitServer){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=100);a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=1E3);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents=
"visible");a=document.getElementById("about-modal");null!=a&&virtualclass.popup.close(a);document.getElementById("sessionEndMsgCont").dataset.displaying="false";document.getElementById("uploadvideourl").dataset.displaying="false";document.getElementById("uploadppturl").dataset.displaying="false";a=document.getElementById("chatrm");null!=a&&(console.log("zIndex performing"),a.style.zIndex=1);document.querySelector("#networkStatusContainer").classList.remove("connecting-room");document.querySelector("#virtualclassApp").classList.remove("try-to-connect")}};
a.prototype.waitBlock=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordPlay").style.display="block";virtualclass.popup.replayWindowAction("none")};a.prototype.waitBlockAction=function(a){document.getElementById("recordPlay").style.display=a};a.prototype.sendBackOtherElems=function(a){a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=0);a=document.getElementById("commandToolsWrapper");
null!=a&&(a.style.pointerEvents="none");a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=0);a=document.getElementById("chatrm");null==a||virtualclass.isPlayMode||(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("memlist");null!=a&&(a.style.zIndex=0)};a.prototype.openProgressBar=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);
this.hideAllPopups();document.getElementById("recordingContainer").style.display="block"};a.prototype.replayWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();virtualclass.popup.replayWindowAction("block")};a.prototype.sesseionEndWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();a=document.getElementById("sessionEndMsgCont");a.style.display="block";a.dataset.displaying=!0;document.getElementById("sessionEndClose").addEventListener("click",
function(){virtualclass.popup.closeElem();d.close()})};a.prototype.validateurlPopup=function(a){var c=document.getElementById("about-modal");virtualclass.popup.open(c);this.hideAllPopups();if("video"==a){var b=document.querySelector("#virtualclassCont.congrea #popupContainer #uploadvideourl");var f=document.querySelector("#virtualclassCont.congrea #popupContainer #vidPopupClose")}else"presentation"==a?(b=document.querySelector("#virtualclassCont.congrea #popupContainer #uploadppturl"),f=document.querySelector("#virtualclassCont.congrea #popupContainer #pptPopupClose")):
console.log("popup works for video and presentation");b.style.display="block";b.dataset.displaying=!0;f.addEventListener("click",function(){virtualclass.popup.closeElem()})};a.prototype.replayWindowAction=function(a){document.getElementById("replayContainer").style.display=a};a.prototype.progressBarAction=function(a){document.getElementById("recordingContainer").style.display=a};a.prototype.confirmInput=function(a,c,b,f,d,v){var g=document.getElementById("about-modal");virtualclass.popup.open(g);
this.hideAllPopups();g=document.getElementById("confirm");g.style.display="block";var k=g.getElementsByClassName("confirmChild");if(0<k.length)for(;1<=k.length;)k[0].parentNode.removeChild(k[0]);k=document.createElement("div");k.id="confirmMessage";k.className="confirmChild";k.innerHTML=a;g.appendChild(k);var m=this;a=function(){m.confirmInit(this.id,c,b,f,d,v)};k=document.createElement("div");k.id="confirmOk";k.className="confirmButton confirmChild";k.addEventListener("click",a);var n=document.createElement("button");
n.id="confirmOkButton";n.className="icon-check";n.innerHTML=virtualclass.lang.getString("confirmOk");k.appendChild(n);g.appendChild(k);k=document.createElement("div");k.id="confirmCancel";k.className="confirmButton confirmChild";k.addEventListener("click",a);a=document.createElement("button");a.id="confirmCancelButton";a.className="icon-close";a.innerHTML=virtualclass.lang.getString("confirmCancel");k.appendChild(a);g.appendChild(k)};a.prototype.pollPopUp=function(a,c){var b=document.getElementById("about-modal");
virtualclass.popup.open(b);this.hideAllPopups();b=document.getElementById("editPollCont");b.style.display="block";var f=this,d=function(){console.log(this.id);f.action(this.id,a,c)};if(null==document.getElementById("pollCancel")){var g=document.createElement("div");g.id="pollCancel";g.className="cancelBtn";g.addEventListener("click",d);var k=document.createElement("button");k.id="confirmCancelButton";k.className="icon-close";k.innerHTML=virtualclass.lang.getString("pollCancel");g.appendChild(k);b.appendChild(g)}document.getElementById("resetPoll").addEventListener("click",
d);document.getElementById("addMoreOption").addEventListener("click",d);document.getElementById("etSave").addEventListener("click",d);document.getElementById("saveNpublish").addEventListener("click",d)};a.prototype.action=function(a,c,b,f,d,v){c(a)};a.prototype.confirmInit=function(a,c,b,f,d,v){virtualclass.popup.closeElem();a="confirmOk"==a?virtualclass.popup.confirmOk():virtualclass.popup.confirmCancel();c(a,b,f,d,v)};a.prototype.confirmCancel=function(){return!1};a.prototype.confirmOk=function(){return!0};
a.prototype.waitMsg=function(a){var c=0;"undefined"!=typeof a&&(c=1300);setTimeout(function(){virtualclass.network.netWorkElementIsReady()},c);"undefined"!=typeof virtualclass.vutil&&virtualclass.vutil.sesionEndMsgBoxIsExisting()||this.hideAllPopups()};a.prototype.chromeExtMissing=function(){var a=document.getElementById("about-modal");a.dataset.currPopup="chromeExt";virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("chromeExtMiss").style.display="block";document.getElementById("chromeExtClose").addEventListener("click",
function(){virtualclass.popup.closeElem();a.dataset.currPopup=""})};a.prototype.generalMsg=function(a){var c=document.getElementById("about-modal");virtualclass.popup.open(c);this.hideAllPopups();document.getElementById("generalMessage").style.display="block";document.querySelector("#generalMessageMsg").innerHTML=a;document.getElementById("generalMessageClose").addEventListener("click",function(){virtualclass.popup.closeElem()})};a.prototype.generalMsgButton=function(a){a=document.getElementById("about-modal");
virtualclass.popup.open(a);this.hideAllPopups();a=document.querySelector("#generalMessageButton");null!=a&&(a.style.display="block;",document.querySelector("#generalMessageButton .button").addEventListener("click",function(){virtualclass.popup.closeElem()}))};a.prototype.hideAllPopups=function(){for(var a=document.getElementsByClassName("popupWindow"),c=0;c<a.length;c++)a[c].style.display="none"};a.prototype.closePopup=function(){virtualclass.popup.closeElem();"true"==document.getElementById("sessionEndMsgCont").dataset.displaying&&
this.sesseionEndWindow()};a.prototype.loadingWindow=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();var c=document.querySelector("#loadingWindowCont");null!=c&&(c.style.display="block",a.parentNode.classList.add("loading"))};return a}(window);(function(d){d.converter=function(){function b(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{base64EncArrInt:function(a){for(var c=new Uint8Array(a.length),b=0;b<a.length;b++)c[b]=0>a[b]?-1*a[b]+127:a[b];return this.base64EncArr(c)},base64EncArr:function(a){for(var c=2,f="",d=a.length,k=0,m=0;m<d;m++)if(c=m%3,0<m&&0===4*m/3%76&&(f+="\r\n"),k|=a[m]<<(16>>>c&24),2===c||1===a.length-m)f+=String.fromCharCode(b(k>>>18&63),b(k>>>12&63),b(k>>>6&63),b(k&63)),k=0;return f.substr(0,f.length-
2+c)+(2===c?"":1===c?"=":"==")},base64DecToArrInt:function(a){a=base64DecToArr(a);for(var c=new Int8Array(a.length),b=0;b<a.length;b++)c[b]=128<=a[b]?-1*(a[b]-127):a[b];return c},base64DecToArr:function(a,c){a=a.replace(/[^A-Za-z0-9\+\/]/g,"");var b=a.length;c=c?Math.ceil((3*b+1>>2)/c)*c:3*b+1>>2;for(var d=new Uint8Array(c),k,m=0,n=0,p=0;p<b;p++){k=p&3;var v=a.charCodeAt(p);m|=(64<v&&91>v?v-65:96<v&&123>v?v-71:47<v&&58>v?v+4:43===v?62:47===v?63:0)<<6*(3-k);if(3===k||1===b-p){for(k=0;3>k&&n<c;k++,
n++)d[n]=m>>>(16>>>k&24)&255;m=0}}return d},base64DecToArrclm:function(a){a=base64DecToArr(a);return new Uint8ClampedArray(a.buffer)}}}})(window);var progressBar={prvVal:"",currVal:"",progressInit:function(){var d=this;"undefined"!=typeof prvTimeout&&clearTimeout(prvTimeout);prvTimeout=setTimeout(function(){d.prvVal==d.currVal&&virtualclass.gObj.hasOwnProperty("downloadProgress")?virtualclass.recorder.initMakeAvailDownloadFile():(d.prvVal=d.currVal,d.progressInit())},5E4)},renderProgressBar:function(d,b,a,c){b>d&&(b=d,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));d=0==d&&0==b?0:Math.round(100*
b/d);a=document.getElementById(a);null!=a&&(a.style.width=d+"%");100<=c&&(c=document.getElementById("recordingClose"),recordingClose.style.display="block",c.addEventListener("click",function(){virtualclass.popup.closeElem()}))}};Server=function(d){function b(a,c){this.document=a;this.operations=c||[]}b.prototype.receiveOperation=function(a,c){console.log("Operations "+this.operations.length+" Revision "+a);if(0>a||this.operations.length<a)return console.log("operation revision "+a+" not in history"),!1;a=this.operations.slice(a);for(var b=c.constructor.transform,d=0;d<a.length;d++)c=b(c,a[d])[0];this.document=c.apply(this.document);this.operations.push(c);return c};return b}(this);
"object"===typeof module&&(module.exports=ot.Server);(function(d){var b={makeEventEmitter:function(a,c){a.prototype.allowedEvents_=c;a.prototype.on=function(a,c,b){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};this.eventListeners_[a]=this.eventListeners_[a]||[];this.eventListeners_[a].push({callback:c,context:b})};a.prototype.off=function(a,c){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};a=this.eventListeners_[a]||[];for(var b=0;b<a.length;b++)if(a[b].callback===c){a.splice(b,1);break}};a.prototype.trigger=
function(a){this.eventListeners_=this.eventListeners_||{};for(var c=this.eventListeners_[a]||[],b=0;b<c.length;b++)c[b].callback.apply(c[b].context,Array.prototype.slice.call(arguments,1))};a.prototype.validateEventType_=function(a){if(this.allowedEvents_){for(var c=!1,b=0;b<this.allowedEvents_.length;b++)if(this.allowedEvents_[b]===a){c=!0;break}if(!c)throw Error('Unknown event "'+a+'"');}}},elt:function(a,c,f){a=document.createElement(a);if("string"===typeof c)b.setTextContent(a,c);else if(c)for(var d=
0;d<c.length;++d)a.appendChild(c[d]);for(var k in f||{})a.setAttribute(k,f[k]);return a},setTextContent:function(a,c){a.innerHTML="";a.appendChild(document.createTextNode(c))},on:function(a,c,b,d){a.addEventListener?a.addEventListener(c,b,d||!1):a.attachEvent&&a.attachEvent("on"+c,b)},off:function(a,c,b,d){a.removeEventListener?a.removeEventListener(c,b,d||!1):a.detachEvent&&a.detachEvent("on"+c,b)},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0},stopEvent:function(a){b.preventDefault(a);b.stopPropagation(a)},stopEventAnd:function(a){return function(c){a(c);b.stopEvent(c);return!1}},trim:function(a){return a.replace(/^\s+/g,"").replace(/\s+$/g,"")},stringEndsWith:function(a,c){for(var b="string"==typeof c?[c]:c,d=0;d<b.length;d++)if(c=b[d],-1!==a.indexOf(c,a.length-c.length))return!0;return!1},assert:function(a,c){if(!a)throw Error(c||"assertion error");},log:function(){if("undefined"!==typeof console&&
"undefined"!==typeof console.log){for(var a=["Vceditor:"],c=0;c<arguments.length;c++)a.push(arguments[c]);console.log.apply(console,a)}}};d.utils=b})(window);(function(d){var b=function(a){function c(a){this.imageInsertionUI=a;this.element_=this.makeElement_()}var b=d.utils;b.makeEventEmitter(c,"bold italic underline strike font font-size color left center right unordered-list ordered-list todo-list indent-increase indent-decrease undo redo insert-image".split(" "));c.prototype.element=function(){return this.element_};c.prototype.makeButton_=function(a,c){var f=this;c=b.elt("a",[b.elt("span","",{"class":"vceditor-tb-"+(c||a)})],{"class":"vceditor-btn"});
b.on(c,"click",b.stopEventAnd(function(){f.trigger(a)}));return c};c.prototype.makeElement_=function(){var a=this.makeFontDropdown_(),c=this.makeFontSizeDropdown_(),f=this.makeColorDropdown_();a=[b.elt("div",[a],{"class":"vceditor-btn-group"}),b.elt("div",[c],{"class":"vceditor-btn-group"}),b.elt("div",[f],{"class":"vceditor-btn-group"}),b.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),this.makeButton_("strike","strikethrough")],{"class":"vceditor-btn-group"}),
b.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{"class":"vceditor-btn-group"}),b.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],{"class":"vceditor-btn-group"}),b.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],{"class":"vceditor-btn-group"}),b.elt("div",[this.makeButton_("undo"),
this.makeButton_("redo")],{"class":"vceditor-btn-group"})];this.imageInsertionUI&&a.push(b.elt("div",[this.makeButton_("insert-image")],{"class":"vceditor-btn-group"}));a=b.elt("div",a,{"class":"vceditor-toolbar-wrapper"});c=b.elt("div",null,{"class":"vceditor-toolbar"});c.appendChild(a);return c};c.prototype.makeFontDropdown_=function(){for(var a="Arial;Comic Sans MS;Courier New;Impact;Times New Roman;Verdana".split(";"),c=[],f=0;f<a.length;f++){var d=b.elt("span",a[f]);d.setAttribute("style","font-family:"+
a[f]);c.push({content:d,value:a[f]})}return this.makeDropdown_("Font","font",c)};c.prototype.makeFontSizeDropdown_=function(){for(var a=[9,10,12,14,18,24,32,42],c=[],f=0;f<a.length;f++){var d=b.elt("span",a[f].toString());d.setAttribute("style","font-size:"+a[f]+"px; line-height:"+(a[f]-6)+"px;");c.push({content:d,value:a[f]})}return this.makeDropdown_("Size","font-size",c,"px")};c.prototype.makeColorDropdown_=function(){for(var a="black red green blue yellow cyan magenta grey".split(" "),c=[],f=
0;f<a.length;f++){var d=b.elt("div");d.className="vceditor-color-dropdown-item";d.setAttribute("style","background-color:"+a[f]);c.push({content:d,value:a[f]})}return this.makeDropdown_("Color","color",c)};c.prototype.makeDropdown_=function(a,c,f,d){function g(){r&&(n.style.display="",b.off(document,"click",g,!0),r=!1);t=!0;setTimeout(function(){t=!1},0)}function k(a,f){"object"!==typeof a&&(a=document.createTextNode(String(a)));a=b.elt("a",[a]);b.on(a,"click",b.stopEventAnd(function(){g();m.trigger(c,
f+d)}));n.appendChild(a)}d=d||"";var m=this;a=b.elt("a",a+" \u25be",{"class":"vceditor-btn vceditor-dropdown"});var n=b.elt("ul",[],{"class":"vceditor-dropdown-menu"});a.appendChild(n);for(var r=!1,t=!1,B=0;B<f.length;B++)k(f[B].content,f[B].value);b.on(a,"click",b.stopEventAnd(function(){t||r||(n.style.display="block",b.on(document,"click",g,!0),r=!0)}));return a};return c}();d.RichTextToolbar=b})(window);(function(d){var b=function(){function a(a,b,d){this.type=a;this.attributes=this.text=this.chars=null;"insert"===a?(this.text=b,c.assert("string"===typeof this.text),this.attributes=d||{},c.assert("object"===typeof this.attributes)):"delete"===a?(this.chars=b,c.assert("number"===typeof this.chars)):"retain"===a&&(this.chars=b,c.assert("number"===typeof this.chars),this.attributes=d||{},c.assert("object"===typeof this.attributes))}var c=d.utils;a.prototype.isInsert=function(){return"insert"===this.type};
a.prototype.isDelete=function(){return"delete"===this.type};a.prototype.isRetain=function(){return"retain"===this.type};a.prototype.equals=function(a){return this.type===a.type&&this.text===a.text&&this.chars===a.chars&&this.attributesEqual(a.attributes)};a.prototype.attributesEqual=function(a){for(var c in this.attributes)if(this.attributes[c]!==a[c])return!1;for(c in a)if(this.attributes[c]!==a[c])return!1;return!0};a.prototype.hasEmptyAttributes=function(){var a=!0,c;for(c in this.attributes){a=
!1;break}return a};return a}();d.TextOp=b})(window);(function(d){TextOperation=function(){function b(){if(!this||this.constructor!==b)return new b;this.ops=[];this.targetLength=this.baseLength=0}function a(a){a=a.ops;switch(a.length){case 1:return a[0];case 2:return a[0].isRetain()?a[1]:a[1].isRetain()?a[0]:null;case 3:if(a[0].isRetain()&&a[2].isRetain())return a[1]}return null}function c(a){return a.ops[0].isRetain()?a.ops[0].chars:0}var f=d.TextOp,g=d.utils;b.prototype.equals=function(a){if(this.baseLength!==a.baseLength||this.targetLength!==a.targetLength||
this.ops.length!==a.ops.length)return!1;for(var c=0;c<this.ops.length;c++)if(!this.ops[c].equals(a.ops[c]))return!1;return!0};b.prototype.retain=function(a,c){if("number"!==typeof a||0>a)throw Error("retain expects a positive integer.");if(0===a)return this;this.baseLength+=a;this.targetLength+=a;c=c||{};var b=0<this.ops.length?this.ops[this.ops.length-1]:null;b&&b.isRetain()&&b.attributesEqual(c)?b.chars+=a:this.ops.push(new f("retain",a,c));return this};b.prototype.insert=function(a,c){if("string"!==
typeof a)throw Error("insert expects a string");if(""===a)return this;c=c||{};this.targetLength+=a.length;var b=0<this.ops.length?this.ops[this.ops.length-1]:null,d=1<this.ops.length?this.ops[this.ops.length-2]:null;b&&b.isInsert()&&b.attributesEqual(c)?b.text+=a:b&&b.isDelete()?d&&d.isInsert()&&d.attributesEqual(c)?d.text+=a:(this.ops[this.ops.length-1]=new f("insert",a,c),this.ops.push(b)):this.ops.push(new f("insert",a,c));return this};b.prototype["delete"]=function(a){"string"===typeof a&&(a=
a.length);if("number"!==typeof a||0>a)throw Error("delete expects a positive integer or a string");if(0===a)return this;this.baseLength+=a;var c=0<this.ops.length?this.ops[this.ops.length-1]:null;c&&c.isDelete()?c.chars+=a:this.ops.push(new f("delete",a));return this};b.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()};b.prototype.clone=function(){for(var a=new b,c=0;c<this.ops.length;c++)if(this.ops[c].isRetain())a.retain(this.ops[c].chars,
this.ops[c].attributes);else if(this.ops[c].isInsert())a.insert(this.ops[c].text,this.ops[c].attributes);else a["delete"](this.ops[c].chars);return a};b.prototype.toString=function(){return(Array.prototype.map||function(a){for(var c=[],b=0,f=this.length;b<f;b++)c[b]=a(this[b]);return c}).call(this.ops,function(a){return a.isRetain()?"retain "+a.chars:a.isInsert()?"insert '"+a.text+"'":"delete "+a.chars}).join(", ")};b.prototype.toJSON=function(){for(var a=[],c=0;c<this.ops.length;c++)this.ops[c].hasEmptyAttributes()||
a.push(this.ops[c].attributes),"retain"===this.ops[c].type?a.push(this.ops[c].chars):"insert"===this.ops[c].type?a.push(this.ops[c].text):"delete"===this.ops[c].type&&a.push(-this.ops[c].chars);0===a.length&&a.push(0);return a};b.fromJSON=function(a){for(var c=new b,f=0,d=a.length;f<d;f++){var k=a[f],u={};"object"===typeof k&&(u=k,f++,k=a[f]);if("number"===typeof k)if(0<k)c.retain(k,u);else c["delete"](-k);else g.assert("string"===typeof k),c.insert(k,u)}return c};b.prototype.apply=function(a,c,b){c=
c||[];b=b||[];if(a.length!==this.baseLength)throw Error("The operation's base length must be equal to the string's length.");for(var f=[],d=0,k,m,n=0,t=this.ops,B=0,A=t.length;B<A;B++){var F=t[B];if(F.isRetain()){if(n+F.chars>a.length)throw Error("Operation can't retain more characters than are left in the string.");f[d++]=a.slice(n,n+F.chars);for(k=0;k<F.chars;k++){var E=c[n+k]||{},D={};for(m in E)D[m]=E[m],g.assert(!1!==D[m]);for(m in F.attributes)!1===F.attributes[m]?delete D[m]:D[m]=F.attributes[m],
g.assert(!1!==D[m]);b.push(D)}n+=F.chars}else if(F.isInsert())for(f[d++]=F.text,k=0;k<F.text.length;k++){E={};for(m in F.attributes)E[m]=F.attributes[m],g.assert(!1!==E[m]);b.push(E)}else n+=F.chars}if(n!==a.length)throw Error("The operation didn't operate on the whole string.");a=f.join("");g.assert(a.length===b.length);return a};b.prototype.invert=function(a){for(var c=0,f=new b,d=this.ops,g=0,k=d.length;g<k;g++){var q=d[g];if(q.isRetain())f.retain(q.chars),c+=q.chars;else if(q.isInsert())f["delete"](q.text.length);
else f.insert(a.slice(c,c+q.chars)),c+=q.chars}return f};b.prototype.compose=function(a){function c(a,c,b){var f={},d;for(d in a)f[d]=a[d];for(d in c)b&&!1===c[d]?delete f[d]:f[d]=c[d];return f}if(this.targetLength!==a.baseLength)throw Error("The base length of the second operation has to be the target length of the first operation");var f=new b,d=this.clone().ops;a=a.clone().ops;for(var g=0,k=0,q=d[g++],r=a[k++],t;"undefined"!==typeof q||"undefined"!==typeof r;)if(q&&q.isDelete())f["delete"](q.chars),
q=d[g++];else if(r&&r.isInsert())f.insert(r.text,r.attributes),r=a[k++];else{if("undefined"===typeof q)throw Error("Cannot compose operations: first operation is too short.");if("undefined"===typeof r)throw Error("Cannot compose operations: first operation is too long.");if(q.isRetain()&&r.isRetain())t=c(q.attributes,r.attributes),q.chars>r.chars?(f.retain(r.chars,t),q.chars-=r.chars,r=a[k++]):q.chars===r.chars?(f.retain(q.chars,t),q=d[g++],r=a[k++]):(f.retain(q.chars,t),r.chars-=q.chars,q=d[g++]);
else if(q.isInsert()&&r.isDelete())q.text.length>r.chars?(q.text=q.text.slice(r.chars),r=a[k++]):q.text.length===r.chars?(q=d[g++],r=a[k++]):(r.chars-=q.text.length,q=d[g++]);else if(q.isInsert()&&r.isRetain())t=c(q.attributes,r.attributes,!0),q.text.length>r.chars?(f.insert(q.text.slice(0,r.chars),t),q.text=q.text.slice(r.chars),r=a[k++]):q.text.length===r.chars?(f.insert(q.text,t),q=d[g++],r=a[k++]):(f.insert(q.text,t),r.chars-=q.text.length,q=d[g++]);else if(q.isRetain()&&r.isDelete())q.chars>
r.chars?(f["delete"](r.chars),q.chars-=r.chars,r=a[k++]):q.chars===r.chars?(f["delete"](r.chars),q=d[g++],r=a[k++]):(f["delete"](q.chars),r.chars-=q.chars,q=d[g++]);else throw Error("This shouldn't happen: op1: "+JSON.stringify(q)+", op2: "+JSON.stringify(r));}return f};b.prototype.shouldBeComposedWith=function(b){if(this.isNoop()||b.isNoop())return!0;var f=c(this),d=c(b),g=a(this);b=a(b);return g&&b?g.isInsert()&&b.isInsert()?f+g.text.length===d:g.isDelete()&&b.isDelete()?d+b.chars===f||f===d:!1:
!1};b.prototype.shouldBeComposedWithInverted=function(b){if(this.isNoop()||b.isNoop())return!0;var f=c(this),d=c(b),g=a(this);b=a(b);return g&&b?g.isInsert()&&b.isInsert()?f+g.text.length===d||f===d:g.isDelete()&&b.isDelete()?d+b.chars===f:!1:!1};b.transformAttributes=function(a,c){var b={},f={},d,k={};for(d in a)k[d]=!0;for(d in c)k[d]=!0;for(d in k){k=a[d];var m=c[d];g.assert(null!=k||null!=m);null==k?f[d]=m:null==m?b[d]=k:k!==m&&(b[d]=k)}return[b,f]};b.transform=function(a,c){if(a.baseLength!==
c.baseLength)throw Error("Both operations have to have the same base length");var f=new b,d=new b;a=a.clone().ops;c=c.clone().ops;for(var g=0,k=0,m=a[g++],r=c[k++];"undefined"!==typeof m||"undefined"!==typeof r;)if(m&&m.isInsert())f.insert(m.text,m.attributes),d.retain(m.text.length),m=a[g++];else if(r&&r.isInsert())f.retain(r.text.length),d.insert(r.text,r.attributes),r=c[k++];else{if("undefined"===typeof m)throw Error("Cannot transform operations: first operation is too short.");if("undefined"===
typeof r)throw Error("Cannot transform operations: first operation is too long.");if(m.isRetain()&&r.isRetain()){var t=b.transformAttributes(m.attributes,r.attributes);if(m.chars>r.chars){var B=r.chars;m.chars-=r.chars;r=c[k++]}else m.chars===r.chars?(B=r.chars,m=a[g++],r=c[k++]):(B=m.chars,r.chars-=m.chars,m=a[g++]);f.retain(B,t[0]);d.retain(B,t[1])}else if(m.isDelete()&&r.isDelete())m.chars>r.chars?(m.chars-=r.chars,r=c[k++]):m.chars===r.chars?(m=a[g++],r=c[k++]):(r.chars-=m.chars,m=a[g++]);else if(m.isDelete()&&
r.isRetain())m.chars>r.chars?(B=r.chars,m.chars-=r.chars,r=c[k++]):m.chars===r.chars?(B=r.chars,m=a[g++],r=c[k++]):(B=m.chars,r.chars-=m.chars,m=a[g++]),f["delete"](B);else if(m.isRetain()&&r.isDelete())m.chars>r.chars?(B=r.chars,m.chars-=r.chars,r=c[k++]):m.chars===r.chars?(B=m.chars,m=a[g++],r=c[k++]):(B=m.chars,r.chars-=m.chars,m=a[g++]),d["delete"](B);else throw Error("The two operations aren't compatible");}return[f,d]};return b}();d.TextOperation=TextOperation})(window);(function(d){var b=function(a){function c(a,c){this.wrapped=a;this.meta=c}function b(a,c){for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b])}function d(a,c){return a&&"object"===typeof a&&"function"===typeof a.transform?a.transform(c):a}c.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)};c.prototype.invert=function(){var a=this.meta;return new c(this.wrapped.invert.apply(this.wrapped,arguments),a&&"object"===typeof a&&"function"===typeof a.invert?a.invert.apply(a,arguments):
a)};c.prototype.compose=function(a){var f=this.wrapped.compose(a.wrapped);var d=this.meta;a=a.meta;if(d&&"object"===typeof d)if("function"===typeof d.compose)d=d.compose(a);else{var g={};b(d,g);b(a,g);d=g}else d=a;return new c(f,d)};c.transform=function(a,b){var f=a.wrapped.constructor.transform;f=f(a.wrapped,b.wrapped);return[new c(f[0],d(a.meta,b.wrapped)),new c(f[1],d(b.meta,a.wrapped))]};return c}();d.WrappedOperation=b})(window);(function(d){var b=function(){function a(a,b){this.position=a;this.selectionEnd=b}a.fromJSON=function(c){return new a(c.position,c.selectionEnd)};a.prototype.equals=function(a){return this.position===a.position&&this.selectionEnd===a.selectionEnd};a.prototype.compose=function(a){return a};a.prototype.transform=function(c){function b(a){for(var b=a,f=c.ops,d=0,g=c.ops.length;d<g&&!(f[d].isRetain()?a-=f[d].chars:f[d].isInsert()?b+=f[d].text.length:(b-=Math.min(a,f[d].chars),a-=f[d].chars),0>a);d++);
return b}var d=b(this.position);return this.position===this.selectionEnd?new a(d,d):new a(d,b(this.selectionEnd))};return a}();d.Cursor=b})(window);(function(d){var b=function(){function a(a){this.maxItems=a||50;this.state="normal";this.dontCompose=!1;this.undoStack=[];this.redoStack=[]}function c(a,c){for(var b=[],f=c.constructor,d=a.length-1;0<=d;d--)c=f.transform(a[d],c),"function"===typeof c[0].isNoop&&c[0].isNoop()||b.push(c[0]),c=c[1];return b.reverse()}a.prototype.add=function(a,c){if("undoing"===this.state)this.redoStack.push(a),this.dontCompose=!0;else if("redoing"===this.state)this.undoStack.push(a),this.dontCompose=!0;else{var b=this.undoStack;
!this.dontCompose&&c&&0<b.length?b.push(a.compose(b.pop())):(b.push(a),b.length>this.maxItems&&b.shift());this.dontCompose=!1;this.redoStack=[]}};a.prototype.transform=function(a){this.undoStack=c(this.undoStack,a);this.redoStack=c(this.redoStack,a)};a.prototype.performUndo=function(a){this.state="undoing";if(0===this.undoStack.length)throw Error("undo not possible");a(this.undoStack.pop());this.state="normal"};a.prototype.performRedo=function(a){this.state="redoing";if(0===this.redoStack.length)throw Error("redo not possible");
a(this.redoStack.pop());this.state="normal"};a.prototype.canUndo=function(){return 0!==this.undoStack.length};a.prototype.canRedo=function(){return 0!==this.redoStack.length};a.prototype.isUndoing=function(){return"undoing"===this.state};a.prototype.isRedoing=function(){return"redoing"===this.state};return a}();d.UndoManager=b})(window);(function(d){var b=function(){function a(a){this.revision=a;this.state=k}function c(){}function b(a){this.outstanding=a}function d(a,c){this.outstanding=a;this.buffer=c}a.prototype.setState=function(a){this.state=a};a.prototype.applyClient=function(a){this.setState(this.state.applyClient(this,a))};a.prototype.applyServer=function(a){this.revision++;this.setState(this.state.applyServer(this,a))};a.prototype.serverAck=function(){this.revision++;this.setState(this.state.serverAck(this))};a.prototype.serverRetry=
function(){this.setState(this.state.serverRetry(this))};a.prototype.transformCursor=function(a){return this.state.transformCursor(a)};a.prototype.sendOperation=function(a){throw Error("sendOperation must be defined in child class");};a.prototype.applyOperation=function(a){throw Error("applyOperation must be defined in child class");};a.Synchronized=c;c.prototype.applyClient=function(a,c){a.sendOperation(a.revision,c);return new b(c)};c.prototype.applyServer=function(a,c){a.applyOperation(c);return this};
c.prototype.transformCursor=function(a){return a};c.prototype.serverAck=function(a){throw Error("There is no pending operation.");};c.prototype.serverRetry=function(a){throw Error("There is no pending operation.");};var k=new c;a.AwaitingConfirm=b;b.prototype.applyClient=function(a,c){return new d(this.outstanding,c)};b.prototype.applyServer=function(a,c){c=c.constructor.transform(this.outstanding,c);a.applyOperation(c[1]);return new b(c[0])};b.prototype.serverAck=function(a){return k};b.prototype.serverRetry=
function(a){a.sendOperation(this.outstanding);return this};b.prototype.transformCursor=function(a){return a.transform(this.outstanding)};a.AwaitingWithBuffer=d;d.prototype.applyClient=function(a,c){a=this.buffer.compose(c);return new d(this.outstanding,a)};d.prototype.applyServer=function(a,c){var b=c.constructor.transform;c=b(this.outstanding,c);b=b(this.buffer,c[1]);a.applyOperation(b[1]);return new d(c[0],b[0])};d.prototype.serverRetry=function(a){var c=this.outstanding.compose(this.buffer);a.sendOperation(c);
return new b(c)};d.prototype.serverAck=function(a){a.sendOperation(a.revision,this.buffer);return new b(this.buffer)};d.prototype.transformCursor=function(a){return a.transform(this.outstanding).transform(this.buffer)};return a}();d.Client=b})(window);(function(d){var b=0,a=0,c=null;"use strict";var f=function(){function f(a,c){this.cursorBefore=a;this.cursorAfter=c}function k(a,c){this.id=a;this.editorAdapter=c;this.li=document.createElement("li")}function m(a,c,b,f){p.call(this,a);this.serverAdapter=b;this.editorAdapter=f;this.undoManager=new u;this.clients={};var d=this;this.editorAdapter.registerCallbacks({change:function(a,c){d.onChange(a,c)},cursorActivity:function(){d.onCursorActivity()},blur:function(){d.onBlur()},focus:function(){d.onFocus()}});
this.editorAdapter.registerUndo(function(){d.undo()});this.editorAdapter.registerRedo(function(){d.redo()});this.serverAdapter.registerCallbacks({client_left:function(a){d.onClientLeft(a)},set_name:function(a,c){d.getClientObject(a).setName(c)},ack:function(){d.serverAck()},operation:function(a){d.applyServer(q.fromJSON(a))},cursor:function(a,c){c?d.getClientObject(a).updateCursor(d.transformCursor(v.fromJSON(c))):d.getClientObject(a).removeCursor()},clients:function(a){for(var c in d.clients)if(d.clients.hasOwnProperty(c)&&
!a.hasOwnProperty(c))d.onClientLeft(c);for(c in a)if(a.hasOwnProperty(c)){var b=d.getClientObject(c);a[c].name&&b.setName(a[c].name);(b=a[c].selection)?d.clients[c].updateSelection(d.transformSelection(Selection.fromJSON(b))):d.clients[c].removeSelection()}},reconnect:function(){d.serverReconnect()}})}function n(a){return a[a.length-1]}var p=d.Client,v=d.Cursor,u=d.UndoManager,q=d.TextOperation,r=d.WrappedOperation;f.prototype.invert=function(){return new f(this.cursorAfter,this.cursorBefore)};f.prototype.compose=
function(a){return new f(this.cursorBefore,a.cursorAfter)};f.prototype.transform=function(a){return new f(this.cursorBefore?this.cursorBefore.transform(a):null,this.cursorAfter?this.cursorAfter.transform(a):null)};k.prototype.setColor=function(a){this.color=a};k.prototype.updateCursor=function(a){this.color="#86BA7D";this.removeCursor();this.cursor=a;this.mark=this.editorAdapter.setOtherCursor(a,this.color,this.id)};k.prototype.removeCursor=function(){this.mark&&this.mark.clear()};(function(a,c){function b(){}
b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a})(m,p);m.prototype.getClientObject=function(a){var c=this.clients[a];return c?c:this.clients[a]=new k(a,this.editorAdapter)};m.prototype.applyUnredo=function(a){this.undoManager.add(this.editorAdapter.invertOperation(a));this.editorAdapter.applyOperation(a.wrapped);(this.cursor=a.meta.cursorAfter)&&this.editorAdapter.setCursor(this.cursor);this.applyClient(a.wrapped)};m.prototype.undo=function(){var a=this;this.undoManager.canUndo()&&
this.undoManager.performUndo(function(c){a.applyUnredo(c)})};m.prototype.redo=function(){var a=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(c){a.applyUnredo(c)})};m.prototype.onChange=function(a,c){var b=this.cursor;this.updateCursor();var d=0<this.undoManager.undoStack.length&&c.shouldBeComposedWithInverted(n(this.undoManager.undoStack).wrapped);b=new f(this.cursor,b);this.undoManager.add(new r(c,b),d);this.applyClient(a)};m.prototype.updateCursor=function(){this.cursor=
this.editorAdapter.getCursor()};m.prototype.onCursorActivity=function(){var a=this.cursor;this.updateCursor();!this.focused||a&&this.cursor.equals(a)||this.sendCursor(this.cursor)};m.prototype.onBlur=function(){this.cursor=null;this.sendCursor(null);this.focused=!1};m.prototype.onFocus=function(){this.focused=!0;this.onCursorActivity()};m.prototype.sendCursor=function(f){if(!(this.state instanceof p.AwaitingWithBuffer)){if(null!=f&&f.hasOwnProperty("position"))var d=f.position;if(null!=f&&f.hasOwnProperty("selectionEnd"))var g=
f.selectionEnd;if(0===b)null!=d&&null!=g?(this.serverAdapter.sendCursor(f),b=1):this.serverAdapter.sendCursor(f);else if(null!=d&&null!=g){null!=c&&clearTimeout(c);a=f;var k=this;c=setTimeout(function(){k.serverAdapter.sendCursor(f);a=null},300)}else null!=a&&(this.serverAdapter.sendCursor(a),a=null),this.serverAdapter.sendCursor(f),b=0;g=d=null}};m.prototype.sendOperation=function(a,c){this.serverAdapter.sendOperation(a,c.toJSON(),this.cursor,this.editorAdapter.cm.options.keyMap)};m.prototype.applyOperation=
function(a){this.editorAdapter.applyOperation(a);this.updateCursor();this.undoManager.transform(new r(a,null))};m.prototype.emitStatus=function(){var a=this;setTimeout(function(){a.trigger("synced",a.state instanceof p.Synchronized)},0)};return m}();d.EditorClient=f})(window);(function(d){var b=function(){function a(a,b){this.pos=a;this.length=b}a.prototype.end=function(){return this.pos+this.length};return a}();d.Span=b})(window);(function(d){var b=function(){function a(a,c){if(!a)throw Error("AnnotationList assertion failed"+(c?": "+c:""));}function c(a,c){this.pos=a;this.length=c.length;this.annotation=c.annotation;this.attachedObject_=c.attachedObject}function b(a,c){this.pos=a;this.length=c.length;this.annotation=c.annotation;this.node_=c}function g(a){this.head_=new k(0,n);this.changeHandler_=a}function k(a,c){this.length=a;this.annotation=c;this.next=this.attachedObject=null}var m=d.Span;c.prototype.getAttachedObject=
function(){return this.attachedObject_};b.prototype.attachObject=function(a){this.node_.attachedObject=a};var n={equals:function(){return!1}};g.prototype.insertAnnotatedSpan=function(c,b){this.wrapOperation_(new m(c.pos,0),function(f,d){a(!d||null===d.next);var g=new k(c.length,b);if(d){a(c.pos>f&&c.pos<f+d.length);var m=new k(0,n);m.next=new k(c.pos-f,d.annotation);m.next.next=g;g.next=new k(f+d.length-c.pos,d.annotation);return m.next}return g})};g.prototype.removeSpan=function(c){0!==c.length&&
this.wrapOperation_(c,function(b,f){a(null!==f);var d=new k(0,n),g=d;c.pos>b&&(g.next=new k(c.pos-b,f.annotation),g=g.next);for(;c.end()>b+f.length;)b+=f.length,f=f.next;b=b+f.length-c.end();0<b&&(g.next=new k(b,f.annotation));return d.next})};g.prototype.updateSpan=function(c,b){0!==c.length&&this.wrapOperation_(c,function(f,d){a(null!==d);var g=new k(0,n),m=g,p=f,q=c.pos-p;a(q<d.length);0<q&&(m.next=new k(q,d.annotation),m=m.next,p+=m.length);for(;null!==d&&c.end()>=f+d.length;)p=f+d.length-p,m.next=
new k(p,b(d.annotation,p)),m=m.next,f+=d.length,d=d.next,p=f;q=c.end()-p;0<q&&(a(q<d.length),m.next=new k(q,b(d.annotation,q)),m=m.next,p+=m.length,m.next=new k(f+d.length-p,d.annotation));return g.next})};g.prototype.wrapOperation_=function(a,f){if(0>a.pos)throw Error("Span start cannot be negative.");var d=[],g=[];a=this.getAffectedNodes_(a);if(null!==a.start){var m=a.end.next;a.end.next=null}else m=a.succ;var n=f(a.startPos,a.start),p=!1;f=!1;if(n){this.mergeNodesWithSameAnnotations_(n);if(a.pred&&
a.pred.annotation.equals(n.annotation)){p=!0;n.length+=a.pred.length;a.beforePred.next=n;var A=a.predPos}else a.beforeStart.next=n,A=a.startPos;for(;n.next;)g.push(new b(A,n)),A+=n.length,n=n.next;a.succ&&a.succ.annotation.equals(n.annotation)?(n.length+=a.succ.length,f=!0,n.next=a.succ.next):n.next=m;g.push(new b(A,n))}else a.pred&&a.succ&&a.pred.annotation.equals(a.succ.annotation)?(f=p=!0,n=new k(a.pred.length+a.succ.length,a.pred.annotation),a.beforePred.next=n,n.next=a.succ.next,g.push(new b(a.startPos-
a.pred.length,n))):a.beforeStart.next=m;p&&d.push(new c(a.predPos,a.pred));m=a.startPos;for(n=a.start;null!==n;)d.push(new c(m,n)),m+=n.length,n=n.next;f&&d.push(new c(m,a.succ));this.changeHandler_(d,g)};g.prototype.getAffectedNodes_=function(a){for(var c={},b=null,f=this.head_,d=f.next,g=0;null!==d&&a.pos>=g+d.length;)g+=d.length,b=f,f=d,d=d.next;if(null===d&&(0!==a.length||a.pos!==g))throw Error("Span start exceeds the bounds of the AnnotationList.");c.startPos=g;c.start=0===a.length&&a.pos===
g?null:d;c.beforeStart=f;g===a.pos&&0<g?(c.pred=f,c.predPos=g-f.length,c.beforePred=b):c.pred=null;for(;null!==d&&a.end()>g;)g+=d.length,f=d,d=d.next;if(a.end()>g)throw Error("Span end exceeds the bounds of the AnnotationList.");0===a.length&&a.end()===g?c.end=null:c.end=f;c.succ=g===a.end()?d:null;return c};g.prototype.mergeNodesWithSameAnnotations_=function(a){if(a)for(var c=null;a;)c&&c.annotation.equals(a.annotation)?(c.length+=a.length,c.next=a.next):c=a,a=a.next};g.prototype.forEach=function(a){for(var c=
this.head_.next;null!==c;)a(c.length,c.annotation,c.attachedObject),c=c.next};g.prototype.getAnnotatedSpansForPos=function(a){for(var b=0,f=this.head_.next,d=null;null!==f&&b+f.length<=a;)b+=f.length,d=f,f=f.next;if(null===f&&b!==a)throw Error("pos exceeds the bounds of the AnnotationList");var g=[];b===a&&d&&g.push(new c(b-d.length,d));f&&g.push(new c(b,f));return g};g.prototype.getAnnotatedSpansForSpan=function(a){if(0===a.length)return[];var c=[],b=this.getAffectedNodes_(a),f=b.startPos;for(b=
b.start;null!==b&&f<a.end();){var d=Math.max(f,a.pos),g=Math.min(f+b.length,a.end());d=new m(d,g-d);d.annotation=b.annotation;c.push(d);f+=b.length;b=b.next}return c};g.prototype.count=function(){for(var c=0,b=this.head_.next,f=null;null!==b;)f&&a(!f.annotation.equals(b.annotation)),f=b,b=b.next,c++;return c};k.prototype.clone=function(){var a=new k(this.spanLength,this.annotation);a.next=this.next;return a};return g}();d.AnnotationList=b})(window);(function(d){d.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"}})(window);(function(d){var b=function(){function a(b){if(!(this instanceof a))return new a(b);this.attributes=b||{};this.attributes[c.LINE_SENTINEL]=!0}var c=d.AttributeConstants;a.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"};a.prototype.cloneWithNewAttribute_=function(c,b){var f={},d;for(d in this.attributes)f[d]=this.attributes[d];!1===b?delete f[c]:f[c]=b;return new a(f)};a.prototype.indent=function(a){return this.cloneWithNewAttribute_(c.LINE_INDENT,a)};a.prototype.align=function(a){return this.cloneWithNewAttribute_(c.LINE_ALIGN,
a)};a.prototype.listItem=function(a){vceditor.utils.assert(!1===a||"u"===a||"o"===a||"t"===a||"tc"===a);return this.cloneWithNewAttribute_(c.LIST_TYPE,a)};a.prototype.getIndent=function(){return this.attributes[c.LINE_INDENT]||0};a.prototype.getAlign=function(){return this.attributes[c.LINE_ALIGN]||0};a.prototype.getListItem=function(){return this.attributes[c.LIST_TYPE]||!1};return a}();d.LineFormatting=b})(window);(function(d){var b=function(){function a(a){return a===k.ORDERED?"</ol>":"</ul>"}function c(a,c){return a===c||a===k.TODO&&c===k.TODOCHECKED||a===k.TODOCHECKED&&c===k.TODO}var b=d.utils,g=d.AttributeConstants,k=d.LineFormatting.LIST_TYPE;return function(f,d){for(var m="",n=!0,u=[],q=!1,r=!0,t=!0,B=0,A=f.ops[B],F=!1;A;){b.assert(A.isInsert());var E=A.attributes;if(n){n=!1;var D=0,H=null,G="left";g.LINE_SENTINEL in E&&(D=E[g.LINE_INDENT]||0,H=E[g.LIST_TYPE]||null,G=E[g.LINE_ALIGN]||"left");H&&(D=D||
1);q?(m+="</li>",q=!1):r||(t&&(m+="<br/>"),m+="</div>");r=!1;for(b.assert(0<=D,"Indent must not be negative.");u.length>D||D===u.length&&null!==H&&!c(H,u[u.length-1]);)m+=a(u.pop());for(;u.length<D;)t=H||k.UNORDERED,F=H==k.TODO||H==k.TODOCHECKED||F,m+=t===k.ORDERED?"<ol>":t===k.UNORDERED?"<ul>":'<ul class="vceditor-todo">',u.push(t);t="left"!==G?' style="text-align:'+G+'"':"";if(H){q="";switch(H){case k.TODOCHECKED:q=' class="vceditor-checked"';break;case k.TODO:q=' class="vceditor-unchecked"'}m+=
"<li"+q+t+">";q=!0}else m+="<div"+t+">";t=!0}if(g.LINE_SENTINEL in E)A=f.ops[++B];else if(g.ENTITY_SENTINEL in E){for(H=0;H<A.text.length;H++)D=vceditor.Entity.fromAttributes(E),D=d.exportToElement(D),m+=D.outerHTML;A=f.ops[++B]}else{D=H="";for(var z in E){G=E[z];var J;if(z===g.BOLD||z===g.ITALIC||z===g.UNDERLINE||z===g.STRIKE){b.assert(!0===G);var L=J=z}else z===g.FONT_SIZE?(L='span style="font-size: '+G,L+="string"!==typeof G||-1===G.indexOf("px",G.length-2)?'px"':'"',J="span"):z===g.FONT?(L='span style="font-family: '+
G+'"',J="span"):z===g.COLOR?(L='span style="color: '+G+'"',J="span"):z===g.BACKGROUND_COLOR?(L='span style="background-color: '+G+'"',J="span"):b.log(!1,"Encountered unknown attribute while rendering html: "+z);L&&(H+="<"+L+">");J&&(D="</"+J+">"+D)}G=A.text;var K=G.indexOf("\n");0<=K?(n=!0,A=K<G.length-1?new vceditor.TextOp("insert",G.substr(K+1),E):f.ops[++B],G=G.substr(0,K)):A=f.ops[++B];G=G.replace(/  +/g,function(a){return Array(a.length+1).join("\u00a0")}).replace(/^ /,"\u00a0").replace(/ $/,
"\u00a0");0<G.length&&(t=!1);m+=H+G.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+D}}q?m+="</li>":r||(t&&(m+="&nbsp;"),m+="</div>");for(;0<u.length;)m+=a(u.pop());F&&(m='<style>ul.vceditor-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.vceditor-todo > li { padding-left: 1em; text-indent: -1em; } ul.vceditor-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.vceditor-todo > li.vceditor-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+
m);return m}}();d.SerializeHtml=b})(window);(function(d){var b=function(){function a(a,c,b){this.listType=a||m.UNORDERED;this.lineFormatting=c||vceditor.LineFormatting();this.textFormatting=b||vceditor.Formatting()}function c(){this.lines=[];this.currentLine=[];this.currentLineListItemType=null}function b(a,c,b){if(a.nodeType===p.ELEMENT_NODE){var f=n.fromElement(a);if(f){b.currentLine.push(new vceditor.Text(vceditor.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new vceditor.Formatting(f.toAttributes())));return}}switch(a.nodeType){case p.TEXT_NODE:a=
a.nodeValue.replace(/[ \n\t]+/g," ");b.currentLine.push(vceditor.Text(a,c.textFormatting));break;case p.ELEMENT_NODE:switch(f=a.getAttribute("style")||"",c=k(c,f),a.nodeName.toLowerCase()){case "div":case "h1":case "h2":case "h3":case "p":b.newlineIfNonEmpty(c);g(a,c,b);b.newlineIfNonEmpty(c);break;case "center":c=c.withAlign("center");b.newlineIfNonEmpty(c);g(a,c.withAlign("center"),b);b.newlineIfNonEmpty(c);break;case "b":case "strong":g(a,c.withTextFormatting(c.textFormatting.bold(!0)),b);break;
case "u":g(a,c.withTextFormatting(c.textFormatting.underline(!0)),b);break;case "i":case "em":g(a,c.withTextFormatting(c.textFormatting.italic(!0)),b);break;case "s":g(a,c.withTextFormatting(c.textFormatting.strike(!0)),b);break;case "font":f=a.getAttribute("face");var d=a.getAttribute("color"),q=parseInt(a.getAttribute("size"));f&&(c=c.withTextFormatting(c.textFormatting.font(f)));d&&(c=c.withTextFormatting(c.textFormatting.color(d)));q&&(c=c.withTextFormatting(c.textFormatting.fontSize(q)));g(a,
c,b);break;case "br":b.newline(c);break;case "ul":b.newlineIfNonEmptyOrListItem(c);f="vceditor-todo"===a.getAttribute("class")?m.TODO:m.UNORDERED;g(a,c.withListType(f).withIncreasedIndent(),b);b.newlineIfNonEmpty(c);break;case "ol":b.newlineIfNonEmptyOrListItem(c);g(a,c.withListType(m.ORDERED).withIncreasedIndent(),b);b.newlineIfNonEmpty(c);break;case "li":b.newlineIfNonEmptyOrListItem(c);f="vceditor-checked"===a.getAttribute("class")?m.TODOCHECKED:c.listType;b.makeListItem(f);f=b.currentLine;g(a,
c,b);(f===b.currentLine||0<b.currentLine.length)&&b.newline(c);break;case "style":break;default:g(a,c,b)}}}function g(a,c,f){if(a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++)b(a.childNodes[d],c,f)}function k(a,c){var b=a.textFormatting,f=a.lineFormatting;c=c.split(";");for(var d=0;d<c.length;d++){var g=c[d].split(":");if(2===g.length){var k=vceditor.utils.trim(g[0]).toLowerCase();g=vceditor.utils.trim(g[1]).toLowerCase();switch(k){case "text-decoration":k=0<=g.indexOf("underline");g=0<=
g.indexOf("line-through");b=b.underline(k).strike(g);break;case "font-weight":g="bold"===g||600<=parseInt(g);b=b.bold(g);break;case "font-style":b=b.italic("italic"===g||"oblique"===g);break;case "color":b=b.color(g);break;case "background-color":b=b.backgroundColor(g);break;case "text-align":f=f.align(g);break;case "font-size":k=null;vceditor.utils.stringEndsWith(g,"px pt % em xx-small x-small small medium large x-large xx-large smaller larger".split(" "))?k=g:parseInt(g)&&(k=parseInt(g)+"px");k&&
(b=b.fontSize(k));break;case "font-family":g=vceditor.utils.trim(g.split(",")[0]),g=g.replace(/['"]/g,""),g=g.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),b=b.font(g)}}}return a.withLineFormatting(f).withTextFormatting(b)}var m=d.LineFormatting.LIST_TYPE;a.prototype.withTextFormatting=function(c){return new a(this.listType,this.lineFormatting,c)};a.prototype.withLineFormatting=function(c){return new a(this.listType,c,this.textFormatting)};a.prototype.withListType=
function(c){return new a(c,this.lineFormatting,this.textFormatting)};a.prototype.withIncreasedIndent=function(){var c=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new a(this.listType,c,this.textFormatting)};a.prototype.withAlign=function(c){c=this.lineFormatting.align(c);return new a(this.listType,c,this.textFormatting)};c.prototype.newlineIfNonEmpty=function(a){this.cleanLine_();0<this.currentLine.length&&this.newline(a)};c.prototype.newlineIfNonEmptyOrListItem=function(a){this.cleanLine_();
(0<this.currentLine.length||null!==this.currentLineListItemType)&&this.newline(a)};c.prototype.newline=function(a){this.cleanLine_();a=a.lineFormatting;null!==this.currentLineListItemType&&(a=a.listItem(this.currentLineListItemType),this.currentLineListItemType=null);this.lines.push(vceditor.Line(this.currentLine,a));this.currentLine=[]};c.prototype.makeListItem=function(a){this.currentLineListItemType=a};c.prototype.cleanLine_=function(){if(0<this.currentLine.length){var a=this.currentLine.length-
1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,"");this.currentLine[a].text=this.currentLine[a].text.replace(/ +$/g,"");for(a=0;a<this.currentLine.length;a++)this.currentLine[a].text=this.currentLine[a].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var n,p=p||{ELEMENT_NODE:1,TEXT_NODE:3};return function(f,d){var g=(vceditor.document||document).createElement("div");g.innerHTML=f;n=d;f=new c;d=new a;b(g,d,f);return f.lines}}();
d.ParseHtml=b})(window);(function(d){RichTextCodeMirrorAdapter=function(){function b(a){this.rtcm=a;this.cm=a.codeMirror;c(this,"onChange");c(this,"onAttributesChange");c(this,"onCursorActivity");c(this,"onFocus");c(this,"onBlur");this.rtcm.on("change",this.onChange);this.rtcm.on("attributesChange",this.onAttributesChange);this.cm.on("cursorActivity",this.onCursorActivity);this.cm.on("focus",this.onFocus);this.cm.on("blur",this.onBlur)}function a(a){var c=a.lineCount()-1;return a.indexFromPos({line:c,ch:a.getLine(c).length})}
function c(a,c){var b=a[c];a[c]=function(){b.apply(a,arguments)}}function f(a){for(var c in a)return!1;return!0}var g=d.TextOperation,k=d.WrappedOperation,m=d.Cursor;b.prototype.detach=function(){this.rtcm.off("change",this.onChange);this.rtcm.off("attributesChange",this.onAttributesChange);this.cm.off("cursorActivity",this.onCursorActivity);this.cm.off("focus",this.onFocus);this.cm.off("blur",this.onBlur)};b.operationFromCodeMirrorChanges=function(c,b){b=a(b);for(var f=(new g).retain(b),d=(new g).retain(b),
k=c.length-1;0<=k;k--){var m=c[k],n=m.start,p=b-n-m.text.length;f=(new g).retain(n)["delete"](m.removed.length).insert(m.text,m.attributes).retain(p).compose(f);d=d.compose((new g).retain(n)["delete"](m.text.length).insert(m.removed,m.removedAttributes).retain(p));b+=m.removed.length-m.text.length}return[f,d]};b.operationFromAttributesChanges=function(c,b){b=a(b);for(var f=new g,d=new g,k=0,m=0;m<c.length;m++){var n=c[m];k=n.start-k;if(!(0<=k))throw Error("assertion error");f.retain(k);d.retain(k);
k=n.end-n.start;f.retain(k,n.attributes);d.retain(k,n.attributesInverse);k=n.start+k}f.retain(b-k);d.retain(b-k);return[f,d]};b.applyOperationToCodeMirror=function(a,c){10<a.ops.length&&c.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var b=a.ops,d=0,g=0,k=b.length;g<k;g++){var m=b[g];m.isRetain()?(f(m.attributes)||c.updateTextAttributes(d,d+m.chars,function(a){for(var c in m.attributes)!1===m.attributes[c]?delete a[c]:a[c]=m.attributes[c]},"RTCMADAPTER",!0),d+=m.chars):
m.isInsert()?(c.insertText(d,m.text,m.attributes,"RTCMADAPTER"),d+=m.text.length):m.isDelete()&&c.removeText(d,d+m.chars,"RTCMADAPTER")}10<a.ops.length&&(c.codeMirror.getWrapperElement().setAttribute("style",""),c.codeMirror.refresh())};b.prototype.registerCallbacks=function(a){this.callbacks=a};b.prototype.onChange=function(a,c){"RTCMADAPTER"!==c[0].origin&&(a=b.operationFromCodeMirrorChanges(c,this.cm),this.trigger("change",a[0],a[1]))};b.prototype.onAttributesChange=function(a,c){"RTCMADAPTER"!==
c[0].origin&&(a=b.operationFromAttributesChanges(c,this.cm),this.trigger("change",a[0],a[1]))};b.prototype.onCursorActivity=function(){this.trigger("cursorActivity")};b.prototype.onFocus=function(){this.trigger("focus")};b.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")};b.prototype.getValue=function(){return this.cm.getValue()};b.prototype.getCursor=function(){var a=this.cm,c=a.getCursor(),b=a.indexFromPos(c);if(a.somethingSelected()){var f=a.getCursor(!0);c=0===(c.line<
f.line?-1:c.line>f.line?1:c.ch<f.ch?-1:c.ch>f.ch?1:0)?a.getCursor(!1):f;a=a.indexFromPos(c)}else a=b;return new m(b,a)};b.prototype.setCursor=function(a){this.cm.setSelection(this.cm.posFromIndex(a.position),this.cm.posFromIndex(a.selectionEnd))};b.prototype.addStyleRule=function(a){if("undefined"!==typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var c=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(c);this.addedStyleSheet=
c.sheet}if(!this.addedStyleRules[a])return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)}};b.prototype.setOtherCursor=function(a,c,b){var f=this.cm.posFromIndex(a.position);if("string"===typeof c&&c.match(/^#[a-fA-F0-9]{3,6}$/)){var d=this.rtcm.end();if("object"===typeof a&&"number"===typeof a.position&&"number"===typeof a.selectionEnd&&!(0>a.position||a.position>d||0>a.selectionEnd||a.selectionEnd>d)){var g=this.cm.cursorCoords(f);d=document.createElement("span");d.className="other-client";
d.id="cursorId"+b;d.style.borderLeftWidth="3px";d.style.borderLeftStyle="solid";d.style.borderLeftColor=c;d.style.marginLeft=d.style.marginRight="-3px";d.style.height=.9*(g.bottom-g.top)+"px";d.setAttribute("data-clientname",virtualclass.vutil.getUserInfo("name",b,virtualclass.connectedUsers));d.setAttribute("data-clientid",b);d.style.position="relative";g=document.getElementById("cursorId"+b);null!=g&&g.parentNode.removeChild(g);if(b!=virtualclass.gObj.uid){if(a.position===a.selectionEnd)return d.style.zIndex=
0,this.cm.setBookmark(f,{widget:d,insertLeft:!0});this.cm.setBookmark(f,{widget:d,insertLeft:!0});b="selection-"+c.replace("#","");this.addStyleRule("."+b+" { background: "+c+"; }");a.selectionEnd>a.position?(c=f,a=this.cm.posFromIndex(a.selectionEnd)):(c=this.cm.posFromIndex(a.selectionEnd),a=f);return this.cm.markText(c,a,{className:b})}}}};b.prototype.trigger=function(a){var c=Array.prototype.slice.call(arguments,1),b=this.callbacks&&this.callbacks[a];b&&b.apply(this,c)};b.prototype.applyOperation=
function(a){b.applyOperationToCodeMirror(a,this.rtcm)};b.prototype.registerUndo=function(a){this.cm.undo=a};b.prototype.registerRedo=function(a){this.cm.redo=a};b.prototype.invertOperation=function(a){for(var c=0,b=this.rtcm.codeMirror,d,m,n=new g,t=0;t<a.wrapped.ops.length;t++){var B=a.wrapped.ops[t];if(B.isRetain())if(f(B.attributes))n.retain(B.chars),c+=B.chars;else for(d=this.rtcm.getAttributeSpans(c,c+B.chars),m=0;m<d.length;m++){var A={},F;for(F in B.attributes){var E=B.attributes[F],D=d[m].attributes[F];
!1===E?D&&(A[F]=D):E!==D&&(A[F]=D||!1)}n.retain(d[m].length,A);c+=d[m].length}else if(B.isInsert())n["delete"](B.text.length);else if(B.isDelete()){A=b.getRange(b.posFromIndex(c),b.posFromIndex(c+B.chars));d=this.rtcm.getAttributeSpans(c,c+B.chars);for(m=E=0;m<d.length;m++)n.insert(A.substr(E,d[m].length),d[m].attributes),E+=d[m].length;c+=B.chars}}return new k(n,a.meta.invert())};return b}();d.Client=RichTextCodeMirrorAdapter})(window);otAdapter=function(){function d(b,a){a=a.charAt(0).toLowerCase()+a.slice(1);var c=Vceditor.getvcEditor();b.operations&&b.revision>b.operations.length?(a=[],a[b.revision-b.operations.length-1]=null,this.operations=a.concat(b.operations)):this.operations=b.operations?b.operations:[];this.server=new c.Server(b.doc,this.operations);this.trigger=function(a){this.callbacks[a].apply(this,Array.prototype.slice.call(arguments,1))};this.teacherOT=function(a){a=this.doOT(a);"undefined"!=typeof a&&this.preSend(a,
!0)};this.doOT=function(a){if(1!==this.myOTrequestData)try{if("virtualclass-editor-operation"==a.eddata){var b=JSON.parse(a.data),f=new c.WrappedOperation(c.TextOperation.fromJSON(b.operation),b.cursor&&c.Cursor.fromJSON(b.cursor)),d=this.server.receiveOperation(b.revision,f);if(!d){console.log("there is some problem on revision of history");return}a.data=d.wrapped.toJSON();a.meta=d.meta}return a}catch(n){console.log("ERROR "+n),roles.isTeacher()&&(this.myOTrequestData=1,virtualclass[a.et].responseToRequest())}};
this.processOp=function(a){if(1!==this.myrequestData&&1!==this.myOTrequestData)try{var c=a.message;c.hasOwnProperty("edFrom")&&(a.fromUser.userid=c.edFrom);c.hasOwnProperty("eddata")?"virtualclass-editor-cursor"==c.eddata?this.trigger("cursor",a.fromUser.userid,JSON.parse(c.data)):"selection"==c.eddata?this.trigger("selection",virtualclass.gObj.uid,c.data):"virtualclass-editor-operation"==c.eddata&&(this.trigger("operation",c.data),this.trigger("cursor",a.fromUser.userid,c.meta),this.storeOperationIfStudent(c)):
console.log("Editor : processOP - No EDDATA")}catch(k){roles.hasAdmin()?(this.myOTrequestData=1,virtualclass[a.message.et].responseToRequest(),console.log("Teacher : send whlole editor data ")):(this.removeOperations(a),virtualclass[a.message.et].requestData(),this.myrequestData=1,console.log("Student : send whlole editor data "))}};this.storeOperationIfStudent=function(a){if(!roles.hasAdmin()){var b={};b.wrapped=c.TextOperation.fromJSON(a.data);b.meta=a.meta;this.server.operations.push(b)}};this.receivedMessage=
function(a){if(!virtualclass.isPlayMode||"object"!=typeof a.toUser){var c=a.message;if("t"!=a.fromUser.role&&"e"!=a.fromUser.role||c.hasOwnProperty("edFrom"))if(c.hasOwnProperty("edFrom")||"t"==a.fromUser.role||"e"==a.fromUser.role)if(c.edFrom==virtualclass.gObj.uid){if("virtualclass-editor-operation"==c.eddata)try{this.trigger("ack"),this.storeOperationIfStudent(c)}catch(k){1===ioMissingPackets.missRequestFlag&&(virtualclass[c.et].cmClient.revision--,this.processOp(a),console.log("Failed Acknolwdgement processOp()")),
console.log("ACK Too Late "+k)}}else this.processOp(a);else c=this.doOT(c),"undefined"!=typeof c&&(a.message=c,c.edFrom=a.fromUser.userid,this.preSend(c,!0));else if(roles.hasAdmin()){if("virtualclass-editor-operation"==c.eddata)try{this.trigger("ack")}catch(k){console.log("ACK Too Late "+k)}}else this.processOp(a)}};this.removeOperations=function(a){a=a.message.et;this.server.operations=[];this.server.document="";virtualclass[a].cmClient.revision=0;if(null!=c){var c=document.getElementById("virtualclassEditorRichBody");
c.parentNode.removeChild(c)}}}d.myrequestData=0;d.myOTrequestData=0;d.prototype.sendOperation=function(b,a,c,f){var d;"undefined"!=typeof f&&(d="richtext"==f?"editorRich":"editorCode");a={eddata:"virtualclass-editor-operation",data:JSON.stringify({revision:b,operation:a,cursor:c}),et:d,cf:"eddata"};console.log("from send operation "+b);this.beforeSend(a);console.log("send operation")};d.prototype.sendSelection=function(b){this.beforeSend({eddata:"selection",data:JSON.stringify(b),cf:"eddata"})};d.prototype.sendCursor=
function(b){this.beforeSend({eddata:"virtualclass-editor-cursor",data:JSON.stringify(b),cf:"eddata"})};d.prototype.registerCallbacks=function(b){this.callbacks=b};d.prototype.beforeSend=function(b){if(1!=this.myrequestData)if(roles.hasAdmin())this.teacherOT(b);else{var a=virtualclass.vutil.whoIsTeacher();b=this.setEditorTypeOnPacket(b);ioAdapter.mustSendUser(b,a)}};d.prototype.setEditorTypeOnPacket=function(b){if(b.hasOwnProperty("eddata")&&"initVcEditor"!=b.eddata&&"virtualclass-editor-operation"!=
b.eddata)if("EditorRich"==virtualclass.currApp||"editorRich"==virtualclass.currApp)b.et="editorRich";else if("EditorCode"==virtualclass.currApp||"editorCode"==virtualclass.currApp)b.et="editorCode";return b};d.prototype.preSend=function(b,a){b=this.setEditorTypeOnPacket(b);"undefined"==typeof a||0==a||null==a?ioAdapter.mustSend(b):setTimeout(function(){ioAdapter.mustSendAll(b)},300)};return d}();var Vceditor=function(){var d=d||{};d.utils=window.utils;d=d||{};d.Span=window.Span;d.TextOp=window.TextOp;d.TextOperation=window.TextOperation;"object"===typeof module&&(module.exports=d.TextOperation);d.AnnotationList=window.AnnotationList;d.Cursor=window.Cursor;d.RichTextToolbar=window.RichTextToolbar;d.WrappedOperation=window.WrappedOperation;d.UndoManager=window.UndoManager;d.Client=window.Client;Client=d.Client;d.EditorClient=window.EditorClient;d.utils.makeEventEmitter(d.EditorClient,["synced"]);
d.AttributeConstants=window.AttributeConstants;d.sentinelConstants={LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};d.EntityManager=function(){function b(){this.entities_={};var c="src alt width height style class".split(" ");this.register("img",{render:function(c){a.assert(c.src,"image entity should have 'src'!");for(var b="src alt width height style class".split(" "),f="<img ",d=0;d<b.length;d++){var n=b[d];n in c&&(f+=" "+n+'="'+c[n]+'"')}return f+">"},fromElement:function(a){for(var b=
{},f=0;f<c.length;f++){var d=c[f];a.hasAttribute(d)&&(b[d]=a.getAttribute(d))}return b}})}var a=d.utils;b.prototype.register=function(a,b){d.utils.assert(b.render,"Entity options should include a 'render' function!");d.utils.assert(b.fromElement,"Entity options should include a 'fromElement' function!");this.entities_[a]=b};b.prototype.renderToElement=function(a,b){return this.tryRenderToElement_(a,"render",b)};b.prototype.exportToElement=function(a){var c=this.tryRenderToElement_(a,"export")||this.tryRenderToElement_(a,
"getHtml")||this.tryRenderToElement_(a,"render");c.setAttribute("data-vceditor-entity",a.type);return c};b.prototype.updateElement=function(a,b){var c=a.type;a=a.info;this.entities_[c]&&"undefined"!=typeof this.entities_[c].update&&this.entities_[c].update(a,b)};b.prototype.fromElement=function(a){var c=a.getAttribute("data-vceditor-entity");c||(c=a.nodeName.toLowerCase());if(c&&this.entities_[c])return a=this.entities_[c].fromElement(a),new d.Entity(c,a)};b.prototype.tryRenderToElement_=function(a,
b,g){var c=a.type;a=a.info;if(this.entities_[c]&&this.entities_[c][b]&&(b=this.entities_[c][b](a,g,d.document||window&&window.document))){if("string"===typeof b)return c=(d.document||document).createElement("div"),c.innerHTML=b,c.childNodes[0];if("object"===typeof b)return d.utils.assert("undefined"!==typeof b.nodeType,"Error rendering "+c+" entity.  render() function must return an html string or a DOM element."),b}};b.prototype.entitySupportsUpdate=function(a){return this.entities_[a]&&this.entities_[a].update};
return b}();d=d||{};d.Entity=window.entity;d.Entity=function(){function b(a,c){if(!(this instanceof b))return new b(a,c);this.type=a;this.info=c||{}}var a=d.AttributeConstants.ENTITY_SENTINEL,c=a+"_";b.prototype.toAttributes=function(){var b={};b[a]=this.type;for(var d in this.info)b[c+d]=this.info[d];return b};b.fromAttributes=function(f){var d=f[a],k={},m;for(m in f)0===m.indexOf(c)&&(k[m.substr(c.length)]=f[m]);return new b(d,k)};return b}();d.RichTextCodeMirror=function(){function b(a,c,b){this.codeMirror=
a;this.options_=b||{};this.entityManager_=c;this.currentAttributes_=null;var f=this;this.annotationList_=new k(function(a,c){f.onAnnotationsChanged_(a,c)});this.initAnnotationList_();g(this,"onCodeMirrorBeforeChange_");g(this,"onCodeMirrorChange_");g(this,"onCursorActivity_");if(/^4\./.test(CodeMirror.version))this.codeMirror.on("changes",this.onCodeMirrorChange_);else this.codeMirror.on("change",this.onCodeMirrorChange_);this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.on("cursorActivity",
this.onCursorActivity_);this.changeId_=0;this.outstandingChanges_={};this.dirtyLines_=[]}function a(a,c){return a.line-c.line||a.ch-c.ch}function c(a){if(0===a.length)return 0;for(var c=0,b=0;b<a.length;b++)c+=a[b].length;return c+a.length-1}function f(a){this.attributes=a||{}}function g(a,c){var b=a[c];a[c]=function(){b.apply(a,arguments)}}var k=d.AnnotationList,m=d.Span,n=d.utils,p=d.AttributeConstants,v={c:"color",bc:"background-color",fs:"font-size",li:function(a){return"padding-left: "+40*a+
"px"}},u={};n.makeEventEmitter(b,["change","attributesChange","newLine"]);var q=d.sentinelConstants.LINE_SENTINEL_CHARACTER,r=d.sentinelConstants.ENTITY_SENTINEL_CHARACTER;b.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.off("change",this.onCodeMirrorChange_);this.codeMirror.off("changes",this.onCodeMirrorChange_);this.codeMirror.off("cursorActivity",this.onCursorActivity_);this.clearAnnotations_()};b.prototype.toggleAttribute=function(a,
c){c=c||!0;if(this.emptySelection_()){var b=this.getCurrentAttributes_();b[a]===c?delete b[a]:b[a]=c;this.currentAttributes_=b}else c=this.getCurrentAttributes_()[a]!==c?c:!1,this.setAttribute(a,c)};b.prototype.setAttribute=function(a,c){var b=this.codeMirror;this.emptySelection_()?(b=this.getCurrentAttributes_(),!1===c?delete b[a]:b[a]=c,this.currentAttributes_=b):(this.updateTextAttributes(b.indexFromPos(b.getCursor("start")),b.indexFromPos(b.getCursor("end")),function(b){!1===c?delete b[a]:b[a]=
c}),this.updateCurrentAttributes_())};b.prototype.updateTextAttributes=function(a,c,b,d,g){var k=[],n=a,t=this;this.annotationList_.updateSpan(new m(a,c-a),function(a,c){var m={};for(A in a.attributes)m[A]=a.attributes[A];m[p.LINE_SENTINEL]&&!g||b(m);var A={};var q={};t.computeChangedAttributes_(a.attributes,m,A,q);a:{for(var r in A){a=!1;break a}a=!0}a||k.push({start:n,end:n+c,attributes:A,attributesInverse:q,origin:d});n+=c;return new f(m)});0<k.length&&this.trigger("attributesChange",this,k)};
b.prototype.computeChangedAttributes_=function(a,c,b,f){var d={},g;for(g in a)d[g]=!0;for(g in c)d[g]=!0;for(g in d)g in c?g in a?a[g]!==c[g]&&(b[g]=c[g],f[g]=a[g]):(b[g]=c[g],f[g]=!1):(b[g]=!1,f[g]=a[g])};b.prototype.toggleLineAttribute=function(a,c){var b=this.getCurrentLineAttributes_();this.setLineAttribute(a,a in b&&b[a]===c?!1:c)};b.prototype.setLineAttribute=function(a,c){this.updateLineAttributesForSelection(function(b){!1===c?delete b[a]:b[a]=c})};b.prototype.updateLineAttributesForSelection=
function(a){var c=this.codeMirror,b=c.getCursor("start"),f=c.getCursor("end");b=b.line;var d=f.line;c=c.getLine(d);f=this.areLineSentinelCharacters_(c.substr(0,f.ch));d>b&&f&&d--;this.updateLineAttributes(b,d,a)};b.prototype.updateLineAttributes=function(a,c,b){for(;a<=c;a++){var f=this.codeMirror.getLine(a),d=this.codeMirror.indexFromPos({line:a,ch:0});f[0]!==q?(f={},f[p.LINE_SENTINEL]=!0,b(f),this.insertText(d,q,f)):this.updateTextAttributes(d,d+1,b,null,!0)}};b.prototype.replaceText=function(a,
c,b,f,d){this.changeId_++;var g="cmrt-"+this.changeId_;this.outstandingChanges_[g]={origOrigin:d,attributes:f};f=this.codeMirror;a=f.posFromIndex(a);c="number"===typeof c?f.posFromIndex(c):null;f.replaceRange(b,a,c,g)};b.prototype.insertText=function(a,c,b,f){var d=this.codeMirror,g=d.getCursor(),k="RTCMADAPTER"==f&&!d.somethingSelected()&&a==d.indexFromPos(g);this.replaceText(a,null,c,b,f);k&&d.setCursor(g)};b.prototype.removeText=function(a,c,b){var f=this.codeMirror;f.replaceRange("",f.posFromIndex(a),
f.posFromIndex(c),b)};b.prototype.insertEntityAtCursor=function(a,c,b){var f=this.codeMirror;f=f.indexFromPos(f.getCursor("head"));this.insertEntityAt(f,a,c,b)};b.prototype.insertEntityAt=function(a,c,b,f){this.insertEntity_(a,new d.Entity(c,b),f)};b.prototype.insertEntity_=function(a,c,b){this.replaceText(a,null,r,c.toAttributes(),b)};b.prototype.getAttributeSpans=function(a,c){var b=[];a=this.annotationList_.getAnnotatedSpansForSpan(new m(a,c-a));for(c=0;c<a.length;c++)b.push({length:a[c].length,
attributes:a[c].annotation.attributes});return b};b.prototype.end=function(){var a=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:a,ch:this.codeMirror.getLine(a).length})};b.prototype.getRange=function(a,c){a=this.codeMirror.posFromIndex(a);c=this.codeMirror.posFromIndex(c);return this.codeMirror.getRange(a,c)};b.prototype.initAnnotationList_=function(){var a=this.end();0!==a&&this.annotationList_.insertAnnotatedSpan(new m(0,a),new f)};b.prototype.onAnnotationsChanged_=function(a,
c){var b,f={};this.tryToUpdateEntitiesInPlace(a,c);for(var d=0;d<a.length;d++)p.LINE_SENTINEL in a[d].annotation.attributes&&(f[this.codeMirror.posFromIndex(a[d].pos).line]=!0),(b=a[d].getAttachedObject())&&b.clear();for(d=0;d<c.length;d++){b=c[d].annotation;var g=p.LINE_SENTINEL in b.attributes,k=p.ENTITY_SENTINEL in b.attributes;a=this.codeMirror.posFromIndex(c[d].pos);g?f[a.line]=!0:k?this.markEntity_(c[d]):(b=this.getClassNameForAttributes_(b.attributes),""!==b&&(g=this.codeMirror.posFromIndex(c[d].pos+
c[d].length),b=this.codeMirror.markText(a,g,{className:b}),c[d].attachObject(b)))}for(var m in f)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(m))),this.queueLineMarking_()};b.prototype.tryToUpdateEntitiesInPlace=function(a,c){for(var b=a.length;b--;)for(var f=a[b],d=c.length;d--;){var g=c[d];if(f.pos==g.pos&&f.annotation.attributes.ent&&f.annotation.attributes.ent==g.annotation.attributes.ent&&this.entityManager_.entitySupportsUpdate(g.annotation.attributes.ent)){a.splice(b,1);c.splice(d,
1);var k=f.getAttachedObject();k.update(g.annotation.attributes);g.attachObject(k)}}};b.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var a=this;this.lineMarkTimeout_=setTimeout(function(){a.lineMarkTimeout_=null;for(var c=[],b=0;b<a.dirtyLines_.length;b++){var f=a.codeMirror.getLineNumber(a.dirtyLines_[b]);c.push(Number(f))}a.dirtyLines_=[];c.sort(function(a,c){return a-c});f=-1;for(b=0;b<c.length;b++){var d=c[b];d>f&&(f=a.markLineSentinelCharactersForChangedLines_(d,d))}},
0)}};b.prototype.addStyleWithCSS_=function(a){var c=document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));c.appendChild(b)};b.prototype.getClassNameForAttributes_=function(a){var c="",b;for(b in a){var f=a[b];if(b===p.LINE_SENTINEL)d.utils.assert(!0===f,"LINE_SENTINEL attribute should be true if it exists.");else{var g=(this.options_.cssPrefix||"cmrt-")+b;if(!0!==f){b===p.FONT_SIZE&&
"string"!==typeof f&&(f+="px");var k=f.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-");g+="-"+k;v[b]&&(u[b]||(u[b]={}),u[b][k]||(u[b][k]=!0,k=v[b],f="function"===typeof k?k(f):k+": "+f,this.addStyleWithCSS_((b==p.LINE_INDENT?"pre."+g:"."+g)+" { "+f+" }")))}c=c+" "+g}}return c};b.prototype.markEntity_=function(a){for(var c=d.Entity.fromAttributes(a.annotation.attributes),b=this.codeMirror,f=this,g=[],k=0;k<a.length;k++){var m=b.posFromIndex(a.pos+k),n=b.posFromIndex(a.pos+k+1),p={collapsed:!0,
atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},q=this.createEntityHandle_(c,a.pos),t=this.entityManager_.renderToElement(c,q);t&&(p.replacedWith=t);m=b.markText(m,n,p);g.push(m);q.setMarker(m)}a.attachObject({clear:function(){for(var a=0;a<g.length;a++)g[a].clear()},update:function(a){a=d.Entity.fromAttributes(a);for(var c=0;c<g.length;c++)f.entityManager_.updateElement(a,g[c].replacedWith)}});this.queueRefresh_()};b.prototype.queueRefresh_=function(){var a=this;this.refreshTimer_||(this.refreshTimer_=
setTimeout(function(){a.codeMirror.refresh();a.refreshTimer_=null},0))};b.prototype.createEntityHandle_=function(a,c){function b(){if(f){var a=f.find();return a?g.codeMirror.indexFromPos(a.from):null}return c}var f=null,g=this;return{find:b,remove:function(){var a=b();null!=a&&(g.codeMirror.focus(),g.removeText(a,a+1))},replace:function(c){var f=d.AttributeConstants.ENTITY_SENTINEL,k=f+"_",m=b();g.updateTextAttributes(m,m+1,function(b){for(var d in b)delete b[d];b[f]=a.type;for(var g in c)b[k+g]=
c[g]})},setMarker:function(a){f=a}}};b.prototype.lineClassRemover_=function(a){var c=this.codeMirror,b=c.getLineHandle(a);return{clear:function(){c.removeLineClass(b,"text",".*")}}};b.prototype.emptySelection_=function(){var a=this.codeMirror.getCursor("start"),c=this.codeMirror.getCursor("end");return a.line===c.line&&a.ch===c.ch};b.prototype.onCodeMirrorBeforeChange_=function(a,c){if("+input"===c.origin||"paste"===c.origin){a=[];for(var b=0;b<c.text.length;b++){var f=c.text[b];f=f.replace(new RegExp("["+
q+r+"]","g"),"");a.push(f)}c.update(c.from,c.to,a)}};b.prototype.onCodeMirrorChange_=function(a,c){if("object"===typeof c.from){for(a=[];c;)a.push(c),c=c.next;c=a}a=this.convertCoordinateSystemForChanges_(c);for(var b=[],d=0;d<a.length;d++){var g=a[d],k=g.start,n=g.text,p=g.removed,q=g.origin;if(0<p.length){for(var r=this.annotationList_.getAnnotatedSpansForSpan(new m(k,p.length)),t=0,u=0;u<r.length;u++){var v=r[u];b.push({start:k,end:k+v.length,removedAttributes:v.annotation.attributes,removed:p.substr(t,
v.length),attributes:{},text:"",origin:g.origin});t+=v.length}this.annotationList_.removeSpan(new m(k,p.length))}0<n.length&&("+input"===g.origin||"paste"===g.origin?g=this.currentAttributes_||{}:q in this.outstandingChanges_?(g=this.outstandingChanges_[q].attributes,q=this.outstandingChanges_[q].origOrigin,delete this.outstandingChanges_[q]):g={},this.annotationList_.insertAnnotatedSpan(new m(k,n.length),new f(g)),b.push({start:k,end:k,removedAttributes:{},removed:"",text:n,attributes:g,origin:q}))}this.markLineSentinelCharactersForChanges_(c);
0<b.length&&this.trigger("change",this,b)};b.prototype.convertCoordinateSystemForChanges_=function(b){function f(b,f){return function(d){if(0>=a(d,f.from))return b(d);if(0>=a(f.to,d)){var g=d.line+f.text.length-1-(f.to.line-f.from.line);if(f.to.line<d.line)d=d.ch;else if(1>=f.text.length)d=d.ch-(f.to.ch-f.from.ch)+c(f.text);else{var k=f.text;d=d.ch-f.to.ch+k[k.length-1].length}return b({line:g,ch:d})+c(f.removed)-c(f.text)}return f.from.line===d.line?b(f.from)+d.ch-f.from.ch:b(f.from)+c(f.removed.slice(0,
d.line-f.from.line))+1+d.ch}}for(var d=this,g=function(a){return d.codeMirror.indexFromPos(a)},k=[],m=b.length-1;0<=m;m--){var n=b[m];g=f(g,n);var p=g(n.from),q=n.removed.join("\n"),r=n.text.join("\n");k.unshift({start:p,end:p+q.length,removed:q,text:r,origin:n.origin})}return k};b.prototype.markLineSentinelCharactersForChanges_=function(a){for(var c=Number.MAX_VALUE,b=-1,f=0;f<a.length;f++){var d=a[f],g=d.from.line;if(1<d.removed.length||0<=d.removed[0].indexOf(q))c=Math.min(c,g),b=Math.max(b,g);
1<d.text.length?(c=Math.min(c,g),b=Math.max(b,g+d.text.length-1)):0<=d.text[0].indexOf(q)&&(c=Math.min(c,g),b=Math.max(b,g))}b=Math.min(b,this.codeMirror.lineCount()-1);this.markLineSentinelCharactersForChangedLines_(c,b)};b.prototype.markLineSentinelCharactersForChangedLines_=function(a,c){if(a<Number.MAX_VALUE)for(;0<a&&this.lineIsListItemOrIndented_(a-1);)a--;if(-1<c)for(var b=this.codeMirror.lineCount();c+1<b&&this.lineIsListItemOrIndented_(c+1);)c++;b=[];for(var f=this.codeMirror;a<=c;a++){var d=
f.getLine(a),g=f.getLineHandle(a);f.removeLineClass(g,"text",".*");if(0<d.length)for(g=d.indexOf(q);0<=g;){for(var k=g;g<d.length&&d[g]===q;){for(var m=f.findMarksAt({line:a,ch:g}),n=0;n<m.length;n++)m[n].isForLineSentinel&&m[n].clear();g++}this.markLineSentinelCharacters_(a,k,g,b);g=d.indexOf(q,g)}else b=[]}return c};b.prototype.markLineSentinelCharacters_=function(a,c,b,f){var d=this.codeMirror,g=null,k=null,m=function(){var a=k.find();return a?a.from.line:null};if(0===c){var n=this.getLineAttributes_(a),
q=n[p.LIST_TYPE],r=n[p.LINE_INDENT]||0;for(q&&0===r&&(r=1);r>=f.length;)f.push(1);"o"===q?(g=this.makeOrderedListElement_(f[r]),f[r]++):"u"===q?(g=this.makeUnorderedListElement_(),f[r]=1):"t"===q?(g=this.makeTodoListElement_(!1,m),f[r]=1):"tc"===q&&(g=this.makeTodoListElement_(!0,m),f[r]=1);m=this.getClassNameForAttributes_(n);""!==m&&this.codeMirror.addLineClass(a,"text",m);f=f.slice(0,r+1)}f={inclusiveLeft:!0,collapsed:!0};g&&(f.replacedWith=g);k=d.markText({line:a,ch:c},{line:a,ch:b},f);k.isForLineSentinel=
!0};b.prototype.makeOrderedListElement_=function(a){return n.elt("div",a+".",{"class":"vceditor-list-left"})};b.prototype.makeUnorderedListElement_=function(){return n.elt("div","\u2022",{"class":"vceditor-list-left"})};b.prototype.toggleTodo=function(a){var c=p.LIST_TYPE,b=this.getCurrentLineAttributes_(),f;c in b&&("t"===b[c]||"tc"===b[c])?"t"===b[c]?f="tc":"tc"===b[c]&&(f=a?"t":!1):f="t";this.setLineAttribute(c,f)};b.prototype.makeTodoListElement_=function(a,c){var b={type:"checkbox","class":"vceditor-todo-left"};
a&&(b.checked=!0);a=n.elt("input",!1,b);var f=this;n.on(a,"click",n.stopEventAnd(function(a){f.codeMirror.setCursor({line:c(),ch:1});f.toggleTodo(!0)}));return a};b.prototype.lineIsListItemOrIndented_=function(a){a=this.getLineAttributes_(a);return!1!==(a[p.LIST_TYPE]||!1)||0!==(a[p.LINE_INDENT]||0)};b.prototype.onCursorActivity_=function(){var a=this;clearTimeout(a.cursorTimeout);a.cursorTimeout=setTimeout(function(){a.updateCurrentAttributes_()},1)};b.prototype.getCurrentAttributes_=function(){this.currentAttributes_||
this.updateCurrentAttributes_();return this.currentAttributes_};b.prototype.updateCurrentAttributes_=function(){var a=this.codeMirror;var c=a.indexFromPos(a.getCursor("anchor"));var b=a.indexFromPos(a.getCursor("head"));a=b;if(c>b){for(;a<this.end();){c=this.getRange(a,a+1);if("\n"!==c&&c!==q)break;a++}a<this.end()&&a++}else for(;0<a;){c=this.getRange(a-1,a);if("\n"!==c&&c!==q)break;a--}c=this.annotationList_.getAnnotatedSpansForPos(a);this.currentAttributes_={};a={};0<c.length&&!(p.LINE_SENTINEL in
c[0].annotation.attributes)?a=c[0].annotation.attributes:1<c.length&&(d.utils.assert(!(p.LINE_SENTINEL in c[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),a=c[1].annotation.attributes);for(var f in a)"l"!==f&&"lt"!==f&&"li"!==f&&0!==f.indexOf(p.ENTITY_SENTINEL)&&(this.currentAttributes_[f]=a[f])};b.prototype.getCurrentLineAttributes_=function(){var a=this.codeMirror,c=a.getCursor("anchor");a=a.getCursor("head");var b=a.line;0===a.ch&&c.line<a.line&&b--;return this.getLineAttributes_(b)};
b.prototype.getLineAttributes_=function(a){var c={},b=this.codeMirror.getLine(a);if(0<b.length&&b[0]===q){a=this.codeMirror.indexFromPos({line:a,ch:0});a=this.annotationList_.getAnnotatedSpansForSpan(new m(a,1));d.utils.assert(1===a.length);for(var f in a[0].annotation.attributes)c[f]=a[0].annotation.attributes[f]}return c};b.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new m(0,this.end()),function(a,c){return new f({})})};b.prototype.newline=function(){var a=this.codeMirror,
c=this;if(this.emptySelection_()){var b=a.getCursor("head").line,f=this.getLineAttributes_(b),d=f[p.LIST_TYPE];d&&1===a.getLine(b).length?this.updateLineAttributes(b,b,function(a){delete a[p.LIST_TYPE];delete a[p.LINE_INDENT]}):(a.replaceSelection("\n","end","+input"),this.updateLineAttributes(b+1,b+1,function(a){for(var g in f)a[g]=f[g];"tc"===d&&(a[p.LIST_TYPE]="t");c.trigger("newLine",{line:b+1,attr:a})}))}else a.replaceSelection("\n","end","+input")};b.prototype.deleteLeft=function(){var a=this.codeMirror,
c=a.getCursor("head"),b=this.getLineAttributes_(c.line),f=b[p.LIST_TYPE];b=b[p.LINE_INDENT];var d=this.emptySelection_()&&1===c.ch;d&&f?this.updateLineAttributes(c.line,c.line,function(a){delete a[p.LIST_TYPE];delete a[p.LINE_INDENT]}):d&&b&&0<b?this.updateLineAttributes(c.line,c.line,function(a){a[p.LINE_INDENT]--}):a.deleteH(-1,"char")};b.prototype.deleteRight=function(){var a=this.codeMirror,c=a.getCursor("head"),b=a.getLine(c.line);b=this.areLineSentinelCharacters_(b);var f=c.line+1<a.lineCount()?
a.getLine(c.line+1):"";this.emptySelection_()&&b&&f[0]===q?a.replaceRange("",{line:c.line,ch:0},{line:c.line+1,ch:0},"+input"):a.deleteH(1,"char")};b.prototype.indent=function(){this.updateLineAttributesForSelection(function(a){var c=a[p.LIST_TYPE];a[p.LINE_INDENT]?a[p.LINE_INDENT]++:a[p.LINE_INDENT]=c?2:1})};b.prototype.unindent=function(){this.updateLineAttributesForSelection(function(a){var c=a[p.LINE_INDENT];c&&1<c?a[p.LINE_INDENT]=c-1:(delete a[p.LIST_TYPE],delete a[p.LINE_INDENT])})};b.prototype.getText=
function(){return this.codeMirror.getValue().replace(new RegExp(q,"g"),"")};b.prototype.areLineSentinelCharacters_=function(a){for(var c=0;c<a.length;c++)if(a[c]!==q)return!1;return!0};f.prototype.equals=function(a){if(!(a instanceof f))return!1;for(var c in this.attributes)if(a.attributes[c]!==this.attributes[c])return!1;for(c in a.attributes)if(a.attributes[c]!==this.attributes[c])return!1;return!0};return b}();d=d||{};d.RichTextCodeMirrorAdapter=window.RichTextCodeMirrorAdapter;d=d||{};d.Formatting=
function(){function b(a){if(!(this instanceof b))return new b(a);this.attributes=a||{}}var a=d.AttributeConstants;b.prototype.cloneWithNewAttribute_=function(a,f){var c={},d;for(d in this.attributes)c[d]=this.attributes[d];!1===f?delete c[a]:c[a]=f;return new b(c)};b.prototype.bold=function(c){return this.cloneWithNewAttribute_(a.BOLD,c)};b.prototype.italic=function(c){return this.cloneWithNewAttribute_(a.ITALIC,c)};b.prototype.underline=function(c){return this.cloneWithNewAttribute_(a.UNDERLINE,
c)};b.prototype.strike=function(c){return this.cloneWithNewAttribute_(a.STRIKE,c)};b.prototype.font=function(c){return this.cloneWithNewAttribute_(a.FONT,c)};b.prototype.fontSize=function(c){return this.cloneWithNewAttribute_(a.FONT_SIZE,c)};b.prototype.color=function(c){return this.cloneWithNewAttribute_(a.COLOR,c)};b.prototype.backgroundColor=function(c){return this.cloneWithNewAttribute_(a.BACKGROUND_COLOR,c)};return b}();d=d||{};d.Text=function(){function b(a,c){if(!(this instanceof b))return new b(a,
c);this.text=a;this.formatting=c||d.Formatting()}return b}();d.LineFormatting=window.LineFormatting;d.Line=function(){function b(a,c){if(!(this instanceof b))return new b(a,c);"[object Array]"!==Object.prototype.toString.call(a)&&(a="undefined"===typeof a?[]:[a]);this.textPieces=a;this.formatting=c||d.LineFormatting()}return b}();d.ParseHtml=window.ParseHtml;d.SerializeHtml=window.SerializeHtml;d.textPiecesToInserts=function(b,a){function c(a,c){a instanceof d.Text&&(c=a.formatting.attributes,a=a.text);
g.push({string:a,attributes:c});b="\n"===a[a.length-1]}function f(a){b&&c(d.sentinelConstants.LINE_SENTINEL_CHARACTER,a.formatting.attributes);for(var f=0;f<a.textPieces.length;f++)c(a.textPieces[f]);c("\n")}for(var g=[],k=0;k<a.length;k++)a[k]instanceof d.Line?f(a[k]):c(a[k]);return g};d=d||{};d.Vceditor=function(b){function a(b,f,d,g){if(!(this instanceof a))return new a(b,f,d,g);if(!t&&!B)throw Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");if(t&&
f instanceof t)this.codeMirror_=this.editor_=f,b=this.codeMirror_.getValue(),""!==b&&console.log("Can't initialize Vceditor with a CodeMirror instance that already contains text.");else if(B&&f&&f.session instanceof B.EditSession){if(this.ace_=this.editor_=f,b=this.ace_.getValue(),""!==b)throw Error("Can't initialize Vceditor with an ACE instance that already contains text.");}else this.codeMirror_=this.editor_=new t(f);b=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_=
r.elt("div",null,{"class":"vceditor"});b.parentNode.replaceChild(this.vcEditorWrapper_,b);this.vcEditorWrapper_.appendChild(b);r.on(b,"dragstart",r.stopEvent);this.editor_.vceditor=this;this.options_=d||{};this.getOption("richTextShortcuts",!1)&&(t.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.vcEditorWrapper_.className+=" vceditor-richtext");this.imageInsertionUI=this.getOption("imageInsertionUI",!0);this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),
this.vcEditorWrapper_.className+=" vceditor-richtext vceditor-with-toolbar");this.addPoweredByLogo_();this.codeMirror_&&this.codeMirror_.refresh();this.getOption("userColor",c("JqrwCaZm29-CLg-Pfz2"));this.entityManager_=new u;b=g.revision;f=[];this.codeMirror_?(this.richTextCodeMirror_=new m(this.codeMirror_,this.entityManager_,{cssPrefix:"vceditor-"}),this.editorAdapter_=new k(this.richTextCodeMirror_)):this.editorAdapter_=new p(this.ace_);d.hasOwnProperty("richTextToolbar")?(virtualclass.editorRich.vcAdapter=
new otAdapter(g,"EditorRich"),virtualclass.editorRich.cmClient=new v(b,f,virtualclass.editorRich.vcAdapter,this.editorAdapter_)):(virtualclass.editorCode.vcAdapter=new otAdapter(g,"EditorCode"),virtualclass.editorCode.cmClient=new v(b,f,virtualclass.editorCode.vcAdapter,this.editorAdapter_));"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var a=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";
c.styleSheet.cssText=":before,:after{content:none !important;}";a.appendChild(c);setTimeout(function(){a.removeChild(c)},0)})}function c(a){for(var c=1,b=0;b<a.length;b++)c=17*(c+a.charCodeAt(b))%360;return g(c/360,1,.85)}function f(a,c,b){function f(a){a=Math.round(255*a).toString(16);return 1===a.length?"0"+a:a}return"#"+f(a)+f(c)+f(b)}function g(a,c,b){if(0===c)return f(b,b,b);var d=.5>b?b*(1+c):b+c-c*b,g=2*b-d;c=function(a){0>a&&(a+=1);1<a&&--a;return 1>6*a?g+6*(d-g)*a:1>2*a?d:2>3*a?g+6*(d-g)*
(2/3-a):g};return f(c(a+1/3),c(a),c(a-1/3))}if(!d.RichTextCodeMirrorAdapter)throw Error("Oops! It looks like you're trying to include lib/vceditor.js directly.  This is actually one of many source files that make up vceditor.  You want dist/vceditor.js instead.");var k=d.RichTextCodeMirrorAdapter,m=d.RichTextCodeMirror,n=d.RichTextToolbar,p=d.ACEAdapter,v=d.EditorClient,u=d.EntityManager,q=d.AttributeConstants,r=d.utils,t=b.CodeMirror,B=b.ace;r.makeEventEmitter(a);a.fromCodeMirror=a;a.fromACE=a;a.prototype.dispose=
function(){this.zombie_=!0;var a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_.removeChild(a);this.vcEditorWrapper_.parentNode.replaceChild(a,this.vcEditorWrapper_);this.editor_.vceditor=null;this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default");this.vcAdapter.dispose();this.editorAdapter_.detach();this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()};a.prototype.setUserId=function(a){this.vcAdapter.setUserId(a)};
a.prototype.setUserColor=function(a){this.vcAdapter.setColor(a)};a.prototype.getText=function(){this.assertReady_("getText");return this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()};a.prototype.setText=function(a){if(this.ace_)return this.ace_.getSession().getDocument().setValue(a);this.codeMirror_.getWrapperElement().setAttribute("style","display: none");this.codeMirror_.setValue("");this.insertText(0,a);this.codeMirror_.getWrapperElement().setAttribute("style",
"");this.codeMirror_.refresh()};a.prototype.insertTextAtCursor=function(a){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};a.prototype.insertText=function(a,c){r.assert(!this.ace_,"Not supported for ace yet.");this.assertReady_("insertText");"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);c=d.textPiecesToInserts(0===a,c);for(var b=0;b<c.length;b++){var f=c[b].string;this.richTextCodeMirror_.insertText(a,f,c[b].attributes);a+=f.length}};a.prototype.getOperationForSpan=
function(a,c){var b=this.richTextCodeMirror_.getRange(a,c);a=this.richTextCodeMirror_.getAttributeSpans(a,c);c=0;for(var f=new d.TextOperation,g=0;g<a.length;g++)f.insert(b.substr(c,a[g].length),a[g].attributes),c+=a[g].length;return f};a.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)};a.prototype.getHtmlFromSelection=function(){var a=this.codeMirror_.getCursor("start"),c=this.codeMirror_.getCursor("end");a=this.codeMirror_.indexFromPos(a);c=this.codeMirror_.indexFromPos(c);
return this.getHtmlFromRange(a,c)};a.prototype.getHtmlFromRange=function(a,c){a=null!=a&&null!=c?this.getOperationForSpan(a,c):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return d.SerializeHtml(a,this.entityManager_)};a.prototype.insertHtml=function(a,c){c=d.ParseHtml(c,this.entityManager_);this.insertText(a,c)};a.prototype.insertHtmlAtCursor=function(a){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};a.prototype.setHtml=function(a){a=d.ParseHtml(a,
this.entityManager_);this.setText(a)};a.prototype.isHistoryEmpty=function(){this.assertReady_("isHistoryEmpty");return this.vcAdapter.isHistoryEmpty()};a.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(q.BOLD);this.codeMirror_.focus()};a.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(q.ITALIC);this.codeMirror_.focus()};a.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(q.UNDERLINE);this.codeMirror_.focus()};a.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(q.STRIKE);
this.codeMirror_.focus()};a.prototype.fontSize=function(a){this.richTextCodeMirror_.setAttribute(q.FONT_SIZE,a);this.codeMirror_.focus()};a.prototype.font=function(a){this.richTextCodeMirror_.setAttribute(q.FONT,a);this.codeMirror_.focus()};a.prototype.color=function(a){this.richTextCodeMirror_.setAttribute(q.COLOR,a);this.codeMirror_.focus()};a.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(q.BACKGROUND_COLOR,"rgba(255,255,0,.65)");this.codeMirror_.focus()};a.prototype.align=
function(a){if("left"!==a&&"center"!==a&&"right"!==a)throw Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(q.LINE_ALIGN,a);this.codeMirror_.focus()};a.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(q.LIST_TYPE,"o");this.codeMirror_.focus()};a.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(q.LIST_TYPE,"u");this.codeMirror_.focus()};a.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo();
this.codeMirror_.focus()};a.prototype.newline=function(){this.richTextCodeMirror_.newline()};a.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()};a.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()};a.prototype.indent=function(){this.richTextCodeMirror_.indent();this.codeMirror_.focus()};a.prototype.unindent=function(){this.richTextCodeMirror_.unindent();this.codeMirror_.focus()};a.prototype.undo=function(){this.codeMirror_.undo()};a.prototype.redo=function(){this.codeMirror_.redo()};
a.prototype.insertEntity=function(a,c,b){this.richTextCodeMirror_.insertEntityAtCursor(a,c,b)};a.prototype.insertEntityAt=function(a,c,b,f){this.richTextCodeMirror_.insertEntityAt(a,c,b,f)};a.prototype.registerEntity=function(a,c){this.entityManager_.register(a,c)};a.prototype.getOption=function(a,c){return a in this.options_?this.options_[a]:c};a.prototype.assertReady_=function(a){if(!this.ready_)throw Error('You must wait for the "ready" event before calling '+a+".");if(this.zombie_)throw Error("You can't use a Vceditor after calling dispose()!");
};a.prototype.makeImageDialog_=function(){this.makeDialog_("img",virtualclass.lang.getString("InsertimageURL"))};a.prototype.makeDialog_=function(a,c){var b=this;c=r.elt("input",null,{"class":"vceditor-dialog-input",id:a,type:"text",placeholder:c,autofocus:"autofocus"});var f=r.elt("a","Submit",{"class":"vceditor-btn",id:"submitbtn"});r.on(f,"click",r.stopEventAnd(function(){var c=document.getElementById("overlay");c.style.visibility="hidden";var f=document.getElementById(a).value;f&&b.insertEntity(a,
{src:f});b.vcEditorWrapper_.removeChild(c)}));var d=r.elt("a","Cancel",{"class":"vceditor-btn"});r.on(d,"click",r.stopEventAnd(function(){var a=document.getElementById("overlay");a.style.visibility="hidden";b.vcEditorWrapper_.removeChild(a)}));f=r.elt("div",[f,d],{"class":"vceditor-btn-group"});c=r.elt("div",[c,f],{"class":"vceditor-dialog-div"});c=r.elt("div",[c],{"class":"vceditor-dialog",id:"overlay"});this.vcEditorWrapper_.appendChild(c)};a.prototype.addToolbar_=function(){this.toolbar=new n(this.imageInsertionUI);
this.toolbar.on("undo",this.undo,this);this.toolbar.on("redo",this.redo,this);this.toolbar.on("bold",this.bold,this);this.toolbar.on("italic",this.italic,this);this.toolbar.on("underline",this.underline,this);this.toolbar.on("strike",this.strike,this);this.toolbar.on("font-size",this.fontSize,this);this.toolbar.on("font",this.font,this);this.toolbar.on("color",this.color,this);this.toolbar.on("left",function(){this.align("left")},this);this.toolbar.on("center",function(){this.align("center")},this);
this.toolbar.on("right",function(){this.align("right")},this);this.toolbar.on("ordered-list",this.orderedList,this);this.toolbar.on("unordered-list",this.unorderedList,this);this.toolbar.on("todo-list",this.todo,this);this.toolbar.on("indent-increase",this.indent,this);this.toolbar.on("indent-decrease",this.unindent,this);this.toolbar.on("insert-image",this.makeImageDialog_,this);this.vcEditorWrapper_.insertBefore(this.toolbar.element(),this.vcEditorWrapper_.firstChild)};a.prototype.addPoweredByLogo_=
function(){};a.prototype.initializeKeyMap_=function(){function a(a){return function(c){setTimeout(function(){a.call(c.vceditor)},0)}}this.getOption("readOnly")?t.keyMap.richtext={fallthrough:["default"]}:t.keyMap.richtext={"Ctrl-B":a(this.bold),"Cmd-B":a(this.bold),"Ctrl-I":a(this.italic),"Cmd-I":a(this.italic),"Ctrl-U":a(this.underline),"Cmd-U":a(this.underline),"Ctrl-H":a(this.highlight),"Cmd-H":a(this.highlight),Enter:a(this.newline),Delete:a(this.deleteRight),Backspace:a(this.deleteLeft),Tab:a(this.indent),
"Shift-Tab":a(this.unindent),fallthrough:["default"]}};return a}(this);d.Vceditor.Formatting=d.Formatting;d.Vceditor.Text=d.Text;d.Vceditor.Entity=d.Entity;d.Vceditor.LineFormatting=d.LineFormatting;d.Vceditor.Line=d.Line;d.Vceditor.TextOperation=d.TextOperation;d.Vceditor.RichTextCodeMirrorAdapter=d.RichTextCodeMirrorAdapter;d.Server=Server;d.Vceditor.getvcEditor=function(){return d};return d.Vceditor}();window.Vceditor=Vceditor;(function(d){var b=function(a){return a.map(function(a){return{operation:a.wrapped.toJSON()}})},a=function(a){var c=Vceditor.getvcEditor();return a.map(function(a){return new c.WrappedOperation(c.TextOperation.fromJSON(a.operation),a.cursor&&c.Cursor.fromJSON(a.cursor))})};d.editor=function(c,f,d){this.etype=c;if("editorRich"==c){var g={lineWrapping:!0};var m={richTextToolbar:!0,richTextShortcuts:!0,readOnly:!1}}else g={lineNumbers:!0,mode:"markdown",readOnly:!1},m={defaultText:"Markdown Editor "};
return{etype:c,cm:"",vcAdapter:"",initialised:!1,prvEdRev:0,dataReqTry:0,stroageData:localStorage.getItem(this.etype+"_allEditorOperations"),tempstroageDataRev:localStorage.getItem(this.etype+"_edOperationRev"),readonly:!1,veryInit:function(){if(null!=this.stroageData&&""!=this.stroageData){this.stroageDataRev=null==this.tempstroageDataRev?0:this.tempstroageDataRev;var a=JSON.parse(this.stroageData);a=JSON.parse(a.data);console.log("Current Editor type "+virtualclass.currAppEditorType);virtualclass.hasOwnProperty("currAppEditor")?
virtualclass.currAppEditorType==this.etype?this.initialiseDataWithEditor(a,"displayEditor",virtualclass.currAppEditorType):this.initialiseDataWithEditor(a):this.initialiseDataWithEditor(a)}virtualclass.gObj.editorInitDone++},init:function(a,c,b,f){var d={};"undefined"!=typeof a&&(d.revision=a);"undefined"!=typeof c&&(d.clients=c);"undefined"!=typeof b&&(d.doc=b);"undefined"!=typeof f&&(d.operations=f);this.cm||"object"==typeof this.cm?virtualclass.dispvirtualclassLayout(virtualclass.currApp):(this.codemirrorWithLayout(g),
this.createEditorClient(m,d));roles.hasControls()?(roles.hasAdmin()&&this.createAllEditorController(),virtualclass.gObj.studentSSstatus.sharing||ioAdapter.mustSendAll({eddata:"init",et:this.etype,cf:"eddata"})):roles.hasAdmin()&&this.createAllEditorController()},createAllEditorController:function(){var a=this.etype,c="all"+a+"Container";if(null==document.getElementById(c)){console.log("For Enable all, Button is creating");var b,f=virtualclass.getTemplate("edenableall","editor")({type1:a});document.querySelector("#virtualclass"+
virtualclass.vutil.capitalizeFirstLetter(a)+"Body").insertAdjacentHTML("beforeend",f);f=document.getElementById(c+"Anch");var d=localStorage.getItem(a+"mode");null!==d&&("editorRich"==a&&"disable"==d||"editorCode"==a&&"disable"==d)&&(f.dataset.action="disable");console.log("Editor type "+a);f.addEventListener("click",function(){console.log("Editor type "+a+" clicked");var f=document.getElementById(c+"Anch");null!=f&&(b=f.dataset.action,"enable"==f.dataset.action?(f.dataset.action="disable",f.classList.remove("icon-collaboratecrose"),
f.classList.add("icon-collaborate"),f.parentNode.setAttribute("data-title",virtualclass.lang.getString("offcollaboration"))):(f.classList.remove("icon-collaborate"),f.classList.add("icon-collaboratecrose"),f.dataset.action="enable",f.parentNode.setAttribute("data-title",virtualclass.lang.getString("oncollaboration"))));localStorage.setItem(a+"mode",f.dataset.action);virtualclass.user.control.toggleAllEditorController.call(virtualclass.user,a,b)})}},removeScrollFromFireFox:function(a){a=virtualclass.vutil.capitalizeFirstLetter(a);
setTimeout(function(){var c=document.querySelector("#virtualclass"+a+"Body .CodeMirror-vscrollbar"),b=document.querySelector("#virtualclass"+a+"Body .CodeMirror"),f=document.querySelector("#virtualclass"+a+"Body .CodeMirror-code");c.style.display=f.offsetHeight>b.offsetHeight-25?"block":""},20)},createEditorClient:function(a,c){roles.hasAdmin()&&(this.cm.setOption("readOnly",!1),this.createAllEditorController(),a.readOnly=!1);virtualclass.isPlayMode&&(this.readOnlyMode("enable","notCreateSyncBox"),
this.cm.setOption("readOnly","nocursor"));Vceditor.fromCodeMirror({},this.cm,a,c);"Firefox"==virtualclass.system.mybrowser.detection()[0]&&this.removeScrollFromFireFox(this.etype)},disableEditorByOuterLayer:function(){var a=document.querySelector("#virtualclass"+virtualclass.vutil.capitalizeFirstLetter(this.etype)+"Body .CodeMirror.cm-s-default");null!=a&&(a.style.pointerEvents="none");console.log("Disable editor for ios")},enableEditorByOuterLayer:function(){var a=document.querySelector("#virtualclass"+
virtualclass.vutil.capitalizeFirstLetter(this.etype)+"Body .CodeMirror.cm-s-default");null!=a&&(a.style.pointerEvents="visible");console.log("Enable editor for ios")},codemirrorWithLayout:function(a){this.UI.container(this.etype);document.getElementById(this.UI.edId);"object"!=typeof this.cm&&(console.log("Code mirror instance is created "),this.cm=CodeMirror(document.getElementById(this.UI.edId),a))},requestData:function(){var a=virtualclass.vutil.whoIsTeacher();this.readOnlyMode("enable");ioAdapter.mustSendUser({eddata:"requestForEditorData",
et:this.etype,cf:"eddata"},a)},readOnlyMode:function(a,c){"object"==typeof this.cm&&("enable"==a?this.readonly||(this.cm.setOption("readOnly","nocursor"),"undefined"==typeof c&&this.UI.createSynchMessageBox(),this.readonly="nocursor"):this.readonly&&!virtualclass.isPlayMode&&(this.cm.setOption("readOnly",!1),this.readonly=!1,this.UI.hideSynchMessageBox()),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)))},isVcAdapterIsReady:function(a){return virtualclass[a].hasOwnProperty("vcAdapter")&&
"object"==typeof virtualclass[a].vcAdapter},receivedOperations:{currAppEditor:function(a){a.fromUser.userid!=virtualclass.gObj.userid&&(console.log("curr app editor"),virtualclass.currAppEditor=!0,virtualclass.currAppEditorType=a.message.et,virtualclass.dispvirtualclassLayout(virtualclass.currAppEditorType))},init:function(a,c){"s"==a.fromUser.role||a.fromUser.userid==virtualclass.gObj.uid&&"1"!=wbUser.virtualclassPlay||virtualclass.makeAppReady(c)},initVcEditor:function(a){console.log("received whole data");
roles.hasView()&&"function"==typeof virtualclass[a.message.et].vcAdapter.removeOperations&&virtualclass[a.message.et].vcAdapter.removeOperations(a);if(!roles.hasControls()||roles.hasControls()&&a.fromUser.userid!=virtualclass.gObj.uid&&(a.message.hasOwnProperty("resFromUser")||a.message.hasOwnProperty("allEdData"))){var c=JSON.parse(a.message.data);a.message.hasOwnProperty("layoutEd")?this.initialiseDataWithEditor(c,a.message):this.initialiseDataWithEditor(c)}},requestForEditorData:function(a){a.fromUser.userid!=
virtualclass.gObj.uid?"object"!=typeof this.vcAdapter||0==this.vcAdapter.operations.length?ioAdapter.mustSendAll({eddata:"noDataForEditor",cf:"eddata"}):this.responseToRequest(a.fromUser.userid):console.log("Cannot send requestForEditorData to self")},noDataForEditor:function(){roles.hasControls()},"virtualclass-editor-operation":function(a){"object"==typeof this.vcAdapter&&(this.readOnlyMode("disable"),this.vcAdapter.receivedMessage(a))},"virtualclass-editor-cursor":function(a){"object"==typeof this.vcAdapter&&
this.vcAdapter.receivedMessage(a)},select:function(){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(e)}},onmessage:function(a,c){this.receivedOperations[a.message.eddata].call(this,a,c);"object"!=typeof this.vcAdapter&&(roles.hasAdmin()&&"virtualclass-editor-operation"==a.message.eddata&&(virtualclass.makeAppReady(c),this.vcAdapter.receivedMessage(a,onmessage)),console.log("virtualclass adapter is not ready for editor"))},UI:{id:f,class:"vmApp virtualclass",edId:d,container:function(a){null==
document.getElementById(this.id)&&(a=virtualclass.getTemplate("editorrich","editor")({type:virtualclass.vutil.capitalizeFirstLetter(a),"class":a}),virtualclass.vutil.insertAppLayout(a))},createSynchMessageBox:function(){if(null!=document.getElementById("synchMessageBox"))this.showSynchMessageBox();else{var a=virtualclass.getTemplate("messagebox","editor")();document.getElementById(this.id).insertAdjacentHTML("afterbegin",a)}},showSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");
null!=a&&(a.style.display="block")},hideSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="none")}},responseToRequest:function(a){var c=this.getWrappedOperations(!0);c.layoutEd="1";roles.isTeacher()&&(c.capp=virtualclass.currApp);c.et=this.etype;a?(c.resFromUser=!0,ioAdapter.mustSendUser(c,a),console.log("Sending responseToRequest to "+a)):(c.allEdData=!0,ioAdapter.mustSend(c),console.log("Sending responseToRequest to all"),virtualclass[c.et].vcAdapter.removeOperations({message:{et:c.et}}),
a=JSON.parse(c.data),virtualclass[c.et].initialiseDataWithEditor(a),virtualclass[c.et].vcAdapter.myOTrequestData=0)},isEidtorWithTeacher:function(){return roles.hasControls()&&("EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp)},getWrappedOperations:function(a){a=this.vcAdapter&&this.vcAdapter.operations?b(this.vcAdapter.operations):[];return{eddata:"initVcEditor",data:JSON.stringify({operations:a}),et:this.etype,cf:"eddata"}},getStudentAllText:function(){return this.cm.getValue("\n")},
removeCodeMirror:function(){this.readonly=!1;var a=document.getElementById(this.UI.id);null!=a&&a.parentNode.removeChild(a);this.cm=""},setReadMode:function(){var a=JSON.parse(localStorage.getItem(this.etype));roles.hasAdmin()||(null!=a?a?(this.cm.setOption("readOnly",!1),a=!0):(this.cm.setOption("readOnly","nocursor"),a=!1):(this.cm.setOption("readOnly","nocursor"),a=!1),virtualclass.user.control.toggleDisplayWriteModeMsgBox(virtualclass.vutil.capitalizeFirstLetter(this.etype),a),virtualclass.vutil.setReadModeWhenTeacherIsDisConn(virtualclass.vutil.smallizeFirstLetter(this.etype)),
"iOS"==virtualclass.system.mybrowser.name&&virtualclass.system.isIPad()&&(a?this.enableEditorByOuterLayer():this.disableEditorByOuterLayer()))},writeBulkDocs:function(c){var b=a(c.operations);c.revision=0;if(this.cm){if(this.cm.getValue()!==c.str||""==c.str)this.vcAdapter=this.cmClient="",c.operations=[],c.doc="";this.createEditorClient(m,c);this.prvEdRev=c.revision}for(c=0;c<b.length;c++)virtualclass[this.etype].vcAdapter.server.receiveOperation(c,b[c]),this.vcAdapter.trigger("operation",b[c].wrapped.toJSON())},
initialiseDataWithEditor:function(c,b){a(c.operations);"undefined"!=typeof b&&b.hasOwnProperty("capp")&&(virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(b.capp));this.removeCodeMirror();this.codemirrorWithLayout(g);virtualclass.dispvirtualclassLayout(virtualclass.currApp);this.writeBulkDocs(c);this.cm.refresh();this.setReadMode();c=virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp);"EditorRich"==c||"EditorCode"==c?(virtualclass.previous="virtualclass"+virtualclass.currApp,
virtualclass.system.setAppDimension(virtualclass.currApp)):(c=document.getElementById("virtualclassEditorRich"),null!=c&&(c.style.display="none"),c=document.getElementById("virtualclassEditorCode"),null!=c&&(c.style.display="none"));c=document.getElementById("virtualclassEditorTool");null!=c&&(c.style.pointerEvents="visible");otAdapter.myrequestData=0},removeEditorData:function(){"object"==typeof this.cm&&("object"==typeof this.vcAdapter&&(this.vcAdapter.operations.length=0),this.removeCodeMirror(),
localStorage.removeItem(this.etype+"_allEditorOperations"),localStorage.removeItem(this.etype+"_edOperationRev"))},saveIntoLocalStorage:function(){if("object"==typeof this.vcAdapter&&0<this.vcAdapter.operations.length){var a=this.getWrappedOperations();localStorage.removeItem(this.etype+"_allEditorOperations");localStorage.setItem(this.etype+"_allEditorOperations",JSON.stringify(a));localStorage.setItem(this.etype+"_edOperationRev",this.cmClient.revision)}},undoManager:function(a){setTimeout(function(){90==
a?document.querySelector(".vceditor-tb-undo").parentNode.click():89==a&&document.querySelector(".vceditor-tb-redo").parentNode.click()},0)}}}})(window);(function(d,b){d.Chat=function(){return{userList:[],init:function(){this.chatroombox=null;this.chatWindow="private";this.counter=0;this.idList=[];this.commonChat=[];b.htab=[];b.htabIndex=[];this.vmstorage={};b("body").footerbar();"false"==localStorage.getItem("init")&&(b("#stickybar").removeClass("maximize").addClass("minimize"),b("#hide_bar input").removeClass("close").addClass("expand"));tabs=b("#tabs").tabs({cache:!0,activeOnAdd:!0});if(0==browserSupportsLocalStorage())alert(lang.sterror);else{this.history();
this.UI.privateChatBox.init();b("ul.tabs").on("click, focus","li",function(){b("li[aria-controls='"+b(this).attr("id")+"']").removeClass("ui-state-highlight")});console.log("chat local storage start ");var a=localStorage.getItem("chatEnable");null!=a&&"false"==a&&(document.querySelector("#chatWidget").classList.add("chat_disabled"),document.querySelector("#chat_div").classList.add("chat_disabled"),document.querySelector("#chatWidget").classList.remove("chat_enabled"))}},fetchChatUsers:function(){console.log("FetchUser congrea_get_enrolled_users");
var a=new FormData;a.append("action","fetchUser");virtualclass.xhr.send(a,d.webapi+"&user="+virtualclass.gObj.uid+"&methodname=congrea_get_enrolled_users",function(a){virtualclass.chat.userList=JSON.parse(a);updateOnlineUserText()})},setChatDisplay:function(){var a=document.querySelector("#virtualclassCont.congrea  #ta_chrm2");var c=document.querySelector("#virtualclassCont.congrea #congreaUserSearch");var b=localStorage.getItem("chatWindow");if(null!=b&&"common"==b)if(virtualclass.chat.chatWindow=
"common",b=document.getElementById("chatrm")){b.classList.add("enable");b.classList.remove("disable");document.getElementById("chatroom_bt2").classList.add("active");if(b=document.getElementById("memlist"))b.classList.remove("enable"),b.classList.contains("disable")||b.classList.add("disable"),b=document.getElementById("user_list"),b.classList.remove("active");if(c=document.querySelector("#virtualclassCont.congrea #congreaUserSearch"))c.style.display="none"}else{if(b=document.getElementById("memlist"))b.classList.add("enable"),
b.classList.remove("disable"),b=document.getElementById("user_list"),b.classList.add("active")}else if(null!=b&&"support"==b)(b=document.getElementById("congreaSupport"))&&b.classList.add("active");else{if(b=document.getElementById("memlist"))b.classList.add("enable"),b=document.getElementById("user_list"),b.classList.add("active"),virtualclass.chat.chatWindow="private";a&&(a.style.display="none")}document.querySelector("#virtualclassCont.congrea  .vmchat_bar_button").classList.contains("active")?
(a&&(a.style.display="none"),c&&(c.style.display="block")):(a&&(a.style.display="block"),c&&(c.style.display="none"))},showChatListUsers:function(){var a=virtualclass.chat.userList;0<a.length&&(this._showChatUserList(a),displayChatOfflineUserList(a),document.querySelector("div#memlist").classList.add("enable"))},_showChatUserList:function(a){if(!document.getElementById("chat_div")){var c=document.createElement("div");c.id="chat_div";document.body.appendChild(c)}b("#chat_div").memberlist({id:"chat_div",
user:a,offset:"-1px",title:lang.online,userSent:function(a){return b("#chat_div").memberlist("option","boxManager").addUsr(a)}})},history:function(){var a=null;null!=localStorage.getItem(wbUser.sid)&&(a=JSON.parse(localStorage.getItem(wbUser.sid)),displayPvtChatHistory(a),a=localStorage.getItem("chatEnable"),null!=a&&"false"==a&&virtualclass.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));0<localStorage.length&&(displaycomChatHistory(),virtualclass.chat.removeChatHighLight("chatrm"),
null!=a&&"false"==a&&virtualclass.user.control.disableCommonChat())},exportCommonChat:function(a){for(var c=[],b=virtualclass.chat.commonChat,d=0;d<b.length;d++)a<=b[d].time&&c.push(b[d]);return c},UI:{privateChatBox:{init:function(){b("#tabs").delegate("span.icon-close","click",this.close);b("#tabs").on("click","li a",this.toggle)},close:function(){var a=b(this).closest("li").attr("id").substring(5);b("#"+a).chatbox("option").boxClosed(a);b("div#cb"+a+".ui-widget").hide();a=b(this).closest("li").remove().attr("aria-controls");
b("#"+a).remove()},toggle:function(){var a=b(this).closest("li").attr("id").substring(5);b("#"+a).chatbox("toggleContentbox");"hidden"==localStorage.getItem(a)?localStorage.removeItem(a):localStorage.setItem(a,"hidden")}}},removedPrvLoggedInDetail:function(){b(".ui-memblist").remove();b(".ui-chatbox").remove();b("div#chatrm").remove();virtualclass.chat.chatroombox=null;console.log("Chat box is  null");for(key in io.uniquesids)key!=io.cfg.userid&&(chatboxManager.delBox(key),b("li#tabcb"+key).remove());
this.idList=0;b("#stickybar").removeClass("maximize").addClass("minimize");tabs.tabs("refresh")},removeCookieUserInfo:function(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";display_error(a.message)},makeUserListEmpty:function(){b("#user_list .inner_bt #usertab_icon").css({background:"url("+d.whiteboardPath+"images/offline.png)no-repeat top left"});
b("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" (0)");b("div#memlist").removeClass("enable")},removeChatHighLight:function(a){if(virtualclass.gObj.hasOwnProperty("testChatDiv")){a=chatContainerEvent.elementFromShadowDom(".ui-state-highlight","all");for(var c=0;c<a.length;c++)a[c].classList.remove("ui-state-highlight")}},openChatBox:function(){var a=document.querySelector("#memlist");null!=a&&(0<a.offsetWidth||0<a.offsetHeight||b("#chat_div").memberlist("option","boxManager").toggleBox())},
enableTechSupport:function(a){var c=document.querySelector("#congreaSupport");c.setAttribute("data-tsid",a);c.classList.remove("notavailable");c.classList.add("available")},disableTechSupport:function(a){var c=document.querySelector("#congreaSupport");c.classList.add("notavailable");c.classList.remove("available");a=document.querySelector("#tabcb"+a+" .icon-close");null!=a&&a.click()},isTechSupportExist:function(a){var c=document.querySelector("#congreaSupport");if(null!=c)return+c.dataset.tsid==
+a}}}})(window,$);(function(d){d.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:d(window).width()-430,supportId:"7",boxClosed:function(b){}},init:function(b){this.elem=b},widget:function(){return this.uiFooterbar},_create:function(){function b(){var c=[];virtualclass.connectedUsers.forEach(function(a){a.userid!=virtualclass.gObj.uid&&(a={id:a.userid,name:a.name.toLowerCase()},c.push(a))});var b=document.getElementById("congreaUserSearch").value;a(c,b.toLowerCase())}function a(a,c){a.forEach(function(a,
b){b=chatContainerEvent.elementFromShadowDom("ml"+a.id,null,!0);-1!=a.name.indexOf(c)?b.style.display="block":b.style.display="none"})}var c=roles.hasAdmin(),f=virtualclass.getTemplate("stickycont","chat");d("#stickycontainer").append(f({control:c}));var g=document.getElementById("chatroom_bt2"),k=document.getElementById("user_list"),m=document.querySelector("#appSettingCtrl"),n=document.querySelector("#virtualclassCont.congrea #appSettingDetail"),p=document.querySelector("#virtualclassCont.congrea #chatWidget");
d("#chatroom_bt2 .inner_bt").click(function(){document.querySelector("#chatwidget .vmchat_room_bt");g.classList.add("active");k.classList.remove("active");m.classList.contains("settingActive")&&(m.classList.remove("settingActive"),m.classList.add("chatActive"));p.classList.remove("deactive");p.classList.contains("active")||p.classList.add("active");n.classList.remove("active");n.classList.contains("deactive")||n.classList.add("deactive");d("#chatroom_bt2").removeClass("ui-state-highlight");virtualclass.chat.chatWindow=
"common";if(0==d("ul#chat_room").length){var a=document.createElement("ul");a.id="chat_room";document.body.appendChild(a);virtualclass.chat.chatroombox=d("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,messageSent:function(a,c){var b=a.userid||virtualclass.gObj.uid;d("#chat_room").chatroom("option","boxManager").addMsg(a.name,c,b)}});virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&(a=document.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a))}if(a=
document.getElementById("ta_chrm2"))a.style.display="block";if(a=document.getElementById("memlist"))a.classList.remove("enable"),a.classList.contains("disable")||a.classList.add("disable");if(a=document.getElementById("congreaUserSearch"))a.style.display="none";if(a=document.getElementById("chatrm"))a.classList.contains("enable")||a.classList.add("enable"),a.classList.remove("disable")});d("#user_list").click(function(){g.classList.remove("active");k.classList.add("active");var a=document.getElementById("appSettingCtrl"),
c=document.getElementById("chatWidget"),b=document.getElementById("appSettingDetail");a.classList.contains("settingActive")&&(a.classList.remove("settingActive"),a.classList.add("chatActive"));c.classList.remove("deactive");c.classList.contains("active")||c.classList.add("active");b.classList.remove("active");b.classList.contains("deactive")||b.classList.add("deactive");virtualclass.chat.chatWindow="private";this.classList.add("active");if(a=document.getElementById("chatrm"))a.classList.remove("enable"),
a.classList.contains("disable")||a.classList.add("disable");if(a=document.getElementById("ta_chrm2"))a.style.display="none";if(a=document.getElementById("congreaUserSearch"))a.style.display="block";if(a=document.getElementById("memlist"))a.classList.remove("disable"),a.classList.contains("enable")||a.classList.add("enable")});d("#congreaUserSearch").keyup(function(){b(this.value)});this._setWidth(this.options.width);this.init(this)},destroy:function(){this.element.remove();this._destroy()},_setWidth:function(b){}})})(jQuery);
(function(d){d.fn.clickToggle=function(b,a){var c=[b,a];this.data("toggleclicked",0);this.click(function(){var a=d(this).data(),b=a.toggleclicked;d.proxy(c[b],this)();a.toggleclicked=(b+1)%2});return this}})(jQuery);(function(d){d.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:320,userSent:function(b){"7"!=b.userid&&this.boxManager.addUsr(b.name)},boxClosed:function(b){},boxManager:{init:function(b){this.elem=b},addUsr:function(b){if(null!=chatContainerEvent.elementFromShadowDom("#ml"+b.userid))return!0;document.createElement("div");document.createDocumentFragment("div").id="tempId";b.userid!=wbUser.id&&(b.notSelf=!0);roles.hasControls()&&(b.isTeacher=!0);"t"==b.role?b.rl=
"teacher":"s"==b.role&&(b.rl="student");b.chatIconColors=virtualclass.gObj.chatIconColors[b.userid];console.log("Chat add user "+b.userid);return virtualclass.getTemplate("chatuser","chat")({peer:b})},highlightBox:function(){var b=this;b.elem.uiChatboxTitlebar.effect("highlight",{},300);b.elem.uiChatbox.effect("bounce",{times:3},300,function(){b.highlightLock=!1;b._scrollToBottom()})},toggleBox:function(){},_scrollToBottom:function(){}}},toggleContent:function(b){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")},
widget:function(){return this.uiChatbox},_create:function(){var b=(this.uiChatbox=d("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist");uiChatboxContent=(this.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(b);uiChatboxLog=(this.uiChatboxLog=this.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var a=d(this).parent().prev();
a.scrollTop(a.scrollHeight)});this._setWidth(this.options.width);this._position(this.options.offset);this.options.boxManager.init(this);roles.hasAdmin()&&(virtualclass.user.mediaSliderUI("audio"),virtualclass.user.mediaSliderUI("video"))},_setOption:function(b,a){if(null!=a)switch(b){case "hidden":a?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(a);break;case "width":this._setWidth(a)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(b){this.uiChatboxLog.width(b+
"px")},_position:function(b){this.uiChatbox.css("right",b)}})})(jQuery);(function(d){d.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent:function(b,a,c){this.boxManager.addMsg(a.name,c)},boxClosed:function(b){},boxManager:{init:function(b){this.elem=b},addMsg:function(b,a){var c=this.elem.uiChatboxLog,f=document.createElement("div");c.append(f);c=!1;if(b){var g=document.createElement("b");d(g).text(b+": ");f.appendChild(g)}else c=!0;b=document.createElement(c?"i":"span");d(b).text(a);f.appendChild(b);d(f).addClass("ui-chatbox-msg");
d(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){},toggleBox:function(){this.elem.uiChatbox.toggle()},_scrollToBottom:function(){var b=this.elem.uiChatboxLog;b.scrollTop(b.get(0).scrollHeight)}}},toggleContent:function(b){},toggleContentbox:function(b){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),d(d('#tabs ul li[id = "tabcb'+this.options.id+
'"]')).removeClass("ui-state-active")):d(d('#tabs ul li[id="tabcb'+this.options.id+'"]')).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget:function(){return this.uiChatbox},_create:function(){createTab(this.options.id,this.options.title);var b=this,a=b.options.title||"No Title",c=(b.uiChatbox=d("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id","cb"+b.options.id).focusin(function(){b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){b.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(b.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(function(a){}).appendTo(c);(b.uiChatboxTitle=d('<span class="cgText"></span>')).html(a).appendTo(f);var g=(b.uiChatboxTitlebarClose=d('<a href="#"></a>')).addClass("ui-chatbox-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).click(function(a){delete virtualclass.chat.vmstorage[b.options.id][0].box;c.hide();
b.options.boxClosed(b.options.id);d("#tabcb"+b.options.id).remove();virtualclass.chat.idList&&virtualclass.chat.idList.length&&(a=virtualclass.chat.idList.indexOf(b.options.id),-1<a&&virtualclass.chat.idList.splice(a,1));return!1}).appendTo(f);d("<span ></span>").addClass("ui-icon icon-close cgIcon ").text("").appendTo(g);var k=(b.uiChatboxTitlebarMinimize=d('<a href = "#"></a>')).addClass("ui-chatbox-icon").attr("role","button").hover(function(){k.addClass("ui-state-hover")},function(){k.removeClass("ui-state-hover")}).click(function(a){b.toggleContentbox(a);
"hidden"==localStorage.getItem(b.options.id)?localStorage.removeItem(b.options.id):localStorage.setItem(b.options.id,"hidden");return!1}).appendTo(f);d("<span></span>").addClass("ui-icon icon-minus").text("").appendTo(k);a=(b.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(c);(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(a);var m=(b.uiChatboxInput=d("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(a),
n=(b.uiChatboxInputBox=d("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id","ta"+b.options.id).appendTo(m).keypress(function(a){if(a.keyCode&&a.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());if(0<msg.length){ioAdapter.mustSendUser({msg:msg,cf:"msg"},b.options.id);d("li[aria-controls='tabcb"+b.options.id+"']").removeClass("ui-state-highlight");d(this).val("");d("#"+b.options.id).chatbox("option").messageSent(b.options.id,{name:io.cfg.userobj.name},msg);
a=b.options.id;"undefined"==typeof virtualclass.chat.vmstorage[a]&&(virtualclass.chat.vmstorage[a]=[]);var c=(new Date).getTime();virtualclass.chat.vmstorage[a].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:c})}return!1}}).focusin(function(){n.addClass("ui-chatbox-input-focus");var a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){n.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();a.children().click(function(){b.uiChatboxInputBox.focus()});
b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b);b.options.hidden||c.show();d(d('#tabs ul li[id = "tabcb'+b.options.id+'"]')).append(c)},_setOption:function(b,a){if(null!=a)switch(b){case "hidden":a?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(a);break;case "width":this._setWidth(a)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(b){this.uiChatbox.width(b+"px");this.uiChatboxInputBox.css("width",b-11+
"px")},_position:function(b){}})})(jQuery);(function(d){d.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:6,width:311,messageSent:function(b,a){this.boxManager.addMsg(b.name,a)},boxClosed:function(b){},boxManager:{init:function(b){this.elem=b},addMsg:function(b,a,c){"undefined"==typeof virtualclass.gObj.chatIconColors[c]&&groupChatImgColor(b,c);var f=virtualclass.vutil.UTCtoLocalTime(a.time),g=a.msg,k=this.elem.uiChatboxLog,m=document.createElement("li");m.className="left clearfix";k.append(m);k=document.createElement("div");
k.className="chat-user-icon pull-left";m.appendChild(k);if(virtualclass.gObj.chatIconColors[c]){k.style.backgroundColor=virtualclass.gObj.chatIconColors[c].bgColor;k.style.color=virtualclass.gObj.chatIconColors[c].textColor;var n=document.createElement("span");n.className="chat-img ";n.innerHTML=virtualclass.gObj.chatIconColors[c].initial}k.appendChild(n);n=!1;c=document.createElement("div");c.className="commonChatCon chat-body clearfix";b?(k=document.createElement("a"),k.className="primary-font",
d(k).text(b),c.appendChild(k)):n=!0;b=document.createElement(n?"i":"p");b.className="text";d(b).text(g);g=document.createElement("span");g.className="text-muted";g.innerHTML=f;c.appendChild(b);c.appendChild(g);m.appendChild(c);c.appendChild(b);m.dataset.msgtime=a.time;d(m).addClass("ui-chatbox-msg");d(m).fadeIn();this._scrollToBottom()},groupChatImgColor:function(b,a){var c=this.getInitials(b);b=this.stringToHslColor(a.toString()+b,60,35);var f=125<virtualclass.vutil.calcBrightness(b)?"black":"white";
virtualclass.gObj.chatIconColors[a]={bgColor:b,textColor:f,initial:c}},stringToHslColor:function(b,a,c){for(var f=0,d=0;d<b.length;d++)f=b.charCodeAt(d)+((f<<5)-f);return"hsl("+f%360+", "+a+"%, "+c+"%)"},getInitials:function(b){b=b.split(" ");var a=b[0].substring(0,1).toUpperCase();1<b.length&&(a+=b[b.length-1].substring(0,1).toUpperCase());return a},highlightBox:function(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox:function(){this.elem.uiChatbox.toggle("slide",
{direction:"down"},1E3)},_scrollToBottom:function(){var b=this.elem.uiChatboxLog;b.scrollTop(b.get(0).scrollHeight)}}},toggleContent:function(b){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget:function(){return this.uiChatbox},_create:function(){var b=null!=localStorage.getItem("chatEnable")?"true"==localStorage.chatEnable?"enable":"disable":"disable";var a=this;b=(a.uiChatbox=d("<div></div>")).appendTo(document.getElementById("congreaChatCont")).addClass("ui-widget ui-corner-top ui-chatroom "+
b).prop("id","chatrm");uiChatboxContent=(a.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(b);uiChatboxLog=(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-chatbox-log").appendTo(uiChatboxContent);uiChatboxInputBox=(a.uiChatboxInputBox=d("<input></input>")).addClass("ui-widget-content ui-chatbox-input-box ").prop("id","ta_chrm2").prop("placeholder","Send message...").appendTo(document.querySelector(".congrea #congchatBarInput")).keydown(function(c){if(c.keyCode&&
c.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());c=(new Date).getTime();var b={receiver:"chatroom",msg:msg,cf:"msg",time:c};0<msg.length&&(ioAdapter.mustSend(b),d(this).val(""),a.options.messageSent({name:io.cfg.userobj.name},{msg:msg,time:c}),null!=localStorage.getItem("chatroom")?(b=JSON.parse(localStorage.getItem("chatroom")),c={userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:c},b.push(c),localStorage.setItem("chatroom",JSON.stringify(b))):(c={userid:io.cfg.userid,name:io.cfg.userobj.name,
msg:msg,time:c},localStorage.setItem("chatroom",JSON.stringify([c]))),virtualclass.chat.commonChat.push(c));return!1}}).focusin(function(){uiChatboxInputBox.addClass("ui-chatbox-input-focus")}).focusout(function(){uiChatboxInputBox.removeClass("ui-chatbox-input-focus")});uiChatboxContent.children().click(function(){a.uiChatboxInputBox.focus()});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);a.options.hidden||(b.show(),virtualclass.vutil.isPlayMode()&&disCommonChatInput())},
_setOption:function(b,a){if(null!=a)switch(b){case "hidden":a?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(a);break;case "width":this._setWidth(a)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(b){this.uiChatbox.width(b+"px")},_position:function(b){this.uiChatbox.css("left",b)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(d){for(var b=0;b<this.length;b++)if(this[b]==d)return b;return-1});
var chatboxManager=function(){var d=[],b=[],a={width:230,gap:20,maxBoxes:5,messageSent:function(a,c,b){$("#"+a).chatbox("option","boxManager").addMsg(c,b)}},c=function(c){var f=b.indexOf(c);if(-1!=f)for(b.splice(f,1),d.splice(f,1),diff=a.width+a.gap,c=f;c<b.length;c++)offset=$("#"+b[c]).chatbox("option","offset"),$("#"+b[c]).chatbox("option","offset",offset-diff);else alert("should not happen: "+c)},f=function(c,b,f){d.indexOf(b.userid);a.messageSent(c,b,f)};return{init:function(c){$.extend(a,c)},
addBox:function(g,k,m){m=b.indexOf(g);var n=d.indexOf(g);-1!=m?console.log("Do nothing"):-1!=n?($("#"+g).chatbox("option","offset",285+(a.width+a.gap)*b.length),$("#"+g).chatbox("option","boxManager").toggleBox(),b.push(g),m=$("#tabs li").index($("#tabcb"+g)),$($(".tabs li")[m]).css("display","list-item"),$("#tabs").tabs("option","active",m),$("#tabs").tabs("show")):(void 0==k.last_name&&(k.last_name=""),m=document.createElement("div"),m.setAttribute("id",g),$(m).chatbox({id:g,user:k,title:k.first_name+
" "+k.last_name,hidden:!1,width:a.width,offset:285+(a.width+a.gap)*b.length,messageSent:f,boxClosed:c}),d.push(g),b.push(g));"support"==k.class?0==$("#cb"+g+".support").length&&$("#cb"+g).addClass("support").removeClass("privateChat"):"privateChat"==k.class&&0==$("#cb"+g+".privateChat").length&&$("#cb"+g).addClass("privateChat").removeClass("support");virtualclass.chat.vmstorage.hasOwnProperty(g)&&(virtualclass.chat.vmstorage[g][0].box="opened")},delBox:function(a){b=$.grep(b,function(c){return a!=
c});d=$.grep(d,function(c){return a!=c})},dispatch:function(a,c){$("#"+a.userid).chatbox("option","boxManager").addMsg(a.name,c)}}}();var myChatBoxOpen=!1,chatResults=[],myDivResult="",checkChatDisabled=!1;
function displayChatUserList(d){virtualclass.gObj.hasOwnProperty("insertUser")||(virtualclass.gObj.insertUser=!0,virtualclass.gObj.userToBeDisplay=500);var b=d;if(virtualclass.gObj.insertUser){if(virtualclass.jId==virtualclass.gObj.uid&&virtualclass.gObj.userToBeDisplay<d.length){b=[];b.push(virtualclass.vutil.getMySelf());for(var a=0;a<virtualclass.gObj.userToBeDisplay;a++)d[a].userid!=virtualclass.gObj.uid&&b.push(d[a])}for(d=0;d<b.length;d++)"undefined"==typeof virtualclass.gObj.chatIconColors[b[d].userid]&&
groupChatImgColor(b[d].name,b[d].userid),virtualclass.gObj.chatIconColors[b[d].userid].savedImg="noimage"==b[d].img?!1:b[d].img,null==document.getElementById("video"+b[d].userid)&&(tmpmyDivResult=$("#chat_div").memberlist("option").userSent(b[d])),"boolean"!=typeof tmpmyDivResult&&void 0!=tmpmyDivResult&&(myDivResult+=tmpmyDivResult);"undefined"==typeof chat_div&&(chat_div=document.querySelector("#chat_div"));null!=myDivResult&&void 0!=myDivResult&&""!=myDivResult&&"boolean"!=typeof myDivResult&&
(" "==chat_div.shadowRoot.innerHTML||""==chat_div.shadowRoot.innerHTML?(d=roles.hasControls()?"teacher":"student",chat_div.shadowRoot.innerHTML=virtualclass.isPlayMode?"<link rel='stylesheet' type='text/css' href='"+whiteboardPath+"css/modules/chat-container.css'> <div id='subchat' class='playMode "+d+"'>"+myDivResult+"</div>":"<link rel='stylesheet' type='text/css' href='"+whiteboardPath+"css/modules/chat-container.css'> <div id='subchat' class='"+d+"'>"+myDivResult+"</div>"):chat_div.shadowRoot.querySelector("#subchat").insertAdjacentHTML("beforeend",
myDivResult));myDivResult="";if(virtualclass.gObj.uid==virtualclass.vutil.whoIsTeacher())for(d=0;d<b.length;d++)virtualclass.gObj.uid!=b[d].userid&&virtualclass.user.initControlHandler(b[d].userid)}virtualclass.gObj.insertUser=virtualclass.connectedUsers.length>=virtualclass.gObj.userToBeDisplay?!1:!0}
function displayChatOfflineUserList(d){alert("display chat offline user");var b=document.querySelector("#melistcontainer");null==b&&(b=document.createDocumentFragment("div"),b.id="melistcontainer");for(var a=0;a<d.length;a++)virtualclass.vutil.alreadyConnected(d[a].userid)||d[a].userid==virtualclass.gObj.uid||null!=document.getElementById("video"+d[a].userid)||(myDivResult=$("#chat_div").memberlist("option").userSent(d[a]),virtualclass.media.addUserRole(myDivResult,d[a].role),b.appendChild(myDivResult));
console.log("display offline user");document.querySelector("#chat_div").appendChild(b)}
function updateOnlineUserText(){if(roles.hasAdmin())if(0<virtualclass.chat.userList.length){document.querySelector("#usertab_text").innerHTML="";var d=roles.hasAdmin()?"Users ("+virtualclass.connectedUsers.length+"/"+virtualclass.chat.userList.length+")":" Users ("+count+")";var b=document.querySelector("#onlineusertext");null==b?document.querySelector("#usertab_text").innerHTML="<span id='onlineusertext' class='cgText'>"+d+"</span>":b.innerHTML=d}else"nothing"==virtualclass.chat.userList.nothing?
document.querySelector("#user_list .inner_bt #usertab_text").innerHTML="<span class='cgText' id='onlineusertext'>Users ("+virtualclass.connectedUsers.length+")</span>":console.log("Chat list is not fetched yet.");else document.querySelector("#user_list .inner_bt #usertab_text").innerHTML="<span class='cgText' id='onlineusertext'>Users ("+virtualclass.connectedUsers.length+")</span>"}
function memberUpdate(d,b){if("removed"==b)b=virtualclass.gObj.testChatDiv.shadowRoot.querySelector("#ml"+d.removeUser),null!=b&&b.parentNode.removeChild(b),updateOnlineUserText();else{d=virtualclass.gObj.memberlistpending;virtualclass.gObj.memberlistpending=[];console.log("member list pending(memberlistpending) empty ");if(0<d.length){virtualclass.chat._showChatUserList(d);virtualclass.jId==virtualclass.gObj.uid&&(virtualclass.chat.openChatBox(),virtualclass.media.dispAllVideo("chat_div"),console.log("chat box is opened"));
displayChatUserList(d);for(var a=0;a<d.length;a++)if(d[a].userid==io.cfg.userid&&"undefined"!=typeof b&&"removed"!=b){var c=document.getElementById("video"+virtualclass.gObj.uid);virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||null!=c||(console.log("Media _handleUserMedia"),virtualclass.media._handleUserMedia(virtualclass.gObj.uid));c=chatContainerEvent.elementFromShadowDom("#ml"+virtualclass.gObj.uid);null!=c&&c.classList.add("mySelf")}virtualclass.raiseHand.moveUpInList()}else $("div#memlist").length&&
(console.log("member remove memlist "+$("div#memlist").length+" addType="+b),$("div#memlist").remove());roles.hasAdmin()&&virtualclass.jId==virtualclass.gObj.uid?(virtualclass.chat.openChatBox(),"added"==b?virtualclass.chat.fetchChatUsers():virtualclass.chat.showChatListUsers(),virtualclass.chat.setChatDisplay()):virtualclass.jId==virtualclass.gObj.uid&&virtualclass.chat.setChatDisplay();d=document.querySelector("#memlist");b=document.querySelector("#chatrm");null!=d&&null==document.querySelector("#chatroom_bt2.active")?
(d.classList.add("enable"),d.classList.remove("disable"),null!=b&&(b.classList.remove("enable"),b.classList.add("disable"))):(d.classList.remove("enable"),d.classList.add("disable"),d=document.querySelector("#user_list"),a=document.querySelector("#chatroom_bt2"),b&&(a.classList.contains("active")||a.classList.add("active"),d.classList.remove("active")));b=document.querySelector("#virtualclassCont.congrea  .vmchat_bar_button");d=document.querySelector("#virtualclassCont.congrea #congreaUserSearch");
a=document.querySelector("#virtualclassCont.congrea  #ta_chrm2");b.classList.contains("active")?(a&&(a.style.display="none"),d&&(d.style.display="block")):(a&&(a.style.display="block"),d&&(d.style.display="none"));updateOnlineUserText();virtualclass.connectedUsers.forEach(function(a){$("#ml"+a.userid).addClass("online").removeClass("offline")});b=document.querySelector("#chat_div .ui-memblist-usr.mySelf .videoSubWrapper video");null!=b&&b.play()}"display"==virtualclass.gObj.delayVid&&setTimeout(function(){virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid)},
200);virtualclass.gObj.delayVid=""}
function messageUpdate(d){var b=$.isPlainObject(d.message)?d.message.msg:d.message;var a=d.toUser,c=d.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==d.message.receiver&&(""==a||void 0==a))b={msg:b,time:d.message.time},virtualclass.chat.chatroombox||0!=$("ul#chat_room").length||(d=document.createElement("ul"),d.id="chat_room",document.body.appendChild(d),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:c,title:lang.chatroom_header,messageSent:function(a,c){var b=
a.userid||virtualclass.gObj.uid;$("#chat_room").chatroom("option","boxManager").addMsg(a.name,c,b)}})),$("#chat_room").chatroom("option").messageSent(c,b),d=localStorage.getItem("chatroom"),null!=d?(d=JSON.parse(d),b={userid:c.userid,name:c.name,msg:b,time:g},d.push(b),localStorage.setItem("chatroom",JSON.stringify(d))):(b={userid:c.userid,name:c.name,msg:b,time:g},localStorage.setItem("chatroom",JSON.stringify([b]))),virtualclass.chat.commonChat.push(b),0==$("#chatroom_bt2.active").length&&($("#chatroom_bt2").addClass("ui-state-highlight"),
$("#chatrm").removeClass("enable"));else if(void 0!=a&&""!=a){if(f==a.userid&&c.userid!=f){-1==$.inArray(c.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(c.userid),virtualclass.chat.vmstorage.hasOwnProperty(c.userid)||(virtualclass.chat.vmstorage[c.userid]=[],virtualclass.chat.vmstorage[c.userid].push({userid:c.userid,name:c.name+" "+c.lname})));null==document.querySelector("#cb"+c.userid)&&(chatboxManager.addBox(c.userid,{dest:"dest"+virtualclass.chat.counter,
title:"box"+virtualclass.chat.counter,first_name:c.name,last_name:c.lname}),virtualclass.chat.vmstorage.hasOwnProperty(c.userid)&&1<virtualclass.chat.vmstorage[c.userid].length&&displayUserSinglePvtChatHistory(c.userid));chatboxManager.init({user:c,messageSent:function(a,c,b){$("#"+a).chatbox("option","boxManager").addMsg(c.name,b)}});d=localStorage.getItem("chatEnable");null!=d&&"false"==d&&virtualclass.user.control.allChatDisable();$("#"+c.userid).chatbox("option").messageSent(c.userid,c,b);$("li[aria-controls='tabcb"+
c.userid+"']").addClass("ui-state-highlight");var k=c.userid}virtualclass.chat.vmstorage[k].push({userid:c.userid,name:c.name,msg:b,time:g})}}function statusUpdate(d,b,a){$("#"+d.userid).length&&($("#"+d.userid).chatbox("option").messageSent(d.userid,d,b),$("#ta"+d.userid).prop("disabled",a))}function common_chatbox_update(d,b){$("ul#chat_room").length&&$("#chat_room").chatroom("option").messageSent(d,b)}
function newStatus(d){$.each(d.message,function(b,a){null!=d.newuser&&a.userid==d.newuser&&(statusUpdate(a,"Online",!1),common_chatbox_update(a,"Online"))})}function createTab(d,b){var a=$("#tabs").tabs(),c=$("div#tabs ul li").length;tabId="tabcb"+d;addTab(a,tabId,c,b)}
function addTab(d,b,a,c){var f=$("#tab_content");a=c||"Tab "+a;b=$(("<li id = '"+b+"' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '"+b+"'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon icon-close'></span></a></li>").replace(/#\{href\}/g,"#"+b).replace(/#\{label\}/g,a));f.val();d.find(".ui-tabs-nav").append(b)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){var d=localStorage.getItem("chatroom");if(null!=d){var b=document.createElement("ul");b.id="chat_room";document.body.appendChild(b);d=JSON.parse(d);virtualclass.chat.commonChat=d;$.each(d,function(a,c){1>a&&(virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:c,title:"Common chat",messageSent:function(a,c){var b=a.userid||virtualclass.gObj.uid;$("#chat_room").chatroom("option","boxManager").addMsg(a.name,c,b)}}));"object"==typeof c.msg?$("#chat_room").chatroom("option").messageSent(c,
c.msg):$("#chat_room").chatroom("option").messageSent(c,{msg:c.msg,time:c.time})})}"hidden"==localStorage.getItem("chatroom_status")&&$("#chatrm").hide()}
function displayPvtChatHistory(d){var b=!1;console.log(d);$.each(d,function(a,c){virtualclass.chat.counter++;virtualclass.chat.idList.push(a);$.each(c,function(c,d){1>c?(d.hasOwnProperty("box")&&(b=!0),b&&(a==virtualclass.chat.supportId&&(d.name="support"),chatboxManager.addBox(a,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:d.name}),chatboxManager.init({messageSent:function(a,c,b){$("#"+a).chatbox("option","boxManager").addMsg(c.name,b)}}))):b&&$("#"+a).chatbox("option").messageSent(a,
d,d.msg)});b=!1;a==virtualclass.chat.supportId&&(c=document.getElementById("cb"+virtualclass.chat.supportId))&&c.classList.add("support");"hidden"==localStorage.getItem(a)&&($("#cb"+a).hide(),$("#tabcb"+a).removeClass("ui-state-active"))})}function display_error(d){virtualclass.view.createErrorMsg(d,"errorContainer","chatWidget",{className:"Unauthenticated"})}function clearAllChatBox(){$("#chatWidget .icon-close").trigger("click")}
function disCommonChatInput(){var d=document.getElementById("ta_chrm");null!=d&&(d.disabled=!0)}
function toggleCommonChatBox(){var d=$("#chatroom_bt2");"hidden"==localStorage.getItem("chatroom_status")?(localStorage.removeItem("chatroom_status"),d.attr("data-title",virtualclass.lang.getString("minCommonChat"))):(localStorage.setItem("chatroom_status","hidden"),d.attr("data-title",virtualclass.lang.getString("maxCommonChat")));d=document.getElementById("cc_arrow_button");null!=d&&(virtualclass.vutil.elemHasAnyClass("cc_arrow_button")?d.classList.contains("icon-arrow-up")?(d.classList.add("icon-arrow-down"),
d.classList.remove("icon-arrow-up")):(d.classList.add("icon-arrow-up"),d.classList.remove("icon-arrow-down")):d.className="icon-arrow-up");virtualclass.chat.chatroombox.chatroom("option","boxManager").toggleBox()}function sortUserList(d,b){return d.name<b.name?-1:d.name>b.name?1:0}function sortCommonChat(){var d=$("#chat_room");d.find(".ui-chatbox-msg").sort(function(b,a){return+b.dataset.msgtime-+a.dataset.msgtime}).appendTo(d)}
function displayUserSinglePvtChatHistory(d){$("#"+d+" .ui-chatbox-msg").remove();var b=virtualclass.chat.vmstorage[d];1<b.length&&$.each(b,function(a,c){0<a&&$("#"+d).chatbox("option").messageSent(d,c,c.msg)})}function groupChatImgColor(d,b){var a=getInitials(d);d=stringToHslColor(b.toString()+d,60,35);var c=125<virtualclass.vutil.calcBrightness(d)?"black":"white";virtualclass.gObj.chatIconColors[b]={bgColor:d,textColor:c,initial:a}}
function stringToHslColor(d,b,a){for(var c=0,f=0;f<d.length;f++)c=d.charCodeAt(f)+((c<<5)-c);return"hsl("+c%360+", "+b+"%, "+a+"%)"}function getInitials(d){d=d.split(" ");var b=d[0].substring(0,1).toUpperCase();1<d.length&&(b+=d[d.length-1].substring(0,1).toUpperCase());return b};var lang={online:"Online users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};var precheck={currTest:"",playTestAudio:!1,session:null,cNavigator:null,handlers:[],videoAction:!1,donePrecheck:!1,init:function(){var d=document.querySelector("#myModal");d&&(d.className="modal in");roles.hasControls()?this.videoAction=virtualclass.videoHost.gObj.videoSwitch:virtualclass.videoHost.gObj.hasOwnProperty("stdStopSmallVid")?this.videoAction=virtualclass.videoHost.gObj.stdStopSmallVid?!1:!0:this.videoAction=!1;this.totalTest=["browser","bandWidth","webcam","speaker","mic"];this.currTest=
"browser";d=document.querySelector("#virtualclassCont #preCheckcontainer");null!=d&&(d.style.display="block");d=document.querySelector("#virtualclassCont #virtualclassApp");null!=d&&(d.style.display="none");this.startToCheckWholeSytem();console.log("Precheck init skip");if(d=document.querySelector("#preCheckcontainer .skip"))d.removeEventListener("click",this.initSkip),d.addEventListener("click",this.initSkip);virtualclass.precheck.donePrecheck=!0;null!=workerAudioSend&&workerAudioSend.postMessage({cmd:"precheck",
msg:{precheck:virtualclass.precheck.donePrecheck}})},initSkip:function(){console.log("Skip clicked");micTesting.makeAudioEmpty();if(localStorage.getItem("precheck")){var d=document.getElementById("preCheckcontainer");d.style.display="none";d=document.getElementById("virtualclassApp");d.style.display="block"}else virtualclass.popup.waitMsg(),virtualclass.makeReadySocket(),d=document.getElementById("preCheckcontainer"),d.style.display="none",d=document.getElementById("virtualclassApp"),d.style.display=
"block",localStorage.setItem("precheck",!0),virtualclass.videoHost.afterSessionJoin();if(d=document.getElementById("vcSpeakerCheckAudio"))d.pause(),d.currentTime=0;virtualclass.gObj.precheckScrn=!1;virtualclass.precheck.afterComplete()},cancelAudioGraph:function(){null!=this.graph&&void 0!=this.graph&&this.graph.microphone.stop()},startToCheckWholeSytem:function(){this[this.totalTest[0]].perform()},_next:function(d,b){console.log("Clicked next");"browser"==d&&virtualclass.media.audio.initAudiocontext();
virtualclass.precheck.cancelAudioGraph();micTesting.makeAudioEmpty();var a=this[d].next;virtualclass.precheck.currTest=a;virtualclass.precheck.updateProgressBar(a);!this[a].hasOwnProperty("alreadyDone")||this[a].hasOwnProperty("alreadyDone")&&"bandwidth"==a?this[a].perform():(virtualclass.precheck.display("#preCheckcontainer .precheck."+a),"speaker"==a?this[a]._play():"mic"==a?this[a].audioOperation():"webcam"==a&&(virtualclass.precheck.webcam.initHandler(),virtualclass.precheck.webcam.createVideo()));
virtualclass.precheck.hide("#preCheckcontainer .precheck."+d);"undefined"!=typeof b&&b();this[a].alreadyDone=!0},_prev:function(d,b){virtualclass.precheck.cancelAudioGraph();micTesting.makeAudioEmpty();var a=this[d].prev;virtualclass.precheck.hide("#preCheckcontainer .precheck."+d);virtualclass.precheck.display("#preCheckcontainer .precheck."+a);document.querySelector("#preCheckcontainer  #preCheckProgress ."+d).classList.remove("active","current");document.querySelector("#preCheckcontainer  #preCheckProgress ."+
a).classList.add("current");"speaker"==a?this[a]._play():"mic"==a?(micTesting.playAudio=!0,this[a].audioOperation()):"webcam"==a&&virtualclass.precheck.webcam.initHandler();"undefined"!=typeof b&&b()},display:function(d){document.querySelector(d).style.display="block"},hide:function(d){document.querySelector(d).style.display="none"},createMessage:function(d,b,a){var c=document.createElement("div");c.className=a;c.innerHTML=b;document.querySelector(d).appendChild(c)},initHandler:function(d,b,a){console.log("initHandler next/prev");
var c=document.querySelector(d);null!=c&&(b=this.triggerInitHandler.bind(c,d,b,a),c.addEventListener("click",b),this.handlers.push({id:d,handler:b}))},removeAllListener:function(){for(var d=0;d<this.handlers.length;d++)document.querySelector(this.handlers[d].id).removeEventListener("click",this.handlers[d].handler);this.handlers=[]},triggerInitHandler:function(d,b,a){this.classList.contains("next")?(virtualclass.precheck._next(b),console.log("Trigger handle Next")):this.classList.contains("prev")&&
(virtualclass.precheck._prev(b),console.log("Trigger handle previous"));"undefined"!=typeof a&&null!=a&&a()},browser:{curr:"browser",next:"bandwidth",perform:function(){virtualclass.precheck.display("#preCheckcontainer .precheck."+this.curr);if(0<virtualclass.error.length){var d=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",d,"error")}d=virtualclass.lang.getString("congreainchrome");virtualclass.precheck.createMessage("#preCheckcontainer .precheck .result",
d,"information");virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .next",this.curr)}},bandwidth:{prev:"browser",curr:"bandwidth",next:"speaker",perform:function(){virtualclass.precheck.display("#preCheckcontainer .precheck."+this.curr);var d=this,b="#preCheckcontainer .precheck."+this.curr+" .result";this.imageAddr="https://dl.congrea.com/bandwidth.jpg";this.downloadSize=1E6;d=this;this.measureConnectionSpeed(function(a){document.querySelector(b).innerHTML="";
a=d.bandWidthInWords(a);b.innerHTML="";a=virtualclass.lang.getString(a+"BandWidthSpeed");virtualclass.precheck.createMessage(b,a,"information");virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+d.curr+"Buttons .prev",d.curr);virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+d.curr+"Buttons .next",d.curr)});var a=virtualclass.media.sessionConstraints();virtualclass.precheck.session=a[1];null==virtualclass.adpt&&(virtualclass.adpt=new virtualclass.adapter);virtualclass.precheck.cNavigator=
virtualclass.adpt.init(navigator);virtualclass.precheck.cNavigator.mediaDevices.getUserMedia(virtualclass.precheck.session).then(function(a){console.log("GEtting stream");virtualclass.precheck.mediaStream=a})},bandWidthInWords:function(d){console.log("bandwidth speed "+d);600<d?(d="high",virtualclass.videoHost.gObj.MYSPEED=1):400<d?(d="medium",virtualclass.videoHost.gObj.MYSPEED=2):(virtualclass.videoHost.gObj.MYSPEED=3,d="low");ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);return d},measureConnectionSpeed:function(d){var b=
new Image,a=this;b.onload=function(){a.endTime=(new Date).getTime();var c=a.calculateSpeed();console.log("Download speed is occurred");d(c)};b.onerror=function(a,b){ShowProgressMessage("Invalid image, or error downloading")};this.startTime=(new Date).getTime();b.src=this.imageAddr+("?nnn="+this.startTime)},calculateSpeed:function(){var d=((8*this.downloadSize/((this.endTime-this.startTime)/1E3)).toFixed(2)/1024).toFixed(2);return Math.round(d)}},speaker:{prev:"bandwidth",curr:"speaker",next:"mic",
perform:function(){var d=document.createElement("div");d.innerHTML=virtualclass.lang.getString("speakerTest");document.querySelector("#preCheckcontainer .precheck."+this.curr+" .result").appendChild(d);this._play()},_play:function(){virtualclass.precheck.display("#preCheckcontainer .precheck."+this.curr);document.querySelector("#vcSpeakerCheckAudio source");var d=document.getElementById("vcSpeakerCheckAudio");d.loop=!0;d.play();this.playTestAudio||(virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+
this.curr+"Buttons .prev",this.curr,function(){d.pause();d.currentTime=0}),virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .next",this.curr,function(){d.pause();d.currentTime=0}),this.playTestAudio=!0);virtualclass.precheck.cancelAudioGraph()}},mic:{prev:"speaker",curr:"mic",next:"webcam",graphProcessor:null,graph:null,perform:function(){micTesting.manipulateStreamFallback(virtualclass.precheck.mediaStream);virtualclass.precheck.display("#preCheckcontainer .precheck."+
this.curr);this.visualize();if(null==document.querySelector("#micTest")){var d=document.createElement("div");d.id="micTest";d.innerHTML=virtualclass.lang.getString("mictesting");document.querySelector("#preCheckcontainer .precheck."+this.curr+" .result").appendChild(d)}if("safari"==virtualclass.system.mybrowser.name||"iOS"==virtualclass.system.mybrowser.name)this.graphContext=new (window.AudioContext||window.webkitAudioContext),this.graphProcessor=this.graphContext.createScriptProcessor(1024,1,1);
this.initAudioGraph()},initAudioGraph:function(){if(this.hasOwnProperty("graph")&&null!=this.graph){var d=document.querySelector("#audioGraph wave");null!=d&&d.parentNode.removeChild(d)}this.graph=WaveSurfer.create({container:"#audioGraph",waveColor:"green",interact:!1,cursorWidth:0,audioContext:this.graphContext||null,audioScriptProcessor:this.graphProcessor||null,plugins:[WaveSurfer.microphone.create()],height:50,maxCanvasWidth:500});this.graph.microphone.on("deviceReady",function(){console.info("Device ready!")});
this.graph.microphone.on("deviceError",function(b){console.warn("Device error: "+b)})},audioOperation:function(){micTesting.playAudio=!0;this.visualize()},visualize:function(){virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .prev",this.curr);virtualclass.precheck.initHandler("#preCheckcontainer .precheck #"+this.curr+"Buttons .next",this.curr)}},webcam:{test:{1:"noWebCam",2:"nopermission",3:"webcambuys"},prev:"mic",curr:"webcam",perform:function(){var d="#preCheckcontainer .precheck."+
this.curr;var b=document.createElement("div");if(virtualclass.system.mediaDevices.hasWebcam)if(0<virtualclass.system.mediaDevices.webcamErr.length){var a=virtualclass.system.mediaDevices.webcamErr[virtualclass.system.mediaDevices.webcamErr.length-1];if("PermissionDeniedError"==a||"SecurityError"==a||"nopermission"==a)a+="Ext","Firefox"==virtualclass.system.mybrowser.name&&(a+="FF");a=virtualclass.lang.getString(a);var c=b.className+" error"}else c=b.className+" general",b=document.createElement("div"),
a=virtualclass.lang.getString("webcamerainfo");else c=b.className+" error",a=virtualclass.lang.getString("nowebcam");b.className=c;b.innerHTML=a;document.querySelector(d+" .result").appendChild(b);virtualclass.precheck.display(d);b.classList.contains("error")?document.getElementById("webcamTempVideo").className="novideo":this.createVideo();this.initHandler()},initHandler:function(){virtualclass.precheck.initHandler("#preCheckcontainer .precheck #joinSession .prev",this.curr);var d=document.querySelector("#joinSession .next");
null!=d?(d.removeEventListener("click",this.joinSession.bind(this)),d.addEventListener("click",this.joinSession.bind(this))):(d=document.querySelector("#joinSession .precheckComplete"),null!=d&&(d.removeEventListener("click",this.initHidePrecheck.bind(this)),d.addEventListener("click",this.initHidePrecheck.bind(this))))},initHidePrecheck:function(){document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display="block";virtualclass.videoHost._resetPrecheck();
virtualclass.precheck.afterComplete()},joinSession:function(){virtualclass.popup.waitMsg();virtualclass.makeReadySocket();var d=document.getElementById("preCheckcontainer");d.style.display="none";d=document.getElementById("preCheckcontainer");d.style.display="none";document.getElementById("virtualclassApp").style.display="block";localStorage.setItem("precheck",!0);virtualclass.videoHost.afterSessionJoin();virtualclass.precheck.afterComplete()},createVideo:function(){if(virtualclass.system.mediaDevices.hasWebcam&&
"undefined"!=typeof virtualclass.precheck.mediaStream){var d=document.getElementById("webcamTempVideo");"mobTab"==virtualclass.system.device?(d.width=320,d.height=100):(d.width=320,d.height=240);virtualclass.adpt.attachMediaStream(d,virtualclass.precheck.mediaStream);d.muted=!0;d.play()}}},startSession:function(){document.getElementById("virtualclassApp").style.display="block";var d=document.getElementById("virtualclassPreCheck");null!=d&&d.parentNode.removeChild(d)},updateProgressBar:function(d){document.querySelector("#progressbarScreen ."+
d);for(var b=document.querySelectorAll("#preCheckProgress .progressbar li"),a=0;a<b.length;a++)if(b[a].classList.add("active"),b[a].classList.contains(d)){0<a&&b[a-1].classList.remove("current");b[a].classList.add("current");break}},afterComplete:function(){virtualclass.precheck.hasOwnProperty("mediaStream")&&null!=virtualclass.precheck.mediaStream&&virtualclass.precheck.mediaStream.getTracks()[0].stop();virtualclass.videoHost._resetPrecheck();micTesting.destroyAudioNode();virtualclass.precheck.removeAllListener();
virtualclass.media.isInitiator=!1;"undefined"!=typeof workletAudioSend?workletAudioSend.disconnect():null!=virtualclass.gObj.audioPlayerNode&&(virtualclass.gObj.audioPlayerNode.disconnect(virtualclass.media.audio.Html5Audio.audioContext.destination),virtualclass.gObj.audioPlayerNode=null);"undefined"!=typeof virtualclass.media.audioCreatorNode&&null!=virtualclass.media.audioCreatorNode&&(virtualclass.media.audioCreatorNode.disconnect(virtualclass.media.audio.Html5Audio.audioContext.destination),virtualclass.media.audioCreatorNode=
null);("iOS"==virtualclass.system.mybrowser.name||"Firefox"==virtualclass.system.mybrowser.name||"Safari"==virtualclass.system.mybrowser.name)&&virtualclass.media.audio.hasOwnProperty("Html5Audio")&&virtualclass.media.audio.Html5Audio.hasOwnProperty("audioContext")&&null!=virtualclass.media.audio.Html5Audio.audioContext&&virtualclass.media.audio.Html5Audio.audioContext.close();virtualclass.media.audio.hasOwnProperty("Html5Audio")&&delete virtualclass.media.audio.Html5Audio;console.log("Fetching media stream");
var d=this;virtualclass.media.init(function(b){"success"==b?(virtualclass.media.audio.initAudiocontext(),virtualclass.vutil.videoHandler(d.videoAction?"on":"off","notSendStatus")):console.log("Something wrong with stream")},"fromPrecheck");virtualclass.precheck.speaker.playTestAudio=!1;virtualclass.precheck.donePrecheck=!1;null!=workerAudioSend&&workerAudioSend.postMessage({cmd:"precheck",msg:{precheck:virtualclass.precheck.donePrecheck}})}};eval(function(d,b,a,c,f,g){f=function(a){return(a<b?"":f(parseInt(a/b)))+(35<(a%=b)?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){for(;a--;)g[f(a)]=c[a]||f(a);c=[function(a){return g[a]}];f=function(){return"\\w+"};a=1}for(;a--;)c[a]&&(d=d.replace(new RegExp("\\b"+f(a)+"\\b","g"),c[a]));return d}('(v(){o d="H+/";o e=I J(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,K,-1,-1,-1,L,M,N,O,P,Q,R,S,T,U,w,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,V,W,X,Y,Z,1a,-1,-1,-1,-1,-1,-1,1b,1c,1d,1e,1f,1g,1h,1i,1j,1k,1l,1m,1n,1o,1p,1q,1r,1s,1t,1u,1v,1w,1x,1y,1z,1A,-1,-1,-1,-1,-1);v A(a){o b,i,g;o c,h,f;g=a.B;i=0;b="";p(i<g){c=a.n(i++)&r;j(i==g){b+=d.k(c>>2);b+=d.k((c&x)<<4);b+="==";q}h=a.n(i++);j(i==g){b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k((h&D)<<2);b+="=";q}f=a.n(i++);b+=d.k(c>>2);b+=d.k(((c&x)<<4)|((h&C)>>4));b+=d.k(((h&D)<<2)|((f&1B)>>6));b+=d.k(f&1C)}s b}v E(a){o b,h,f,l;o i,g,m;g=a.B;i=0;m="";p(i<g){t{b=e[a.n(i++)&r]}p(i<g&&b==-1);j(b==-1)q;t{h=e[a.n(i++)&r]}p(i<g&&h==-1);j(h==-1)q;m+=y.z((b<<2)|((h&1D)>>4));t{f=a.n(i++)&r;j(f==w)s m;f=e[f]}p(i<g&&f==-1);j(f==-1)q;m+=y.z(((h&1E)<<4)|((f&1F)>>2));t{l=a.n(i++)&r;j(l==w)s m;l=e[l]}p(i<g&&l==-1);j(l==-1)q;m+=y.z(((f&1G)<<6)|l)}s m}j(!u.F)u.F=A;j(!u.G)u.G=E})();',
62,105,"               c3 len c2  if charAt c4 out charCodeAt var while break 0xff return do window function 61 0x3 String fromCharCode base64encode length 0xF0 0xF base64decode btoa atob ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 new Array 62 63 52 53 54 55 56 57 58 59 60 20 21 22 23 24           25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 0xC0 0x3F 0x30 0XF 0x3C 0x03".split(" "),0,{}));function createRequestObject(){return"Microsoft Internet Explorer"==navigator.appName?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}var http=createRequestObject();function convertResponseBodyToText(d){for(var b={},a=0;256>a;a++)for(var c=0;256>c;c++)b[String.fromCharCode(a+256*c)]=String.fromCharCode(a)+String.fromCharCode(c);a=IEBinaryToArray_ByteStr(d);d=IEBinaryToArray_ByteStr_Last(d);return a.replace(/[\s\S]/g,function(a){return b[a]})+d}var IEBinaryToArray_ByteStr_Script="\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n\tIEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n\tDim lastIndex\r\n\tlastIndex = LenB(Binary)\r\n\tif lastIndex mod 2 Then\r\n\t\tIEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n\tElse\r\n\t\tIEBinaryToArray_ByteStr_Last = \"\"\r\n\tEnd If\r\nEnd Function\r\n\x3c/script>\r\n";
document.write(IEBinaryToArray_ByteStr_Script);
function loadfile2(d,b){"undefined"===typeof b&&(b="dec");"dec"===b?(http.open("get","http://localhost/google-webp/1.webp"),http.overrideMimeType?http.overrideMimeType("text/plain; charset=x-user-defined"):http.setRequestHeader("Accept-Charset","x-user-defined"),http.onreadystatechange=function(){if(4==http.readyState){var a="undefined"==typeof http.responseBody?http.responseText.split("").map(function(a){return String.fromCharCode(a.charCodeAt(0)&255)}).join(""):convertResponseBodyToText(http.responseBody);
"dec"===b&&WebPDecodeAndDraw(a)}},http.send(null)):"enc"===b&&ImageToCanvas("/images-enc/"+d)}
function loadfile(d,b,a){"undefined"===typeof type&&(type="dec");if("dec"===type){var c=new Image;c.src=d;http.open("get",c.src);http.overrideMimeType?http.overrideMimeType("text/plain; charset=x-user-defined"):http.setRequestHeader("Accept-Charset","x-user-defined");http.onreadystatechange=function(){if(4==http.readyState){var c="undefined"==typeof http.responseBody?http.responseText.split("").map(function(a){return String.fromCharCode(a.charCodeAt(0)&255)}).join(""):convertResponseBodyToText(http.responseBody);
"dec"===type&&virtualclass.gObj.meetingMode&&WebPDecDemo(b.id);WebPDecodeAndDraw(c,b,a)}};http.send(null)}else"enc"===type&&ImageToCanvas("/images-enc/"+filename)};function WebPDecDemo(d){function b(d,n,p,v,u,q,r,t,B,A,F,E,D){k=setTimeout(function(){q=q+u>v.length?v.length-u:q;memcpy(r,0,v,u,q);status=d.WebPIAppend(n,r,q);var m=A=d.WebPIDecGetRGB(n,p.last_y,p.width,p.height,p.stride);if(p.biHeight.value!=p.height.value||p.biWidth.value!=p.width.value){p.biHeight.value=p.height.value;p.biWidth.value=p.width.value;var G=p.biHeight.value;var z=p.biWidth.value;a.height=G;a.width=z;c=a.getContext("2d");g=c.createImageData(a.width,a.height);f=g.data}if(m&&p.last_y.value!=
p.last_y_cache.value){z=p.biWidth.value;for(G=p.last_y_cache.value;G<p.last_y.value;G++)for(var J=0;J<z;J++)f[0+4*J+4*z*G]=m[0+3*J+3*z*G],f[1+4*J+4*z*G]=m[1+3*J+3*z*G],f[2+4*J+4*z*G]=m[2+3*J+3*z*G],f[3+4*J+4*z*G]=255;c.putImageData(g,0,0);p.last_y_cache.value=p.last_y.value}u+=q;5==status&&k&&b(d,n,p,v,u,q,r,t,B,A,F,E,D);0==status&&(decSpeedResult.innerHTML="Speed result:<br />libwebpjs (Incremental decoding): finish in "+(new Date-E)+"ms")},D)}var a=document.getElementById(d),c=a.getContext("2d"),
f=null,g=null,k=null;document.createElement("img");WebPDecodeAndDraw=function(a,c,b){window.Worker&&webpToPng.postMessage({vdata:a,canid:c.id});window.Worker&&(webpToPng.onmessage=function(a){var c="videoParticipate"==a.data.canid?document.querySelector("#"+a.data.canid):chatContainerEvent.elementFromShadowDom("#"+a.data.canid);var b=c.getContext("2d"),f=b.createImageData(c.width,c.height);c.height=a.data.bh;c.width=a.data.bw;f.data.set(a.data.vdata);b.putImageData(f,0,0);virtualclass.gObj.isReadyForVideo=
!0})};WebPIDecodeAndDraw=function(a){clearTimeout(k);if(!isNaN(parseInt(IncrementalDecBufferSizeBtn.value))&&!isNaN(parseInt(IncrementalDecSleepBtn.value))){a=convertBinaryToArray(a);var c=parseInt(IncrementalDecBufferSizeBtn.value),f=Arr(c-1,0),d=parseInt(IncrementalDecSleepBtn.value),g=new WebPDecoder,m=g.WebPINew("MODE_RGB");b(g,m,{last_y:{value:null},last_y_cache:{value:null},width:{value:0},height:{value:0},biWidth:{value:0},biHeight:{value:0},stride:{value:0}},a,0,c,f,0,0,null,null,new Date,
d);g.WebPIDelete(m);finishDecoding()}}};var BASE64_MARKER=";base64,",videoHost={gObj:{},setDefaultValue:function(d){virtualclass.videoHost.gObj.MYSPEED=d||1;virtualclass.videoHost.gObj.teacherVideoQuality=this.getTeacherVideoQuality()},init:function(d,b){this.sl=0;this.width=d;this.height=b;this.gObj.videoSwitch=1;console.log("videoSwitch 1");this.allStdVideoOff=this.domReady=this.gObj.stdStopSmallVid=!1;roles.hasAdmin()?(this._init(),d=document.createElement("canvas"),d.id="dummyCanvas",d.width=40,d.height=40,document.querySelector("#virtualclassApp").appendChild(d),
WebPDecDemo("dummyCanvas"),this.domReady=!0):(this.setCanvasAttr("videoPartCan","videoParticipate"),WebPDecDemo("videoParticipate"),virtualclass.videoHost.UI.hideTeacherVideo());d=document.querySelector("#virtualclassAppRightPanel");if(null!=d)if(b=localStorage.getItem("tvideo"),null==b&&(b="show"),d.classList.add(b),roles.hasControls())(d=localStorage.getItem("videoSwitch"))&&"0"==d&&(virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):
virtualclass.gObj.delayVid="display",virtualclass.videoHost.UI.hideTeacherVideo());else{if(d=JSON.parse(localStorage.getItem("stdVideoSwitch")))virtualclass.connectedUsers&&virtualclass.connectedUsers.length?virtualclass.videoHost.setUserIcon(virtualclass.gObj.uid):virtualclass.gObj.delayVid="display",virtualclass.videoHost.UI.hideTeacherVideo();console.log(d)}},renderSelfVideo:function(d){"undefined"==typeof virtualclass.media.tempStream&&(console.log("Media attached stream"),this.getMediaStream(d))},
isDomReady:function(d){var b=this;this.domReady?(null!=this.domreadyCheck&&clearTimeout(this.domreadyCheck),d()):this.domreadyCheck=setTimeout(function(){b.isDomReady(d)},1E3)},_init:function(){this.setCanvasAttr("vidHost","videoHost");this.setCanvasAttr("vidHostSlice","videoHostSlice");this.vidHostSlice.globalAlpha=.5;this.vidHostSlice.globalCompositeOperation="multiply"},onmessage:function(d){console.log(d);"on"==d.congCtr.videoSwitch?(virtualclass.videoHost.gObj.videoSwitch=1,console.log("videoSwitch 1"),
this.UI.displayTeacherVideo(),localStorage.tvideo="show"):"off"==d.congCtr.videoSwitch&&(virtualclass.videoHost.gObj.videoSwitch=0,this.UI.hideTeacherVideo(),localStorage.tvideo="hide")},stdVideoCtrlMsg:function(d){var b=d.fromUser.userid;d.message.stdVideoCtr.videoSwitch?this.setUserIcon(b):this.removeUserIcon(b)},toggleVideoMsg:function(d){var b=document.querySelector("#congCtrBar");"enable"==d?(b.style.pointerEvents="visible",b.style.opacity="1",virtualclass.videoHost.gObj.allStdVideoOff=!1):(b.style.pointerEvents=
"none",b.style.opacity="0.5",virtualclass.videoHost.gObj.allStdVideoOff=!0)},toggleStdVideoIcon:function(d){var b=document.querySelector(".congrea .videoSwitchCont"),a=document.querySelector(".congrea #rightCtlr #videoSwitch");"enable"==d?(a.setAttribute("data-action","disable"),a.className="video on",b.setAttribute("data-title","Video off")):(a.setAttribute("data-action","enable"),a.className="video off",b.setAttribute("data-title","Video on"))},setUserIcon:function(d){var b;(b=chatContainerEvent.elementFromShadowDom("#ml"+
d+" .user-details a .videoWrapper"))&&b.parentNode.removeChild(b);var a=chatContainerEvent.elementFromShadowDom("#ml"+d+" .user-details a");chatContainerEvent.elementFromShadowDom("#ml"+d+" .user-details a span")||chatContainerEvent.elementFromShadowDom("#ml"+d+" .user-details a img")||null==a?console.log("Image container is null"):(virtualclass.gObj.chatIconColors[d]&&!virtualclass.gObj.chatIconColors[d].savedImg?(b=document.createElement("span"),b.innerHTML=virtualclass.gObj.chatIconColors[d].initial,
b.style.backgroundColor=virtualclass.gObj.chatIconColors[d].bgColor,b.style.color=virtualclass.gObj.chatIconColors[d].textColor,b.dataset.event="ub",b.classList.add("chat-img","media-object"),a.appendChild(b)):virtualclass.gObj.chatIconColors[d]&&virtualclass.gObj.chatIconColors[d].savedImg&&(b=document.createElement("img"),b.setAttribute("src",virtualclass.gObj.chatIconColors[d].savedImg),b.classList.add("chat-img","media-object"),a.appendChild(b)),console.log("set User icon"))},removeUserIcon:function(d){console.log("Remove User icon");
virtualclass.gObj.uid==d&&(d=cthis.video.createVideoElement(),virtualclass.media.util.imageReplaceWithVideo(virtualclass.gObj.uid,d),chatContainerEvent.elementFromShadowDom("#ml"+virtualclass.gObj.uid+" #tempVideo")||(cthis.video.insertTempVideo(d),cthis.video.tempVideoInit()),cthis.video.myVideo=chatContainerEvent.elementFromShadowDom("#video"+virtualclass.gObj.uid),cthis.video.myVideo.muted=!0,virtualclass.adpt.attachMediaStream(cthis.video.myVideo,cthis.video.tempStream))},fromLocalStorage:function(){var d=
"";if(roles.hasControls())d=localStorage.getItem("videoSwitch"),localStorage.removeItem("videoSwitch");else{var b=localStorage.getItem("stdVideoSwitch");b=null!=b&&"undefined"!=b?JSON.parse(b):!1;localStorage.removeItem("stdVideoSwitch");var a=localStorage.getItem("allStdVideoOff");a=null!=a&&"undefined"!=a?JSON.parse(a):!1;virtualclass.videoHost.gObj.allStdVideoOff=a;localStorage.removeItem("stdVideoSwitch")}if("undefined"!=typeof d&&d)if(virtualclass.videoHost.gObj.videoSwitch=+d,roles.hasControls()){if(a=
document.getElementById("videoSwitch"))+d?a.classList.contains("off")&&(a.classList.add("on"),a.classList.remove("off"),console.log("Video controller on")):a.classList.contains("on")&&(console.log("Video controller off"),a.classList.add("off"),a.classList.remove("on"),virtualclass.gObj.meetingMode&&virtualclass.multiVideo.setVideoStatus(!1))}else virtualclass.gObj.meetingMode||(+d?virtualclass.videoHost.UI.displayTeacherVideo():virtualclass.videoHost.UI.hideTeacherVideo());roles.hasControls()||("undefined"!=
typeof b&&b&&((virtualclass.videoHost.gObj.stdStopSmallVid=b)?(virtualclass.videoHost.toggleStdVideoIcon("disable"),virtualclass.multiVideo.setVideoStatus(!1)):virtualclass.videoHost.toggleStdVideoIcon("enable")),virtualclass.videoHost.gObj.allStdVideoOff||!virtualclass.system.mediaDevices.hasWebcam?virtualclass.videoHost.toggleVideoMsg("disable"):virtualclass.gObj.videoEnable?virtualclass.videoHost.toggleVideoMsg("enable"):virtualclass.videoHost.toggleStdVideoIcon("disable"))},setCanvasAttr:function(d,
b){this[d]=document.getElementById(b);this[d].width=this.width;this[d].height=this.height;this[d+"Con"]=this[d].getContext("2d")},getMediaStream:function(d){this.videoHostSrc=document.getElementById("videoHostSource");this.videoHostSrc.width=this.width;this.videoHostSrc.height=this.height;virtualclass.adpt.attachMediaStream(this.videoHostSrc,d);var b=this;setTimeout(function(){b.shareVideo()},2E3)},shareVideo:function(){this.imageSlices=this.getImageSlices(1,1);var d=this;videoHost.gObj.hasOwnProperty("shareVideoInterval")&&
clearInterval(videoHost.gObj.shareVideoInterval);videoHost.gObj.shareVideoInterval=setInterval(function(){d.gObj.videoSwitch&&io.webSocketConnected()&&virtualclass.system.mediaDevices.hasWebcam&&d._shareVideo(d,1,1)},120)},_shareVideo:function(d,b,a){for(d.sl=0;d.sl<b*a;d.sl++){d.vidHostCon.drawImage(d.videoHostSrc,0,0,d.width,d.height);var c=d.imageSlices[d.sl];var f=d.vidHostCon.getImageData(c.x,c.y,c.w,c.h);d.vidHostSliceCon.putImageData(f,c.x,c.y)}d.sl==b*a&&(virtualclass.system.webpSupport?(a=
d.vidHostSlice.toDataURL("image/webp",.6),b=1):(a=d.vidHostSlice.toDataURL("image/jpeg",.3),b=0),d.vidHostSliceCon.clearRect(0,0,d.width,d.height),d.sendInBinary(a,b))},sendInBinary:function(d,b){d=this.convertDataURIToBinary(d);b=new Int8Array([21,b]);var a=new Int8Array(d.length+b.length);a.set(b);a.set(d,b.length);ioAdapter.sendBinary(a)},convertDataURIToBinary:function(d){var b=d.indexOf(BASE64_MARKER)+BASE64_MARKER.length;d=d.substring(b);d=window.atob(d);b=d.length;var a=new Uint8Array(new ArrayBuffer(b));
for(i=0;i<b;i++)a[i]=d.charCodeAt(i);return a},drawReceivedImage:function(d,b,a){"undefined"==typeof vid0eoPartCont&&(this.videoPartCan=document.getElementById("videoParticipate"),this.videoPartCont=this.videoPartCan.getContext("2d"),videoPartCont=!0);var c=this;"undefined"!=typeof virtualclass.media.audio.Html5Audio?sampleRate=virtualclass.media.audio.Html5Audio.audioContext.sampleRate:"undefined"==typeof sampleRate&&(sampleRate=(new (window.AudioContext||window.webkitAudioContext)).sampleRate);
virtualclass.gObj.isReadyForVideo&&document.querySelector("#virtualclassCont.congrea #videoHostContainer.hide")&&virtualclass.videoHost.UI.displayTeacherVideo();setTimeout(function(){if(virtualclass.isPlayMode||3>virtualclass.videoHost.gObj.MYSPEED)if(virtualclass.system.webpSupport||"jpeg"==b){var f=new Image;f.onload=function(){c.videoPartCont.drawImage(f,a.x,a.y)};f.src=d}else virtualclass.gObj.isReadyForVideo&&(virtualclass.gObj.isReadyForVideo=!1,loadfile(d,c.videoPartCan,c.videoPartCont))},
260)},onError:function(d){console.log("MediaStream Error "+d)},getImageSlices:function(d,b){for(var a=[],c=d*b,f=Math.floor(this.vidHost.width/b),g=Math.floor(this.vidHost.height/d),k=0;k<c;k++){var m=this._getSingleSliceImg(k,f,g,d,b);a.push(m)}return a},_getSingleSliceImg:function(d,b,a,c,f){0==d?f=d=0:(c=Math.floor(d/f),d=d%f*b,f=c*a);return{x:d,y:f,w:b,h:a}},Uint8ToString:function(d){for(var b=[],a=0;a<d.length;a+=32768)b.push(String.fromCharCode.apply(null,d.subarray(a,a+32768)));return b.join("")},
getTeacherVideoQuality:function(){virtualclass.videoHost.gObj.teacherVideoQuality=16;var d=document.querySelector("#virtualclassCont.teacher #videoHostSource");null!=d&&""==d.src&&(virtualclass.videoHost.gObj.teacherVideoQuality=0);return virtualclass.videoHost.gObj.teacherVideoQuality},afterSessionJoin:function(){var d=roles.hasAdmin()?1:virtualclass.videoHost.gObj.MYSPEED;this.setDefaultValue(d);virtualclass.network.initToPing(1E4);this.fromLocalStorage();this.resetPrecheck()},resetPrecheck:function(){this._resetPrecheck();
var d=document.querySelector("#joinSession .next");if(null!=d){var b=document.createElement("button");d.parentNode.appendChild(b);d.parentNode.removeChild(d);b.classList.add("precheckComplete","btn","btn-default");b.innerHTML=virtualclass.lang.getString("prechkcmplt")}(d=document.querySelector("#preCheckcontainer .skip"))&&d.addEventListener("click",function(){micTesting.makeAudioEmpty();document.getElementById("preCheckcontainer").style.display="none";document.getElementById("virtualclassApp").style.display=
"block";virtualclass.videoHost._resetPrecheck()})},_resetPrecheck:function(){for(var d=document.querySelectorAll("#congProgressbar .active"),b=0;b<d.length;b++)0<b&&d[b].classList.remove("active");0<d.length&&(d=document.querySelectorAll("#myModal .precheck"),[].slice.call(d,0).forEach(function(a){a.style.display="none"}),(d=document.querySelector("#vcBrowserCheck .information"))&&d.parentNode.removeChild(d),virtualclass.precheck.totalTest&&virtualclass.precheck.totalTest.forEach(function(a){"undefined"!=
typeof virtualclass.precheck[a]&&virtualclass.precheck[a].hasOwnProperty("alreadyDone")&&"mic"==a&&delete virtualclass.precheck[a].alreadyDone}))},UI:{displayTeacherVideo:function(){if(!virtualclass.gObj.meetingMode){var d=document.querySelector(".congrea #videoHostContainer");d.classList.add("show");d.classList.remove("hide");d=document.querySelector(".congrea #virtualclassAppRightPanel");d.classList.add("vidShow");d.classList.remove("vidHide")}},hideTeacherVideo:function(){if(!virtualclass.gObj.meetingMode){var d=
document.querySelector(".congrea #videoHostContainer");d.classList.remove("show");d.classList.add("hide");d=document.querySelector(".congrea #virtualclassAppRightPanel");d.classList.add("vidHide");d.classList.remove("vidShow")}}}};(function(d){var b=function(){return{coursePoll:[],sitePoll:[],setting:{showResult:!0,timer:!0,time:{digit:"2",unit:"minut"}},uid:0,currQid:0,currOption:{},dataToStd:{},count:{},save:0,newUserTime:{},list:[],listPoll:{},currResultView:"bar",tStamp:[],pollState:{},exportfilepath:d.exportfilepath,uniqueUsers:[],init:function(){this.pollState={};virtualclass.previrtualclass="virtualclassPoll";virtualclass.previous="virtualclassPoll";this.cmid=virtualclass.vutil.getUrlVars(exportfilepath).cmid;this.timer&&
clearInterval(this.timer);!roles.hasAdmin()||roles.isEducator()?roles.isStudent()?this.UI.defaultLayoutForStudent():(this.UI.container(),roles.hasControls()?ioAdapter.mustSend({poll:{pollMsg:"init"},cf:"poll"}):this.UI.defaultLayoutForStudent()):(this.UI.container(),ioAdapter.mustSend({poll:{pollMsg:"init"},cf:"poll"}));var a=JSON.parse(localStorage.getItem("pollState")),c;if(c=a){a:{for(var b in a)if(a.hasOwnProperty(b)){c=!1;break a}c=!0}c=!c}c?(console.log("storeddata if block"),this.storedDataHandle(a)):
roles.hasControls()&&(console.log("fetchlist"),this.interfaceToFetchList(this.cmid));localStorage.removeItem("pollState")},interfaceToSave:function(a,c){var b=this;c=new FormData;c.append("dataToSave",JSON.stringify(a));c.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(c,d.webapi+"&methodname=poll_save",function(a){a=JSON.parse(a);var c={},f={};a.options.forEach(function(a){f[a.optid]=a.options});a.copied?(a.options=f,c.questionid=a.qid,c.category=a.category,c.createdby=a.createdby,c.questiontext=
a.question,c.creatorname=a.creatorname,c.options=a.options,b.publishPoll(c),b.interfaceToFetchList(c.category)):b.updatePollList(a);b.currQid=a.qid;b.currOption=f})},interfaceToEdit:function(a){var c=this,b=new FormData;b.append("editdata",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(b,d.webapi+"&methodname=poll_update",function(a){a=JSON.parse(a);console.log(a);c.updatePollList(a)})},updatePollList:function(a){var c={},b={};a.options.forEach(function(a){b[a.id]=
a.options});c.questionid=a.qid;c.category=a.category;c.createdby=a.createdby;c.questiontext=a.question;c.creatorname=a.creatorname;c.options=b;this.currQid=a.qid;this.currOption=b;(c.category?this.coursePoll:this.sitePoll).push(c);this.interfaceToFetchList(c.category)},interfaceToFetchList:function(a){var c=this,b=new FormData;b.append("category",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);virtualclass.recorder.items=[];virtualclass.xhr.send(b,d.webapi+"&methodname=poll_data_retrieve",
function(b){b=JSON.parse(b);for(var f=0;f<=b.length-1;f++){var d=b[f].options;for(g in d)b[f].options[g]=d[g].options,console.log("getContent "+b[f])}console.log(b);var g=b.pop();JSON.parse(a)?(c.coursePoll=b,c.displaycoursePollList()):(c.sitePoll=b,c.displaysitePollList(g))})},interfaceToDelete:function(a){var c=this,b=new FormData;b.append("qid",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(b,d.webapi+"&methodname=poll_delete",function(a){a=JSON.parse(a);c.interfaceToFetchList(a)})},
interfaceToDelOption:function(a){var c=new FormData;c.append("id",JSON.stringify(a));c.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(c,d.webapi+"&methodname=poll_option_drop",function(a){})},interfaceToSaveResult:function(a){var c=this,b=new FormData;b.append("saveResult",JSON.stringify(a));b.append("user",virtualclass.gObj.uid);virtualclass.xhr.send(b,d.webapi+"&methodname=poll_result",function(a){a&&(a=JSON.parse(a),c.interfaceToFetchList(a))})},storedDataHandle:function(a){"displaycoursePollList"==
a.currScreen?this.reloadPollList(a,"course"):"displaysitePollList"==a.currScreen?this.reloadPollList(a,"site"):"stdPublish"==a.currScreen?this.reloadStdPublish(a):"teacherPublish"==a.currScreen?this.loadTeacherScrn(a):"voted"==a.currScreen?(this.reloadVotedScrn(a),setTimeout(function(){var a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult");a&&(a.style.display="none")},700)):"stdPublishResult"==a.currScreen&&this.reloadStdResult(a);localStorage.removeItem("pollState")},
reloadPollList:function(a,c){var b=document.getElementById("coursePollTab"),d=document.getElementById("sitePollTab"),k=0;"course"==c?(d.classList.remove("active"),b.classList.add("active"),k=this.cmid):(b.classList.remove("active"),d.classList.add("active"));this.interfaceToFetchList(k);a.currScreen=="display"+c+"PollList"},reloadStdPublish:function(a){this.dataRec=a.data.stdPoll;this.dataRec.newTime=a.data.timer;this.stdPublish();a={stdPoll:this.dataRec,timer:this.newUserTime};this.pollState.currScreen=
"stdPublish";this.pollState.data=a},reloadVotedScrn:function(a){this.dataRec=a.data.stdPoll;this.dataRec.newTime=a.data.timer;(a=document.getElementById("stdPollMszLayout"))&&a.parentNode.removeChild(a);a=this.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):virtualclass.lang.getString("votesuccessPbt");this.showMsg("mszBoxPoll",a,"alert-success");a={stdPoll:this.dataRec,timer:this.newUserTime};this.pollState.currScreen="voted";this.pollState.data=a},reloadStdResult:function(a){var c=
document.getElementById("mszBoxPoll");c&&(c.style.display="none");if(this.dataRec=a.data.stdPoll)this.dataRec.newTime=a.data.timer;this.count=a.data.count;this.currResultView=a.data.view;this.stdPublishResult(this.count);"bar"==this.currResultView?this.updateBarGraph():"pi"==this.currResultView&&(this.createPiChart(),this.updatePiChart());a={stdPoll:this.dataRec,timer:this.newUserTime,count:this.count,view:this.currResultView};this.pollState.currScreen="stdPublishResult";this.pollState.data=a},loadTeacherScrn:function(a){console.log("currentscreenpublish");
this.dataToStd.question=a.data.question;this.dataToStd.options=a.data.options;this.dataToStd.qId=a.data.qId;this.setting=a.data.setting;this.nTimer=this.newTime=this.newUserTime=a.data.newTime;this.count=a.data.count;this.currResultView=a.data.view;this.uniqueUsers=a.data.users;var c=a.data.pollType,b=document.getElementById("coursePollTab"),d=document.getElementById("sitePollTab"),k=0;"course"==c?(d.classList.remove("active"),b.classList.add("active"),k=this.cmid):(b.classList.remove("active"),d.classList.add("active"));
this.interfaceToFetchList(k);this.list=a.data.list;c={question:this.dataToStd.question,options:this.dataToStd.options,setting:this.setting,newTime:this.nTimer,count:this.count,view:this.currResultView,list:this.list,totalUsers:a.data.totalUsers,users:this.uniqueUsers,pollType:c,qId:a.data.qId};"yes"!=a.pollClosed&&this.reloadTeacherPublish(a);"undefined"!=typeof a.data.pollClosed&&"yes"!=a.pollClosed&&(this.UI.pollClosedUI(),a=virtualclass.lang.getString("Pclosed"),this.showMsg("resultLayoutHead",
a,"alert-success"),this.timer&&clearInterval(this.timer),this.testNoneVoted(),(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a),c.pollClosed="yes",this.pollState.pollClosed="yes");this.pollState.data=c;this.pollState.currScreen="teacherPublish";localStorage.removeItem("pollState")},reloadTeacherPublish:function(a){var c,b=a.data.pollType;virtualclass.modal.closeModalHandler("editPollModal");var d=this.setting.timer;this.UI.resultView(d,b);this.list=a.data.list;this.count=a.data.count;
this.currResultView=a.data.view;var k=a.data.totalUsers;this.reloadGraph();this.noOfVotes(k);if(d)if(k=this.nTimer.min,d=this.nTimer.sec,k||1<d){if(c=document.getElementById("timerWrapper")){var m=document.createElement("div");m.id="timerCont";c.appendChild(m)}this.showTimer(virtualclass.poll.nTimer,0)}else{if(k||1>=d){if(c=document.getElementById("timerWrapper"))m=document.createElement("div"),m.id="timerCont",c.appendChild(m);m.innerHTML=(10>k?"0"+k:k)+":"+(10>d?"00":d);this.testNoneVoted();(m=
document.getElementById("pollResultMsz"))&&m.parentNode.removeChild(m)}}else k=a.data.newTime.min,d=a.data.newTime.sec,this.elapsedTimer(k,d);if(m=document.getElementById("modalClose"))m.removeAttribute("data-dismiss"),m.addEventListener("click",function(){virtualclass.poll.pollModalClose(b)});this.count=a.data.count;this.pollState.currScreen="teacherPublish"},pollModalClose:function(a){roles.hasControls()&&virtualclass.poll.pollState.currScreen&&"teacherPublish"==virtualclass.poll.pollState.currScreen&&
(virtualclass.poll.pollState.currScreen="course"==a?"displaycoursePollList":"displaysitePollList");var c=virtualclass.lang.getString("pclosetag");virtualclass.popup.confirmInput(c,this.resultCloseConfirm,a)},resultCloseConfirm:function(a){if(a){(a=document.querySelector("#editPollModal"))&&a.remove();if(virtualclass.poll.timer){ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"});virtualclass.poll.resultToStorage();var c={qid:virtualclass.poll.dataToStd.qId,
list:virtualclass.poll.list}}virtualclass.poll.timer&&(virtualclass.poll.interfaceToSaveResult(c),clearInterval(virtualclass.poll.timer),virtualclass.poll.timer=0);if(c=document.getElementById("congreaPollVoters"))c.innerHTML=virtualclass.lang.getString("receivedVotes");virtualclass.poll.count={}}},resultToStorage:function(){var a=roles.hasControls()?this.dataToStd:this.dataRec;a&&(a={result:this.count,qid:a.qId,pollData:a},this.uid++,a.uid=this.uid,roles.hasControls()||virtualclass.storage.pollStore(JSON.stringify(a)))},
reloadGraph:function(){"bar"==this.currResultView?(this.showGraph(),this.updateBarGraph()):"pi"==this.currResultView?(this.createPiChart(),this.updatePiChart()):"list"==this.currResultView&&this.listView();var a=document.getElementsByClassName("emptyList"),c=document.getElementById("chart");if(0<this.list.length)for(c=0;c<a.length;c++)a[c].style.display="none";else c.style.display="none";if(a=document.querySelectorAll("#chartMenuCont button"))for(c=0;c<a.length;c++)a[c].classList.remove("disabled")},
saveInLocalStorage:function(){console.log("pollinlocalstorage"+this.pollState);console.log(this.pollState.data);console.log(this.pollState);localStorage.setItem("pollState",JSON.stringify(this.pollState))},onmessage:function(a,c){"stdPublish"==a.poll.pollMsg&&(this.dataRec=a.poll.data);console.log("student side "+a.poll.pollMsg);virtualclass.poll[a.poll.pollMsg].call(this,a.poll.data,c);"stdPublishResult"==a.poll.pollMsg&&this.resultToStorage()},pollPopUp:function(a,c,b){for(var f=function(){console.log(this.id);
virtualclass.poll.action(this.id,a,c,b);"goBack"!=this.id&&"cacelSetting"!=this.id||virtualclass.modal.removeModal()},d=(document.getElementById("editPollModal")?document.getElementById("editPollModal"):document.getElementById("qnPopup")).querySelectorAll("#pollModalBody .controls"),m=0;m<d.length;m++)d[m].addEventListener("click",f)},attachConfirmInit:function(a,c,b,d){this.action(a,c,b,d)},action:function(a,c,b,d){c(a,b,d)},displaycoursePollList:function(){var a,c=this;this.dispList("course");if(a=
document.querySelector("#listQnContcourse tbody"))for(;a.childNodes.length;)a.removeChild(a.lastChild);var b=document.querySelector("#listQnContcourse");if(this.coursePoll.length)b&&(b.style.display="block"),a=document.querySelector("#mszBoxPoll"),a.style.display="none",this.coursePoll.forEach(function(a,b){c.forEachPoll(a,b,"course")});else{a=document.querySelector("#mszBoxPoll");var d=virtualclass.lang.getString("noPoll");a.style.display="block";a.innerHTML=d;b&&(b.style.display="none")}(a=document.getElementById("emptyListsite"))&&
a.parentNode.removeChild(a);this.dispNewPollBtn("course");"teacherPublish"!=this.pollState.currScreen&&(this.pollState.currScreen="displaycoursePollList")},displaysitePollList:function(a){var c,b=this;this.dispList("site");if(c=document.querySelector("#listQnContsite tbody"))for(;c.childNodes.length;)c.removeChild(c.lastChild);var d=document.querySelector("#listQnContsite");if(this.sitePoll.length)this.sitePoll.forEach(function(c,f){b.forEachPoll(c,f,"site",a)}),d&&(d.style.display="block"),c=document.querySelector("#mszBoxPoll"),
c.style.display="none";else{c=document.querySelector("#mszBoxPoll");var k=virtualclass.lang.getString("noPoll");"false"==a&&(k=virtualclass.lang.getString("noPollNoAdmin"));c.style.display="block";c.innerHTML=k;d&&(d.style.display="none")}(c=document.getElementById("emptyListcourse"))&&c.parentNode.removeChild(c);this.dispNewPollBtn("site",a);"teacherPublish"!=this.pollState.currScreen&&(this.pollState.currScreen="displaysitePollList")},dispList:function(a){var c=document.getElementById("mszBoxPoll");
0<c.childNodes.length&&c.childNodes[0].parentNode.removeChild(c.childNodes[0]);c="course"==a?"site":"course";this.hidePollList(c);var b=document.getElementById("listQnCont"+a);b?(b.style.display="table",(b=document.getElementById("newPollBtn"+a))&&b.classList.contains(c)&&(b.classList.remove(c),b.classList.add(a))):this.UI.layout2("layoutPollBody",a)},dispNewPollBtn:function(a,c){this.attachEvent("newPollBtn"+a,"click",this.newPollHandler,a);var b=document.getElementById("newPollBtn"+a);"site"==a?
("undefined"!=typeof c&&"true"==c?b.style.display="table":(b.style.display="none",roles.hasControls&&(a=document.getElementById("listQnContsite"),a.classList.add("teacherTableHeader"))),b=document.getElementById("newPollBtncourse")):(roles.hasControls&&(a=document.getElementById("listQnContsite"),a.classList.remove("teacherTableHeader")),b.style.display="table",b=document.getElementById("newPollBtnsite"));b&&(b.style.display="none")},forEachPoll:function(a,c,b,d){var f={};f.questiontext=a.questiontext;
f.creator=a.creatorname;f.pollType=b;f.index=c;var g=virtualclass.getTemplate("qn","poll");(document.querySelector("#listQnCont"+b+" .pollList tbody")||document.querySelector("#listQnCont"+b+" .pollList")).insertAdjacentHTML("beforeend",g({pollQn:f}));if("course"==b&&a.createdby==wbUser.id||"site"==b&&"true"==d){if(a.isPublished){if(d=document.querySelector("#editQn"+b+c+" span"))d.setAttribute("title",virtualclass.lang.getString("etDisabledA")),d.style.cursor="default",d.classList.add("disabled")}else this.attachEvent("editQn"+
b+c,"click",this.editHandler,a,b,c,a.createdby,a.questionid);this.attachEvent("deleteQn"+b+c,"click",this.deleteHandler,a,b,c)}else{if(d=document.querySelector("#editQn"+b+c+" span"))d.setAttribute("title",virtualclass.lang.getString("etDisabledCr")),d.style.cursor="default",d.classList.add("disabled");d=document.querySelector("#deleteQn"+b+c+" span");d.setAttribute("title",virtualclass.lang.getString("dltDisabled"));d.style.cursor="default";d.classList.add("disabled")}d="course"==b?virtualclass.poll.coursePoll:
virtualclass.poll.sitePoll;if(c==d.length-1||c==d.length-2||c==d.length-3)d=document.querySelector("#contQn"+b+c),d.classList.add("lastNode");this.attachEvent("publishQn"+b+c,"click",this.publishHandler,a,b,c);this.previewOnHover(a,b,c)},previewOnHover:function(a,c,b){var f={};document.querySelector("#qnText"+c+b+" .popover-content")||(f.questiontext=a.questiontext,f.options=a.options,a=virtualclass.getTemplate("previewPopup","poll")({data:f}),virtualclass.modal.attachpopupHandler(c,b,a))},attachEvent:function(a,
c,b,d,k,m,n,p,v){p=document.getElementById(a);null!=p&&p.addEventListener(c,function(){"undefined"!=typeof d?b(d,k,m,a,n,v):b(k,m,a,n,v)})},hidePollList:function(a){if(a=document.getElementById("listQnCont"+a))a.style.display="none"},editHandler:function(a,c,f){a=document.getElementById("mszBoxPoll");0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);a={};b="course"==c?virtualclass.poll.coursePoll[f]:virtualclass.poll.sitePoll[f];a.options=b.options;a.questiontext=b.questiontext;
var d=virtualclass.getTemplate("edit-modal","poll");document.querySelector("#bootstrapCont").insertAdjacentHTML("beforeend",d({data:a}));virtualclass.poll.UI.editPoll(c,f);virtualclass.modal.closeModalHandler("editPollModal")},stdResponse:function(a,c){this.updateResponse(a,c)},newPollHandler:function(a){var c=document.querySelector("#createPollCont"),b=document.querySelector("#editPollModal");b&&b.remove();b=virtualclass.getTemplate("modal","poll");c.insertAdjacentHTML("beforeend",b());virtualclass.modal.closeModalHandler("editPollModal");
virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,void 0,a)},popupFn:function(a,c,b){virtualclass.poll[a].call(this.poll,c,b,a)},next:function(a,c){virtualclass.poll.pollSetting(c,a)},goBack:function(a,c){console.log("modal dismiss")},etSave:function(a,c,b){var f=virtualclass.poll.isBlank();if(!f)return 0;f="course"==c?virtualclass.poll.coursePoll[a]:virtualclass.poll.sitePoll[a];var d="course"==c?virtualclass.poll.cmid:0,m=document.getElementById("q");document.getElementById("etSave").setAttribute("data-dismiss",
"modal");if("undefined"!=typeof a)virtualclass.poll.saveQuestion(m,a,c),virtualclass.poll.saveOption(a,c),virtualclass.poll.interfaceToEdit({questionid:f.questionid,question:f.questiontext,options:f.options,createdby:f.createdby},d);else if(f=virtualclass.poll.newPollSave("undefined",c),!f)return 0;"etSave"==b&&virtualclass.modal.removeModal();return 1},closePoll:function(a){var c=virtualclass.lang.getString("pclose");virtualclass.popup.confirmInput(c,virtualclass.poll.askConfirmClose,"close",a)},
saveQuestion:function(a,c,b){"course"==b?(this.coursePoll[c].questiontext=a.value,this.coursePoll[c].creator=wbUser.name):(this.sitePoll[c].questiontext=a.value,this.sitePoll[c].creator=wbUser.name);console.log(this.coursePoll);document.getElementById("qnText"+b+c).innerHTML=a.value},saveOption:function(a,c){var b=[],d=0,k;a="course"==c?this.coursePoll[a]:this.sitePoll[a];var m=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt");for(c=0;c<m.length;c++)b[c]=
m[c].value;for(k in a.options)a.options[k]=b[d],d++;if(c>d)for(d,k=d;k<c;k++)a.options["noid"+d]=b[d],d++},hideModal:function(){virtualclass.modal.removeModal()},newPollSave:function(a,c){a=0;var b=[];if(!virtualclass.poll.isBlank())return 0;for(var d=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt"),k=0;k<d.length;k++)b.push(d[k].value);d=document.getElementById("q");"course"==c&&(a=virtualclass.poll.cmid);virtualclass.poll.interfaceToSave({question:d.value,
options:b,action:"newPollSave",category:a,copied:!1},a);return 1},isBlank:function(){document.getElementById("q");for(var a=document.getElementById("optsTxCont").querySelectorAll("#virtualclassCont #optsTxCont .opt"),c=0,b=0,d=0;d<a.length;d++)null==a[d].value||""===a[d].value.trim()?b++:c++;a=document.getElementById("q");return null==a.value||""===a.value.trim()?(virtualclass.lang.getString("pollblank"),alert(virtualclass.lang.getString("pollblank")),0):2>c?(alert(virtualclass.lang.getString("minoption")),
0):b?(alert(virtualclass.lang.getString("delblank")),0):1},saveNdPublish:function(a,c){var b=virtualclass.poll.isBlank();if(!b)return 0;var d=c+"Poll";var k=document.getElementById("optsTxCont");k=k.querySelectorAll("#virtualclassCont #optsTxCont .opt");if("undefined"==typeof a){d=virtualclass.poll[d].length;b=document.getElementById("q").value;var m={};k=document.getElementById("optsTxCont");k=k.querySelectorAll("#virtualclassCont #optsTxCont .opt");for(var n=0;n<k.length;n++)m[n]=k[n].value;virtualclass.poll.dataToStd.question=
b;virtualclass.poll.dataToStd.options=m;(b=virtualclass.poll.newPollSave(d,c,!0))&&virtualclass.poll.pollSetting(c,d,!0)}else{m=virtualclass.poll[d][a];b=document.getElementById("q").value;m.question=b;b=0;for(n in m.options)m.options[n]=k[b].value,b++;virtualclass.poll[d][a].questiontext=document.getElementById("q").value;virtualclass.poll.dataToStd.question=virtualclass.poll[d][a].questiontext;virtualclass.poll.dataToStd.options=virtualclass.poll[d][a].options;(b=virtualclass.poll.etSave(a,c,void 0))&&
virtualclass.poll.pollSetting(c,a,!0)}a={type:"course",qid:a,pollqnOps:virtualclass.poll.dataToStd};virtualclass.poll.pollState.currScreen="setting";virtualclass.poll.pollState.data=a},pollCancel:function(){virtualclass.popup.closeElem();virtualclass.modal.closeModalHandler("editPollModal")},reset:function(){for(var a=document.querySelectorAll("#editPollModal textArea"),c=0;c<a.length;c++)a[c].value=""},addMoreOption:function(a,c){virtualclass.poll.UI.createOption(a,c)},removeOption:function(a,c,
b){var f=b.replace("remove","");b=document.getElementById(b);b.parentNode.parentNode.removeChild(b.parentNode);a="course"==a?virtualclass.poll.coursePoll[c]:virtualclass.poll.sitePoll[c];"undefined"!==typeof a&&(delete a.options[f],virtualclass.poll.interfaceToDelOption(f))},publishHandler:function(a,c,b){var f=document.getElementById("mszBoxPoll");0<f.childNodes.length&&f.childNodes[0].parentNode.removeChild(f.childNodes[0]);a.isPublished?virtualclass.poll.duplicatePoll(a):virtualclass.poll.publishPoll(a,
c,b)},duplicatePoll:function(a){var c=[],b;for(b in a.options)c.push(a.options[b]);virtualclass.poll.interfaceToSave({question:a.questiontext,options:c,action:"newPollSave",category:a.category,copied:!0},a.category)},publishPoll:function(a,c){virtualclass.poll.dataToStd.question=a.questiontext;virtualclass.poll.dataToStd.qId=a.questionid;virtualclass.poll.dataToStd.options=a.options;var b=document.getElementById("layoutPollBody"),d=document.createElement("div");d.className="container";b.appendChild(d);
(b=document.getElementById("editPollModal"))&&b.remove();b={};b.questiontext=a.questiontext;b.options=a.options;d=virtualclass.getTemplate("preview-modal","poll");var k=document.querySelector("#virtualclassApp #bootstrapCont");k&&k.insertAdjacentHTML("beforeend",d({poll:b}));c||(c="0"==a.category?"site":"course");virtualclass.poll.pollPreview(c);virtualclass.modal.closeModalHandler("editPollModal")},pollPreview:function(a){var c=document.getElementById("contFooter");virtualclass.poll.UI.previewFooterBtns(c,
a)},publishHandler2:function(){virtualclass.poll.showMsg("mszBoxPoll","poll published","alert-success")},deleteHandler:function(a,c,b){a=document.getElementById("mszBoxPoll").querySelectorAll("#mszBoxPoll .alert");0<a.length&&a[0].parentNode.removeChild(a[0]);a=virtualclass.lang.getString("pollDel");virtualclass.popup.confirmInput(a,virtualclass.poll.askConfirm,c,b)},showMsg:function(a,c,b){var f=document.getElementById(a);if(!f){var d=document.getElementById("layoutPollBody");f=document.createElement("div");
f.id=a;d.appendChild(f)}var m=document.createElement("div");m.className="alert  alert-dismissable";m.classList.add(b);m.innerHTML=c;f.insertBefore(m,f.firstChild);a=document.createElement("button");a.className="close";a.setAttribute("data-dismiss","alert");a.innerHTML="&times";m.appendChild(a);a.addEventListener("click",function(){m.parentNode.removeChild(m)})},askConfirm:function(a,c,b){if(a){a=document.getElementById("contQn"+c+b);a.parentNode.removeChild(a);a=virtualclass.lang.getString("Pdsuccess");
virtualclass.poll.showMsg("mszBoxPoll",a,"alert-success");a="course"==c?virtualclass.poll.coursePoll[b]:virtualclass.poll.sitePoll[b];var f=a.questionid;a="course"==c?virtualclass.poll.coursePoll:virtualclass.poll.sitePoll;a.splice(b,1);virtualclass.poll.interfaceToDelete(f)}},askConfirmClose:function(a,c,b){if(a){(virtualclass.poll.setting.showResult&&roles.hasControls()||!roles.hasControls())&&ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"});virtualclass.poll.resultToStorage();
virtualclass.poll.UI.pollClosedUI();virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list});a=virtualclass.lang.getString("Pclosed");virtualclass.poll.showMsg("resultLayoutHead",a,"alert-success");virtualclass.poll.pollState.data.pollClosed="yes";clearInterval(virtualclass.poll.timer);a=virtualclass.poll.timer=0;for(var f in virtualclass.poll.count)virtualclass.poll.count[f]&&(a=1);if(a)f=document.getElementById("chart"),"list"!=virtualclass.poll.currResultView&&
(f.style.display="block");else{virtualclass.poll.noneVoted(b);if(b=document.getElementById("resultLayoutHead"))for(f=0;f<b.childNodes.length;f++)b.childNodes[f].parentNode.removeChild(b.childNodes[f]);f=document.getElementById("pollResultMsz");f.parentNode.removeChild(f);f=document.getElementById("chartMenuCont");f.parentNode.removeChild(f)}}},showStudentPollReport:function(a){virtualclass.poll.studentReportLayout(a);(a=document.getElementById("mszBoxPoll"))&&a.parentNode.removeChild(a)},studentReportLayout:function(a){for(var c=
document.getElementById("layoutPollBody");1<c.childElementCount;)c.removeChild(c.lastChild);var b=document.createElement("div");c.appendChild(b);c=a.result;virtualclass.poll.count=c;virtualclass.poll.dataRec=a.pollData;virtualclass.poll.stdPublishResult(c,"true")},timerDisable:function(){document.getElementById("timer").classList.add("disabled")},stdPublish:function(){var a;(a=document.getElementById("mszBoxPoll"))&&0<a.childNodes.length&&a.childNodes[0].parentNode.removeChild(a.childNodes[0]);virtualclass.poll.timer&&
clearInterval(virtualclass.poll.timer);(a=document.getElementById("resultLayout"))&&a.parentNode.removeChild(a);(a=document.getElementById("stdPollContainer"))&&a.parentNode.removeChild(a);if(a=document.querySelector(".congrea.student #virtualclassPoll #navigator #stdPollHeader"))a.style.display="block";a={};a.question=virtualclass.poll.dataRec.options;var c=virtualclass.getTemplate("pollStd","poll");document.querySelector("#layoutPollBody").insertAdjacentHTML("beforeend",c({poll:a}));this.UI.stdPublishUI();
virtualclass.poll.dataRec.setting.timer?(a=virtualclass.poll.dataRec.newTime,virtualclass.poll.newTimer=a,this.showTimer(a),a=document.querySelector("#timerLabel"),a.innerHTML=virtualclass.lang.getString("Rtime")):(this.elapsedTimer(),a=virtualclass.lang.getString("Tmyclose"),virtualclass.poll.showMsg("stdContHead",a,"alert-success"),a=document.querySelector("#timerLabel"),a.innerHTML=virtualclass.lang.getString("ETime"));a=document.getElementById("stdQnCont");this.showQn(a);a=document.getElementById("stdOptionCont");
this.showOption(a);(a=document.getElementById("btnVote"))&&a.addEventListener("click",virtualclass.poll.voted);a={stdPoll:virtualclass.poll.dataRec,timer:virtualclass.poll.newUserTime};if(c=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult"))c.style.display="none";virtualclass.poll.pollState.currScreen="stdPublish";virtualclass.poll.pollState.data=a},voted:function(){virtualclass.poll.pollState.currScreen="voted";if(!document.querySelector("#virtualclassCont.congrea #stdPollContainer #btnVote").classList.contains("disabled"))if(virtualclass.poll.saveSelected()){virtualclass.poll.timer&&
clearInterval(virtualclass.poll.timer);var a=document.getElementById("stdPollMszLayout");a&&a.parentNode.removeChild(a);a=document.getElementById("stdPollContainer");a.parentNode.removeChild(a);a=virtualclass.poll.dataRec.setting.showResult?virtualclass.lang.getString("votesuccess"):virtualclass.lang.getString("votesuccessPbt");document.querySelector(".congrea.student #mszBoxPoll").style.display="block";virtualclass.poll.showMsg("mszBoxPoll",a,"alert-success");virtualclass.poll.sendResponse()}else alert("Select an option");
a={stdPoll:virtualclass.poll.dataRec,timer:virtualclass.poll.newUserTime};virtualclass.poll.pollState.currScreen="voted";virtualclass.poll.pollState.data=a},sendResponse:function(){var a=virtualclass.vutil.whoIsTeacher();ioAdapter.mustSendUser({poll:{pollMsg:"stdResponse",data:virtualclass.poll.responseId},cf:"poll"},a)},timeStamp:function(a){virtualclass.poll.newTimer=a},saveSelected:function(){for(var a=document.getElementById("stdOptionCont").querySelectorAll("#stdOptionCont .opt"),c=0;c<a.length;c++)if(a[c].checked)return virtualclass.poll.responseId=
a[c].id,1;if(c==a.length)return 0},elapsedTimer:function(a,c){virtualclass.poll.hasOwnProperty("timer")&&clearInterval(virtualclass.poll.timer);var b=document.getElementById("timerLabel");b&&(b.innerHTML=virtualclass.lang.getString("ETime"));if(a||c){var d=a;var k=c}else d=k=0;if(roles.hasControls())var m=document.getElementById("timerCont");else{if(a=document.getElementById("stdContHead"))m=document.querySelector("#timerCont"),null==m&&(m=document.createElement("div"),m.id="timerCont",a.appendChild(m));
d=virtualclass.poll.dataRec.newTime.min;k=virtualclass.poll.dataRec.newTime.sec}a=function(){m?(k++,60==k&&(k=0,d++,60==d&&(d=0)),virtualclass.poll.newUserTime.min=d,virtualclass.poll.newUserTime.sec=k,m.innerHTML=(10>d?"0"+d:d)+":"+(10>k?"0"+k:k)):clearInterval(virtualclass.poll.timer)};a();virtualclass.poll.timer=setInterval(a,1E3)},showTimer:function(a,c){var b;virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);var d=document.getElementById("timerCont");roles.hasControls()&&virtualclass.poll.pollState.data&&
(virtualclass.poll.pollState.data.newTime=virtualclass.poll.newUserTime,console.log("test"+virtualclass.poll.pollState.data.newTime));var k=b=0;roles.hasControls()&&("undefined"!=typeof a.digit?(c=a.digit,a=a.unit,k=c,b=0,"minut"==a&&(b=c,k=0)):"undefined"!=typeof a.min&&(b=a.min,k=a.sec));roles.hasControls()||!virtualclass.poll.newTimer.min&&!virtualclass.poll.newTimer.sec||(b=virtualclass.poll.newTimer.min,k=virtualclass.poll.newTimer.sec,virtualclass.poll.newTimer={});a=function(){d?(virtualclass.poll.newUserTime.min=
b,virtualclass.poll.newUserTime.sec=k,d.innerHTML=(10>b?"0"+b:b)+":"+(10>k?"0"+k:k),console.log("testtimer"+virtualclass.poll.timer),k--,0>=k&&(k=59,b--,0>b&&(k=b=0,d.innerHTML=(10>b?"0"+b:b)+":"+(10>k?"0"+k:k),clearInterval(virtualclass.poll.timer),virtualclass.poll.timerExpired()))):clearInterval(virtualclass.poll.timer)};if(b||k)a(),virtualclass.poll.timer=setInterval(a,1E3)},timerExpired:function(){var a=document.getElementById("btnVote");a&&a.classList.add("disabled");roles.hasControls()&&(virtualclass.poll.setting.showResult&&
ioAdapter.mustSend({poll:{pollMsg:"stdPublishResult",data:virtualclass.poll.count},cf:"poll"}),virtualclass.poll.timer&&virtualclass.poll.interfaceToSaveResult({qid:virtualclass.poll.dataToStd.qId,list:virtualclass.poll.list}),this.testNoneVoted());virtualclass.poll.timer=0;if(a=document.getElementById("congreaPollVoters"))a.innerHTML=virtualclass.lang.getString("rvtu");virtualclass.poll.pollState.data.pollClosed="yes"},testNoneVoted:function(){var a=0,c;for(c in virtualclass.poll.count)virtualclass.poll.count[c]&&
(a=1);if(a)(c=document.getElementById("chart"))&&"list"!=virtualclass.poll.currResultView&&(c.style.display="block");else{this.noneVoted();if(a=document.getElementById("resultLayoutHead"))for(c=0;c<a.childNodes.length;c++)a.childNodes[c].parentNode.removeChild(a.childNodes[c]);c=document.getElementById("pollResultMsz");c.parentNode.removeChild(c);c=document.getElementById("chartMenuCont");c.parentNode.removeChild(c)}},stdPublishResult:function(a,c){virtualclass.poll.count=a;virtualclass.poll.timer&&
clearInterval(virtualclass.poll.timer);if(virtualclass.poll.dataRec||c)virtualclass.poll.dataRec.setting.showResult?this.resultDisplay(a):(this.noResultDisplay(),a=document.getElementById("resultLayoutHead"),virtualclass.poll.UI.resultNotShownUI(a),virtualclass.poll.pollState.currScreen="stdPublishResult",virtualclass.poll.pollState.data="noResult");virtualclass.poll.resultToStorage()},resultDisplay:function(a){var c=document.querySelector(".congrea #stdPollContainer");c&&(c.style.display="none");
(c=document.getElementById("resultLayout"))&&c.parentNode.removeChild(c);virtualclass.poll.UI.createResultLayout();document.getElementById("resultLayout");c=document.getElementById("timerWrapper");c.parentNode.removeChild(c);c=document.getElementById("resultLayout");c.classList.add("bootstrap","container");virtualclass.poll.count=a;(a=document.getElementById("mszBoxPoll"))&&0<a.childNodes.length&&(a=a.querySelectorAll("#mszBoxPoll .alert"),0<a.length&&a[0].parentNode.removeChild(a[0]));(c=document.getElementById("chartMenuCont"))&&
virtualclass.poll.UI.chartMenu(c);a=0;for(var b in virtualclass.poll.count)virtualclass.poll.count[b]&&(a=1);a?(virtualclass.poll.showGraph(),document.getElementById("chart").style.display="block"):this.noneVoted();b={stdPoll:virtualclass.poll.dataRec,timer:virtualclass.poll.newUserTime,count:virtualclass.poll.count};virtualclass.poll.pollState.currScreen="stdPublishResult";virtualclass.poll.pollState.data=b},noResultDisplay:function(){var a=document.getElementById("stdPollContainer");a&&a.parentNode.removeChild(a);
virtualclass.poll.UI.createResultLayout();var c=document.getElementById("resultLayoutHead");if(c)for(a=0;a<c.childNodes.length;a++)c.childNodes[a].parentNode.removeChild(c.childNodes[a]);if(c=document.getElementById("resultLayoutBody"))for(a=0;a<c.childNodes.length;a++)c.childNodes[a].parentNode.removeChild(c.childNodes[a])},noneVoted:function(a){"undefined"!=typeof virtualclass.poll.timer&&clearInterval(virtualclass.poll.timer);this.noResultDisplay();var c=document.querySelector("#resultLayoutHead");
c&&(c.style.display="none");document.querySelector("#qnLabelCont");if(c=document.querySelector("#chartMenuCont"))c.style.display="none";c=document.getElementById("resultLayoutBody");var b=document.createElement("div");b.className="pollResultNotify";b.id="resultNote";c.appendChild(b);c.insertBefore(b,c.firstChild);b=virtualclass.lang.getString("Pclosed");virtualclass.poll.showMsg("resultNote",b,"alert-error");b=document.getElementById("resultNote");var d=document.createElement("div");d.className="notifyText alert alert-info";
d.id="congreaPollNote";d.innerHTML=virtualclass.lang.getString("Novote");b.appendChild(d);b=virtualclass.poll.dataRec;roles.hasControls()||this.showPollText(c,b);(c=document.getElementById("modalClose"))&&c.addEventListener("click",function(){var c=document.querySelector("#editPollModal");c&&c.remove();roles.hasControls()&&a&&virtualclass.poll.pollState.currScreen&&"teacherPublish"==virtualclass.poll.pollState.currScreen&&(virtualclass.poll.pollState.currScreen="course"==a?"displaycoursePollList":
"displaysitePollList")})},showPollText:function(a){var c=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec;a={};a.question=c.question;a.options=c.options;c=virtualclass.getTemplate("qnOptions","poll");document.querySelector("#resultLayoutBody #optnNonVotd").insertAdjacentHTML("beforeend",c({poll:a}))},showQn:function(a){roles.hasControls()?a.innerHTML=virtualclass.poll.dataToStd.question:a.innerHTML=virtualclass.poll.dataRec.question},showOption:function(a){var c=roles.hasControls()?
virtualclass.poll.dataToStd:virtualclass.poll.dataRec,b=c.options,d;for(d in b){b=document.createElement("div");a.appendChild(b);var k=document.createElement("input");k.className="opt";k.setAttribute("name","option");k.setAttribute("value",d);k.setAttribute("type","radio");k.id=d;b.appendChild(k);k=document.createElement("span");k.className="stdoptn";b.appendChild(k);k.innerHTML=c.options[d]}},pollSetting:function(a,c,b){virtualclass.poll.UI.hidePrevious(c);null==document.getElementById("settingTx"+
c)&&virtualclass.poll.UI.pollSettingUI(c,a);"undefined"!=typeof b&&document.getElementById("publish").setAttribute("disable",!0);document.getElementById("publish").addEventListener("click",function(){virtualclass.poll.saveSetting(a,b)});document.getElementById("cancelSetting").addEventListener("click",function(){virtualclass.modal.removeModal("editPollModal")});virtualclass.modal.closeModalHandler("editPollModal")},saveSetting:function(a,c){if(document.getElementById("radioBtn2")){var b=document.getElementById("radioBtn2").checked;
virtualclass.poll.setting.timer=b}var d=document.getElementById("timer");if(d){virtualclass.poll.setting.time.digit=d.options[d.selectedIndex].value;var k=document.getElementById("ut");virtualclass.poll.setting.time.unit=k.options[k.selectedIndex].value;k=Date.now();console.log("sender TimeStamp"+Date.now());virtualclass.poll.setting.time.timestamp=k}document.getElementById("pollCkbox")&&(k=document.getElementById("pollCkbox").checked,virtualclass.poll.setting.showResult=k);virtualclass.poll.UI.resultView(b,
a);virtualclass.poll.currResultView="bar";b?virtualclass.poll.showTimer(virtualclass.poll.setting.time,0):virtualclass.poll.elapsedTimer();"undefined"!=typeof c&&(virtualclass.poll.dataToStd.qId=virtualclass.poll.currQid,virtualclass.poll.dataToStd.options=virtualclass.poll.currOption);a={question:virtualclass.poll.dataToStd.question,options:virtualclass.poll.dataToStd.options,qId:virtualclass.poll.dataToStd.qId,setting:virtualclass.poll.setting,newTime:virtualclass.poll.newUserTime,count:virtualclass.poll.count,
list:virtualclass.poll.list,users:virtualclass.poll.uniqueUsers,pollType:a};"undefined"!=typeof virtualclass.poll.afterReload&&(a.newTime=virtualclass.poll.afterReload,delete virtualclass.poll.afterReload);d&&(ioAdapter.mustSend({poll:{pollMsg:"stdPublish",data:a},cf:"poll"}),console.log("to send"+a));a.view=virtualclass.poll.currResultView;virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.currScreen="teacherPublish";virtualclass.poll.pollState.data=a},updateResponse:function(a,
c){var b=document.getElementById("chart");b&&"list"!=virtualclass.poll.currResultView&&(b.style.display="block");if(b=document.getElementById("pollResultMsz"))b.style.display="none";b=document.querySelectorAll("#chartMenuCont button");for(var d=0;d<b.length;d++)b[d].classList.remove("disabled");b={};"undefined"==typeof virtualclass.poll.count[a]&&(virtualclass.poll.count[a]=0);virtualclass.poll.count[a]+=1;b[c.userid]=a;b.username=c.name;virtualclass.poll.list.push(b);"bar"==virtualclass.poll.currResultView?
(virtualclass.poll.showGraph(),virtualclass.poll.updateBarGraph()):"pi"==virtualclass.poll.currResultView?virtualclass.poll.updatePiChart():"list"==virtualclass.poll.currResultView&&virtualclass.poll.updateListResult()},noOfVotes:function(a){var c=virtualclass.hasOwnProperty("connectedUsers")?virtualclass.connectedUsers.length:0,b=0,d;for(d in virtualclass.poll.count)b+=virtualclass.poll.count[d];c=c?c-1:0;virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.totalUsers=a?a:c);(a=virtualclass.poll.uniqueUsers.length?
virtualclass.poll.uniqueUsers.length:0)&&(c=a);a=document.getElementById("receivedVotes");null!=a&&(a.innerHTML=b+"/"+c)},updateBarGraph:function(){var a=document.getElementById("chart"),c=document.getElementById("pollResultMsz"),b=[],d=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,k;for(k in virtualclass.poll.count)b.push([d.options[k],virtualclass.poll.count[k]]),virtualclass.poll.count[k]&&(a&&(a.style.display="block"),c&&(c.style.display="none"));for(k in d.options)virtualclass.poll.count.hasOwnProperty(k)||
(b.push([d.options[k],"0"]),virtualclass.poll.count[k]=0);virtualclass.poll.chart&&virtualclass.poll.chart.load({columns:b});roles.hasControls()&&this.noOfVotes()},updatePiChart:function(){var a=document.getElementById("chart"),c=document.getElementById("pollResultMsz");this.noOfVotes();var b=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,d=[],k;for(k in virtualclass.poll.count)d.push([b.options[k],virtualclass.poll.count[k]]),virtualclass.poll.count[k]&&(a&&(a.style.display=
"block"),c&&(c.style.display="none"));for(k in b.options)virtualclass.poll.count.hasOwnProperty(k)||(d.push([b.options[k],"0"]),virtualclass.poll.count[k]=0);virtualclass.poll.piChart&&virtualclass.poll.piChart.load({columns:d})},updateListResult:function(){this.noOfVotes();var a=virtualclass.poll.list.pop();virtualclass.poll.addResultListItem(a);virtualclass.poll.list.push(a);virtualclass.poll.pollState.data.list=virtualclass.poll.list},createPiChart:function(){var a=roles.hasControls()?virtualclass.poll.dataToStd:
virtualclass.poll.dataRec;virtualclass.poll.currResultView="pi";var c=document.getElementById("chart");c.style.display="none";var b=document.getElementById("listCont");b&&(b.style.display="none");b=[];var d=!1,k;for(k in virtualclass.poll.count)b.push([a.options[k],virtualclass.poll.count[k]]),virtualclass.poll.count[k]&&(d=!0);d&&(c.style.display="block");virtualclass.poll.piChart=c3.generate({data:{columns:b,transition:{duration:null},type:"pie",onclick:function(a,c){console.log("onclick",a,c)},
onmouseover:function(a,c){console.log("onmouseover",a,c)},onmouseout:function(a,c){console.log("onmouseout",a,c)}}});virtualclass.poll.currResultView="pi";"undefined"!=typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="pi")},listView:function(){virtualclass.poll.currResultView="list";document.getElementById("chart").style.display="none";var a=document.getElementById("resultLayoutBody"),c=document.getElementById("listCont");c.hasChildNodes()&&c.removeChild(c.childNodes[0]);
0<virtualclass.poll.list.length&&(virtualclass.poll.createResponseTable(a),(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a));if(c=document.getElementById("listCont"))c.style.display="block"},createResponseTable:function(a){a=virtualclass.getTemplate("pollresultlist","poll");document.querySelector("#virtualclassApp #listCont").insertAdjacentHTML("beforeend",a({}));virtualclass.poll.list.forEach(function(a,b){virtualclass.poll.addResultListItem(a,b)});virtualclass.poll.currResultView=
"list";"undefined"!=typeof virtualclass.poll.pollState.data&&(virtualclass.poll.pollState.data.view="list",virtualclass.poll.pollState.data.list=virtualclass.poll.list)},addResultListItem:function(a){var c,b=virtualclass.poll.dataToStd.options,d=document.getElementById("resultList");for(k in a)"username"!=k&&(c=a[k]);var k=document.createElement("tr");d.appendChild(k);d=document.createElement("td");d.innerHTML=a.username;k.appendChild(d);d=document.createElement("td");d.innerHTML=b[c];k.appendChild(d)},
barGraph:function(){var a=document.getElementById("chart");a&&(a.style.display="block");virtualclass.poll.currResultView="bar";if(a=document.getElementById("listCont"))a.style.display="none";virtualclass.poll.showGraph();virtualclass.poll.updateBarGraph();virtualclass.poll.pollState.data.view="bar"},showGraph:function(){var a=roles.hasControls()?virtualclass.poll.dataToStd:virtualclass.poll.dataRec,c=[],b;for(b in virtualclass.poll.count)c.push([a.options[b],virtualclass.poll.count[b]]);a={type:"bar"};
a.columns=c;if(c=document.getElementById("chart"))c.style.display="none";virtualclass.poll.chart=c3.generate({bindto:"#chart",data:a,bar:{width:100}})},UI:{id:"virtualclassPoll",class:"virtualclass",container:function(){var a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);a=virtualclass.getTemplate("pollmain","poll");var c=roles.hasAdmin()?!0:!1;virtualclass.vutil.insertAppLayout(a({control:c}));if(roles.hasAdmin()){var b=document.querySelector("#coursePollTab"),d=document.querySelector("#sitePollTab");
d.addEventListener("click",function(){b.classList.remove("active");d.classList.add("active");d.style.pointerEvents="none";b.style.pointerEvents="visible";virtualclass.poll.interfaceToFetchList(0)});b.addEventListener("click",function(){d.classList.remove("active");b.classList.add("active");b.style.pointerEvents="none";d.style.pointerEvents="visible";virtualclass.poll.interfaceToFetchList(virtualclass.poll.cmid)})}else{document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult").style.display=
"none";virtualclass.storage.getAllDataOfPoll(["pollStorage"],function(a){if(a&&(a=JSON.parse(a.pop().pollResult),a.pollData.setting.showResult)){virtualclass.poll.previousResult=a;if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #pollResult"))a.style.display="block";if(a=document.querySelector("#virtualclassCont.congrea.student #navigator #stdPollHeader"))a.style.display="none"}});var k=document.querySelector(".congrea.student #virtualclassPoll #navigator #pollResult");k.addEventListener("click",
function(){virtualclass.poll.showStudentPollReport(virtualclass.poll.previousResult);k.classList.add("active")})}},resultView:function(a,c){document.getElementById("layoutPoll");if(roles.hasControls()&&(this.createResultLayout(),!a)){var b=document.getElementById("resultLayoutHead");a=document.getElementById("closePoll");a||(a=document.createElement("button"),a.id="closePoll",a.className="btn btn-default col-md-2",b.appendChild(a),a.innerHTML=virtualclass.lang.getString("closeVoting"),a.addEventListener("click",
function(){virtualclass.poll.closePoll(c)}),b=document.createElement("i"),b.className="icon-close-poll",a.appendChild(b))}if(a=document.getElementById("modalClose"))a.removeAttribute("data-dismiss"),a.addEventListener("click",function(){virtualclass.poll.pollModalClose(c)});virtualclass.poll.count={};virtualclass.poll.list=[]},createResultLayout:function(){var a=document.getElementById("resultLayout");a&&a.parentNode.removeChild(a);var c=roles.hasControls()?!0:!1;a={};a.control=c;if(roles.hasControls()){a.question=
virtualclass.poll.dataToStd.question;a.options=virtualclass.poll.dataToStd.options;c=virtualclass.getTemplate("result-modal","poll");var b=document.querySelector("#editPollModal");b&&b.remove();document.querySelector("#bootstrapCont").insertAdjacentHTML("beforeend",c({obj:a}));a=document.querySelectorAll("#chartMenuCont button");for(c=0;c<a.length;c++)a[c].classList.add("disabled")}else a.question=virtualclass.poll.dataRec.question,c=virtualclass.getTemplate("stdResult","poll"),document.querySelector("#virtualclassPoll").insertAdjacentHTML("beforeend",
c({obj:a}));this.resultLayoutBody()},resultNotShownUI:function(a){var c=document.querySelector("#resultLayoutBody");c&&(c.style.display="none");if(a=document.getElementById("mszBoxPoll"))for(;0<a.childNodes.length;)a.removeChild(a.childNodes[0]);else a=document.createElement("div"),a.id="mszBoxPoll",c.appendChild(a);a=virtualclass.lang.getString("noResultStd");document.querySelector("#mszBoxPoll").style.display="block";if(c=document.querySelector("#resultLayoutHead"))c.style.display="none";virtualclass.poll.showMsg("mszBoxPoll",
a,"alert-success")},resultLayoutBody:function(a){if(a=document.querySelector("#qnLabelCont"))roles.hasControls()&&(a.innerHTML=virtualclass.poll.dataToStd.question),roles.hasControls()&&(this.chartMenu(),this.createResultMsgCont())},createResultMsgCont:function(a){document.getElementById("pollResultMsz").innerHTML=virtualclass.lang.getString("watstdrespo")},pollClosedUI:function(){var a=document.getElementById("closePoll");a&&a.parentNode.removeChild(a);if(a=document.getElementById("congreaPollVoters"))a.innerHTML=
virtualclass.lang.getString("rvtu");(a=document.getElementById("pollResultMsz"))&&a.parentNode.removeChild(a)},chartMenu:function(a){a=document.querySelector("#chartMenuCont #bar");a.addEventListener("click",virtualclass.poll.barGraph);document.querySelector("#chartMenuCont #pi").addEventListener("click",virtualclass.poll.createPiChart);roles.hasControls()&&(a=document.querySelector("#chartMenuCont #rList"),a.addEventListener("click",virtualclass.poll.listView))},qnLabel:function(a){var c=document.createElement("div");
c.id="chart";c.className="row";a.appendChild(c)},createNav:function(a){roles.hasControls()||document.querySelector(".congrea.student #virtualclassPoll #navigator a").addEventListener("click",function(){virtualclass.poll.showStudentPollReport()})},createMszBox:function(a){var c=document.createElement("div");c.id="mszBoxPoll";c.className="row";a.appendChild(c)},createOption:function(a,c){for(var b,d,k=document.getElementById("optsTxCont").querySelectorAll("#optsTxCont .opt"),m=0,n=0;n<k.length;n++)m++,
d=k[n].id;b=d?m:"0";d={};d.index=b;d.closeBtn=1<b?!0:!1;d=virtualclass.getTemplate("optioninput","poll")({close:d});document.querySelector("#addMoreCont").insertAdjacentHTML("beforebegin",d);d=document.getElementById("remove"+b);d.addEventListener("click",function(){virtualclass.poll.removeOption(c,a,"remove"+b)})},hidePrevious:function(a){(a=document.getElementById("optsTxCont"))&&a.parentNode.removeChild(a);if(a=document.getElementById("reset"))a.style.display="none";a=document.getElementById("footerCtrCont");
a.parentNode.removeChild(a)},editPoll:function(a,c){virtualclass.poll.UI.loadContent(a,c);virtualclass.poll.UI.footerBtns(a,c)},loadContent:function(a,c){document.getElementById("qnTxCont");virtualclass.poll.UI.editQn(a,c);var f=b.options;var d=0;if("object"==typeof f)for(var k in f)console.log(k),d++,virtualclass.poll.UI.editOptions(a,c,k,d);else for(k=0;k<f.length;k++)virtualclass.poll.UI.editOptions(a,c,k,d)},previewFooterBtns:function(a,c,b){document.getElementById("footerCtrCont")&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,
b,c)},footerBtns:function(a,c){a&&virtualclass.poll.pollPopUp(virtualclass.poll.popupFn,c,a)},editQn:function(a,c){var b=document.querySelector("#qnTxCont #q");null==b&&(b.value=document.getElementById("qnText"+a+c).innerHTML);null==b||b.value||(b.value="course"==a?virtualclass.poll.coursePoll[c].questiontext:virtualclass.poll.sitePoll[c].questiontext)},editOptions:function(a,c,b,d){document.getElementById("optsTxCont").style.display="block";document.getElementById("opt"+c+b);if(2<d){var f=document.createElement("a");
f.id="remove"+b;f.className="close";f.innerHTML="&times";document.querySelector("#optsTxCont .inputWrapper #option"+b).parentNode.appendChild(f);f.addEventListener("click",function(){virtualclass.poll.removeOption(a,c,f.id)})}d=document.getElementById("option"+b);b="course"==a?virtualclass.poll.coursePoll[c].options[b]:virtualclass.poll.sitePoll[c].options[b];d.value="object"==typeof b?b.options:b},pollSettingUI:function(a,c){for(var b=virtualclass.getTemplate("setting-modal","poll"),d=document.querySelector("#editPollModal");d.firstChild;)d.removeChild(d.firstChild);
d.insertAdjacentHTML("beforeend",b({time:function(a,c){var b=[];for(a=c-a+1;a--;)b[a]=c--;return b}(1,60)}));this.settingUIBody(a,c)},settingUIBody:function(a,c){this.addSettingHandlers()},addSettingHandlers:function(){document.getElementById("mode").addEventListener("click",function(){var a=document.getElementById("radioBtn1");var c=document.getElementById("radioBtn2");a.checked?(a=document.getElementById("timer"),a.setAttribute("disabled",!0),a=document.getElementById("ut"),a.setAttribute("disabled",
!0)):c.checked&&(a=document.getElementById("timer"),a.removeAttribute("disabled"),a=document.getElementById("ut"),a.removeAttribute("disabled"))})},defaultLayoutForStudent:function(){this.container();var a=document.getElementById("mszBoxPoll");if(null==document.getElementById("stdPollMszLayout")){var c=document.createElement("div");c.id="stdPollMszLayout";c.innerHTML=virtualclass.lang.getString("pollmaybeshown");a.appendChild(c)}},stdPublishUI:function(){var a=document.getElementById("stdPollMszLayout");
a&&a.parentNode.removeChild(a)},disableClose:function(){document.getElementById("pollClose").style.display="none"}},updateUsersOnPoll:function(){0>virtualclass.poll.uniqueUsers.indexOf(virtualclass.jId)&&(virtualclass.poll.uniqueUsers.push(virtualclass.jId),0<Object.keys(virtualclass.poll.count).length&&virtualclass.poll.noOfVotes())}}};d.poll=b})(window);var dashBoard={userConfirmation:function(d,b){virtualclass.popup.confirmInput(d,function(a){b(a)})},close:function(){console.log("Close dashboard");var d=document.querySelector("#congdashboard .modal-content button.close");null!=d&&(d.classList.remove("clicked"),d.click(),d=document.querySelector("#dashboardnav button"),null!=d&&d.classList.remove("clicked"),virtualclass.modal.hideModal())},isDashBoardExit:function(d){return null!=document.querySelector("#"+d+"Dashboard")},isDashBoardNavExist:function(){return null!=
document.querySelector("#dashboardnav")},actualCloseHandler:function(){var d=document.querySelector("#congdashboard .modal-content button.close");null!=d&&d.addEventListener("click",function(){var b=document.querySelector("#dashboardnav button");null!=b&&(b.classList.remove("clicked"),dashBoard.dashBoardClickTooltip("open"))})},clickCloseButton:function(){var d=document.querySelector("#dashboardnav button");null!=d&&d.classList.add("clicked")},dashBoardClickTooltip:function(d){var b=document.querySelector("#dashboardnav button");
"Video"==virtualclass.currApp?b.parentNode.setAttribute("data-title",virtualclass.lang.getString(d+"videoDashboard")):"SharePresentation"==virtualclass.currApp?b.parentNode.setAttribute("data-title",virtualclass.lang.getString(d+"SharePresentationdbHeading")):"DocumentShare"==virtualclass.currApp?b.parentNode.setAttribute("data-title",virtualclass.lang.getString(d+"dsDbheading")):console.log("dashboard tooltip not working properly")}};(function(d){d.videoUl=function(){return{videos:[],uploaderParam:{},videoObj:{},videoId:"",videoUrl:"",isfullscreen:!1,order:[],currPlaying:"",autoPlayFlag:1,status:0,yts:!1,online:!1,listEndPause:!1,attachPlayer:!1,init:function(b,a){this.videoInit=!0;this.currPlaying="";this.pages={};virtualclass.previrtualclass="virtualclassVideo";virtualclass.previous="virtualclassVideo";this.autoPlayFlag=1;"undefined"!=typeof b&&("studentlayout"!=b.init&&(this.videoId=b.init.videoId||b.init,this.videoUrl=b.init.videoUrl,
this.yts=b.init.yts,this.online=b.init.online,this.isPaused=b.init.isPaused),"undefined"!=typeof b.isAutoplay&&(this.autoPlayFlag=b.isAutoplay));if(!roles.hasAdmin()||roles.isEducator()){if("undefined"!=typeof this.videoId||!roles.isStudent()||virtualclass.videoUl.yts)if(this.UI.container(),roles.hasControls())ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"}),ioAdapter.mustSend({videoUl:{init:{id:virtualclass.videoUl.videoId,videoUrl:virtualclass.videoUl.videoUrl},startFrom:virtualclass.videoUl.player.currentTime()},
cf:"videoUl"});else if("undefined"!=typeof b)if(b.hasOwnProperty("fromReload"))this.fromReload(this.videoId,this.videoUrl,a);else{if(void 0!=this.videoId&&"undefined"!=typeof this.videoId&&("object"!=typeof this.videoId||0!=this.videoId.yts)){var c=b.url||b.init.videoUrl;"undefined"!=typeof c&&""!=c&&"studentlayout"!=b.init&&("undefined"==typeof a?this.UI.displayVideo(b.id,c):this.UI.displayVideo(b.id,c,a))}}else if(a=document.getElementById("messageLayoutVideo"))a.style.display="block"}else this.UI.container(),
b=document.querySelector("#dashboardnav button"),null!=b&&b.click(),"undefined"!=typeof a?this.fromReload(this.videoId,this.videoUrl,a):ioAdapter.mustSend({videoUl:{init:"studentlayout"},cf:"videoUl"})},isPlayerReady:function(){return virtualclass.videoUl.hasOwnProperty("player")&&"object"==typeof virtualclass.videoUl.player},createPageModule:function(){virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(b,a){virtualclass.videoUl.pages[b.id]=
new virtualclass.page("videoList","video","virtualclassVideo","videoUl",b.status)})},reArrangeElements:function(b){var a=document.getElementById("listvideo"),c=document.createElement("div");c.id="listvideo";c.className="videos";var f=this.getActiveVideos(),d=!1;for(j=0;j<f.length;j++)-1>=b.indexOf(f[j].fileuuid)&&(b.push(f[j].fileuuid),d=!0);d&&(virtualclass.videoUl.order=b,virtualclass.videoUl.sendOrder(virtualclass.videoUl.order));for(f=0;f<b.length;f++)(d=document.getElementById("linkvideo"+b[f]))&&
c.appendChild(d);a.parentNode.replaceChild(c,a)},getActiveVideos:function(){for(var b=[],a=0;a<virtualclass.videoUl.videos.length;a++)virtualclass.videoUl.videos[a].hasOwnProperty("deleted")||b.push(virtualclass.videoUl.videos[a]);return b},fromReload:function(b,a,c){virtualclass.videoUl.UI.container();a&&virtualclass.videoUl.UI.displayVideo(b,a,c)},saveVideosInLocalStr:function(){console.log(virtualclass.videoUl.order);console.log("videosinlocalstorage");console.log(virtualclass.videoUl.videos);
localStorage.setItem("videoList",JSON.stringify(virtualclass.videoUl.videos));localStorage.setItem("videoOrder",JSON.stringify(virtualclass.videoUl.order))},requestOrder:function(){virtualclass.vutil.requestOrder("vid",function(b){"Error"==b?console.log("page order retrieve failed"):"undefined"!=typeof b&&void 0!=b&&(virtualclass.videoUl.order=[],virtualclass.videoUl.order=b,0<virtualclass.videoUl.order.length&&virtualclass.videoUl.reArrangeElements(virtualclass.videoUl.order))})},afterDocStatus:function(b){},
updateOrder:function(){var b=this.getActiveVideos();b.length!=this.order.length&&(this.order=b.map(function(a){return a.fileuuid}));this.sendOrder(this.order)},afterUploadVideo:function(b,a,c){if(c=c.success){this.updateOrder();virtualclass.videoUl.order.push(virtualclass.gObj.file.uuid);virtualclass.videoUl.sendOrder(virtualclass.videoUl.order);virtualclass.videoUl.showUploadMsz("Video uploaded successfully","alert-success");(b=document.querySelector(".congrea #VideoDashboard #videoPopup"))&&(b.classList.contains("uploadSuccess")||
b.classList.add("uploadSuccess"));for(b=0;b<virtualclass.gObj.uploadingFiles.length;b++)a={},a.filename=virtualclass.gObj.uploadingFiles[b].name+" (Processing...)",a.fileuuid=virtualclass.gObj.uploadingFiles[b].uuid,a.filetype="video",a.key_room=virtualclass.gObj.sessionInfo.key+"_"+virtualclass.gObj.sessionInfo.room,a.noVideo=!0,console.log("File uploading "+a.filename),this.afterUploadFile(a);virtualclass.gObj.uploadingFiles=[];virtualclass.serverData.pollingStatus(virtualclass.videoUl.UI.awsVideoList)}else virtualclass.videoUl.showUploadMsz("video upload failed",
"alert-error");if(b=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))b.style.display="none"},showUploadMsz:function(b,a){var c=document.querySelector("#VideoDashboard #uploadMsz"),f=document.querySelector("#VideoDashboard #uploadMsz .alert");f&&f.parentNode.removeChild(f);var d=document.createElement("div");d.className="alert  alert-dismissable";d.classList.add(a);d.innerHTML=b;c.appendChild(d);b=document.createElement("button");b.className="close";b.setAttribute("data-dismiss",
"alert");b.innerHTML="&times";b.addEventListener("click",function(){var a=document.querySelector("#uploadMsz");a&&(a.style.display="none");(a=document.querySelector(".congrea #VideoDashboard #videoPopup"))&&a.classList.remove("uploadSuccess");d.parentNode.removeChild(d)});d.appendChild(b)},retrieveOrder:function(){this.requestOrder()},afterUploadFile:function(b){var a=b.fileuuid;this.pages[a]=new virtualclass.page("videoList","video","virtualclassVideo","videoUl",b.status,b.filetype);if("video_yts"==
b.filetype){var c=virtualclass.videoUl.getVideoId(b.URL);virtualclass.videoUl.UI.fetchYtsTitle(b,c)}this.pages[a].init(a,b.filename);this.videoDisplayHandler(b);a=document.getElementById("linkvideo"+b.fileuuid);if(c=document.getElementById("videoTitle"+b.fileuuid))c.innerHTML=b.filename;c=a.getElementsByClassName("status")[0];b.hasOwnProperty("disabled")?(this._disable(b.fileuuid),a&&(a.classList.add("disable"),a.dataset.status=0)):(this._enable(b.fileuuid),a&&(a.classList.add("enable"),a.dataset.status=
1));c.dataset.status=a.dataset.status;this.calculateHeight();b.hasOwnProperty("noVideo")&&a.classList.add("noVideo")},calculateHeight:function(){var b=document.querySelector("#listvideo"),a=document.querySelector(".congrea .qq-uploader-selector");console.log(b.offsetHeight);b=b.offsetHeight;console.log(a.offsetHeight);$(".qq-uploader-selector").css({minHeight:b})},showVideos:function(b,a){roles.hasControls()&&virtualclass.videoUl.showVideoList();virtualclass.videoUl.videoUrl&&(virtualclass.videoUl.activeVideoClass(virtualclass.videoUl.videoId),
virtualclass.vutil.showFinishBtn())},showVideoList:function(){document.getElementById("videoList");var b=document.getElementById("listvideo");if(b)for(var a=0;a<b.childNodes.length-1;a++)b.childNodes[a].parentNode.removeChild(b.childNodes[a]);virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,b){a.hasOwnProperty("deleted")||(b=document.querySelector("#linkvideo"+a.fileuuid),null!=b&&b.classList.remove("noVideo"),virtualclass.videoUl.afterUploadFile(a))});
virtualclass.vutil.makeElementActive("#listvideo");b=document.querySelector(".congrea #listvideo .linkvideo.singleVideo");a=document.querySelector(".congrea #listvideo .linkvideo");1!=virtualclass.videoUl.videos.length||b?1<virtualclass.videoUl.videos.length&&b&&b.classList.remove("singleVideo"):a.classList.add("singleVideo")},videoDisplayHandler:function(b){var a=document.getElementById("mainpvideo"+b.fileuuid);a&&!b.status?a.classList.contains("playDisable")||a.classList.add("playDisable"):a&&a.classList.contains("playDisable")&&
a.classList.remove("playDisable");a&&a.addEventListener("click",function(){virtualclass.videoUl.isPaused=!1;"video_yts"==b.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"==b.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1);if(b.urls){var a=b.urls.main_video;virtualclass.videoUl.UI.displayVideo(b.fileuuid,a);virtualclass.videoUl.activeVideoClass(b.fileuuid);var d={};d.content_path=
a;d.id=b.fileuuid;d.title=b.filename;d.type=b.filetype;virtualclass.videoUl.videoToStudent(d);virtualclass.videoUl.videoId=b.fileuuid;virtualclass.vutil.showFinishBtn();virtualclass.dashBoard.close()}})},activeVideoClass:function(b){for(var a=document.getElementsByClassName("controlCont"),c=0;c<a.length;c++)a[c].classList.contains("removeCtr")&&a[c].classList.remove("removeCtr");(a=document.getElementById("controlContvideo"+b))&&!a.classList.contains("removeCtr")&&a.classList.add("removeCtr");a=document.getElementsByClassName("linkvideo");
for(c=0;c<a.length;c++)a[c].classList.contains("playing")&&a[c].classList.remove("playing");(b=document.getElementById("linkvideo"+b))&&!b.classList.contains("playing")&&b.classList.add("playing")},shareVideo:function(b){var a={};virtualclass.videoUl.UI.displayVideo("no",b);a.instantVideo=!0;a.content_path=b;virtualclass.videoUl.videoToStudent(a)},destroyPl:function(){"object"==typeof virtualclass.videoUl.player&&("ScreenShare"==virtualclass.currApp&&ioAdapter.mustSend({video:"destroyPl",cf:"video"}),
virtualclass.videoUl.player.dispose())},_rearrange:function(b){this.order=b;this.reArrangeElements(b);this.sendOrder(this.order)},_editTitle:function(b,a,c){c=new FormData;var f={lc_content_id:b,action:"edit",title:a,user:virtualclass.gObj.uid};c=new FormData;for(var g in f)c.append(g,f[g]),console.log(f[g]);virtualclass.xhr.sendFormData(c,d.webapi+"&user="+virtualclass.gObj.uid+"&methodname=update_content_video",function(c){"ERROR"!=c&&(c=document.getElementById("videoTitle"+b))&&(c.innerHTML=a,
c.style.display="inline",virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(c,d){c.id==b&&(console.log(c),c.title=a)}))})},sendOrder:function(b,a){virtualclass.vutil.sendOrder("vid",b)},onmessage:function(b){if("string"==typeof b.videoUl)if("play"==b.videoUl)this.playVideo(b),virtualclass.videoUl.isPaused=!1;else if("pause"==b.videoUl)this.pauseVideo(),virtualclass.videoUl.isPaused=!0;else if("destroyPlayer"==b.videoUl)virtualclass.videoUl.destroyPlayer();
else if("enterFullScreen"==b.videoUl)virtualclass.videoUl.enterFullScreen();else if("exitFullScreen"==b.videoUl)virtualclass.videoUl.exitFullScreen();else{if("videoDelete"==b.videoUl&&(b=document.querySelector("#videoPlayerCont"))){b.style.display="none";if(b=document.querySelector("#messageLayoutVideo"))b.style.display="block";virtualclass.videoUl.videoId=null;virtualclass.videoUl.videoUrl=null;b=document.querySelector(".congrea #dispVideo video");var a=document.querySelector(".congrea #dispVideo iframe");
(b=b?b:a)&&b.setAttribute("src","")}}else this.onmessageObj(b)},onmessageObj:function(b){b.videoUl.type&&("video_yts"==b.videoUl.type?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.online=!1):"video_online"==b.videoUl.type?(virtualclass.videoUl.online=!0,virtualclass.videoUl.yts=!1):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!1));if(b.videoUl.hasOwnProperty("init"))if(virtualclass.videoUl.rec=b.videoUl,console.log(virtualclass.videoUl.rec),"studentlayout"==b.videoUl.init){if(virtualclass.makeAppReady("Video",
void 0,b.videoUl),b=document.getElementById("messageLayoutVideo"))b.style.display="block"}else b.videoUl.init.hasOwnProperty("videoUrl")&&(virtualclass.videoUl.videoId=b.videoUl.init.id,virtualclass.videoUl.videoUrl=b.videoUl.init.videoUrl,virtualclass.videoUl.UI.displayVideo(b.videoUl.init.id,b.videoUl.init.videoUrl,b.videoUl.startFrom));else b.videoUl.hasOwnProperty("content_path")?(virtualclass.videoUl.videoId=b.videoUl.id,virtualclass.videoUl.videoUrl=b.videoUl.content_path,virtualclass.videoUl.title=
b.videoUl.title,virtualclass.videoUl.UI.displayVideo(b.videoUl.id,virtualclass.videoUl.videoUrl)):b.videoUl.hasOwnProperty("play")&&(this.playVideo(b.videoUl.play),virtualclass.videoUl.isPaused=!1)},enablePlayer:function(){var b=document.getElementById("videoPlayerCont");b&&(b.style.display="block")},disablePlayer:function(){var b=document.getElementById("videoPlayerCont");b&&(b.style.display="none")},destroyPlayer:function(){virtualclass.videoUl.player.dispose()},playVideo:function(b){virtualclass.videoUl.isPlayerReady()&&
(console.log("====Video play"),virtualclass.videoUl.player.currentTime(b),virtualclass.videoUl.player.play())},pauseVideo:function(){virtualclass.videoUl.isPlayerReady()&&(console.log("====Video pause"),virtualclass.videoUl.player.pause(),virtualclass.videoUl.isPaused=!0)},autoPlayList:function(b){var a=this.getActiveVideos();b=this.findNextObj(b);"object"!=typeof b?b<a.length&&(b=this.autoPlayList(b)):(a={},a.id=b.fileuuid,a.title=b.filename,a.type=b.filetype,virtualclass.videoUl.listEnd||("video_online"==
b.filetype?(virtualclass.videoUl.yts=!1,virtualclass.videoUl.online=!0,virtualclass.videoUl.UI.displayVideo(b.fileuuid,b.URL),virtualclass.videoUl.videoToStudent(b),this.activeVideoClass(b.id),a.content_path=b.URL):(virtualclass.videoUl.online=!1,"video_yts"==b.filetype?(virtualclass.videoUl.yts=!0,virtualclass.videoUl.UI.displayVideo(b.fileuuid,b.URL),a.content_path=b.URL):(virtualclass.videoUl.yts=!1,virtualclass.videoUl.UI.displayVideo(b.fileuuid,b.urls.main_video),a.content_path=b.urls.main_video),
virtualclass.videoUl.videoToStudent(a)),virtualclass.videoUl.player&&virtualclass.videoUl.player.ready(function(){this.play()}),this.activeVideoClass(b.fileuuid)))},findNextObj:function(b){for(var a=this.findNextVideoId(b),c=this.getActiveVideos(),d=0;d<c.length;d++)if(c[d].fileuuid==a)return"1"==document.getElementById("linkvideo"+c[d].fileuuid).getAttribute("data-status")?b=c[d]:b+1},findNextVideoId:function(b){var a=document.querySelectorAll("#listvideo .linkvideo");return b<a.length?a[b].getAttribute("data-rid"):
!1},findVideoIndex:function(b){for(var a=document.querySelectorAll("#listvideo .linkvideo"),c=0;c<a.length;c++)if(a[c].getAttribute("data-rid")==b)return b=c},_disable:function(b){document.querySelector("#linkvideo"+b).classList.add("playDisable");var a=document.getElementById("mainpvideo"+b);a.style.opacity=.3;a.style.pointerEvents="none";virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,d){a.fileuuid==b&&(a.disabled=0,a.status=0)})},
_enable:function(b){document.querySelector("#linkvideo"+b).classList.remove("playDisable");var a=document.getElementById("mainpvideo"+b);a&&(a.style.opacity=1,a.style.pointerEvents="auto",virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(a,d){a.fileuuid==b&&(delete a.disabled,a.status=1)}))},_delete:function(b){var a=this;virtualclass.xhrn.sendData({uuid:b,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,function(c){a.afterDeleteCallback(c,
b)})},afterDeleteCallback:function(b,a){if("ERROR"!=b&&(b=document.getElementById("linkvideo"+a))){b.parentNode.removeChild(b);if(virtualclass.videoUl.videoId==a&&(b=document.querySelector("#videoPlayerCont"))){b.style.display="none";ioAdapter.mustSend({videoUl:"videoDelete",cf:"videoUl"});virtualclass.videoUl.videoId=null;virtualclass.videoUl.videoUrl=null;b=document.querySelector(".congrea #dispVideo video");var c=document.querySelector(".congrea #dispVideo iframe");(b=b?b:c)&&b.setAttribute("src",
"");virtualclass.vutil.removeFinishBtn()}virtualclass.videoUl.videos&&virtualclass.videoUl.videos.length&&virtualclass.videoUl.videos.forEach(function(c,b){c.fileuuid==a&&(b=virtualclass.videoUl.videos.indexOf(c),0<=b&&(virtualclass.videoUl.videos.splice(b,1),console.log(virtualclass.videoUl.videos)))});b=virtualclass.videoUl.order.indexOf(a);0<=b&&(virtualclass.videoUl.order.splice(b,1),console.log(virtualclass.videoUl.order),virtualclass.videoUl.sendOrder(virtualclass.videoUl.order));virtualclass.videoUl.videos.length?
1==virtualclass.videoUl.videos.length&&(b=document.querySelector(".congrea #listvideo .linkvideo"))&&b.classList.add("singleVideo"):virtualclass.vutil.removeFinishBtn()}},xhrOrderSend:function(b){virtualclass.xhrn.sendData({order:b.toString()},virtualclass.api.UpdateRoomMetaData,function(){virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList)})},videoToStudent:function(b){ioAdapter.mustSend({videoUl:b,cf:"videoUl"})},getVideoId:function(b){b=b.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/);
return null!=b&&1<b.length&&(b=b[1].substring(0,11),11==b.length)?b:!1},UI:{id:"virtualclassVideo",class:"bootstrap virtualclass",container:function(){if(!document.getElementById("virtualclassVideo")){var b={control:roles.hasAdmin()?!0:!1};virtualclass.vutil.insertAppLayout((0,JST[virtualclass.gObj.tempPrefix+"/videoupload/videoupload.hbs"])(b));document.getElementById(this.id)}!roles.hasControls()&&(b=document.getElementById("messageLayoutVideo"))&&(b.style.display="block")},createYoutubeUrlCont:function(b){var a=
document.createElement("div");a.id="listvideo";b.appendChild(a)},displayVideo:function(b,a,c){var d=this;virtualclass.videoUl.hasOwnProperty("displayVideoTime")&&clearTimeout(virtualclass.videoUl.displayVideoTime);virtualclass.videoUl.displayVideoTime=setTimeout(function(){"Video"==virtualclass.currApp&&d._displayVideo(b,a,c)},300)},_displayVideo:function(b,a,c){var d;"object"==typeof virtualclass.videoUl.player&&virtualclass.videoUl.player.hasOwnProperty("dispose")&&virtualclass.videoUl.player.dispose();
virtualclass.videoUl.videoUrl=a;virtualclass.videoUl.videoId=b;(d=document.getElementById("videoPlayerCont"))?d.style.display="block":(virtualclass.videoUl.UI.container(),d=document.getElementById("videoPlayerCont"));var g=document.querySelector("iframe#player");g&&g.remove();virtualclass.videoUl.UI.switchDisplay(d,a);virtualclass.videoUl.UI.videojsPlayer(a,b,c);virtualclass.modal.hideModal()},videojsPlayer:function(b,a,c){if(!virtualclass.videoUl.player){var d=videojs("dispVideo");if(roles.hasControls()){$(".vjs-autoPlay-button").length||
virtualclass.videoUl.UI.appendAutoPlayButton(d);var g=document.getElementById("autoPlayListBtn");g&&(g.className=virtualclass.videoUl.autoPlayClass)}virtualclass.videoUl.player=d;virtualclass.videoUl.UI.attachPlayerHandler(virtualclass.videoUl.player,a,b)}virtualclass.videoUl.UI.onEndedHandler(virtualclass.videoUl.player,a,b);virtualclass.videoUl.UI.setPlayerUrl(virtualclass.videoUl.player,b,c)},attachPlayerHandler:function(b,a,c){this.attachPlayer||(this.attachPlayer=!0,console.log("Attach video player"),
b.on("pause",function(a){console.log("paused");roles.hasControls()&&ioAdapter.mustSend({videoUl:"pause",cf:"videoUl"});virtualclass.videoUl.isPaused=!0}),b.on("play",function(a){console.log("play");roles.hasControls()&&ioAdapter.mustSend({videoUl:{play:b.currentTime()},cf:"videoUl"});virtualclass.videoUl.isPaused=!1}))},switchDisplay:function(b,a){var c;(c=document.getElementById("dispVideo"))?c.style.display="block":virtualclass.videoUl.UI.createVideoElem(b);c=document.getElementById("videoPlayerCont");
b=document.getElementById("messageLayoutVideo");"undefined"==typeof a?(c.style.display="none",b?b.style.display="block":(c=document.createElement("div"),c.id="messageLayoutVideo")):(c.style.display="block",b&&(b.style.display="none"))},createVideoElem:function(b,a){b.insertAdjacentHTML("beforeend",'<video id="dispVideo" class="video-js" autoplay controls  preload="auto" data-setup="{}" >');b=document.createElement("p");b.setAttribute("class","vjs-no-js");document.getElementById("dispVideo").appendChild(b);
a=document.createElement("a");a.setAttribute("href","https://videojs.com/html5-video-support/");a.setAttribute("target","_blank");a.innerHTML="supports HTML5 video";b.appendChild(a)},setPlayerUrl:function(b,a,c){console.log("====Video init to play start");void 0==c&&virtualclass.videoUl.startTime&&(c=virtualclass.videoUl.startTime);b.poster_&&(b.poster_="");var d=document.querySelector("#dispVideo");virtualclass.videoUl.yts?(d.setAttribute("data-setup",'{ techOrder: [youtube],"preload": "auto"}'),
b.src({type:"video/youtube",src:a})):virtualclass.videoUl.online?(d.setAttribute("data-setup",'{"preload": "auto" }'),b.src({type:"video/webm",src:a}),b.src({type:"video/mp4",src:a})):(d.setAttribute("data-setup",'{"preload": "auto"}'),b.src({type:"application/x-mpegURL",withCredentials:!0,src:a}));b.ready(function(){var a=this;a.on("loadedmetadata",function(){virtualclass.videoUl.isPaused?a.pause():"desktop"==virtualclass.system.device&&a.play();c&&(a.currentTime(c),virtualclass.videoUl.yts&&!virtualclass.videoUl.isPaused&&
"desktop"==virtualclass.system.device&&a.play())})});console.log(c)},appendAutoPlayButton:function(b){virtualclass.videoUl.autoPlayClass=virtualclass.videoUl.autoPlayFlag?"vjs-autoPlay-button vjs-control on":"vjs-autoPlay-button vjs-control off";b.controlBar.addChild("button",{el:videojs.createEl("button",{className:"vjs-autoPlay-button vjs-control on",id:"autoPlayListBtn",role:"button",title:"Auto Play",onclick:function(){virtualclass.videoUl.UI.autoPlayFn(this)}})})},autoPlayFn:function(b){b.classList.contains("off")?
(virtualclass.videoUl.autoPlayFlag=1,b.classList.remove("off"),b.classList.add("on"),b.style.color="green"):(virtualclass.videoUl.autoPlayFlag=0,b.classList.remove("on"),b.classList.add("off"),b.style.color="red")},onEndedHandler:function(b,a,c){b.off("ended");b.on("ended",function(d){virtualclass.videoUl.UI.onEnded(b,a,c)})},onEnded:function(b,a,c){var d=document.querySelector("#dispVideo");virtualclass.videoUl.yts?(d.setAttribute("data-setup","{ techOrder: [youtube],controls: true,}"),b.src({type:"video/youtube",
src:c})):virtualclass.videoUl.online?(d.setAttribute("data-setup",'{"preload": "auto", "controls": true, }'),b.src({type:"video/webm",src:c}),b.src({type:"video/mp4",src:c})):(d.setAttribute("data-setup",'{"preload": "auto", "controls": true, }'),b.src({type:"application/x-mpegURL",withCredentials:!0,src:c}));console.log("ended"+a);c=document.querySelectorAll("#listvideo .linkvideo");for(var g=d=0;g<c.length;g++)if(c[g].getAttribute("data-rid")==a){d=g;break}virtualclass.videoUl.autoPlayFlag?(b.poster_&&
(b.poster_=""),virtualclass.videoUl.findNextVideoId(d+1)?virtualclass.videoUl.autoPlayList(d+1,c):virtualclass.videoUl.UI.autoVideoPause()):virtualclass.videoUl.UI.autoVideoPause()},autoVideoPause:function(){virtualclass.videoUl.isPaused=!0;virtualclass.videoUl.listEndPause=!0;virtualclass.videoUl.player.on("play",function(){virtualclass.videoUl.listEndPause&&(console.log("==== Video is paused"),virtualclass.videoUl.player.pause(),virtualclass.videoUl.listEndPause=!1)})},inputUrl:function(){document.getElementById("congreaShareVideoUrlCont");
var b=document.getElementById("messageLayout");null!=b&&b.parentNode.removeChild(b);document.getElementById("submitURL").addEventListener("click",function(){var a=document.querySelector(".congrea #videourl");if(virtualclass.videoUl.UI.validateURL(a.value)){var c=document.querySelector(" #listvideo .playing");c&&c.classList.remove("playing");(c=document.querySelector(" #listvideo .removeCtr"))&&c.classList.remove("removeCtr");a=virtualclass.vutil.createHashString(a.value)+virtualclass.vutil.randomString(32).slice(1,
-1);virtualclass.videoUl.UI.saveYtsUrl(a)}});(b=document.querySelector(".congrea #newVideoBtn"))&&b.addEventListener("click",function(){var a=document.querySelector(".congrea #congreavideoContBody");a.style.display="block";a=document.querySelector(".congrea #listvideo");a.style.display="none"})},saveYtsUrl:function(b){var a=document.querySelector(".congrea #videourl"),c={};c.uuid=b;c.URL=a.value;c.title=a.value;b=virtualclass.api.addURL;"boolean"==typeof virtualclass.videoUl.getVideoId(a.value)?c.type=
"video_online":c.type="video_yts";virtualclass.xhrn.sendData(c,b,function(a){virtualclass.videoUl.updateOrder();virtualclass.videoUl.order.push(c.uuid);virtualclass.videoUl.sendOrder(virtualclass.videoUl.order);virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList)});document.querySelector(".congrea #videourl").value=""},fetchYtsTitle:function(b,a){$.getJSON("https://www.googleapis.com/youtube/v3/videos",{key:"AIzaSyCt1SQWwanpucKGFlzytu-mDdr6vRKzJGA",part:"snippet,statistics",
id:a},function(a){0===a.items.length?console.log("video not found"):(a=a.items[0].snippet.title,virtualclass.videoUl.UI.setYtsTitle(b,a))}).fail(function(a,b,d){console.log("unable to fetch you tube title");return"ERROR"})},validateURL:function(b){return null==b.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)?(virtualclass.popup.validateurlPopup("video"),!1):!0},setYtsTitle:function(b,a){if(b=document.querySelector("#listvideo #videoTitle"+
b.fileuuid))b.innerHTML=a},removeinputURL:function(){var b=document.getElementById("youtubeUrlContainer");null!=b&&b.parentNode.removeChild(b)},popup:function(b){(b=document.querySelector("#congreavideoContBody"))&&null!=b.lastChild&&b.removeChild(b.lastChild);b={};var a=document.querySelector("#listvideo .playing");a&&(this.currPlaying=a.getAttribute("data-rid"));b.validation="mp4 avi wmv mov webm mkv vob mpeg".split(" ");b.cb=virtualclass.videoUl.afterUploadVideo;b.cthis="video";b.multiple=!1;b.maxSize=
512E6;b.requesteEndPoint=d.webapi+"&methodname=file_save&live_class_id="+virtualclass.gObj.congCourse+"&status=1&content_type_id=2&user="+virtualclass.gObj.uid;b.wrapper=document.getElementById("congreavideoContBody");virtualclass.fineUploader.uploaderFn(b);virtualclass.vutil.isBulkDataFetched()&&virtualclass.videoUl.videos.length?(virtualclass.videoUl.showVideos(virtualclass.videoUl.videos),0<virtualclass.videoUl.order.length&&virtualclass.videoUl.reArrangeElements(virtualclass.videoUl.order)):virtualclass.serverData.fetchAllData(virtualclass.videoUl.UI.awsVideoList);
(b=document.querySelector("#virtualclassCont.congrea #VideoDashboard .qq-uploader.qq-gallery"))&&b.setAttribute("qq-drop-area-text","Drop videos here");b=document.querySelector("#uploadMsz");if(a=document.querySelector("#videoPopup #congreavideoContBody .qq-upload-list-selector.qq-upload-list"))a.style.display="block";var c=document.querySelector("#uploadMsz div");c||(c=document.createElement("div"),b.appendChild(c));c.appendChild(a);b=document.querySelectorAll("#videoPopup #uploadMsz ul");if(2<b.length)for(a=
0;a<b.length-1;a++)b[a].querySelector("li")||b[a].parentNode.removeChild(b[a]);a=document.querySelector("#videoPopup #uploadMsz .qq-upload-list-selector.qq-upload-list");document.querySelector("#uploadVideo").addEventListener("click",function(){var a=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-button input"),c=document.querySelector("#uploadMsz");c&&(c.style.display="block");a&&a.click()})},awsr:function(){console.log("Request get document url 2");this.postAjax(virtualclass.api.GetDocumentURLs,
"Demo")},awsVideoList:function(){for(var b=virtualclass.awsData,a=[],c=0;c<b.length;c++)"video"!=b[c].filetype&&"video_yts"!=b[c].filetype&&"video_online"!=b[c].filetype||b[c].hasOwnProperty("deleted")||a.push(b[c]);console.log(a);virtualclass.videoUl.videos=a;virtualclass.serverData.rawData.video=a;virtualclass.videoUl.showVideos(a);virtualclass.videoUl.retrieveOrder()}}}}})(window);(function(d){var b=function(){return{generateModal:function(a,c){var b=document.getElementById(a+"PopupCont");elem1Id="congreaVideoContBody";elem2Id="congreaShareVideoUrlCont";var d=document.createElement("div");d.id=a+"Popup";d.className="modal";d.role="dialog";d.style.display="none";d.setAttribute("tab-index","-1");d.setAttribute("area-hidden","true");b.appendChild(d);a=document.createElement("div");a.className="modal-dialog";d.appendChild(a);d=document.createElement("div");d.className="modal-content";
d.id="videoModalBody";a.appendChild(d);a=document.createElement("div");a.id="contHead";a.className="modal-header";d.appendChild(a);b=document.createElement("button");b.type="button";b.className="close";b.id="modalClose";b.setAttribute("data-dismiss","modal");b.innerHTML="&times";a.appendChild(b);var k=document.createElement("div");k.id="modalcontBody";k.className="modal-body";d.appendChild(k);c.forEach(function(a){virtualclass.fineUploader.createElems(k,a)});c=document.createElement("form");c.id=
"form1";d.appendChild(c);c=document.createElement("div");c.id="contFooter";c.className="modal-footer";d.appendChild(c)},createElems:function(a,c){var b=document.createElement("div");b.id=c;b.className="upload";a.appendChild(b)},initModal:function(a){$("#"+a+"Popup").modal({backdrop:"static",keyboard:!1});$("#"+a+"Popup").modal({show:!0});$("#"+a+"Popup").on("hidden.bs.modal",function(){$("#"+a+"Popup").remove()})},uploaderFn:function(a){new qq.s3.FineUploader({element:a.wrapper,template:"qq-template-gallery",
debug:!0,multiple:a.multiple,validation:{allowedExtensions:a.validation,minSizeLimit:4E3,sizeLimit:a.maxSize},request:{endpoint:virtualclass.api.uploadMedia,accessKey:"AKIAJV7RJOFBDFVY62EQ"},signature:{endpoint:virtualclass.api.upload,version:4,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},uploadSuccess:{endpoint:virtualclass.api.uploadSuccess,customHeaders:{"x-api-key":wbUser.lkey,"x-congrea-authuser":wbUser.auth_user,
"x-congrea-authpass":wbUser.auth_pass,"x-congrea-room":wbUser.room}},retry:{enableAuto:!1},cors:{allowXdr:!0,expected:!0,sendCredentials:!1},objectProperties:{key:function(a){var c=wbUser.lkey,b=wbUser.room;virtualclass.gObj.file={};virtualclass.gObj.file.uuid=this.getUuid(a);virtualclass.gObj.file.name=this.getName(a);var d={name:this.getName(a),uuid:this.getUuid(a)};virtualclass.gObj.uploadingFiles.push(d);virtualclass.gObj.sessionInfo={key:c,room:b};return c+"/"+b+"/"+virtualclass.gObj.file.uuid+
"/"+this.getName(a)}},callbacks:{onComplete:function(c,b,d){if("video"==a.cthis){a.cb.call(virtualclass.videoUl,c,b,d);if(c=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))c.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listvideo");c=document.querySelector("#uploadMsz .qq-upload-list-selector.qq-upload-list");null!=c&&(c.style.display="block");c=document.querySelectorAll("#uploadMsz .qq-upload-list-selector.qq-upload-list");
if(1<c.length)for(b=1;b<c.length-1;b++)c[b].parentNode.removeChild(c[b]);virtualclass.vutil.removeChildrens("#VideoDashboard #uploadMsz .qq-upload-list-selector.qq-upload-list li");var f=document.querySelector("#VideoDashboard")}else"docs"==a.cthis&&(a.cb.call(virtualclass.dts,c,b,d),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listdocs"),c=document.querySelector("#docsuploadContainer #docsUploadMsz .qq-upload-list-selector.qq-upload-list"),
null!=c&&(c.style.display="block"),virtualclass.vutil.removeChildrens("#docsUploadMsz .qq-upload-list-selector.qq-upload-list li"),f=document.querySelector("#DocumentShareDashboard"));null!=f&&f.classList.remove("uploading")},onError:function(){var c;(c=document.querySelector(".dbContainer .alert"))&&c.parentNode.removeChild(c);if("video"==a.cthis){if(c=document.querySelector("#videoPopup .qq-upload-list-selector.qq-upload-list"))c.style.display="none";virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery");
virtualclass.vutil.makeElementActive("#listvideo")}else if("docs"==a.cthis){if(c=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))c.style.display="none";virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#listdocs")}},onSubmitted:function(c,b){this.setName(c,b.toLowerCase());if("video"==a.cthis){var d="#uploadMsz";var f="#VideoDashboard"}else"docs"==a.cthis&&(d=
"#docsUploadMsz",f="#DocumentShareDashboard");document.querySelector(f).classList.add("uploading");c=document.querySelector(d+" .close");null!=c&&c.click();c=document.querySelector(d);null!=c&&(c.style.display="block");document.querySelector(d+" .qq-upload-list-selector.qq-upload-list").style.display="block"}}})},onDragEnter:function(a){"DocumentShare"==virtualclass.currApp?(virtualclass.vutil.makeElementDeactive("#listnotes"),virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery")):
"Video"==virtualclass.currApp&&(virtualclass.vutil.makeElementDeactive("#listvideo"),virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"))},onDragEnd:function(a){}}}();d.fineUploader=b})(window);(function(d,b){var a=function(a,b,d,k,m,n){this.appId=d;this.id=null;this.parent="undefined"!=typeof a?a:null;this.status="undefined"!=typeof m?m:1;this.type=b;this.module=k;"video"==b&&(this.videoClass=n)};a.prototype.init=function(a,d){this.rid=a;this.id=this.type+a;"undefined"!=typeof d&&(this.title=d);roles.hasControls()&&(a=b.getElementById(this.parent),null==b.querySelector("#link"+this.id)&&this.createPageNav(a))};a.prototype.createPageNav=function(a){var c=b.getElementById("list"+this.type);
var d="link"+this.type+this.rid;a={rid:this.rid,status:this.status,id:this.id,type:this.type,title:this.title,titleAction:1==this.status?"Hide":"Show"};if("video"==this.type){if(c=b.getElementById("listvideo")){a=this.UI.createPageNavLink2.call(this,c);var k=virtualclass.getTemplate("linkvideo","videoupload");c.insertAdjacentHTML("beforeend",k(a));c=b.getElementById(this.type+"Title"+this.rid);c.innerHTML=this.title;c.dataset.title=this.title;this.UI.controller.init(this,d)}}else if("docs"==this.type)k=
virtualclass.getTemplate("docsNav",virtualclass.dts.tempFolder),a.title=virtualclass.vutil.trimExtension(a.title),c.insertAdjacentHTML("beforeend",k(a)),this.UI.controller.init(this,d);else if("notes"==this.type){k=virtualclass.getTemplate("notesNav",virtualclass.dts.tempFolder);var m=virtualclass.dts.getNote(this.rid);a.content_path=m.thumbnail;c.insertAdjacentHTML("beforeend",k(a));this.UI.controller.init(this,d)}else"ppt"==this.type&&(c=b.getElementById("listppt"))&&(a=this.UI.createPageNavLink2.call(this,
c),k=virtualclass.getTemplate("linkPpt","ppt"),c.insertAdjacentHTML("beforeend",k(a)),c=b.getElementById(this.type+"Title"+this.rid),c.innerHTML=this.title,c.dataset.title=this.title,this.UI.controller.init(this,d));d=b.getElementById("mainp"+this.id);this.createPageNavAttachEvent(d)};a.prototype.createPageNavAttachEvent=function(a){if("docs"==this.type){var c=virtualclass.dts;a=a.closest(".linkdocs");null!=a?a.onclick=c.docs.goToDocs(this.rid):alert("Element is null")}else"notes"==this.type&&(a.onclick=
virtualclass.dts.docs.goToNavs(this.rid))};a.prototype.displayContent=function(a,d){b.getElementById(a);a.appendChild(d)};a.prototype.sendUpdate=function(c){c.type=this.type;c.id=this.rid;a.prototype.xhrSend(c)};a.prototype.xhrSend=function(a){var c=new FormData,b;for(b in a)c.append(b,a[b]);virtualclass.xhr.sendFormData(c,d.webapi+"&user="+virtualclass.gObj.uid+("SharePresentation"!=virtualclass.currApp?"&methodname=update_content":"&methodname=update_content_video"),this.onServerResponse)};a.prototype.sendStatus2=
function(a){"notes"==this.type?a.page_id=this.rid:a.lc_content_id=this.rid;this.xhrSend(a)};a.prototype.sendStatus=function(a){if("notes"==this.type){var c=this.rid.split("_");a.uuid=c[0];a.page=parseInt(c[1])}else a.uuid=this.rid,a.page=0;virtualclass.xhrn.sendData(a,virtualclass.api.UpdateDocumentStatus,function(a){console.log("Msg "+a)})};a.prototype.rearrange=function(){var a=b.querySelectorAll("#list"+this.type+" .link"+this.type),d=[];if(null!=a)for(var g=0;g<a.length;g++)d.push(a[g].dataset.rid);
0<d.length?"notes"==this.type?virtualclass.dts.reArrangeNotes(d):virtualclass[this.module]._rearrange(d):console.log("Document share:- Element is missing")};a.prototype.disable=function(a){"notes"==this.type?virtualclass.dts._noteDisable(this.rid):virtualclass[this.module]._disable(this.rid)};a.prototype.enable=function(){"notes"==this.type?virtualclass.dts._noteEnable(this.rid):virtualclass[this.module]._enable(this.rid)};a.prototype.UI={mainPDiv:function(){var a=b.createElement("div");a.className=
"mainp"+this.type;a.id="mainp"+this.id;a.className="mainpreview";if("notes"==this.type){a.innerHTML="";var d=b.createElement("img");d.className="thumbnail";d.id="thumbnail"+this.rid;var g=virtualclass.dts.getNote(this.rid);d.src=g.content_path;d.style.border="1px solid gray";d.style.width="70px";d.style.height="40px";d.style.padding="5px";a.appendChild(d);g=b.querySelectorAll("#list"+this.type+" .link"+this.type);g=null!=g?g.length:1;var k=b.createElement("span");k.className="thumbList tooltip2";
k.innerHTML=g;k.dataset.title=this.title;a.appendChild(d);a.appendChild(k)}else"docs"==this.type&&(a.innerHTML=this.title,a.dataset.title=this.title,a.className+=" tooltip2");a.dataset.screen=this.id;a.dataset.rid=this.rid;return a},createPageNavLink2:function(){var a=b.createElement("div");a.className="link"+this.type;a.id="link"+this.id;a.className="link"+this.type+" links";a.dataset.screen=this.id;a.dataset.rid=this.rid;a.type=this.type;a.dataset.selected=0;a.dataset.status=this.status;"video"==
this.type&&a.classList.add(this.videoClass);return a},createPageNavLink:function(a){var c={};c.type=this.type;c.className="link"+this.type;c.id="link"+this.id;c.className="link"+this.type+" links";c.dataset={};c.dataset.screen=this.id;c.dataset.rid=this.rid;c.dataset.selected=0;c.dataset.status=this.status;if("video"==this.type){c.type="video";var b=virtualclass.getTemplate("linkvideo","videoupload")}else b=JST["templates/linkdoc.hbs"];a.insertAdjacentHTML("beforeend",b(c))},mainView:function(a){b.getElementById(this.parent);
if(null==b.getElementById("screen-"+this.type)){a={hasControls:roles.hasControls(),cd:virtualclass.dts.docs.currDoc};var c=JST["templates/docMain.hbs"];b.querySelector("#documentScreen").insertAdjacentHTML("beforeend",c(a))}return b.querySelector("#screen"+this.id+"   .pageContainer")},controller:{cthis:null,init:function(a,b){this.cthis=a;this.element(a,"status",this.cthis.status);this.element(a,"delete");"video"==a.type&&this.element(a,"edit");"docs"!=a.type&&this.dragDrop.init(this.cthis)},dragDrop:{cthis:null,
source:null,init:function(a){var c=this;this.cthis=a;var d=b.querySelector("#"+("link"+this.cthis.type+this.cthis.rid));d.setAttribute("draggable","true");d.addEventListener("dragstart",function(b){c.handleDragStart(b,a)},!1);d.addEventListener("dragenter",function(b){c.handleDragEnter(b,a)},!1);d.addEventListener("dragend",function(b){c.handleDragEnd(b,a)},!1)},isBefore:function(a,b){if(a&&b){if(a.parentNode==b.parentNode)for(;a;a=a.previousSibling)if(a===b)return!0;return!1}},handleDragStart:function(a,
b){a.dataTransfer.setData("text/plain","nirmala");"video"===b.type?(virtualclass.vutil.makeElementDeactive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listvideo")):"notes"===this.cthis.type&&(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes"));a.target.classList.contains("link"+b.type)?this.source=a.target:this.source=a.target.closest(".link"+
b.type);a.dataTransfer.effectAllowed="move";this.source&&this.source.classList.add("dragElem")},handleDragEnter:function(a,d){"video"==d.type?virtualclass.vutil.makeElementActive("#listvideo"):"notes"==d.type&&virtualclass.vutil.makeElementActive("#listnotes");if(this.source){this.source.classList.add("dragElem");console.log("add dragelem");if("video"==d.type||"notes"==d.type||"ppt"==d.type){var c=b.querySelectorAll("#virtualclassCont.congrea .link"+d.type+".htn");for(var f=0;f<c.length;f++)c[f].classList.remove("htn")}c=
a.target.closest(".link"+d.type);c.classList.add("htn");this.isBefore(this.source,c)?c.parentNode.insertBefore(this.source,c):(a=a.target.closest(".link"+d.type),a.parentNode.insertBefore(this.source,a.nextSibling));if("video"==d.type||"notes"==d.type||"ppt"==d.type)for(c=b.querySelectorAll("#virtualclassCont.congrea .link"+d.type+":not(.dragElem)"),f=0;f<c.length;f++)c[f].classList.add("opaq")}},handleDragEnd:function(a,d){"DocumentShare"==virtualclass.currApp&&(virtualclass.dts.indexNav.oldOrder=
virtualclass.dts.order);d.rearrange();a.preventDefault();this.source.classList.remove("dragElem");console.log("remove dragelem");if("video"==d.type||"notes"==d.type||"ppt"==d.type){"video"==d.type?virtualclass.vutil.makeElementActive("#VideoDashboard .qq-uploader-selector.qq-uploader.qq-gallery"):"notes"==d.type&&virtualclass.vutil.makeElementActive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery");virtualclass.vutil.makeElementActive("#list"+d.type);var c=b.querySelectorAll(" #virtualclassCont.congrea .link"+
d.type+".opaq");for(a=0;a<c.length;a++)c[a].classList.remove("opaq");d=b.querySelectorAll(" #virtualclassCont.congrea .link"+d.type+".htn");for(a=0;a<d.length;a++)d[a].classList.remove("htn")}}},events:{status2:function(a,b){0==+a.dataset.status?(a.title="video"==b.type||"ppt"==b.type?"Disable":"Hide",b.status=1,b.enable()):(a.title="video"==b.type||"ppt"==b.type?"Enable":"Show",b.status=0,b.disable());a.dataset.status=b.status;a.closest(".link"+b.type).dataset.status=b.status;a.querySelector(".statusanch").innerHTML=
"status"+a.dataset.status;b.sendStatus({action:"status",status:a.dataset.status})},status:function(a,b){0==+a.dataset.status?(a.title="video"==b.type||"ppt"==b.type?"Disable":"Hide",b.status=1,b.enable()):(a.title="video"==b.type||"ppt"==b.type?"Enable":"Show",b.status=0,b.disable());a.dataset.status=b.status;a.closest(".link"+b.type).dataset.status=b.status;a.querySelector(".statusanch").innerHTML="status"+a.dataset.status;b.sendStatus(0==b.status?{action:"disable"}:{action:"enable"})},delete:function(a,
b,g){virtualclass.dashBoard.userConfirmation(virtualclass.lang.getString("deletepopup"),function(a){a&&("notes"==b.type?virtualclass[b.module]._deleteNote(b.rid,b.type):virtualclass[b.module]._delete(b.rid))});"DocumentShare"==virtualclass.currApp&&(a=g?g:d.event,a.stopPropagation&&a.stopPropagation(),null!=a.cancelBubble&&(a.cancelBubble=!0))},edit:function(a,d){if(!b.querySelector("#titleCont"+d.rid)&&"video"==d.type){var c=b.querySelector("#virtualclassCont.congrea #videoTitle"+d.rid);a=c.innerHTML;
c.style.display="none";var f=b.querySelector("#virtualclassCont.congrea #videoTitleCont"+d.rid+" .controls.edit"),m=b.createElement("div");m.setAttribute("class","titleCont");m.setAttribute("id","titleCont"+d.rid);c.parentNode.insertBefore(m,f);c=b.createElement("input");c.setAttribute("type","text");c.setAttribute("class","textInput");c.setAttribute("id","temp"+d.rid);c.setAttribute("placeholder",a);m.appendChild(c);$(b).on("click",function(a){a.target.id!="temp"+d.rid&&a.target.id!="editVideoTitle"+
d.rid&&(a=b.querySelector("#virtualclassCont.congrea #temp"+d.rid))&&(a.value||(a.value=d.title),a.value&&(virtualclass.videoUl._editTitle(d.rid,a.value,d.videoClass),a=b.querySelector("#virtualclassCont.congrea #titleCont"+d.rid),a.parentNode.removeChild(a)))})}}},element2:function(a,d,g){("video"==a.type?"status"==d?b.querySelector("#controlCont"+a.type+a.rid+" .status"):b.querySelector("#controlCont"+a.type+a.rid+" .delete"):"status"==d?b.querySelector(".controls.status"):b.querySelector(".controls.delete")).onclick=
this.goToEvent(this.cthis,d)},element:function(a,d,g){g="."+d;"status"==d||"delete"==d?(g=b.querySelector("#controlCont"+a.type+a.rid+" "+g),g.onclick=this.goToEvent(this.cthis,d)):"edit"==d&&(g=b.querySelector("#"+a.type+"TitleCont"+a.rid+" "+g),g.onclick=this.goToEvent(this.cthis,d),"video_yts"!=a.videoClass&&(g.style.pointerEvents="none",g.classList.add("editDisable")));var c=this;if(g=b.querySelector("#link"+a.type+a.rid))c.hoverHandler(a),g.classList.add("showCtr"),g.addEventListener("mouseover",
function(){c.hoverHandler(a)}),g.addEventListener("mouseout",function(){c.hoverHandler1(a)})},hoverHandler:function(a){(a="video"==a.type?b.querySelector("#VideoDashboard #link"+a.type+a.rid+" .controlCont"):"ppt"==a.type?b.querySelector("#SharePresentationDashboard #link"+a.type+a.rid+" .controlCont"):b.querySelector("#DocumentShareDashboard #link"+a.type+a.rid+" .controlCont"))&&a.classList.add("showCtr")},hoverHandler1:function(a){"video"==a.type?(a=b.querySelector("#VideoDashboard #link"+a.type+
a.rid+" .controlCont"),a.classList.remove("showCtr")):"ppt"==a.type&&(a=b.querySelector("#SharePresentationDashboard #link"+a.type+a.rid+" .controlCont"),a.classList.remove("showCtr"))},goToEvent:function(a,b){var c=this;return function(d){c.events[b](this,a,d)}}}};d.page=a})(window,document);(function(d){var b=!0;d.documentShare=function(){return{allPages:null,allNotes:null,allDocs:null,notes:null,order:[],tempFolder:"documentSharing",init:function(a){this.firstRequest=!1;b=!0;this.indexNav=new virtualclass.pageIndexNav("documentShare");virtualclass.gObj.hasOwnProperty("dstAll")&&"string"==typeof virtualclass.gObj.dstAll?this.storageRawData=null:(null==virtualclass.gObj.dstAll||"undefined"!=typeof virtualclass.gObj.dstAll&&0==Object.keys(virtualclass.gObj.dstAll).length?(a=void 0,localStorage.removeItem("dtsdocs"),
this.storageRawData=null):this.storageRawData="object"==typeof virtualclass.gObj.dstAll?virtualclass.gObj.dstAll:null,null!=virtualclass.gObj.dstAllNotes&&(this.allNotes=virtualclass.gObj.dstAllNotes),roles.isStudent()&&(virtualclass.serverData.rawData.docs=this.storageRawData),roles.hasControls()&&virtualclass.storage.dstAllStore(virtualclass.gObj.dstAll));virtualclass.gObj.hasOwnProperty("docs")&&"string"==typeof virtualclass.gObj.docs?this.documents=null:this.documents="object"==typeof virtualclass.gObj.docs?
virtualclass.gObj.docs:null;this.UI.container();this.pages={};this.notes={};null!=this.documents&&(this.allNotes=this.documents);this.initAfterUpload(a);roles.hasControls()&&"undefined"==typeof a&&(ioAdapter.mustSend({dts:{init:"studentlayout"},cf:"dts"}),console.log(virtualclass.gObj.currWb+" Document share Teacher layout "));"undefined"!=typeof a?"layout"!=a.init&&"studentlayout"!=a.init?(null!=this.storageRawData&&this.rawToProperData(this.storageRawData,"fromStorage"),this.setNoteScreen(a)):b&&
roles.isStudent()&&this.rawToProperData(this.storageRawData,"fromStorage"):(a=JSON.parse(localStorage.getItem("dtsdocs")),null!=a?(null!=this.storageRawData&&this.rawToProperData(this.storageRawData,"fromStorage"),this.initAfterUpload(a),null!=a.slideNumber&&(this.setNoteScreen(a),a.slideNumber=null,localStorage.setItem("dtsdocs",JSON.stringify(a)))):null!=this.allDocs&&0<Object.keys(this.allDocs).length?(console.log("Do nothing"),this.afterFirstRequestDocs(virtualclass.serverData.rawData.docs,!0)):
roles.hasControls()&&this.firstRequestDocs());virtualclass.dts.noteExist()?virtualclass.modal.hideModal():virtualclass.modal.showModal()},moveProgressbar:function(){var a=document.querySelector("#docsUploadMsz"),c=document.querySelector("#docsuploadContainer .qq-upload-list-selector.qq-upload-list");if(c){c.style.display="block";var b=document.createElement("div");a.appendChild(b);b.appendChild(c)}},initAfterUpload:function(a){if("undefined"!=typeof a){for(var c in a.docs)this.afterUploadFile(a.docs[c].rid,
"fromReload",a);a.hasOwnProperty("order")&&(this.order=JSON.parse(a.order))}},setNoteScreen:function(a){if(null==document.querySelector("#note"+a.slideNumber+".current.note")){var c=this.getDocId(a.slideNumber);this.docs.executeScreen(c,"fromreload",void 0,a.slideNumber);this.setScreenByOrder(c)}},setScreenByOrder:function(a){if(null!=this.order&&0<this.order.length){for(var c=this.getAllNotes(this.order),b,d=0;d<c.length;d++)b=c[d].id.split("_")[0],this.setLinkSelected(b,1);document.querySelectorAll("#notesContainer .note");
this.createNoteLayout(c,a);this.reArrangeNotes(this.order);for(d=0;d<this.order.length;d++)this.noteStatus(this.order[d],this.allNotes[this.order[d]].status);this.storeInDocs(this.allNotes)}},createNoteLayout:function(a,c){var b=[];for(var d=0;d<a.length;d++)a[d].hasOwnProperty("deletedn")||b.push(a[d]);0<b.length&&(null==document.querySelector("#screen-docs .pageContainer")?(c={notes:b,hasControls:roles.hasControls(),cd:c},b="screen",a=document.querySelector("#docScreenContainer")):(c={notes:b},
b="notesMain",a=document.querySelector("#screen-docs #notesContainer")),b=virtualclass.getTemplate(b,"documentSharing"),c=b(c),null!=a?a.insertAdjacentHTML("beforeend",c):console.log("there is no such element"),roles.hasControls()||virtualclass.vutil.showZoom())},afterUploadFile:function(a,c,b){var d="undefined"!=typeof b?b.docs["docs"+a].status:1;"undefined"==typeof c&&roles.hasControls()?this.requestDocs(a):(c="docs"+a,"object"!=typeof this.pages[c]&&(this.pages[c]=new virtualclass.page("docScreenContainer",
"docs","virtualclassDocumentShare","dts",d),b="undefined"!=typeof b?b.docs[c].title:this.allDocs[a].title,this.pages[c].init(a,b)))},initDocs:function(a){if("object"!=typeof this.pages[a]){var c=0;if("true"==this.allDocs[a].status||1==this.allDocs[a].status)c=1;var b="docs"+a;this.pages[b]=new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",c);this.pages[b].init(a,this.allDocs[a].filename);this.upateInStorage()}},firstRequestDocs:function(){var a=this;virtualclass.vutil.isBulkDataFetched()?
(ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},cf:"dts"}),a.afterFirstRequestDocs(virtualclass.serverData.rawData.docs)):virtualclass.serverData.fetchAllData(function(){ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},cf:"dts"});a.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);a.firstRequest=!0})},fetchAllNotes:function(){var a={},c;for(c in virtualclass.dts.allDocs)for(var b=0;b<virtualclass.dts.allDocs[c].notesarr.length;b++)a[virtualclass.dts.allDocs[c].notesarr[b].id]=
virtualclass.dts.allDocs[c].notesarr[b];return a},fetchAllNotesAsArr:function(){var a=[],c;for(c in virtualclass.dts.allDocs)for(var b=0;b<virtualclass.dts.allDocs[c].notesarr.length;b++)a.push(virtualclass.dts.allDocs[c].notesarr[b]);return a},afterFirstRequestDocs:function(a,c){this.rawToProperData(a);virtualclass.storage.dstAllStore(a);for(var b in this.allDocs)this.allDocs[b].hasOwnProperty("deleted")||this.initDocs(this.allDocs[b].fileuuid);roles.hasAdmin()&&this.requestOrder(this.executeOrder)},
rawToProperData:function(a,c){"undefined"==typeof notconvert&&(this.allDocsTemp=a,this.allDocs=this.convertInObjects(this.allDocsTemp));this.allNotes="undefined"!=typeof c?virtualclass.gObj.dstAllNotes:this.fetchAllNotes()},afterRequestOrder:function(a){this.order.length=0;this.order=a;a=this.getDocId(this.order[0]);virtualclass.dts.allDocs.hasOwnProperty(a)&&(a="docs"+a,console.log("From database doc share order "+this.order.join(",")),this.setScreenByOrder(a),this.docs.currNote=this.order[0],this.docs.displayScreen(a,
this.order[0]))},requestOrder:function(a){virtualclass.vutil.requestOrder("docs",a)},executeOrder:function(a){if(void 0!=a&&"undefined"!=typeof a){var c=virtualclass.dts;0<a.length&&("Failed"==a||"Error"==a?(console.log("page order retrieve failed"),$("#congdashboard").modal(),console.log("dashboard length "+$("#congdashboard").length),virtualclass.dashBoard.clickCloseButton()):a&&roles.hasAdmin()&&(ioAdapter.mustSend({dts:{order_recived:a},cf:"dts"}),c.afterRequestOrder(a),c.createNoteNav()))}},
getFilenameFromUploadingfiles:function(a){for(;0<virtualclass.gObj.uploadingFiles.length;)return virtualclass.gObj.uploadingFiles[0].name},requestDocs:function(a){var c={filename:this.getFilenameFromUploadingfiles(a),fileuuid:a,filepath:"somewhere",filetype:"doc",key_room:virtualclass.gObj.sessionInfo.key+"_"+virtualclass.gObj.sessionInfo.room,status:1};this.allDocs[a]=c;c=0;if("true"==this.allDocs[a].status||1==this.allDocs[a].status)c=1;var b="docs"+a;"object"!=typeof this.pages[b]&&(this.pages[b]=
new virtualclass.page("docScreenContainer","docs","virtualclassDocumentShare","dts",c),this.pages[b].init(a,this.allDocs[a].filename),this.allDocs[a].hasOwnProperty("notes")||document.querySelector("#linkdocs"+a).classList.add("noDocs"));ioAdapter.mustSend({dts:{allDocs:this.allDocs,doc:a},cf:"dts"});virtualclass.serverData.pollingStatus(virtualclass.dts.afterRequestNotes)},afterRequestNotes:function(){var a=virtualclass.dts;virtualclass.dts.afterFirstRequestDocs(virtualclass.serverData.rawData.docs);
ioAdapter.mustSend({dts:{fallDocs:virtualclass.serverData.rawData.docs},cf:"dts"});a.removeNoDocsElem();a.allPages=virtualclass.dts.fetchAllNotesAsArr();a.allNotes=virtualclass.dts.fetchAllNotes();a.storeInDocs(a.allNotes);virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs);ioAdapter.mustSend({dts:{allNotes:a.allNotes},cf:"dts"})},removeNoDocsElem:function(){for(var a=document.querySelectorAll(".noDocs"),c=0;c<a.length;c++)a[c].classList.remove("noDocs")},requestNotes:function(a){var c=
this;virtualclass.vutil.xhrSendWithForm({live_class_id:virtualclass.gObj.congCourse,notes_id:"all",user:virtualclass.gObj.uid},"retrieve_all_notes",function(b){b=JSON.parse(b);+b.status&&(c.allPages=b.resultdata,c.allNotes=c.convertInObjects(c.allPages),c.storeInDocs(c.allNotes),ioAdapter.mustSend({dts:{allNotes:c.allNotes,doc:a},cf:"dts"}))})},firstRequestNotes:function(){var a=this;virtualclass.vutil.xhrSendWithForm({live_class_id:virtualclass.gObj.congCourse,notes_id:"all",user:virtualclass.gObj.uid},
"retrieve_all_notes",function(c){c=JSON.parse(c);a.allPages=c.resultdata;a.allNotes=a.convertInObjects(a.allPages);a.storeInDocs(a.allNotes);ioAdapter.mustSend({dts:{fallNotes:a.allNotes},cf:"dts"});a.requestOrder(a.executeOrder)})},requestSlidesOld:function(a){a=parseInt(a,10);console.log(virtualclass.gObj.currWb+" document share : request "+a);var c=this.getDocs(a),b=document.querySelector("#linkdocs"+a).dataset.selected;ioAdapter.mustSend({dts:{dres:a,ds:1-+b},cf:"dts"});return c},requestSlides:function(a){console.log(virtualclass.gObj.currWb+
" document share : request "+a);var c=this.getDocs(a),b=document.querySelector("#linkdocs"+a).dataset.selected;ioAdapter.mustSend({dts:{dres:a,ds:1-+b},cf:"dts"});return c},storeInDocs:function(a){virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs)},removeWhiteboardFromStorage:function(a){virtualclass.storage.wbDataRemove(a)},getNotesOld:function(a){var c=[],b;for(b in this.allNotes)this.allNotes[b].lc_content_id==a&&c.push(this.allNotes[b]);return c},getNotes:function(a){return this.allDocs[a].notesarr},
removePagesUI:function(a){a=this.getNotes(a);for(var c=0;c<a.length;c++)this._removePageUI(a[c].id);0>=this.order.length&&(b=!0);roles.hasControls()&&this.indexNav.createIndex()},_removePageUI:function(a,c){c=this.order.indexOf(a);0<=c&&this.order.splice(c,1);c=document.querySelector("#notesContainer #note"+a);null!=c&&c.parentNode.removeChild(c);"object"==typeof virtualclass.wb["_doc_"+a+"_"+a]&&delete virtualclass.wb["_doc_"+a+"_"+a];this.removeNoteNav(a);this.reaArrangeThumbCount();if(!roles.hasControls())if(a=
document.querySelector("#notesContainer .note.current"))a=a.id.split("note")[1],virtualclass.dts.indexNav.studentDocNavigation(a);else{if(a=document.getElementById("stdPageNo"))a.innerHTML=0;virtualclass.dts.indexNav.setTotalPages(virtualclass.dts.order.length)}},addPages:function(a){for(var c=0;c<a.length;)a[c].hasOwnProperty("deletedn")||null!=this.order&&-1>=this.order.indexOf(a[c].id)&&this.order.push(a[c].id),c++},toggleSlideWithOrder:function(a,c){a=document.querySelector("#linkdocs"+a);if(null!=
a){if(1==a.dataset.selected)return a.dataset.selected=0,!1;a.dataset.selected=1;return!0}console.log("Document sharing There is no Element")},setLinkSelected:function(a,c){a=document.querySelector("#linkdocs"+a);null!=a&&(a.dataset.selected=c)},onResponseFiles:function(a,c,d,g,k){b&&(this.docs.currNote="undefined"!=typeof g?g:c[0].id,console.log("Current note "+this.docs.currNote),b=!1);(roles.hasControls()?this.toggleSlideWithOrder(a,c):"undefined"!=typeof d?+d:1)?(this.addPages(c),a="string"!=typeof a?
"docs"+a:0<=a.indexOf("docs")?a:"docs"+a,this.createNoteLayout(c,a),"undefined"!=typeof g?this.docs.displayScreen(a,g):this.docs.displayScreen(a),"undefined"!=typeof k?this.createNoteNav(k):this.createNoteNav(),this.updateLinkNotes(this.docs.currNote),virtualclass.dts.setCurrentNav(this.docs.currNote),virtualclass.vutil.hideUploadMsg("docsuploadContainer"),virtualclass.vutil.addNoteClass()):(this.removePagesUI(a),virtualclass.dts.noteExist()||(virtualclass.vutil.showUploadMsg("docsuploadContainer"),
virtualclass.dts.docs.currNote=0,virtualclass.dts.docs.currDoc=void 0,virtualclass.gObj.currWb=null),virtualclass.dts.docSelected()||(c=JSON.parse(localStorage.getItem("dtsdocs")),null!=c&&(c.slideNumber=null,localStorage.setItem("dtsdocs",JSON.stringify(c))),roles.isStudent()&&(c=document.querySelector("#cont"+virtualclass.gObj.currWb),null!=c?c.style.display="block":(c=document.querySelector("#docScreenContainer"),null!=c&&c.classList.remove("noteDisplay"),virtualclass.gObj.currWb=null,document.querySelector("#virtualclassCont").classList.remove("pdfRendering"),
c=document.querySelector("#virtualclassAppLeftPanel.hideZoom"),g=document.querySelector("#virtualclassAppLeftPanel"),c||(g.classList.add("hideZoom"),g.classList.remove("showZoom"))))));null==document.querySelector("#listnotes .currentNav")&&(c=document.querySelector("#listnotes .linknotes"),null!=c&&(virtualclass.dts.currNote=c.dataset.rid,c=document.querySelector("#mainpnotes"+virtualclass.dts.currNote),null!=c&&(virtualclass.dts.docs.currDoc=virtualclass.dts.currNote.split("_")[0],c.click())));
roles.hasAdmin()&&this.sendOrder(this.order)},selectFirstNote:function(){if(null==document.querySelector("#notesContainer .current")){var a=document.querySelector("#notesContainer .note");null!=a&&(this.docs.currNote=a.dataset.slide,console.log("Current note "+this.docs.currNote),this.docs.currDoc="docs"+this.getDocId(a.dataset.slide),this.docs.note.getScreen(a))}},isDocumentExist:function(a){if("undefined"!=typeof a)return"layout"!=a.init&&"studentlayout"!=a.init?!0:!1},isDocAlreadyExist:function(a){for(var c=
0;c<this.documents.length;c++)if(this.documents[c].id==a)return!0;return!1},UI:{id:"virtualclassDocumentShare",class:"virtualclass container",container:function(){if(null==document.getElementById(this.id)){roles.hasAdmin();var a={control:roles.hasControls()},c=virtualclass.getTemplate("docsMain","documentSharing");virtualclass.vutil.insertAppLayout(c(a));null==document.querySelector("#congdashboard")&&(a=virtualclass.getTemplate("dashboard")({app:"DocumentShare"}),document.querySelector("#dashboardContainer").innerHTML=
a)}null==document.querySelector("#DocumentShareDashboard")&&(a=document.createElement("div"),document.querySelector("#congdashboard .modal-body").appendChild(a),a.id="DocumentShareDashboard");null==document.querySelector("#docsDbCont")&&(document.querySelector("#DocumentShareDashboard").innerHTML=virtualclass.vutil.getDocsDashBoard("DocumentShare"),roles.hasControls()&&(virtualclass.vutil.attachEventToUploadTab(),null==document.querySelector("#DocumentShareDashboard .qq-gallery")&&virtualclass.vutil.modalPopup("docs",
["docsuploadContainer"]),virtualclass.vutil.modalCloseHandler()))},createMainContent:function(a,c,b){},createSlides:function(a,c){var b=document.querySelector("#notesContainer");null==b&&(b=document.createElement("div"),b.className="notes",b.id="notesContainer");for(var d=0;d<c.length;d++)if(null==document.querySelector("#note"+c[d].id)){var k=document.createElement("div");k.id="note"+c[d].id;k.className="note";k.dataset.slide=c[d].id;k.dataset.status="true"==k.dataset.statuS||1==k.dataset.statuS?
1:"false"==k.dataset.status||0==k.dataset.status?0:c[d].status}a.appendChild(b);roles.hasControls()&&(this.createNavigation(a,"prev"),this.createNavigation(a,"next"))},createNavigation:function(a,c){if(null==document.querySelector("#docs"+c)){var b=document.createElement("span");b.className="nvgt "+c;b.id="docs"+c;a.appendChild(b)}},createDocsNav:function(a,c){var b=document.getElementById("listDocs");null==b&&(b=document.createElement("div"),b.id="listDocs",a.appendChild(b));a=this.createDocsNavLink(c);
this.attachDocsNav(a,c);b.appendChild(a)},createDocsNavLink:function(a){var c=document.createElement("div");c.id="link"+a;c.className="linkdoc";c.innerHTML=a;c.dataset.screen=a;return c},attachDocsNav:function(a,c){a.onclick=virtualclass.dts.docs.goToDocs(c)}},createNoteNav:function(a){this.order&&this.indexNav.init();for(var c=0;c<this.order.length;c++){if("object"!=typeof this.notes[this.order[c]]){var b="true"==this.allNotes[this.order[c]].status||1==+this.allNotes[this.order[c]].status?1:0;this.notes[this.order[c]]=
new virtualclass.page("screen-docs","notes","virtualclassDocumentShare","dts",b);this.notes[this.order[c]].init(this.order[c],"note_"+this.allNotes[this.order[c]].lc_content_id+"_"+this.order[c]);"undefined"==typeof a&&this.noteStatus(this.order[c],b)}roles.hasControls()&&this.indexNav.createDocNavigationNumber(this.order[c],c,b)}this.storeInDocs(this.allNotes);roles.hasControls()&&(this.indexNav.shownPage(this.indexNav.width),this.indexNav.addActiveNavigation(),document.querySelector("#dcPaging").addEventListener("change",
function(){virtualclass.dts.docs.goToNavs(this.value)()}));document.querySelector(".congrea.teacher  #dashboardContainer .modal-header button.enable")||virtualclass.vutil.showFinishBtn();this.indexNav.setTotalPages(virtualclass.dts.order.length)},addNoteHidClass:function(a,c,b){c>b?a.classList.add("hid","right"):a.classList.add("shw")},calcInitialWidth:function(){},indexHandler:function(a){virtualclass.dts.docs.goToNavs(a)},createNoteNavAlt:function(a){for(var c,b=0;b<this.order.length;b++)c="true"==
this.allNotes[this.order[b]].status||1==+this.allNotes[this.order[b]].status?1:0,this.notes[this.order[b]]=new virtualclass.page("screen-docs","notes","virtualclassDocumentShare","dts",c),this.notes[this.order[b]].init(this.order[b],"note_"+this.allNotes[this.order[b]].lc_content_id+"_"+this.order[b]),"undefined"==typeof a&&this.noteStatus(this.order[b],c);"undefined"==typeof a&&this.storeInDocs(this.allNotes)},removeNoteNav:function(a){var c=document.querySelector("#linknotes"+a);null!=c&&c.parentNode.removeChild(c);
"object"==typeof this.notes[a]&&delete this.notes[a]},docs:{num:0,currNote:0,curr:function(a,c){this.currDoc=a;virtualclass.dts.docs.num=a;var b=document.querySelector("#documentScreen .screen.current");null!=b&&b.classList.remove("current");document.querySelector("#screen-docs").classList.add("current");document.querySelector("#documentScreen").dataset.screen=a;this.note="undefined"!=typeof c?new this.slide(c):new this.slide;this.note.init();this.note.currentSlide(this.currNote)},display:function(a){document.querySelector(a).style.display=
"block"},hide:function(a){document.querySelector(a).style.display="none"},goToDocs:function(a){var c=this;return function(){"object"==typeof virtualclass.dts.docs.note&&virtualclass.vutil.updateCurrentDoc(virtualclass.dts.docs.note.currNote);c.executeScreen(a);roles.hasControls()&&(Object.keys(virtualclass.dts.notes).length?virtualclass.vutil.showFinishBtn():virtualclass.vutil.removeFinishBtn())}},goToNavs:function(a){return function(){var c=document.querySelector("#linknotes"+a);null!=c?1==+c.dataset.status&&
(virtualclass.dts.docs.currNote=a,virtualclass.dts.docs.note.currentSlide(a)):(virtualclass.dts.docs.currNote=a,virtualclass.dts.docs.note.currentSlide(a));virtualclass.dts.indexNav.addActiveNavigation();virtualclass.dts.indexNav.UI.setClassPrevNext()}},studentExecuteScreen:function(a){var c=a.dres;this.currDoc=c;var b=virtualclass.dts.getDocs(c);if(null!=b)virtualclass.dts.onResponseFiles(c,b,a.ds)},executeScreen:function(a,c,b,d){this.currDoc=a;-1==a.indexOf("docs")&&(this.currDoc="docs"+a);var f=
virtualclass.dts;if(roles.hasControls()&&"undefined"==typeof c)c=f.requestSlides(a),null!=c?(f.onResponseFiles(a,c),"undefined"!=typeof b&&b()):console.log("There is no data");else{"string"==typeof a&&-1<a.indexOf("docs")&&(a=a.split("docs")[1]);var g=f.getDocs(a);if(null!=g){if("undefined"==typeof c)f.onResponseFiles(a,g,void 0,d);else f.onResponseFiles(a,g,void 0,d,"fromReload");"undefined"!=typeof b&&b()}}},displayScreen:function(a,c){console.log("==== prev display screen");"undefined"!=typeof c?
this.curr(a,c):this.curr(a)},createWhiteboard:function(a){return $jscomp.executeAsyncGenerator(function(){function c(c,f){for(;;)switch(b){case 0:n="_doc_"+a+"_"+a;console.log(virtualclass.gObj.currWb+" document share Create Whiteboard ");m=document.createElement("div");m.id="cont";m.className="whiteboard";m.dataset.wid=n;m.id="cont"+m.dataset.wid;k=".note[data-slide='"+a+"']";d=document.querySelector(k);if(null==d){b=1;break}d.insertBefore(m,d.firstChild);b=3;return{value:virtualclass.vutil.createWhiteBoard(m.dataset.wid),
done:!1};case 3:if(void 0===f){b=4;break}b=-1;throw f;case 4:b=2;break;case 1:console.log("Element is null");case 2:console.log("==== previous set ",virtualclass.dtsConfig.id),virtualclass.previous=virtualclass.dtsConfig.id,b=-1;default:return{value:void 0,done:!0}}}var b=0,d,k,m,n,p={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();p[Symbol.iterator]=function(){return this};return p}())},
slide:function(a){return{li_items:0,imageNumber:0,currSlide:"undefined"!=typeof a?a:0,currNote:"undefined"!=typeof a?a:0,doc:1,init:function(a){var c=virtualclass.dts;a="#screen-docs";var b=document.querySelector(a+" .notes");this.doc=c.docs.num;if(null!=b){if(this.li_items=b.children,this.imageNumber=this.li_items.length,roles.hasControls()){b=document.querySelector(a+" .prev");a=document.querySelector(a+" .next");var d=this;b.onclick=function(){virtualclass.vutil.navWhiteboard(d,d.prevSlide,c)};
a.onclick=function(){virtualclass.vutil.navWhiteboard(d,d.nextSlide,c)}}}else alert("no element")},slideTo:function(a,b){var c=a.dataset.slide;virtualclass.vutil.updateCurrentDoc(c);this.displaySlide(a);roles.hasControls()&&"undefined"==typeof b&&(ioAdapter.mustSend({dts:{slideTo:c,docn:virtualclass.dts.docs.currDoc},cf:"dts"}),console.log("Slide to document sharing "+c))},displaySlide:function(a){var c=document.querySelector("#screen-docs .note.current");null!=c&&c.classList.remove("current");null!=
a&&a.classList.add("current");virtualclass.vutil.addNoteClass();roles.hasControls()||(a=a.id.split("note")[1],virtualclass.dts.indexNav.studentDocNavigation(a))},prevSlide:function(a){var c=a.docs.currNote,b=document.querySelector("#documentScreen #note"+c);null!=b&&(b=b.previousElementSibling,null!=b?(0==+b.dataset.status?(c=this.getActiveSlide(a,c,"prev"))?(this.getScreen(c,!0),a.docs.currNote=c.dataset.slide,console.log("Current note "+virtualclass.dts.docs.currNote)):virtualclass.dts.indexNav.UI._setArrowStatusDocs(document.getElementById("leftNavPage"),
"disable","enable"):(this.getScreen(b,!0),a.docs.currNote=b.dataset.slide,console.log("Current note "+virtualclass.dts.docs.currNote)),"object"==typeof virtualclass.wb["_doc_"+a.docs.currNote+"_"+a.docs.currNote]&&system.setAppDimension(null,"resize"),virtualclass.dts.indexNav.movePageIndex("left")):virtualclass.dts.indexNav.UI._setArrowStatusDocs(document.getElementById("leftNavPage"),"disable","enable"))},getActiveSlide:function(a,b,d){b=document.querySelector("#documentScreen #note"+b);if(null!=
b)return b="next"==d?b.nextElementSibling:b.previousElementSibling,null!=b?0==+b.dataset.status?this.getActiveSlide(a,b.dataset.slide,d):b:!1},nextSlide:function(a){var c=a.docs.currNote;if(c!=a.order[a.order.length-1]){var b=document.querySelector("#documentScreen #note"+c);null!=b&&(nextSlide=b.nextElementSibling,null!=nextSlide&&(0==+nextSlide.dataset.status?(c=this.getActiveSlide(a,c,"next"))?(this.getScreen(c,!0),a.docs.currNote=c.dataset.slide,console.log("Current note "+virtualclass.dts.docs.currNote)):
alert("There is no page"):(this.getScreen(nextSlide,!0),a.docs.currNote=nextSlide.dataset.slide)));virtualclass.dts.indexNav.movePageIndex("right")}else virtualclass.dts.indexNav.UI._setArrowStatusDocs(document.getElementById("rightNavPage"),"disable","enable"),virtualclass.zoom.adjustScreenOnDifferentPdfWidth()},isSlideAvailable:function(a,b){return a==b?!1:!0},currentSlide:function(a){var c=document.querySelector("#documentScreen #note"+a);null!=c?this.getScreen(c):console.log("Document-Sharing:-"+
a+" is not found ");a=document.querySelector("#docScreenContainer");null!=a&&a.classList.add("noteDisplay")},isPdfRendered:function(){var a=document.querySelector("#canvas"+virtualclass.gObj.currWb);return null!=a?a.parentNode.dataset.hasOwnProperty("pdfrender"):!1},getScreen:function(a,b){this.currNote=this.currSlide=a.dataset.slide;virtualclass.dts.currDoc=this.doc;this.slideTo(a);null!=virtualclass.wb[virtualclass.gObj.currWb]&&console.log("whiteboard ============ "+virtualclass.wb[virtualclass.gObj.currWb].gObj.queue.length);
null!=virtualclass.wb[virtualclass.gObj.currWb]&&0<virtualclass.wb[virtualclass.gObj.currWb].gObj.queue.length&&(virtualclass.gObj.tempQueue[virtualclass.gObj.currWb]=virtualclass.wb[virtualclass.gObj.currWb].gObj.queue);this.isWhiteboardExist(this.currNote)?this.isWhiteboardExist(this.currNote)&&!this.isPdfRendered(this.currNote)?(delete virtualclass.wb[virtualclass.gObj.currWb],virtualclass.dts.docs.createWhiteboard(this.currNote)):virtualclass.zoom.adjustScreenOnDifferentPdfWidth():virtualclass.dts.docs.createWhiteboard(this.currNote);
virtualclass.vutil.updateCurrentDoc(this.currNote);virtualclass.dts.updateLinkNotes(this.currNote);b=virtualclass.dts.isFirstNote(a.id);a=virtualclass.dts.isLastNote(a.id);var c=document.querySelector("#screen-docs .pageContainer");b&&a?(c.classList.add("firstNote"),c.classList.add("lastNote")):b?(c.classList.remove("lastNote"),c.classList.add("firstNote")):a?(c.classList.remove("firstNote"),c.classList.add("lastNote")):(c.classList.remove("firstNote"),c.classList.remove("lastNote"))},isWhiteboardExist:function(a){wbCont=
document.querySelector("#"+("containerWb_doc_"+a+"_"+a));return null!=wbCont}}}},destroyDts:function(){var a=document.getElementById(virtualclass.dts.UI.id);null!=a?a.parentNode.removeChild(a):console.log("Element is null");virtualclass.dts=null},screenIsCreated:function(a){return null!=document.getElementById("screen"+a)},convertInObjects:function(a){for(var c={},b=0;b<a.length;b++)c[a[b].fileuuid]=a[b];return c},onmessage:function(a){"object"!=typeof virtualclass.dts&&virtualclass.makeAppReady("DocumentShare",
void 0,{init:"studentlayout"});var c=a.message.dts;c.hasOwnProperty("docn")&&-1==c.docn.indexOf("docs")&&(c.docn="docs"+c.docn);if(c.hasOwnProperty("allNotes"))this.allNotes=c.allNotes,this.storeInDocs(this.allNotes);else if(c.hasOwnProperty("fallNotes"))this.allNotes=c.fallNotes,this.storeInDocs(this.allNotes),virtualclass.storage.dstAllStore(virtualclass.serverData.rawData.docs);else if(c.hasOwnProperty("allDocs"))this.allDocs=c.allDocs,this.afterUploadFile(c.doc);else if(c.hasOwnProperty("fallDocs")){var b=
this;b.afterFirstRequestDocs(c.fallDocs);virtualclass.serverData.rawData.docs=c.fallDocs}else c.hasOwnProperty("dres")?(this.docs.studentExecuteScreen(c),console.log(virtualclass.gObj.currWb+" document share :- Layout initialized")):c.hasOwnProperty("slideTo")?"object"!=typeof this.docs.note?(b=this,this.docs.executeScreen(c.docn,void 0,function(){console.log("document share :- doc is not created");b.docs.note.currNote=c.slideTo;var a=document.querySelector("#note"+c.slideTo);b.docs.note.slideTo(a)},
c.slideTo)):"object"==typeof this.docs.note&&c.docn!=this.docs.num?(this.docs.currNote=c.slideTo,console.log("Current note "+this.docs.currNote),this.docs.executeScreen(c.docn,void 0),this.docs.note.currentSlide(c.slideTo)):(a=document.querySelector("#note"+c.slideTo),null!=a?(this.docs.currNote=c.slideTo,console.log("Current note "+this.docs.currNote),this.docs.note.getScreen(a),console.log(virtualclass.gObj.currWb+" document share :- Normal Case")):alert("Note is not found "+c.slideTo)):c.hasOwnProperty("dispScreen")?
(a=c.dispScreen.sc,virtualclass.vutil.updateCurrentDoc(a,c.dispScreen.sn),virtualclass.dts.screenIsCreated(a)?(console.log(virtualclass.gObj.currWb+" document share :- Only display screen"),this.docs.displayScreen(a)):(console.log(virtualclass.gObj.currWb+" document share :- With screen Created"),this.docs.executeScreen(a,void 0,void 0,c.dispScreen.sn),"object"==typeof this.docs.note&&this.docs.note.getScreen(c.dispScreen.sn))):c.hasOwnProperty("rmnote")?this._delete(c.rmnote):c.hasOwnProperty("rmsnote")?
(this._removePageUI(c.rmsnote),this._removePageFromStructure(c.rmsnote)):c.hasOwnProperty("noteSt")?(this.noteStatus(c.note,c.noteSt),this.storeInDocs(this.allNotes)):c.hasOwnProperty("docSt")?this.docStatus(c.doc,c.docSt):c.hasOwnProperty("order_recived")?this.afterRequestOrder(c.order_recived):c.hasOwnProperty("norder")&&(this.order=c.norder,virtualclass.dts.indexNav.studentDocNavigation(this.docs.currNote))},sendCurrentSlide:function(){if(virtualclass.dts.docs.hasOwnProperty("currDoc")){var a=
virtualclass.dts.docs.currDoc;void 0!=a?null!=document.querySelector("#listnotes .note")&&(ioAdapter.mustSend({dts:{slideTo:virtualclass.dts.docs.note.currNote,docn:a},cf:"dts"}),console.log(virtualclass.gObj.currWb+" Document share send current slide")):console.log("Document sharing : doc number is undefined")}},sendCurrentDoc:function(){virtualclass.dts.docs.hasOwnProperty("currDoc")&&console.log("Document sharing : doc number is undefined")},consoleMessage:function(a){console.log(virtualclass.gObj.currWb+
" "+a)},_rearrange:function(a){alert(a.toString())},reArrangeNotes:function(a){this.order=a;this.reArrangeElements(a);roles.hasAdmin()&&(this.sendOrder(this.order),ioAdapter.mustSend({dts:{norder:this.order},cf:"dts"}))},sendOrder:function(a){virtualclass.vutil.sendOrder("docs",a)},reaArrangeThumbCount:function(){for(var a=document.querySelectorAll("#listnotes .thumbList"),c=0;c<a.length;c++)a[c].innerHTML=c+1},reArrangeElements:function(a){var c=document.getElementById("notesContainer"),b=document.createElement("div");
b.id="notesContainer";b.className="notes";for(var d=0;d<a.length;d++)b.appendChild(document.getElementById("note"+a[d]));c.parentNode.replaceChild(b,c);this.reaArrangeThumbCount();0<document.querySelectorAll("#dcPaging .noteIndex").length&&this.indexNav.rearrangePageNavigation(a);document.querySelector("#dcPaging").addEventListener("change",function(){virtualclass.dts.docs.goToNavs(this.value)()})},_delete:function(a){var c=document.querySelector("#linkdocs"+a);null!=c&&c.parentNode.removeChild(c);
var b=this;virtualclass.xhrn.sendData({uuid:a,action:"delete",page:0},virtualclass.api.UpdateDocumentStatus,function(a){"ok"==JSON.parse(a).status&&b.sendOrder(b.order)});delete this.pages["docs"+a];this.removePagesUI(a);this.removePagesFromStructure(a);this.upateInStorage()},_deleteNote:function(a,c){this._removePageUI(a,c);this._removePageFromStructure(a,c);roles.hasControls()&&ioAdapter.mustSend({dts:{rmsnote:a},cf:"dts"});c=a.split("_");a=c[0];c=parseInt(c[1]);var b=this;virtualclass.xhrn.sendData({uuid:a,
action:"delete",page:c},virtualclass.api.UpdateDocumentStatus,function(a){"ok"==JSON.parse(a).status&&b.sendOrder(b.order)});c=!1;var d=virtualclass.dts.allDocs[a];if(null!=d)for(var k=0;k<d.notesarr.length;k++)if(!d.notesarr[k].hasOwnProperty("deletedn")){c=!0;break}c||this._delete(a);roles.hasControls()&&this.indexNav.createIndex()},removePagesFromStructure:function(a){this.allDocs[a].deleted="0";for(var c in this.allNotes)-1<this.allNotes[c].id.indexOf(a)&&this._removePageFromStructure(this.allNotes[c].id)},
updateInAllDocs:function(a){var c=a.split("_")[0];doc=this.allDocs[c];if("undefined"!=typeof doc.notes[a])for(doc.notes[a].deletedn=a,c=0;c<doc.notesarr.length;c++)doc.notesarr[c].id==a&&(doc.notesarr[c].deletedn=a);else console.log("The note with the id "+a+" is not available")},_removePageFromStructure:function(a){this.removeWhiteboardFromStorage("_doc_"+a+"_"+a);this.allNotes[a].deletedn=a;this.storeInDocs(this.allNotes);this.updateInAllDocs(a)},_disable:function(a){this.docStatus(a)},_enable:function(a){this.docStatus(a)},
docStatus:function(a,c){var b=document.querySelector("#linkdocs"+a+" .controls.status");null!=b?"undefined"==typeof c&&(c=1-+b.dataset.status):console.log("document share:- there is no element "+a);b=this.getDocs(a);for(var d=0;d<b.length;d++){var k=b[d].id;this.noteStatus(k,c);this.updatePageNavStatus(k,c)}this.storeInDocs(this.allNotes);roles.hasControls()&&ioAdapter.mustSend({dts:{docSt:c,doc:a},cf:"dts"})},updatePageNavStatus:function(a,c){var b=document.querySelector("#linknotes"+a);null!=b?
(b.dataset.status=c,a=b.querySelector(".controls.status"),a.dataset.status=c,a.querySelector(".statusanch").innerHTML="status"+c):console.log("Document share : there is no element #linknotes"+a)},_noteDisable:function(a){this.noteStatus(a);this.storeInDocs(this.allNotes);this.sendNoteStatus(a)},_noteEnable:function(a){this.noteStatus(a);this.storeInDocs(this.allNotes);this.sendNoteStatus(a)},sendNoteStatus:function(a){if(roles.hasControls()){var c=document.querySelector("#note"+a);null!=c?ioAdapter.mustSend({dts:{noteSt:c.dataset.status,
note:a},cf:"dts"}):console.log("Element is null")}},noteStatus:function(a,c){var b=document.querySelector("#note"+a);null!=b?(c="undefined"==typeof c?1-+b.dataset.status:1==c||"true"==c?1:0,b.dataset.status=c,c=this.allNotes[a],c.status=b.dataset.status,this.allNotes[a]=c):console.log("there is no element #note"+a)},getDocsOld:function(a){var c=[],b;for(b in this.allNotes)a==this.allNotes[b].lc_content_id&&c.push(this.allNotes[b]);return c},getDocs:function(a){console.log("--------------");if(null!=
this.allDocs&&"object"==typeof this.allDocs[a])return this.allDocs[a].notesarr;console.log("There is no document with the id "+a)},getDocId:function(a){return a.split("_")[0]},getAllNotes:function(a){var c=[];for(i=0;i<a.length;i++)c.push(this.allNotes[a[i]]);return c},getNote:function(a){return this.allNotes[a]},updateLinkNotes:function(a){var c=document.querySelector("#listnotes .currentNav");null!=c&&c.classList.remove("currentNav");this.setCurrentNav(a)},setCurrentNav:function(a){a=document.querySelector("#linknotes"+
a);null!=a&&a.classList.add("currentNav")},onAjaxResponse:function(a,c,b){if(b.hasOwnProperty("success")&&b.success){for(a=0;a<virtualclass.gObj.uploadingFiles.length;a++)this.afterUploadFile(virtualclass.gObj.uploadingFiles[a].uuid);virtualclass.gObj.uploadingFiles=[];this.showUploadMsz(virtualclass.lang.getString("docUploadSuccess"),"alert-success")}else"duplicate"==b.message?this.showUploadMsz(virtualclass.lang.getString("duplicateUploadMsg"),"alert-error"):b.hasOwnProperty("error")?this.showUploadMsz(b.error,
"alert-error"):this.showUploadMsz(virtualclass.lang.getString("someproblem"),"alert-error");if(a=document.querySelector("#DocumentShareDashboard .qq-upload-list-selector.qq-upload-list"))a.style.display="none";null!=document.querySelector("#listnotes")?(virtualclass.vutil.makeElementDeactive("#DocumentShareDashboard .qq-uploader-selector.qq-uploader.qq-gallery"),virtualclass.vutil.makeElementActive("#listnotes")):console.log("List note is null")},showUploadMsz:function(a,c){var b=document.querySelector("#DocumentShareDashboard #docsUploadMsz"),
d=document.querySelector("#DocumentShareDashboard #docsUploadMsz .alert");d&&d.parentNode.removeChild(d);d=document.createElement("div");d.className="alert  alert-dismissable";d.classList.add(c);d.innerHTML=a;b.appendChild(d);a=document.createElement("button");a.className="close";a.setAttribute("data-dismiss","alert");a.innerHTML="&times";d.appendChild(a);a.addEventListener("click",function(){this.parentNode.remove()})},setNoteDimension:function(a,c,b){var d=document.querySelector("#cont"+b);null!=
d&&(d=document.querySelector("#"+d.parentNode.id+" .imageContainer img"),d.style.width=a,d.style.height=c);system.setDocCanvasDimension(a,c,b);b=document.querySelector("#screen-docs .pageContainer");roles.hasAdmin()&&(c+=60);null!=b&&(b.style.width=a+"px",b.style.height=c+"px")},isFirstNote:function(a){var c=document.querySelector("#notesContainer .note");return null!=c&&a==c.id},isLastNote:function(a){var c=document.querySelectorAll("#notesContainer .note"),b=c[c.length-1];return 0<c.length&&b.id==
a},noteExist:function(){return null!=document.querySelector("#notesContainer .note")},docSelected:function(){return document.querySelector('#listdocs .linkdocs[data-selected="1"]')},isUploaderExist:function(){return null!=document.querySelector("#docsuploadContainer .qq-uploader-selector")},upateInStorage:function(){if(virtualclass.hasOwnProperty("dts")&&typeof virtualclass.dts.hasOwnProperty("pages")&&"object"==typeof virtualclass.dts.pages){var a={};a.docs=virtualclass.dts.pages;a.order=JSON.stringify(virtualclass.dts.order);
a.slideNumber=0<virtualclass.dts.order.length?virtualclass.dts.docs.note.currNote:null;localStorage.setItem("dtsdocs",JSON.stringify(a))}}}}})(window);(function(d){d.quiz=function(){return{coursequiz:[],uid:virtualclass.gObj.uid,qzid:0,newUserTime:{},list:[],listQuiz:{},uniqueUsers:[],usersFinishedQz:[],quizJSON:{},attemptedUsers:{},cmid:2,exportfilepath:d.exportfilepath,quizSt:{},quizAttempted:{},qGrade:[],init:function(){virtualclass.previrtualclass="virtualclassQuiz";virtualclass.previous="virtualclassQuiz";this.cmid=virtualclass.vutil.getUrlVars(exportfilepath).cmid;!roles.hasAdmin()||roles.isEducator()?roles.isStudent()?this.UI.defaultLayoutForStudent():
(this.UI.container(),roles.hasControls()?ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}):this.UI.defaultLayoutForStudent()):(this.UI.container(),ioAdapter.mustSend({quiz:{quizMsg:"init"},cf:"quiz"}));roles.hasControls()&&(console.log("fetchquizes"),this.interfaceToFetchList(this.cmid));var b=JSON.parse(localStorage.getItem("quizSt"));b&&(this.storedDataHandle(b),virtualclass.quiz.quizSt=b)},storedDataHandle:function(b){if("stdPublish"==b.screen){var a=this;virtualclass.storage.getQuizData(function(c){c.hasOwnProperty("qData")?
(c=JSON.parse(c.qData),a.quizDisplay(c)):console.log("Quiz data is not available")})}else if("quizsubmitted"==b.screen){var c=JSON.parse(localStorage.getItem("qRep"));this.UI.displayStudentResultScreen(c)}else"tchResultView"==b.screen&&(a=this,virtualclass.storage.getQuizData(function(c){if("undefined"!==typeof c&&c.hasOwnProperty("qData")&&c.hasOwnProperty("qDetail")){var d=JSON.parse(c.qDetail);a.quizJSON=c.qData;a.openQuizPopup(a.quizJSON,d.id);a.UI.resultView(d);a.tabContent();c.hasOwnProperty("qAttempt")&&
(a.quizAttempted=JSON.parse(c.qAttempt),a.displayAttemptOverview());c.hasOwnProperty("qGrade")&&(a.qGrade=JSON.parse(c.qGrade),a.displayGradeReport());"true"==b.qClosed&&(document.getElementById("closeQzBt").disabled=!0)}}),virtualclass.quiz.quizSt.screen=b.screen)},displayQuizList:function(){var b=!1;virtualclass.quiz.dispList("course");document.getElementById("listquizcourse");if(0<Object.keys(this.coursequiz).length){for(var a in this.coursequiz)this.coursequiz.hasOwnProperty(a)&&!+this.coursequiz[a].quizstatus&&
(b=!0,this.displayQuizes(this.coursequiz[a],a));this.UI.listHeader();if(b)b=document.querySelector("#virtualclassCont.congrea #layoutQuiz #headerContainer"),b.classList.contains("show")||b.classList.add("show");else if(b=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))b.classList.add("show"),b.innerHTML=virtualclass.lang.getString("noQuiz")}else if(b=document.querySelector("#virtualclassCont.congrea #layoutQuiz #mszBoxQuiz"))b.classList.add("show"),b.innerHTML=virtualclass.lang.getString("noQuiz")},
dispList:function(){document.getElementById("mszBoxQuiz");var b=document.getElementById("listQzCont");b?b.style.display="block":(console.log("quiz layout 2"),this.UI.layout2("layoutQuizBody"))},interfaceToFetchList:function(b){b=new FormData;b.append("cmid",this.cmid);b.append("user",this.uid);var a=this;virtualclass.xhr.send(b,d.webapi+"&methodname=congrea_quiz",function(c){c=JSON.parse(c);if(0==c.status)document.getElementById("bootstrapQzCont").innerHTML=virtualclass.lang.getString("noQuiz");else{for(var b=
0;b<=c.length-1;b++){var d=c[b].options,k;for(k in d)c[b].options[k]=d[k].options}a.coursequiz=c;a.displayQuizList()}})},displayQuizes:function(b,a){this.UI.qzCont(a);this.UI.qzCtrCont(a);this.UI.qzTextCont(b,a);this.attachQZEvent("publishQz"+a,"click",this.publishHandler,b,a)},attachQZEvent:function(b,a,c,d,g){b=document.getElementById(b);null!=b&&b.addEventListener(a,function(){"undefined"!=typeof d?(console.log("attach time handler"),c(d,g)):console.log("quiz is missing no need of time")})},publishHandler:function(b,
a){var c=document.getElementById("mszBoxQuiz");0<c.childNodes.length&&c.childNodes[0].parentNode.removeChild(c.childNodes[0]);virtualclass.quiz.publishQuiz(b,a)},publishQuiz:function(b,a){this.openQuizPopup(b,a);this.quizPreview(b);b=document.querySelector("#editQuizModal");b.className="modal in";b.style.display="block"},openQuizPopup:function(b,a){this.qzid=a;b=document.getElementById("layoutQuizBody");a=document.createElement("div");a.className="container";b.appendChild(a);(b=document.getElementById("editQuizModal"))&&
b.remove();b=document.getElementById("bootstrapQzCont");virtualclass.quiz.UI.generateModal("editQuizModal",b)},showQn:function(b){roles.hasControls()?b.innerHTML="quiz question":b.innerHTML="quiz question for student"},action:function(b,a,c){a(b,c)},getQuizData:function(b){var a=this.coursequiz[b.id],c=new FormData;c.append("cmid",this.cmid);c.append("user",this.uid);c.append("qid",b.id);scope=this;virtualclass.xhr.send(c,d.webapi+"&methodname=congrea_get_quizdata",function(c){if(scope.isJson(c))scope.quizJSON=
c,$("#slickQuiz").slickQuiz({json:scope.quizJSON,questionPerPage:a.questionsperpage,questionMode:a.preferredbehaviour,quizTime:a.timelimit,displayDetailResult:!1});else{var b=document.getElementById("publishQzBt");b.parentNode.removeChild(b);document.getElementById("contQzBody").innerHTML=c}})},quizPopUp:function(b,a){console.log("quiz pop up");for(var c=function(){console.log(this.id);virtualclass.quiz.action(this.id,b,a)},d=(document.getElementById("editQuizModal")?document.getElementById("editQuizModal"):
document.getElementById("qzPopup")).querySelectorAll(":scope .controls"),g=0;g<d.length;g++)d[g].addEventListener("click",c)},quizPreview:function(b){console.log("quiz preview function");this.UI.modalContentUI();var a=document.getElementById("contQzHead"),c=document.createElement("div");c.id="QstnName";c.innerHTML=b.name;a.appendChild(c);c=document.getElementById("contQzBody");a=document.createElement("button");a.id="publishQzBt";a.classList.add("btn","btn-default","controls");a.innerHTML=virtualclass.lang.getString("PQuiz");
c.appendChild(a);c=document.createElement("i");c.className="icon-publish";a.appendChild(c);this.getQuizData(b);this.quizPopUp(this.popupFn,1)},popupFn:function(b,a){virtualclass.quiz[b].call(this.quiz,a)},publishQzBt:function(){var b=virtualclass.quiz,a=b.quizJSON,c=JSON.parse(a).questions.length;b.coursequiz[b.qzid].noOfQus=c;c=b.coursequiz[b.qzid];var f={json:a,questionPerPage:c.questionsperpage,questionMode:c.preferredbehaviour,quizTime:c.timelimit,displayDetailResult:!1,ptm:(new Date).getTime()};
ioAdapter.mustSend({quiz:{quizMsg:"stdPublish",quizId:b.qzid,data:f},cf:"quiz"});b.UI.resultView(c);b.tabContent();b.quizSt.screen="tchResultView";virtualclass.storage.quizStorage("qDetail",JSON.stringify(c));virtualclass.storage.quizStorage("qData",a);a=new FormData;a.append("cmid",b.cmid);a.append("qzid",b.qzid);a.append("user",b.uid);virtualclass.xhr.send(a,d.webapi+"&methodname=congrea_add_quiz",function(a){"ture"!==a&&console.log("Quiz data not saved in congrea")})},closeQzBt:function(){console.log("-------CLOSE QUIZ--------");
ioAdapter.mustSend({quiz:{quizMsg:"stdShowResult",data:{qzid:virtualclass.quiz.qzid}},cf:"quiz"});"undefined"!=typeof CDTimer&&(clearInterval(CDTimer),console.log("Clear quiz interval"));document.getElementById("closeQzBt").disabled=!0;var b=document.createElement("div");b.className="alert alert-info";b.innerHTML=virtualclass.lang.getString("QClosed");resultQzLayout.insertBefore(b,resultQzLayout.firstChild)},quizDisplay:function(b){var a=document.getElementById("mszBoxQuiz");a&&a.parentNode.removeChild(a);
(a=document.getElementById("contQzBody"))&&a.parentNode.removeChild(a);a=document.getElementById("bootstrapQzCont");var c=virtualclass.view.customCreateElement("div","contQzBody","modal-body");a.appendChild(c);this.UI.modalContentUI();$("#slickQuiz").slickQuiz(b)},saveInLocalStorage:function(){var b=virtualclass.quiz;null!=document.querySelector("#qztime")&&(b.quizSt.qtime=document.querySelector("#qztime").textContent,console.log("quiz="+b.quizSt.qtime));null!=document.querySelector("#elsTime")&&
(b.quizSt.qtime=document.querySelector("#elsTime").textContent,console.log("quiz="+b.quizSt.qtime));console.log("quiz="+b.quizSt.screen);null!=document.getElementById("closeQzBt")&&1==document.getElementById("closeQzBt").disabled&&(b.quizSt.qClosed="true");b.quizSt&&localStorage.setItem("quizSt",JSON.stringify(b.quizSt));b.quizAttempted&&(console.log("attempt data ="+b.quizAttempted),virtualclass.storage.quizStorage("qAttempt",JSON.stringify(b.quizAttempted)))},onmessage:function(b,a){var c=virtualclass.quiz;
"stdPublish"==b.quiz.quizMsg&&(c.dataRec=b.quiz.data,virtualclass.storage.quizStorage("qData",JSON.stringify(c.dataRec)),c.quizSt.screen="stdPublish",this.quizDisplay(b.quiz.data));if("stdShowResult"==b.quiz.quizMsg||"quizTimeEnd"==b.quiz.quizMsg){null!=document.querySelector("#timeText")&&(document.querySelector("#timeText").textContent="Quiz has been closed");var d=document.querySelector("#slickQuiz .quizResults");d&&"block"!=d.style.display&&(d=document.querySelectorAll("#slickQuiz .nextQuestion"),
d[d.length-1].click())}"quizClosed"==b.quiz.quizMsg&&(localStorage.removeItem("quizSt"),this.quizSt={},localStorage.removeItem("qRep"),virtualclass.storage.clearTableData("quizData"),this.UI.defaultLayoutForStudent());if("quizAttempt"==b.quiz.quizMsg&&roles.hasControls()){"undefined"==typeof this.attemptedUsers[b.quiz.questionId]&&(this.attemptedUsers[b.quiz.questionId]={});d=b.quiz.user;"undefined"==typeof this.attemptedUsers[b.quiz.questionId][d]&&(this.attemptedUsers[b.quiz.questionId][d]={});
this.attemptedUsers[b.quiz.questionId][d]=b.quiz.ans;d=Object.keys(this.attemptedUsers[b.quiz.questionId]).length;var g=0;for(k in this.attemptedUsers[b.quiz.questionId])1==this.attemptedUsers[b.quiz.questionId][k]&&g++;document.getElementById("usA_"+b.quiz.questionId).innerHTML=d;var k=0;0<g&&(k=g/d*100);var m=document.getElementById("qPb_"+b.quiz.questionId);m.innerHTML=k+"% correct";m.style.width=k+"%";"undefined"==typeof this.quizAttempted[b.quiz.questionId]&&(this.quizAttempted[b.quiz.questionId]=
{});this.quizAttempted[b.quiz.questionId].uA=d;this.quizAttempted[b.quiz.questionId].cA=g}"quizsubmitted"==b.quiz.quizMsg&&roles.hasControls()&&(this.usersFinishedQz.push(b.quiz.user),a="undefined"==!typeof a.lname?a.name+" "+a.lname:a.name,this.gradeReport(this.usersFinishedQz.length,a,b.quiz.timetaken,b.quiz.score,b.quiz.quesattemptd,b.quiz.correctans),this.qGrade.push({nm:a,tt:b.quiz.timetaken,sc:b.quiz.score,qAt:b.quiz.quesattemptd,ca:b.quiz.correctans}),virtualclass.storage.quizStorage("qGrade",
JSON.stringify(c.qGrade)),this.saveGradeInDb(b.quiz.user,b.quiz.timetaken,b.quiz.score,b.quiz.quesattemptd,b.quiz.correctans))},saveGradeInDb:function(b,a,c,f,g){var k=virtualclass.quiz;a=this.convertTimeToSec(a);var m=new FormData;m.append("cmid",k.cmid);m.append("qzid",k.qzid);m.append("user",b);m.append("grade",c);m.append("timetaken",a);m.append("qusattempted",f);m.append("currectans",g);virtualclass.xhr.send(m,d.webapi+"&methodname=congrea_quiz_result",function(a){"ture"!==a&&console.log("Quiz data not saved in congrea")})},
displayAttemptOverview:function(){var b=virtualclass.quiz,a;for(a in b.quizAttempted)if(document.getElementById("usA_"+a).innerHTML=b.quizAttempted[a].uA,0<b.quizAttempted[a].cA){var c=(b.quizAttempted[a].cA/b.quizAttempted[a].uA*100).toFixed(2),d=document.getElementById("qPb_"+a);d.innerHTML=c+"% correct";d.style.width=c+"%"}},displayGradeReport:function(){for(var b=virtualclass.quiz,a=0;a<b.qGrade.length;a++)b.gradeReport(a+1,b.qGrade[a].nm,b.qGrade[a].tt,b.qGrade[a].sc,b.qGrade[a].qAt,b.qGrade[a].ca)},
attemptProgressReport:function(){var b=JSON.parse(virtualclass.quiz.quizJSON),a=virtualclass.view.customCreateElement("div","attemptQzBody","modal-body");b=b.questions;var c=1;for(i=0;i<b.length;i++){var d=virtualclass.view.customCreateElement("div","","q-area");a.appendChild(d);var g=virtualclass.view.customCreateElement("span","","q-no");g.innerHTML=c;d.appendChild(g);g=virtualclass.view.customCreateElement("div","","qscolor");g.innerHTML=b[i].q;d.appendChild(g);g=virtualclass.view.customCreateElement("div");
g.innerHTML="Users attempted : <span id='usA_"+b[i].qid+"'>0</span>";d.appendChild(g);g=this.UI.createProgressBar(b[i].qid,0);d.appendChild(g);c++}return a},tabContent:function(){var b=document.getElementById("resultQzLayout"),a=virtualclass.view.customCreateElement("div","","tab-content"),c=virtualclass.view.customCreateElement("div","qzOverv");c.className="tab-pane fade in active";var d=this.attemptProgressReport();c.appendChild(d);a.appendChild(c);c=virtualclass.view.customCreateElement("div",
"gdRpt");c.className="tab-pane fade";d=this.UI.gradeReportLayout();c.appendChild(d);a.appendChild(c);b.appendChild(a)},gradeReport:function(b,a,c,d,g,k){var f=document.getElementById("qzReTbody");if(f){var n=document.createElement("tr");f.appendChild(n);f=document.createElement("th");f.scope="row";f.innerHTML=b;n.appendChild(f);b=document.createElement("td");b.innerHTML=a;n.appendChild(b);a=document.createElement("td");a.innerHTML=c;n.appendChild(a);c=document.createElement("td");c.innerHTML=d+"%";
n.appendChild(c);d=document.createElement("td");d.innerHTML=g;n.appendChild(d);g=document.createElement("td");g.innerHTML=k;n.appendChild(g)}},quizTimer:function(b,a,c){function d(){k="asc"==c?b+((Date.now()-g)/1E3|0):b-((Date.now()-g)/1E3|0);m=k/3600|0;n=k%3600/60|0;p=k%60|0;m=10>m?"0"+m:m;n=10>n?"0"+n:n;p=10>p?"0"+p:p;a.textContent=m+":"+n+":"+p;timeTakenQuiz=m+":"+n+":"+p;0>=k&&("asc"!=c&&(a.textContent="00 : 00 : 00 "),g=0,"undefined"!=typeof CDTimer&&(clearInterval(CDTimer),console.log("Clear quiz interval")),
ioAdapter.mustSend({quiz:{quizMsg:"quizTimeEnd",quizId:virtualclass.view.qzid},cf:"quiz"}),roles.hasControls()&&(document.getElementById("closeQzBt").disabled=!0))}c="undefined"!==typeof c?c:"desc";var g=Date.now(),k,m,n,p;"asc"!==c&&d();CDTimer=setInterval(d,1E3)},quizModalClose:function(){var b=this,a=virtualclass.lang.getString("rusureCquiz");virtualclass.popup.confirmInput(a,function(a){a&&(localStorage.removeItem("quizSt"),b.quizSt={},virtualclass.storage.clearTableData("quizData"),localStorage.removeItem("qRep"),
a=document.getElementById("editQuizModal"),a.parentNode.removeChild(a),b.attemptedUsers={},b.quizAttempted={},ioAdapter.mustSend({quiz:{quizMsg:"quizClosed",quizId:b.qzid},cf:"quiz"}))})},convertSecToTime:function(b){if(/^\d+$/.test(b)){var a=new Date(null);a.setSeconds(b);return a.toISOString().substr(11,8)}return"00:00:00"},convertTimeToSec:function(b){return b?(b=b.split(":"),3600*+b[0]+60*+b[1]+ +b[2]):0},isJson:function(b){try{JSON.parse(b)}catch(a){return!1}return!0},UI:{id:"virtualclassQuiz",
class:"virtualclass",container:function(){console.log("quiz layout check");var b=document.getElementById(this.id);null!=b&&b.parentNode.removeChild(b);b=virtualclass.view.customCreateElement("div",this.id,this.class);virtualclass.vutil.insertAppLayout(b);this.layout(b)},layout:function(b){var a=virtualclass.view.customCreateElement("div","layoutQuiz","bootstrap container-fluid quizLayout");b.appendChild(a);b=document.createElement("nav");b.className="nav navbar ";a.appendChild(b);var c=virtualclass.view.customCreateElement("div",
"","vchead");c.innerHTML=virtualclass.lang.getString("Quiz");b.appendChild(c);b=virtualclass.view.customCreateElement("div","layoutQuizBody","quizMainCont");a.appendChild(b);this.createMszBox(b);this.createModalCont(b)},createModalCont:function(b){var a=virtualclass.view.customCreateElement("div","bootstrapQzCont","modalCont");b.appendChild(a)},layout2:function(b){var a=document.getElementById(b);b=document.getElementById("listQzCont");if(null==b){var c=document.createElement("div");c.className="table-responsive";
a.appendChild(c);b=virtualclass.view.customCreateElement("table","listQzCont","table table-bordered table-striped quizList");c.appendChild(b)}},listHeader:function(){var b=document.getElementById("listQzCont"),a=document.createElement("tr");a.classList.add("headerContainer");a.id="headerContainer";b.insertBefore(a,b.firstChild);b=document.createElement("th");b.classList.add("controlsHeader");b.innerHTML=virtualclass.lang.getString("Controls");a.appendChild(b);var c=document.createElement("i");c.className=
"icon-setting";b.appendChild(c);b=document.createElement("th");b.classList.add("qnTextHeader");b.innerHTML=virtualclass.lang.getString("Quizes");a.appendChild(b);c=document.createElement("i");c.className="icon-help";b.appendChild(c);b=document.createElement("th");b.classList.add("timeHeader");b.innerHTML=virtualclass.lang.getString("Time");a.appendChild(b);c=document.createElement("i");c.className="icon-creator";b.appendChild(c);b=document.createElement("th");b.classList.add("qperpageHeader");b.innerHTML=
virtualclass.lang.getString("Quiz/page");a.appendChild(b)},createTab:function(){var b=document.createElement("ul");b.classList.add("nav","nav-tabs");var a=document.createElement("li");a.className="active";var c=document.createElement("a");c.setAttribute("data-toggle","tab");c.href="#qzOverv";c.innerHTML="Questions overview";a.appendChild(c);b.appendChild(a);var d=document.createElement("li");c=document.createElement("a");c.setAttribute("data-toggle","tab");c.href="#gdRpt";c.innerHTML=virtualclass.lang.getString("Greport");
d.appendChild(c);b.appendChild(d);d.addEventListener("click",function(){d.classList.toggle("active");a.classList.toggle("active");d.classList.contains("active")&&(document.querySelector("#gdRpt").className="tab-pane fade in active",document.querySelector("#qzOverv").className="tab-pane fade")});a.addEventListener("click",function(){a.classList.toggle("active");d.classList.toggle("active");a.classList.contains("active")&&(document.querySelector("#qzOverv").className="tab-pane fade in active",document.querySelector("#gdRpt").className=
"tab-pane fade")});return b},resultView:function(b){document.getElementById("layoutQuiz");if(roles.hasControls()){this.createResultLayout();var a=document.querySelector("#contQzHead");var c=document.querySelector("#QstnName");null==c&&(c=document.createElement("div"),c.id="QstnName",c.innerHTML=b.name,null!=a&&a.appendChild(c));var d=parseInt(b.timelimit);if(0<d){c="desc";var g="Time remaining"}else c="asc",g="Elapsed time";a=localStorage.getItem("quizSt");null!=a&&(a=JSON.parse(a),0<Object.keys(a).length&&
(a=a.qtime.split(":"),d=parseInt(a[2])+60*parseInt(a[1])+3600*parseInt(a[0])));a=document.getElementById("resultQzLayout");var k=virtualclass.view.customCreateElement("div","rsQzHead","row col-md-12");a.appendChild(k);var m=virtualclass.view.customCreateElement("div","","col-md-3");m.innerHTML="Time limit : <span> "+virtualclass.quiz.convertSecToTime(b.timelimit)+"</span>";k.appendChild(m);m=virtualclass.view.customCreateElement("div","","col-md-3");m.innerHTML="No of questions : <span> "+b.noOfQus+
"</span>";k.appendChild(m);b=virtualclass.view.customCreateElement("div","","col-md-4");b.innerHTML=g+' : <span id="elsTime">00:00:00</span>';k.appendChild(b);b=virtualclass.view.customCreateElement("button","closeQzBt","");b.classList.add("btn","btn-default","controls");b.innerHTML=virtualclass.lang.getString("Cquiz");k.appendChild(b);b.addEventListener("click",virtualclass.quiz.closeQzBt);b=JSON.parse(localStorage.getItem("quizSt"));null==b||"true"!=b.qClosed&&!b.qClosed?virtualclass.quiz.quizTimer(d,
document.getElementById("elsTime"),c):(console.log("Don't run timer when quiz is closed"),c=document.querySelector("#elsTime"),localStorage.setItem("quizSt",JSON.stringify(b)),null!=c&&(c.innerHTML=b.qtime));c=this.createTab();a.appendChild(c)}},createResultLayout:function(){var b=document.getElementById("resultQzLayout");b&&b.parentNode.removeChild(b);if(roles.hasControls()){b=document.getElementById("contQzHead");(pubbtn=document.getElementById("publishQzBt"))&&pubbtn.parentNode.removeChild(pubbtn);
var a=document.querySelector("#contQzHead .close");a&&(a.parentNode.removeChild(a),a=virtualclass.view.customCreateElement("div","modalQzClose","close"),a.type="button",a.innerHTML="&times",b.appendChild(a));if(b=document.getElementById("quizModalBody"))for(;1<b.childElementCount;)b.removeChild(b.lastChild);a=document.createElement("div");a.id="resultQzLayout";b.appendChild(a);document.getElementById("modalQzClose").addEventListener("click",function(){virtualclass.quiz.usersFinishedQz=[];virtualclass.quiz.qGrade=
[];virtualclass.quiz.quizModalClose()})}},createProgressBar:function(b,a){var c=virtualclass.view.customCreateElement("div","","progress");b=virtualclass.view.customCreateElement("div","qPb_"+b,"progress-bar");b.role="progressbar";b.setAttribute("setaria-valuenow",a);b.setAttribute("aria-valuemin","0");b.setAttribute("aria-valuemax","100");b.style="width:"+a+"%";b.innerHTML=a+"% Correct";c.appendChild(b);return c},gradeReportLayout:function(){var b=virtualclass.view.customCreateElement("div","gradeRpBody",
"modal-body"),a=virtualclass.view.customCreateElement("table","","table"),c=virtualclass.view.customCreateElement("thead","","thead-inverse"),d=document.createElement("tr"),g=document.createElement("th");g.innerHTML="#";d.appendChild(g);g=document.createElement("th");g.innerHTML="Name";d.appendChild(g);g=document.createElement("th");g.innerHTML="Time taken";d.appendChild(g);g=document.createElement("th");g.innerHTML="Grade";d.appendChild(g);g=document.createElement("th");g.innerHTML="Q. attempted";
d.appendChild(g);g=document.createElement("th");g.innerHTML="Correct";d.appendChild(g);c.appendChild(d);a.appendChild(c);c=virtualclass.view.customCreateElement("tbody","qzReTbody");a.appendChild(c);b.appendChild(a);return b},displayStudentResultScreen:function(b){var a=document.getElementById("mszBoxQuiz");if(a){var c=document.getElementById("stdQuizMszLayout");c&&a.removeChild(c);c=virtualclass.view.customCreateElement("div","resultDiv");a.appendChild(c);a=document.createElement("h4");a.innerHTML=
"<span class='col-md-4'> Total no of questions </span>  <span class='nfqh'>: &nbsp;  "+b.grade.noofqus+"</span>";c.appendChild(a);a=document.createElement("h4");a.innerHTML=" <span class='col-md-4'> Time taken </span><span class='tth'> : &nbsp;   "+b.grade.timetaken+"</span>";c.appendChild(a);a=document.createElement("h4");a.innerHTML=" <span class='col-md-4'> Maximum mark </span><span class='mmh'>: &nbsp;  "+b.grade.maxmarks+"</span>";c.appendChild(a);a=document.createElement("h4");a.innerHTML="<span class='col-md-4'> Correct answers </span><span class='cah'>: &nbsp;  "+
b.grade.correctans+"</span>";c.appendChild(a);a=document.createElement("h4");a.innerHTML=" <span class='col-md-4'> Questions attempted</span> <span class='qah'>: &nbsp;  "+b.grade.quesattemptd+"</span>";c.appendChild(a);a=document.createElement("h4");a.innerHTML=" <span class='col-md-4'> You Scored </span> <span class='sch'>: &nbsp;  "+b.grade.score+"</span>";c.appendChild(a);c.style.display="block"}},createMszBox:function(b){var a=virtualclass.view.customCreateElement("div","mszBoxQuiz","row");b.appendChild(a)},
generateModal:function(b,a){var c=virtualclass.view.customCreateElement("div",b,"modal");c.role="dialog";c.style.display="none";c.setAttribute("tab-index","-1");c.setAttribute("area-hidden","true");a.appendChild(c);a=document.createElement("div");a.className="modal-dialog";c.appendChild(a);b=virtualclass.view.customCreateElement("div","quizModalBody","modal-content");a.appendChild(b);a=virtualclass.view.customCreateElement("div","contQzHead","modal-header");b.appendChild(a);var d=virtualclass.view.customCreateElement("div",
"","close");d.type="button";d.setAttribute("data-dismiss","modal");d.innerHTML="&times";a.appendChild(d);a=virtualclass.view.customCreateElement("div","contQzBody","modal-body");b.appendChild(a);document.querySelector("#editQuizModal #contQzHead .close ").addEventListener("click",function(){c.style.display="none";c.className="modal fade"})},modalContentUI:function(){var b=document.getElementById("contQzBody"),a=virtualclass.view.customCreateElement("div","slickQuiz","path-mod-congrea-quiz"),c=virtualclass.view.customCreateElement("h3",
"","quizName");a.appendChild(c);c=virtualclass.view.customCreateElement("P","timeText");a.appendChild(c);var d=virtualclass.view.customCreateElement("div","exam_navblock","navblock");a.appendChild(d);c=virtualclass.view.customCreateElement("div","","content");d.appendChild(c);d=virtualclass.view.customCreateElement("div","","qn_buttons multipages");c.appendChild(d);c=virtualclass.view.customCreateElement("div","","quizArea");a.appendChild(c);d=virtualclass.view.customCreateElement("div","","quizHeader");
c.appendChild(d);c=virtualclass.view.customCreateElement("a","","button startQuiz");c.href="#";c.innerHTML="Get Started!";d.appendChild(c);d=virtualclass.view.customCreateElement("div","","quizResults");a.appendChild(d);var g=virtualclass.view.customCreateElement("h3","","quizScore");g.innerHTML="You Scored: <span></span>";d.appendChild(g);g=virtualclass.view.customCreateElement("h3","","quizLevel");c.innerHTML="<strong>Ranking:</strong> <span></span>";d.appendChild(g);c=virtualclass.view.customCreateElement("div",
"","quizResultsCopy");d.appendChild(c);b.appendChild(a)},qzCont:function(b){var a=document.getElementById("listQzCont");b=virtualclass.view.customCreateElement("tr","contQz"+b,"vcQuizCont");null!=a&&a.insertBefore(b,a.firstChild)},qzCtrCont:function(b){var a=document.getElementById("contQz"+b),c=virtualclass.view.customCreateElement("td","ctrQz"+b,"quizCtrCont");a.appendChild(c);a=document.createElement("a");a.href="#";a.id="publishQz"+b;c.appendChild(a);b=document.createElement("span");b.className=
"icon-publish2";b.setAttribute("data-toggle","tooltip");b.setAttribute("title",virtualclass.lang.getString("quizreviewpublish"));a.appendChild(b)},qzTextCont:function(b,a){a=document.getElementById("contQz"+a);var c=document.createElement("td");c.classList.add("qnText");c.innerHTML=b.name;a.appendChild(c);var d=document.createElement("td");d.classList.add("creator");c=0<b.timelimit?virtualclass.quiz.convertSecToTime(b.timelimit):b.timelimit;d.innerHTML=c;a.appendChild(d);d=document.createElement("td");
d.classList.add("qperpage");d.innerHTML=b.questionsperpage;a.appendChild(d)},defaultLayoutForStudent:function(){this.container();var b=document.getElementById("mszBoxQuiz");if(null==document.getElementById("stdQuizMszLayout")){var a=virtualclass.view.customCreateElement("div","stdQuizMszLayout");a.innerHTML=virtualclass.lang.getString("quizmayshow");b.appendChild(a)}}}}}})(window);!function(){var d=Handlebars.template;(Handlebars.templates=Handlebars.templates||{})["docNotesMain.hbs"]=d({compiler:[7,">= 4.0.0"],main:function(b,a,c,d,g){var f;return'<div id="notesContainer" class="notes ddd">\n  '+b.escapeExpression((f=null!=(f=c.name||(null!=a?a.name:a))?f:c.helperMissing,"function"==typeof f?f.call(null!=a?a:b.nullContext||{},{name:"name",hash:{},data:g}):f))+"\n</div>"},useData:!0})}();(function(d){function b(a){console.log("multivideo, "+a)}function a(){console.log("multivideo, success setRemoteDescriptionSuccess")}function c(a){console.log("multivideo, error setRemoteDescriptionError"+a)}function f(a){console.log("multivideo, error handleCreateAnswerError"+a)}function g(){console.log("multivideo, success addIceCandidateSuccess")}function k(a){console.log("multivideo, error addIceCandidateError"+a)}function m(b,d){apc[d]=new RTCPeerConnection(pc_config);apc[d].onicecandidate=n(d,
"opc");apc[d].onaddstream=v(d);"undefined"!=typeof _localStream?apc[d].addStream(_localStream):console.log("_localStream is not defined");apc[d].setRemoteDescription(new RTCSessionDescription(b.sdp),a,c);console.log("multivideo, addStream and setRemoteDescription for"+d);apc[d].createAnswer(function(a){apc[d].setLocalDescription(a);console.log("multivideo setLocalDescription for "+d);ioAdapter.sendUser({cf:"mvid",sdp:a,answer:!0},d)},f)}function n(a,c){return function(b){console.log("multivideo, STEP 7(9), handleIceCandidate event");
b.candidate?ioAdapter.sendUser({cf:"mvid",candidate:b.candidate,pt:c},a):console.log("multivideo, STEP 10, End of candidates.")}}function p(a,c){userStreams[c]=a;virtualclass.multiVideo.removeUser(c);c=$("<div class='videoCont remoteVideo'  id='vid"+c+"' data-userid='"+c+"' data-totaluser=''></div>");$video=$("<video  class='videoBox' autoplay></video>");$video.attr({src:d.URL.createObjectURL(a),autoplay:"autoplay"});c.append($video);$("#videosWrapper").append(c);virtualclass.multiVideo.updateVideoLength();
console.log("multivideo, Remote stream added");c.click(function(){q.UI.displayMainVideo(this)});"undefined"!=typeof updateActiveTime&&clearTimeout(updateActiveTime);updateActiveTime=setTimeout(function(){var a=0;for(d in userStreams){var c=userStreams[d].getVideoTracks()[0];var b=document.querySelector("#vid"+d);null!=c?(a++,null!=b?(b.classList.add("vshow"),b.classList.remove("vhide")):console.log("Meeting mode is null")):null!=b?(b.classList.add("vhide"),b.classList.remove("vshow")):console.log("Meeting mode is null")}c=
"one";4<a?c="morethanfour":2<a?c="four":1<a&&(c="two");a=document.querySelector("#virtualclassCont");var d=document.querySelector("#videoConfrence");a.setAttribute("data-totalUser",c);d.setAttribute("data-totalUser",c)},3E3)}function v(a){return function(c){p(c.stream,a);_remoteStream=c.stream}}function u(a){opc[a]=new RTCPeerConnection(pc_config);opc[a].onicecandidate=n(a,"apc");opc[a].onaddstream=v(a);"undefined"!=typeof _localStream?(opc[a].addStream(_localStream),console.log("multivideo, Set addStream for "+
a)):console.log("No _localStream  for "+a);console.log("multivideo, Create offer for "+a);opc[a].createOffer(function(c){opc[a].setLocalDescription(c);console.log("multivideo, setLocalDescription with offer");ioAdapter.sendUser({cf:"mvid",sdp:c,offer:!0},a)},b)}userStreams={};var q={init:function(){pc_config={iceServers:[{urls:["stun:turn.congrea.net"]},{urls:"turn:turn.congrea.net",username:wbUser.auth_user,credential:wbUser.auth_pass}]};this.UI.container();this.start();var a=document.querySelector("#videosWrapper .videoCont.selfVideo");
a.id="vid"+virtualclass.gObj.uid;a.setAttribute("data-userid",virtualclass.gObj.uid);var c=this;userStreams[virtualclass.gObj.uid]=virtualclass.multiVideo.localStream;a.addEventListener("click",function(){c.UI.displayMainVideo(this)});this.updateVideoLength();a=localStorage.getItem("videoSwitch");null!=a&&"0"==a&&virtualclass.multiVideo.setVideoStatus(!1)},_init:function(){var a=document.querySelector("#videosWrapper .videoCont.selfVideo");this.UI.displayMainVideo(a);var c=this;setTimeout(function(){c.displayVideo();
roles.hasControls()&&ioAdapter.mustSend({cf:"mvid",_init:!0})},2E3)},displayVideo:function(){document.querySelector("#virtualclassMultiVideo").style.display="block"},start:function(){console.log("Video First, multivideo");virtualclass.multiVideo.localStream=virtualclass.media.video.tempStream;_localStream=virtualclass.multiVideo.localStream;console.log("multivideo, add get user media ");selfView=document.querySelector("#videoConfrence .multilocalVideo");virtualclass.adpt.attachMediaStream(selfView,
virtualclass.multiVideo.localStream);this.initDone=!0},UI:{container:function(){if(null==document.querySelector("#virtualclassMultiVideo")){var a=virtualclass.getTemplate("multiVideoMain");virtualclass.vutil.insertAppLayout(a())}},displayMainVideoOld:function(a){var c=a.firstElementChild;if("MultiVideo"==virtualclass.currApp){var b=document.querySelector("#multiVidSelected"),d=b.getContext("2d");"undefined"!=typeof earlierVideo&&clearInterval(earlierVideo);earlierVideo=setInterval(function(){d.drawImage(c,
0,0,b.width,b.height)},28)}},displayMainVideo:function(a){if("MultiVideo"==virtualclass.currApp){var c=document.querySelector("#multiVidSelected");virtualclass.adpt.attachMediaStream(c,userStreams[a.dataset.userid])}}},removeUser:function(a){a=document.querySelector('#videosWrapper .videoCont[data-userid="'+a+'"]');null!=a&&a.parentNode.removeChild(a)},onUserRemove:function(a){this.removeUser(a);this.updateVideoLength();"object"==typeof apc[a]&&apc[a].close();"object"==typeof opc[a]&&opc[a].close()},
updateVideoLength:function(){var a=document.querySelectorAll("#videoConfrence .videoCont");var c="one";4<a.length?c="morethanfour":2<a.length?c="four":1<a.length&&(c="two");a=document.querySelector("#virtualclassCont");var b=document.querySelector("#videoConfrence");a.setAttribute("data-totalUser",c);b.setAttribute("data-totalUser",c)},setAudioStatus:function(a){var c=virtualclass.multiVideo.localStream.getAudioTracks();if(0===c.length)console.log("No local audio available.");else for(var b=0;b<c.length;++b)c[b].enabled=
a},setVideoStatus:function(a){setTimeout(function(){if("undefined"!=typeof virtualclass.multiVideo.localStream){var c=document.querySelector("#vid"+virtualclass.gObj.uid),b=virtualclass.multiVideo.localStream.getVideoTracks();if(0===b.length)console.log("No local video available.");else{console.log("Toggling video mute state.");for(var d=0;d<b.length;++d)if(b[d].enabled=a,null!=c){var f=document.querySelector("#videoConfrence"),g=document.querySelectorAll("#videosWrapper .videoCont.vshow");null!=
f&&(f.dataset.activeuser="vid_"+g.length)}}}else console.log("localStream is undefined")},1E3)},addClass:function(){}};apc={};opc={};q.onmessage=function(b,d){if(b.hasOwnProperty("_init"))virtualclass.makeAppReady(virtualclass.apps.mv);else if(b.hasOwnProperty("offer"))m(b,d);else if(b.hasOwnProperty("candidate")){var f=new RTCIceCandidate(b.candidate);"apc"==b.pt?apc[d].addIceCandidate(f,g,k):opc[d].addIceCandidate(f,g,k);console.log("multivideo addIcecandidate")}else b.hasOwnProperty("answer")&&
(console.log("multivideo setRemoteDescription for"+d),opc[d].setRemoteDescription(new RTCSessionDescription(b.sdp),a,c))};q.onUserJoin=function(a){setTimeout(function(){u(a)},2E3)};d.MultiVideo=q})(window);(function(d){d.zoomWhiteboard=function(){return{init:function(){if(null==document.querySelector(".zoomControler")){var b=document.querySelector("#virtualclassAppLeftPanel");if(null!=b){var a=virtualclass.getTemplate("zoomControl")({hasControls:roles.hasControls()});b.insertAdjacentHTML("beforeend",a);this._initScaleController();b=localStorage.getItem("canvasDimension");null!=b&&(virtualclass.zoom.canvasDimension=JSON.parse(b))}}},_initScaleController:function(){var b=document.querySelector(".zoomControler"),
a=this;a=this;b.querySelector(".zoomIn").addEventListener("click",function(){virtualclass.zoom.performZoom=!0;delete virtualclass.zoom.fitToScreenWidth;delete virtualclass.zoom.prvWhiteboard;a.zoomAction("zoomIn")});b.querySelector(".zoomOut").addEventListener("click",function(){delete virtualclass.zoom.fitToScreenWidth;delete virtualclass.zoom.prvWhiteboard;virtualclass.zoom.performZoom=!0;a.zoomAction("zoomOut")});b.querySelector(".fitScreen").addEventListener("click",function(){a.zoomAction("fitToScreen")})},
zoomAction:function(b){"ScreenShare"===virtualclass.currApp?virtualclass.studentScreen[b].call(virtualclass.studentScreen):(virtualclass.zoom.prvCanvasScale=this.canvasScale,this[b].call(this))},zoomIn:function(b){var a=virtualclass.gObj.currWb;if("object"==typeof virtualclass.wb[a]){var c=virtualclass.wb[a].vcan.main.canvas,d=virtualclass.zoom.canvasDimension.width*SCALE_FACTOR,g=virtualclass.zoom.canvasDimension.height*SCALE_FACTOR;virtualclass.zoom.canvasDimension.width=d;virtualclass.zoom.canvasDimension.height=
g;"undefined"!=typeof b?virtualclass.pdfRender[a]._zoom.call(virtualclass.pdfRender[a],c,d,g,b):virtualclass.pdfRender[a]._zoom.call(virtualclass.pdfRender[a],c,d,g)}},zoomOut:function(){var b=virtualclass.gObj.currWb,a=virtualclass.wb[b].vcan.main.canvas,c=a.parentNode,d=a.parentNode.offsetWidth;console.log("Canvas pdf scale "+this.canvasScale);var g=1/SCALE_FACTOR*virtualclass.zoom.canvasDimension.width,k=1/SCALE_FACTOR*virtualclass.zoom.canvasDimension.height;virtualclass.zoom.canvasDimension.width=
g;virtualclass.zoom.canvasDimension.height=k;g<=d&&c.classList.remove("scrollX");virtualclass.pdfRender[b]._zoomOut.call(virtualclass.pdfRender[b],a,g,k)},adjustScreenOnDifferentPdfWidth:function(b){var a=this;this.hasOwnProperty("adjustScreenOnDifferentPdfWidthTime")&&clearTimeout(this.adjustScreenOnDifferentPdfWidthTime);this.adjustScreenOnDifferentPdfWidthTime=setTimeout(function(){a._adjustScreenOnDifferentPdfWidth()},400)},_adjustScreenOnDifferentPdfWidth:function(b){b=b||virtualclass.pdfRender[virtualclass.gObj.currWb].page;
if(null!=b){var a=b.getViewport(1);b=a.width;a=a.height;virtualclass.zoom.hasOwnProperty("prevPdfWidth")&&b!==virtualclass.zoom.prevPdfWidth?(virtualclass.zoom.canvasDimension.width=virtualclass.zoom.canvasScale*b,virtualclass.zoom.canvasDimension.height=virtualclass.zoom.canvasScale*a,virtualclass.zoom.hasOwnProperty("fitToScreenWidth")?virtualclass.zoom.fitToScreen():virtualclass.zoom.normalRender()):virtualclass.zoom.normalRender();virtualclass.zoom.prevPdfWidth=b}else console.log("Page is null")},
getReduceValueForCanvas:function(){var b=document.querySelector("#canvas"+virtualclass.gObj.currWb);if(null!=b&&null!=b.parentNode)return b.parentNode.scrollHeight>b.parentNode.clientHeight?382:372},fitToScreen:function(){virtualclass.gObj.fitToScreen=!0;delete virtualclass.zoom.performZoom;var b=virtualclass.gObj.currWb;if("undefined"!=typeof virtualclass.pdfRender[b]){console.log("--Pdf render start----------");var a=virtualclass.pdfRender[b].page,c=virtualclass.wb[virtualclass.gObj.currWb].vcan.main.canvas;
var f=document.querySelector("#virtualclassCont");f=null!=f?f.offsetWidth:d.innerWidth;f-=this.getReduceValueForCanvas();console.log("==== wrapperWidth "+f);try{var g=a.getViewport(1);virtualclass.zoom.fitToScreenWidth=g.width;virtualclass.zoom.prvWhiteboard=virtualclass.gObj.currWb;var k=a.getViewport(+f/a.getViewport(1).width);console.log("==== PDF width => "+k.width+" PDF height => "+k.height+" scale => "+k.scale);console.log("==== PDF temp width => "+g.width+" PDF height => "+g.height+" scale => "+
g.scale+", after scale="+this.canvasScale);virtualclass.pdfRender[b]._fitToScreen.call(virtualclass.pdfRender[b],c,f,c.height)}catch(m){console.log("Error "+m)}}},reload:function(){virtualclass.zoom.normalRender()},normalRender:function(b){console.log("--Pdf Render Start "+virtualclass.currApp+" ------------");console.log("Pdf render normal view");console.log("--Pdf render------------");b=virtualclass.gObj.currWb;delete virtualclass.zoom.performZoom;"object"==typeof virtualclass.pdfRender[b].shownPdf&&
(null!=virtualclass.zoom.canvasScale?(virtualclass.zoom.canvasDimension.width/=SCALE_FACTOR,virtualclass.zoom.canvasDimension.height/=SCALE_FACTOR,console.log("Canvas pdf scale "+this.canvasScale),virtualclass.zoom.zoomIn("normalRender")):console.log("canvasScale is not defined yet."))},removeZoomController:function(){var b=document.querySelector("#virtualclassApp .zoomControler");null!=b&&virtualclass.gObj.studentSSstatus.mesharing&&b.parentNode.removeChild(b)}}}})(window);(function(d){d.pdfRender=function(){return{firstTime:!0,shownPdf:"",canvasWrapper:null,canvasId:null,canvas:null,pdfScale:1,url:"",xhr:new CommonXHR,xhrNext:new CommonXHR,init:function(b,a){document.querySelector("#virtualclassCont");io.globallock=!1;virtualclass.gObj.firstNormalRender=!1;this.url="undefined"!=typeof a?virtualclass.dts.getNote(a).pdf:whiteboardPath+"resources/sample.pdf";this.loadPdf(this.url,b,a)},prefechPdf:function(b){var a=virtualclass.dts.getNote(b);this.xhrNext.send(a.pdf,this.afterPdfPrefetch.bind(this,
b),"arraybuffer")},afterPdfPrefetch:function(b,a){virtualclass.gObj.next={};virtualclass.gObj.next[b]=a},loadPdf:function(b,a,c){var d=this;return $jscomp.executeAsyncGenerator(function(){function f(f,g){for(;;)switch(k){case 0:virtualclass.gObj.hasOwnProperty("getDocumentTimeout")&&clearTimeout(virtualclass.gObj.getDocumentTimeout),null==virtualclass.gObj.getDocumentTimer||0==virtualclass.gObj.getDocumentTimer?(d._loadPdf(b,a,c),virtualclass.gObj.getDocumentTimer=!0,virtualclass.gObj.getDocumentTimeout=
setTimeout(function(){virtualclass.gObj.getDocumentTimer=!1},1E3)):virtualclass.gObj.getDocumentTimeout=setTimeout(function(){d._loadPdf(b,a,c);virtualclass.gObj.getDocumentTimer=!1},1E3),k=-1;default:return{value:void 0,done:!0}}}var k=0,m={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}())},_loadPdf:function(b,a,c){virtualclass.gObj.next.hasOwnProperty(c)?
this.afterPdfLoad(a,c,virtualclass.gObj.next[c]):this.xhr.send(b,this.afterPdfLoad.bind(this,a,c),"arraybuffer")},afterPdfLoad:function(b,a,c){var d=this;return $jscomp.executeAsyncGenerator(function(){function f(f,g){for(;;)switch(k){case 0:d.canvasWrapper=document.querySelector("#canvasWrapper"+virtualclass.gObj.currWb),d.canvas=b,v={},v.data=c,null!=virtualclass.gObj.myworker&&(v.worker=virtualclass.gObj.myworker),p=d,n=virtualclass.currApp,m=virtualclass.gObj.currWb,n==virtualclass.currApp?(p.wbId=
"undefined"==typeof a?virtualclass.gObj.currWb:a,console.log("-----------START "+virtualclass.currApp+"----------"),console.log("PDF render request to pdf.js 1"),PDFJS.workerSrc=whiteboardPath+"build/src/pdf.worker.min.js",PDFJS.getDocument(v).then(function(a){null==virtualclass.gObj.myworker&&(virtualclass.gObj.myworker=a.loadingTask._worker);p.displayPage(a,1,function(){},!0);p.shownPdf=a;roles.hasControls()||(p.topPosY=0,p.leftPosX=0);p.scrollEvent()})):"DocumentShare"==virtualclass.currApp&&virtualclass.wbCommon.deleteWhiteboard(m),
"undefined"!=typeof virtualclass.gObj.currWb&&null!=virtualclass.gObj.currWb&&(f=document.querySelector("#note"+a),null!=f&&null!=f.nextElementSibling&&virtualclass.pdfRender[virtualclass.gObj.currWb].prefechPdf(f.nextElementSibling.dataset.slide)),k=-1;default:return{value:void 0,done:!0}}}var k=0,m,n,p,v,u={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();u[Symbol.iterator]=function(){return this};
return u}())},updateScrollPosition:function(b,a){"object"==typeof this.scroll[a]&&this.scroll[a].hasOwnProperty("b")?(this.scroll[a].b=b,this.scroll[a].c=this.scroll[a].b+this.scroll[a].studentVPm):console.log("Scroll b is undefined")},scrollEvent:function(){var b=this.canvasWrapper,a=b.scrollTop,c=b.scrollLeft;virtualclass.topPosY=a;virtualclass.leftPosX=c;this.topPosY=a;this.leftPosX=c;var d=this;b.onscroll=function(){d.onScroll(b)}},onScroll:function(b,a){var c=b.scrollTop;var d=b.scrollLeft;(0<
c||"undefined"!==typeof a)&&this._scroll(d,c,b,"Y");(0<d||"undefined"!==typeof a)&&this._scroll(d,c,b,"X");roles.hasControls()||virtualclass.pdfRender[virtualclass.gObj.currWb].setScrollPosition({scX:d,scY:c})},_scroll:function(b,a,c,d){var f;if(roles.hasControls())return this.topPosY=a,this.leftPosX=b,this.scrollPosition(c,d);"Y"==d?f=a:"X"==d&&(f=b);this.updateScrollPosition(f,d);return null},scrollPosition:function(b,a){var c=this.canvas;if("Y"==a){var d=b.scrollTop;var g=c.height}else"X"==a&&
(d=b.scrollLeft,g=c.width);this["scrollPos"+a]=d/g*100;b=virtualclass.vutil.getElemM("canvasWrapper"+virtualclass.gObj.currWb,a);this["actualVp"+a]=b;this["viewPort"+a]=b/g*100;g={};g["vp"+a]=this["viewPort"+a];g["sc"+a]=this["scrollPos"+a];return g},scroll:{caclculatePosition:function(b,a,c){b=this.type=c;null==this[b]&&(this[b]={});this[b].a=0;this[b].d=a;a="canvasWrapper"+virtualclass.gObj.currWb;c=document.querySelector("#"+a);null!=c&&("X"==this.type?this[b].b=c.scrollLeft:"Y"==this.type&&(this[b].b=
c.scrollTop),this[b].studentVPm=virtualclass.vutil.getElemM(a,b),this[b].c=this[b].b+this[b].studentVPm)}},setScrollPosition:function(b){b.hasOwnProperty("scY")&&null!=b.scY&&this.scroll.caclculatePosition(b.scY,this.canvas.height,"Y");b.hasOwnProperty("scX")&&null!=b.scX&&this.scroll.caclculatePosition(b.scX,this.canvas.width,"X")},customMoustPointer:function(b,a,c){this.scroll[a].e=c;this.scroll[a].e>this.scroll[a].c?(b=this.scroll[a].b+(this.scroll[a].d-this.scroll[a].c),b>this.scroll[a].e&&(b=
this.scroll[a].e-(this.scroll[a].b+this.scroll[a].c)/2),console.log("custom mouse down pointer ay="+this.scroll[a].a+" by="+this.scroll[a].b+" cy="+this.scroll[a].c+" dy="+this.scroll[a].d+" ey"+this.scroll[a].e+" scrollPos="+b),"Y"==a?this.canvasWrapper.scrollTop=b:(this.canvasWrapper.scrollLeft=b,console.log("Scroll left "+this.canvasWrapper.scrollLeft)),this.scroll[a].b=b,this.scroll[a].c=this.scroll[a].b+this.scroll[a].studentVPm):this.scroll[a].e<this.scroll[a].b&&(b=this.scroll[a].b-this.scroll[a].a,
this.scroll[a].c-b<this.scroll[a].e&&(b=(this.scroll[a].b+this.scroll[a].c)/2-this.scroll[a].e),"Y"==a?this.canvasWrapper.scrollTop-=b:this.canvasWrapper.scrollLeft-=b,this.scroll[a].b=b,this.scroll[a].c=this.scroll[a].b+this.scroll[a].studentVPm)},setCustomMoustPointer:function(b,a){var c="scrollDiv"+a+virtualclass.gObj.currWb;var d=document.querySelector("#"+c+"mousePointer");null==d&&(d=document.createElement("div"),d.className="mousepointer",d.id=c+"mousePointer",c=document.querySelector("#scrollDiv"+
a+virtualclass.gObj.currWb),null!=c&&c.appendChild(d));"Y"==a?d.style.top=b.y-this.scroll[a].a+"px":"X"==a&&(d.style.left=b.x-this.scroll[a].a+"px")},sendScroll:function(){virtualclass.vutil.setDefaultScroll()},sendCurrentScroll:function(b){var a={};if(null!=this.currentScroll){a=Object.assign(a,this.currentScroll);console.log("Send scroll first time "+this.currentScroll);var c=this;c.currentScrolltoUser=b;setTimeout(function(){c.currentScrolltoUser=b;a.cf="scf";a.toUser=b;virtualclass.vutil.beforeSend({toUser:b,
cf:"scf",scY:a.scY,vpY:a.vpY},b);console.log("Send scroll "+a+"to user "+b);console.log("Send scroll "+a)},2E3)}},renderPage:function(b,a){var c=this;return $jscomp.executeAsyncGenerator(function(){function f(f,k){for(var m;;)switch(g){case 0:console.log("#### render page");if(null!=virtualclass.gObj.currWb){f=c.pdfScale;null!=virtualclass.zoom.canvasScale&&""!=virtualclass.zoom.canvasScale&&(0<virtualclass.zoom.canvasScale?f=virtualclass.zoom.canvasScale:console.log("Why negative value"));m="Whiteboard"==
virtualclass.currApp&&null!=c.wbId&&virtualclass.gObj.currWb!=c.wbId?-1<c.wbId.indexOf("_doc_")?c.wbId:"_doc_"+c.wbId+"_"+c.wbId:virtualclass.gObj.currWb;var n=virtualclass.wb[m].vcan.main.canvas;virtualclass.gObj.hasOwnProperty("fitToScreen")?(n.width=d.innerWidth-virtualclass.zoom.getReduceValueForCanvas(),console.log("==== a canvas width fit to screen"),roles.hasControls()||(n.width+=50)):virtualclass.zoom.hasOwnProperty("performZoom")?(n.width=virtualclass.zoom.canvasDimension.width,delete virtualclass.zoom.performZoom):
virtualclass.zoom.hasOwnProperty("canvasDimension")?(console.log("==== a canvas width dimension "+virtualclass.zoom.canvasDimension.width+" scale="+virtualclass.zoom.canvasScale),n.width=virtualclass.zoom.canvasDimension.width):0===n.offsetWidth?(n.width=d.innerWidth-382,console.log("==== a canvas width click to continue")):virtualclass.isPlayMode&&(n.width=d.innerWidth-382,console.log("==== a canvas width"));c.firstTime?(c.firstTime=!1,console.log("## WHITEBOARD Canvas = ",virtualclass.zoom.prvCanvasScale,
" ID ",virtualclass.gObj.currWb),f=null==virtualclass.zoom.canvasScale?b.getViewport(n.width/b.getViewport(1).width):b.getViewport(f)):f=b.getViewport(n.width/b.getViewport(1).width);virtualclass.zoom.prvCanvasScale=virtualclass.zoom.canvasScale;virtualclass.zoom.canvasScale=f.scale;n.height=f.height;k=n.nextSibling;k.width=n.width;k.height=n.height;virtualclass.zoom.canvasDimension={};virtualclass.zoom.canvasDimension.width=n.width;virtualclass.zoom.canvasDimension.height=n.height;console.log("==== canvas dimension ",
virtualclass.zoom.canvasDimension.width);if(virtualclass.gObj.hasOwnProperty("fitToScreen")){var u=document.querySelector("#canvasWrapper"+virtualclass.gObj.currWb);if(null!=u&&(u.scrollHeight<=u.clientHeight||u.scrollWidth<=u.clientWidth))virtualclass.pdfRender[virtualclass.gObj.currWb].onScroll(u,!0)}delete virtualclass.gObj.fitToScreen;f={canvasContext:k.getContext("2d"),viewport:f};var q=c;console.log("PDF render initiate to display pdf on canvas 3");b.render(f).then(function(){console.log("PDF render DONE 4");
console.log("-----------END----------");n.parentNode.dataset.pdfrender=!0;q[m]={pdfrender:!0};virtualclass.vutil.showZoom();void 0!=a&&null!=virtualclass.gObj.currWb&&q.initWhiteboardData(virtualclass.gObj.currWb);displayCb();"object"==typeof q.shownPdf?(io.globallock=!1,io.onRecJson(null),virtualclass.gObj.hasOwnProperty("pdfNormalTimeout")&&clearTimeout(virtualclass.gObj.pdfNormalTimeout),virtualclass.gObj.firstNormalRender||null==virtualclass.gObj.currWb||null==document.querySelector("#canvas"+
virtualclass.gObj.currWb+"_pdf")||(virtualclass.zoom.adjustScreenOnDifferentPdfWidth(b),virtualclass.gObj.firstNormalRender=!0),virtualclass.vutil.removeClass("virtualclassCont","resizeWindow")):console.log("We should have a PDF here")})}g=-1;default:return{value:void 0,done:!0}}}var g=0,k={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}())},
displayPage:function(b,a,c,d){displayCb=c;this._displayPage(b,a,c,d)},_displayPage:function(b,a,c,d){var f=this;return $jscomp.executeAsyncGenerator(function(){function c(c,k){for(;;)switch(g){case 0:return g=1,{value:b.getPage(a),done:!1};case 1:if(void 0===k){g=2;break}g=-1;throw k;case 2:n=p=c;virtualclass.pdfRender[virtualclass.gObj.currWb].page=n;console.log("==== to be display ",virtualclass.pdfRender[virtualclass.gObj.currWb].page,virtualclass.gObj.currWb);if("undefined"===typeof d){g=3;break}g=
5;return{value:f.renderPage(n,d),done:!1};case 5:if(void 0===k){g=6;break}g=-1;throw k;case 6:g=4;break;case 3:return g=7,{value:f.renderPage(n,null),done:!1};case 7:if(void 0===k){g=8;break}g=-1;throw k;case 8:case 4:g=-1;default:return{value:void 0,done:!0}}}var g=0,n,p,v={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();v[Symbol.iterator]=function(){return this};return v}())},fitToScreenIfNeed:function(){"DocumentShare"!=
virtualclass.currApp||virtualclass.gObj.docPdfFirstTime||(virtualclass.gObj.docPdfFirstTime=!0,virtualclass.zoom.zoomAction("fitToScreen"))},initWhiteboardData:function(b){return $jscomp.executeAsyncGenerator(function(){function a(a,d){for(;;)switch(c){case 0:return c=1,{value:virtualclass.storage.getWbData(b),done:!1};case 1:if(void 0===d){c=2;break}c=-1;throw d;case 2:"object"===typeof virtualclass.gObj.tempReplayObjs[b]&&0<virtualclass.gObj.tempReplayObjs[b].length&&(console.log("Start whiteboard replay from local storage"),
virtualclass.wb[b].utility.replayFromLocalStroage(virtualclass.gObj.tempReplayObjs[b])),c=-1;default:return{value:void 0,done:!0}}}var c=0,d={next:function(c){return a(c,void 0)},throw:function(c){return a(void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())},_zoom:function(b,a,c,d){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,b,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,b,a);
var f=b.parentNode,k=virtualclass.vutil.getValueWithoutPixel(f.style.width),m=this;this.displayPage(this.shownPdf,1,function(){if("undefined"===typeof d){console.log("Zooming whiteboard");for(var c in virtualclass.pdfRender)m.zoomwhiteboardObjects(c)}else null!=virtualclass.gObj.currWb&&virtualclass.wb[virtualclass.gObj.currWb].vcan.renderAll();a>k&&f.classList.add("scrollX")})},fitWhiteboardAtScale:function(b){if("object"===typeof virtualclass.wb[b]){b=virtualclass.wb[b].vcan;var a=b.main.children;
if(0<a.length)for(var c in a){var d=a[c].scaleX/virtualclass.zoom.prvCanvasScale*virtualclass.zoom.canvasScale,g=a[c].scaleY/virtualclass.zoom.prvCanvasScale*virtualclass.zoom.canvasScale,k=a[c].x/a[c].scaleX*d,m=a[c].y/a[c].scaleY*g;a[c].scaleX=d;a[c].scaleY=g;a[c].x=k;a[c].y=m;a[c].setCoords()}b.renderAll()}},zoomwhiteboardObjects:function(b){this.fitWhiteboardAtScale(b)},zoomOutWhiteboardObjects:function(b){this.fitWhiteboardAtScale(b)},fitToScreenWhiteboardObjects:function(b){this.fitWhiteboardAtScale(b)},
_zoomOut:function(b,a,c,d){virtualclass.vutil.setHeight(virtualclass.gObj.currWb,b,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,b,a);var f=this;this.displayPage(this.shownPdf,1,function(){for(wid in virtualclass.pdfRender)f.zoomOutWhiteboardObjects(wid)})},_fitToScreen:function(b,a,c){console.log("==== Current whiteboard id "+virtualclass.gObj.currWb);virtualclass.vutil.setHeight(virtualclass.gObj.currWb,b,c);virtualclass.vutil.setWidth(virtualclass.gObj.currWb,b,a);var d=b.parentNode,
g=d.offsetWidth,k=this;" "!==this.shownPdf?this.displayPage(this.shownPdf,1,function(){for(wid in virtualclass.pdfRender)k.fitToScreenWhiteboardObjects(wid);a>g&&55<a-g?d.classList.add("scrollX"):d.classList.remove("scrollX")}):console.log("ERROR : shown pdf is not available")},isBiggerCanvasHeight:function(b){},isBiggerCanvasWidth:function(b){},calculateScaleAtFirst:function(b,a){b=b.getViewport(a.width/b.getViewport(1).width);this.firstTime=!1;return b},isWhiteboardAlreadyExist:function(b){return null!=
this.canvas},defaultScroll:function(){null!=virtualclass.gObj.currWb&&(this.canvasWrapper.scrollTop=1)}}}})(window);(function(d){var b={order:[0],wbInd:0,initNavHandler:function(){var a=this,c=document.querySelector("#virtualclassWhiteboard.whiteboard .next");null!=c&&(c.onclick=function(){virtualclass.vutil.navWhiteboard(a,a.next);b.hasOwnProperty("setNextWhiteboardTime")&&clearTimeout(b.setNextWhiteboardTime);"Whiteboard"==virtualclass.currApp&&(b.setNextWhiteboardTime=setTimeout(function(){virtualclass.zoom.normalRender()},500))});c=document.querySelector("#virtualclassWhiteboard.whiteboard .prev");null!=c&&
(c.onclick=function(){virtualclass.vutil.navWhiteboard(a,a.prev);"object"==typeof virtualclass.wb[virtualclass.gObj.currWb]&&setTimeout(function(){console.log("whiteboard zoom normal render");virtualclass.zoom.normalRender()},500)})},initNav:function(a){"undefined"==typeof this.indexNav&&(this.indexNav=new pageIndexNav("WB"));this.indexNav.init();if(roles.hasControls()){for(var c=0;c<a.length;c++)virtualclass.wbCommon.indexNav.createWbNavigationNumber(a[c],a[c]);virtualclass.wbCommon.indexNav.addActiveNavigation(virtualclass.gObj.currWb);
c=localStorage.getItem("wbOrder");null!=c&&(c=JSON.parse(c),virtualclass.wbCommon.order=c);1<this.order.length&&(virtualclass.wbCommon.rearrangeNav(this.order),this.rearrange(this.order))}else virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex-1||virtualclass.gObj.currSlide);document.querySelector("#dcPaging").onchange=function(){virtualclass.wbCommon.setCurrSlideNumber(this.value);virtualclass.wbCommon.indexNav.addActiveNavigation(this.value);virtualclass.wbCommon.readyCurrentWhiteboard(this.value);
virtualclass.gObj.currWb=this.value};virtualclass.wbCommon.indexNav.setTotalPages(a.length)},displaySlide:function(a){this.hideElement();var c=document.querySelector("#note"+a);null!=c&&(c.classList.add("current"),virtualclass.gObj.currWb=a);this.identifyFirstNote(a);this.identifyLastNote(a);roles.hasControls()||"undefined"!==typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex-1||virtualclass.gObj.currSlide)},hideElement:function(){var a=
document.querySelector("#virtualclassWhiteboard.whiteboard .current");null!=a&&(console.log("Whiteboard slide remove"),a.classList.remove("current"))},currentWhiteboard:function(a){null==document.querySelector("#canvas"+a)&&(this.hideElement(),virtualclass.vutil.createWhiteBoard(a),this.displaySlide(a),virtualclass.gObj.currWb=a)},next:function(){this.hideElement();var a=this.whiteboardWrapperExist("next");virtualclass.wbCommon.indexNav.createWbNavigationNumber(virtualclass.gObj.wbCount);virtualclass.vutil.beforeSend({cf:"cwb",
wbCount:virtualclass.gObj.wbCount,currIndex:c});c=a.slice(7);var c=this.order.indexOf(c);this.whiteboardExist(a)||virtualclass.vutil.createWhiteBoard(a,c);virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:a,currIndex:c});this.setCurrSlideNumber(a);virtualclass.wbCommon.indexNav.addActiveNavigation(a);virtualclass.wbCommon.indexNav.UI.pageNavHandler("right");this.displaySlide(a);virtualclass.gObj.currWb=a},newPage:function(){this.hideElement();var a=virtualclass.gObj.currWb.slice(7);virtualclass.gObj.wbCount++;
var c=this.whiteboardWrapperExist("next");virtualclass.gObj.hasOwnProperty("currSlide")&&-1==virtualclass.gObj.wIds.indexOf(Number(virtualclass.gObj.wbCount))&&(console.log("wids, From virtualclass "),virtualclass.gObj.wIds.push(virtualclass.gObj.wbCount));var b="_doc_0_"+virtualclass.gObj.wbCount;var d=this.order.indexOf(a);this.whiteboardExist(b)||virtualclass.vutil.createWhiteBoard(b,d);this.setCurrSlideNumber(b);virtualclass.wbCommon.indexNav.UI.pageNavHandler("right");this.displaySlide(b);d=
0;null==c?(this.order.push(virtualclass.gObj.wbCount),virtualclass.wbCommon.indexNav.createWbNavigationNumber(virtualclass.gObj.wbCount,virtualclass.gObj.wbCount),d=this.order.length,virtualclass.wbCommon.identifyLastNote(virtualclass.gObj.currWb)):(d=this.order.indexOf(a),this.order.splice(d+1,0,virtualclass.gObj.wbCount),this.rearrange(this.order),this.indexNav.index=d+1,this.rearrangeNav(this.order));this.wbInd=d+1;virtualclass.vutil.beforeSend({cf:"cwb",wbCount:virtualclass.gObj.wbCount,currIndex:d+
1});virtualclass.gObj.currWb=b;this.indexNav.setTotalPages(virtualclass.gObj.wIds.length);virtualclass.wbCommon.indexNav.addActiveNavigation(virtualclass.gObj.currWb);document.querySelector("#dcPaging").onchange=function(){virtualclass.wbCommon.setCurrSlideNumber(this.value);virtualclass.wbCommon.indexNav.addActiveNavigation(this.value);virtualclass.wbCommon.readyCurrentWhiteboard(this.value);virtualclass.gObj.currWb=this.value}},rearrange:function(a){var c=document.getElementsByClassName("whiteboardContainer")[0],
b=document.createElement("div");b.className="whiteboardContainer";for(var d=0;d<a.length;d++){var k=document.getElementById("note_doc_0_"+a[d]);k&&b.appendChild(k)}c.parentNode.replaceChild(b,c)},rearrangeNav:function(a){var c;document.querySelector("#dcPaging").innerHTML="";for(var b=0;b<=virtualclass.gObj.wbCount;b++)virtualclass.wbCommon.indexNav.createWbNavigationNumber(a[b],b);"Whiteboard"==virtualclass.currApp&&(c=virtualclass.gObj.currWb.split("doc_0_")[1]);a=this.order.indexOf(c);(b=document.querySelector(".congrea #dcPaging .noteIndex.active"))&&
b.classList.remove("active");if(b=document.querySelector("#index"+c))b.classList.add("active"),b.selected="selected";c=document.querySelector("#dcPaging .hid.right.active");var d=document.querySelector("#dcPaging .hid.left.active");if(c||d)var k=c?c.title:d.title;"Whiteboard"==virtualclass.currApp?this.index=+a+1:(this.index=null!=k?k:null!=b&&"undefined"!=typeof b?b.title:1,virtualclass.dts.order.length||(this.index=0),k=document.querySelector("#docShareNav"),this.index?(k.classList.add("show"),
k.classList.remove("hide")):(k.classList.add("hide"),k.classList.remove("show")))},setCurrSlideNumber:function(a){a=a.split("_");0<a.length&&(virtualclass.gObj.currSlide=a[a.length-1],roles.hasControls()||"undefined"!==typeof virtualclass.wbCommon.indexNav&&virtualclass.wbCommon.indexNav.studentWBPagination(virtualclass.gObj.currIndex-1||virtualclass.gObj.currSlide))},prev:function(){this.hideElement();var a=this.whiteboardWrapperExist("prev");this.readyCurrentWhiteboard(a);this.setCurrSlideNumber(a);
virtualclass.wbCommon.indexNav.addActiveNavigation(a);virtualclass.wbCommon.indexNav.UI.pageNavHandler("left");a=document.querySelector("#"+virtualclass.wb[a].prvTool);null==a||a.classList.contains("active")||a.classList.add("active")},readyCurrentWhiteboard:function(a){null!=a?(this.whiteboardExist(a)||virtualclass.vutil.createWhiteBoard(a),this.displaySlide(a),virtualclass.gObj.currWb=a,virtualclass.vutil.beforeSend({cf:"cwb",diswb:!0,wid:virtualclass.gObj.currWb}),console.log("whiteboard slide send="+
virtualclass.gObj.currWb)):alert("Elemennt is NULL")},whiteboardExist:function(a){return null!=document.querySelector("#canvas"+a)},whiteboardWrapperExist:function(a){var c=virtualclass.gObj.currWb;if(null!=c){c=document.querySelector("#note"+c);if("prev"==a)var b=c.previousElementSibling;else"next"==a&&(b=c.nextElementSibling);return null!=b?b.dataset.wbId:null}},readyElements:function(a){for(var c=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),b,d=0;d<a.length;d++){var k=
"_doc_0_"+a[d];b=document.querySelector("#note"+k);null==b&&(b=document.createElement("div"),b.id="note"+k,b.dataset.wbId=k,b.className="canvasContainer",c.appendChild(b))}},reArrangeElements:function(a){var c=document.querySelector("#virtualclassWhiteboard .whiteboardContainer"),b=document.createElement("div");b.className="whiteboardContainer";for(var d,k=0;k<a.length;k++)d="note_doc_0_"+a[k],d=document.getElementById(d),null!=b&&null!=d?b.appendChild(d):console.log("Error temp div is null "+b);
c.parentNode.replaceChild(b,c)},identifyFirstNote:function(a){var c=document.querySelector("#virtualclassWhiteboard");"_doc_0_0"==a?c.classList.add("firstNote"):c.classList.remove("firstNote")},identifyLastNote:function(a){var c=document.querySelector("#virtualclassWhiteboard");this.order.indexOf(a.slice(7))+1==this.order.length?c.classList.add("lastNote"):c.classList.remove("lastNote")},removeAllContainers:function(){for(var a=document.querySelectorAll("#virtualclassWhiteboard .whiteboardContainer .canvasContainer"),
c,b=0;b<a.length;b++)c=a[b],c.parentNode.removeChild(c)},clearNavigation:function(){for(var a=document.getElementById("dcPaging");a.firstChild;)a.removeChild(a.firstChild);if(roles.hasControls())virtualclass.wbCommon.indexNav.createWbNavigationNumber(0,0);else{var c=document.createElement("span");c.id="stdPageNo";a.appendChild(c);virtualclass.wbCommon.indexNav.studentWBPagination(0)}},deleteWhiteboard:function(a){delete virtualclass.wb[a];delete virtualclass.pdfRender[a];"Whiteboard"==virtualclass.currApp&&
(a=document.querySelector("#containerWb"+a),null!=a&&a.parentNode.removeChild(a))}};d.wbCommon=b})(window);var serverData={rawData:{video:[],ppt:[],docs:[]},fetchAllData:function(d){console.log("Fetch all data");this.cb=d;console.log("Request get document url");this.requestData(virtualclass.api.GetDocumentURLs)},requestData:function(d){this.rawData={video:[],ppt:[],docs:[]};var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST",d);var a=this;b.onreadystatechange=function(){3<b.readyState&&200==b.status&&a.afterResponse(b.responseText)};b.setRequestHeader("x-api-key",
wbUser.lkey);b.setRequestHeader("x-congrea-authuser",wbUser.auth_user);b.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);b.setRequestHeader("x-congrea-room",wbUser.room);b.setRequestHeader("Content-Type","application/json");b.send(null)},afterResponse:function(d){"ERROR"!=d&&(virtualclass.serverData.formatRawData(d),virtualclass.gObj.fetchedData=!0,"undefined"!=typeof virtualclass.serverData.cb&&virtualclass.serverData.cb())},formatRawData:function(d){d=JSON.parse(d);this.awsUrlArr(d)},awsUrlArr:function(d){this.rawData=
{video:[],ppt:[],docs:[]};for(var b=[],a=d.Items,c,f,g,k,m=0;m<a.length;m++)if(a[m].hasOwnProperty("filetype"))switch(a[m].filetype.S){case "doc":d=this.processObj(a[m]);k=a[m].processed_data.M.commonpath.S;var n=parseInt(a[m].processed_data.M.count.N);if(null!=k&&null!=n){k="https://media.congrea.net/"+a[m].processed_data.M.commonpath.S;d.notes={};d.notesarr=[];var p=[],v=[];d.hasOwnProperty("deletednes")&&(p=d.deletednes);d.hasOwnProperty("disablednes")&&(v=d.disablednes);for(var u=1;u<=n;u++){c=
u;f=3-(""+c).length;g=(0<f?Array(++f).join("0"):"")+c;c=k+"/image/"+g+"."+a[m].processed_data.M.image.M.type.S;f=k+"/pdf/"+g+".pdf";g=k+"/thumbnail/"+g+"."+a[m].processed_data.M.thumbnail.M.type.S;var q=99<u?d.fileuuid+"_"+u:9<u?d.fileuuid+"_0"+u:d.fileuuid+"_00"+u;var r={};0<p.length&&-1<p.indexOf(u)&&(r.deletedn=q);r.id=q;r.pdf=f;r.image=c;r.thumbnail=g;0<v.length?-1<v.indexOf(u)?r.status=0:r.status=1:r.status=1;d.notes[q]=r;d.notesarr.push(r)}b.push(d);this.rawData.docs.push(d)}break;case "video":null!=
a[m].processed_data&&"COMPLETED"==a[m].processed_data.S&&(d=this.processObj(a[m]),n=d.filepath.substr(0,d.filepath.lastIndexOf("/")),d.urls={},d.urls.thumbnail={},d.urls.videos={},d.urls.main_video="https://media.congrea.net/"+n+"/video/play_video.m3u8",d.urls.videos["0400k"]="https://media.congrea.net/"+n+"/video/0400k/video.m3u8",d.urls.videos["0600k"]="https://media.congrea.net/"+n+"/video/0600k/video.m3u8",d.urls.videos["1000k"]="https://media.congrea.net/"+n+"/video/1000k/video.m3u8",d.urls.videos["1500k"]=
"https://media.congrea.net/"+n+"/video/1500k/video.m3u8",d.urls.videos["2000k"]="https://media.congrea.net/"+n+"/video/2000k/video.m3u8",d.urls.thumbnail["0400k"]="https://media.congrea.net/"+n+"/video/0400k/thumbs/00001.png",d.urls.thumbnail["0600k"]="https://media.congrea.net/"+n+"/video/0600k/thumbs/00001.png",d.urls.thumbnail["1000k"]="https://media.congrea.net/"+n+"/video/1000k/thumbs/00001.png",d.urls.thumbnail["1500k"]="https://media.congrea.net/"+n+"/video/1500k/thumbs/00001.png",d.urls.thumbnail["2000k"]=
"https://media.congrea.net/"+n+"/video/2000k/thumbs/00001.png",b.push(d),this.rawData.video.push(d));break;case "video_yts":console.log("Handle youtube");d=this.processVidUrlObj(a[m]);d.urls={};d.urls.main_video=d.URL;b.push(d);this.rawData.video.push(d);break;case "presentation":console.log("presentation data");d=this.processVidUrlObj(a[m]);d.urls={};d.urls.presentation=d.URL;b.push(d);this.rawData.ppt.push(d);break;case "video_online":console.log("Handle one line "),d=this.processVidUrlObj(a[m]),
d.urls={},d.urls.main_video=d.URL,b.push(d),this.rawData.video.push(d)}virtualclass.awsData=b},processObj:function(d){var b={};b.filename=d.filename.S;b.filepath=d.filepath.S;b.filetype=d.filetype.S;b.fileuuid=d.fileuuid.S;b.key_room=d.key_room.S;b.fileuuid=d.fileuuid.S;d.hasOwnProperty("deleted")&&("0"==d.deleted.NS[0]?b.deleted=d.deleted.NS[0]:b.deletednes=d.deleted.NS);d.hasOwnProperty("disabled")&&("0"==d.disabled.NS[0]?b.disabled=d.disabled.NS[0]:b.disablednes=d.disabled.NS);return b},processVidUrlObj:function(d){var b=
{};b.URL=d.URL.S;b.filename=b.URL;b.filetype=d.filetype.S;b.fileuuid=d.fileuuid.S;b.key_room=d.key_room.S;b.fileuuid=d.fileuuid.S;d.hasOwnProperty("deleted")&&(b.deleted=d.deleted.NS[0]);d.hasOwnProperty("disabled")&&(b.disabled=d.disabled.NS[0]);return b},pollingStatus:function(d){var b=virtualclass.api.GetDocumentStatus;virtualclass.gObj.hasOwnProperty("pollingDocumentStatus")&&clearTimeout(virtualclass.gObj.pollingDocumentStatus);var a=this;virtualclass.gObj.pollingDocumentStatus=setTimeout(function(){virtualclass.xhrn.sendData({uuid:virtualclass.gObj.file.uuid},
b,function(c){c=JSON.parse(c).Item;void 0!=c&&"undefined"!=typeof c&&(c.hasOwnProperty("processed_data")&&(c.processed_data.hasOwnProperty("S")&&"COMPLETED"==c.processed_data.S||c.processed_data.hasOwnProperty("M")&&c.processed_data.M.hasOwnProperty("pdf"))?(clearTimeout(virtualclass.gObj.pollingDocumentStatus),virtualclass.serverData.fetchAllData(d)):a.pollingStatus(d))})},5E3)}};var api={access:"https://api.congrea.net/data/access",upload:"https://api.congrea.net/t/upload",uploadSuccess:"https://api.congrea.net/t/uploadSuccess",uploadMedia:"https://uploadmedia.congrea.net",UpdateDocumentStatus:"https://api.congrea.net/t/UpdateDocumentStatus",GetDocumentURLs:"https://api.congrea.net/t/GetDocumentURLs",UpdateRoomMetaData:"https://api.congrea.net/t/UpdateRoomMetaData",GetRoomMetaData:"https://api.congrea.net/t/GetRoomMetaData",addURL:"https://api.congrea.net/t/addURL",GetDocumentStatus:"https://api.congrea.net/t/GetDocumentStatus",
recordingFiles:"https://api.congrea.net/data/recording-files"};(function(d,b){d.raiseHand=function(a){return{stdRhEnable:"enabled",rhCount:0,rhCountR:0,init:function(a){this.stdRhEnable="enabled";roles.hasControls()||(this.attachHandlerAtStudent(),this.stdRhEnable&&"disabled"==this.stdRhEnable&&(b.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action","disable"),a=b.querySelector("#virtualclassCont.congrea #congHr"),a.classList.remove("enable"),a.classList.add("disable"),a.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdDisabled"))))},
disableRaiseHand:function(a){chatContainerEvent.elementFromShadowDom("#ml"+a+" .controllerRaiseH");var c=chatContainerEvent.elementFromShadowDom("#ml"+a+" .controllerRaiseH");var d=c.querySelector("a.congtooltip"),k=d.querySelector(".RaiseHandImg");ioAdapter.mustSendUser({data:{action:"disable"},cf:"raiseHand"},a);c.classList.remove("enabled");c.classList.add("disabled");k.setAttribute("data-raisehand-disable",!0);d.setAttribute("data-title","disabled");c.style.pointerEvents="none";virtualclass.user.control.updateUser(a,
"raiseHand",!1);virtualclass.raiseHand.moveDownInList(a);this.rhCount--;this.rhCount||b.querySelector("#user_list .hand_bt").classList.remove("highlight");a=b.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(c=b.querySelector("#user_list .hand_bt"),a.innerHTML="",c.classList.remove("congtooltip"),c.removeAttribute("data-title"),b.querySelector("#user_list .hand_bt").classList.remove("highlight"))},onMsgRec:function(a){a=a.message;roles.hasControls()?this.msgRecAtTeacher(a.data):
this.msgRecAtStudent(a.data)},msgRecAtTeacher:function(a){console.log("raiseStd"+a.action);var c=a.user,d=chatContainerEvent.elementFromShadowDom("#ml"+c+" .controllerRaiseH"),k=d.querySelector("a.congtooltip"),m=k.querySelector(".RaiseHandImg");"enable"==a.action?(this.enableRaiseHand(c),this.moveUpInList()):"disable"==a.action&&(virtualclass.user.control.updateUser(c,"raiseHand",!1),d.classList.remove("enabled"),d.classList.add("disabled"),m.setAttribute("data-raisehand-disable",!0),k.setAttribute("data-title",
"disabled"),d.style.pointerEvents="none",this.moveDownInList(c),this.rhCount--,this.rhCount||b.querySelector("#user_list .hand_bt").classList.remove("highlight"));a=b.querySelector("#user_list .hand_bt  #notifyText");0<this.rhCount?a.innerHTML=this.rhCount:(c=b.querySelector("#user_list .hand_bt"),a.innerHTML="",c.classList.remove("congtooltip"),c.removeAttribute("data-title"))},msgRecAtStudent:function(a){"disable"==a.action&&(this.stdRhEnable="enabled",a=b.getElementById("congHr"),a.classList.remove("disable"),
a.classList.add("enable"),b.querySelector("#virtualclassCont.congrea #icHr").setAttribute("data-action","enable"),b.querySelector("#virtualclassCont.congrea #congHr").setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")))},moveUpInList:function(){for(var a=chatContainerEvent.elementFromShadowDom(".controllerRaiseH","all"),b=0;b<a.length;b++)a[b].classList.contains("enabled")&&0!=b&&a[b].closest(".ui-memblist-usr").parentNode.insertBefore(a[b].closest(".ui-memblist-usr"),a[0].closest(".ui-memblist-usr"))},
moveDownInList:function(a){var c=chatContainerEvent.elementFromShadowDom(".controllerRaiseH.enabled","all");a=virtualclass.gObj.testChatDiv.shadowRoot.getElementById(a+"contRaiseH");0<c.length&&a.closest(".ui-memblist-usr").parentNode.insertBefore(a.closest(".ui-memblist-usr"),c[c.length-1].closest(".ui-memblist-usr").nextSibling)},enableRaiseHand:function(a){this.rhCount++;this._enableRaiseHand(this.rhCount,a)},_enableRaiseHand:function(a,d){var c=chatContainerEvent.elementFromShadowDom("#ml"+d+
" .controllerRaiseH"),f=c.querySelector("a.congtooltip"),m=f.querySelector(".RaiseHandImg");virtualclass.user.control.updateUser(d,"raiseHand",!0);c.classList.remove("disabled");c.classList.add("enabled");m.setAttribute("data-raisehand-disable",!1);f.setAttribute("data-title",virtualclass.lang.getString("RaiseHandEnable"));c.style.pointerEvents="visible";d=b.querySelector("#user_list .hand_bt");d.classList.contains("highlight")||d.classList.add("highlight");b.querySelector("#user_list .hand_bt  #notifyText").innerHTML=
a;a=b.querySelector("#user_list .hand_bt");a.classList.contains("congtooltip")||a.classList.add("congtooltip");a.setAttribute("data-title",virtualclass.lang.getString("raiseHandNotify"))},_raiseHand:function(a){this.rhCountR++;this.rhCount=this.rhCountR;this._enableRaiseHand(this.rhCountR,a)},updateInStorage:function(){localStorage.setItem("stdRhEnable",this.stdRhEnable)},attachHandlerAtStudent:function(){var a=b.querySelector("#virtualclassCont.congrea #congHr");a.addEventListener("click",function(){var c=
b.querySelector("#virtualclassCont.congrea #icHr");var d=virtualclass.vutil.whoIsTeacher();ioAdapter.sendUser({data:{user:wbUser.id,action:c.getAttribute("data-action")},cf:"raiseHand"},d);"enable"==c.getAttribute("data-action")?(c.setAttribute("data-action","disable"),a.classList.remove("enable"),a.classList.add("disable"),c=b.querySelector("#virtualclassCont.congrea #congHr"),c.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdDisabled")),virtualclass.raiseHand.stdRhEnable="disabled"):
(c.setAttribute("data-action","enable"),a.classList.add("enable"),a.classList.remove("disable"),c=b.querySelector("#virtualclassCont.congrea #congHr"),c.setAttribute("data-title",virtualclass.lang.getString("RaiseHandStdEnabled")),virtualclass.raiseHand.stdRhEnable="enabled")})}}}()})(window,document);(function(d){d.colorSelector={makeThemeReady:function(){var b=virtualclassSetting.theme.selectedColor,a=virtualclass.vutil.calcBrightness(b);var c=125<a?"black":"white";var d={},g={},k={};k.fcolor=chroma(b).brighten().hex();k.scolor=chroma(b).brighten(1.8).hex();50>a?10>=a?(g.fcolor=chroma(b).brighten(2).hex(),g.scolor=chroma(b).brighten(3).hex()):(g.fcolor=chroma(b).darken().hex(),g.scolor=chroma(b).darken(2).hex()):180<a?(g.fcolor=chroma(b).darken(1.5).hex(),g.scolor=chroma(b).darken(1.1).hex(),
k.fcolor=chroma(b).darken(.5).hex(),k.scolor=chroma(b).darken(.8).hex()):(g.fcolor=chroma(b).darken(.8).hex(),g.scolor=chroma(b).darken(.6).hex(),k.fcolor=chroma(b).brighten().hex(),k.scolor=chroma(b).brighten(1.8).hex());d.fcolor=b;d.scolor=chroma(b).brighten().hex();g.frontColor=c;k.frontColor=c;this.makeThemeReadyMainCont(c,d,g,k);this.makeThemeReadyEditor(c,d,g,k);this.makeThemeReadyRightPanel(c,d,g,k);this.makeThemeReadyVideo(c,d,g,k,a);this.makeThemeReadyPoll(c,d,g,k,a);this.makeThemeReadyPresentation(c,
d,g,k,a);this.makeThemeReadyDocument(c,d,g,k);this.lightColorCustomize(c,d,g,k,a)},lightColorCustomize:function(b,a,c,d,g){218<=g&&(a.fcolor=chroma(a.fcolor).darken(.4).hex(),a.scolor=chroma(a.fcolor).darken().hex());b="0.05em solid "+a.fcolor;this.addCss("#virtualclassCont.congrea #virtualclassOptionsCont .appOptions, #virtualclassCont.congrea #audioWidget{border-top:"+b+" !important;}#virtualclassCont.congrea .containerWb .commandToolsWrapper .shapesToolbox .shapesTool .tool a{border-bottom:"+b+
" !important;}#virtualclassCont.congrea .containerWb .commandToolsWrapper .shapesToolbox .shapes_icon a{border-left: 0.01em solid "+a.fcolor+"!important;}#virtualclassCont.congrea #audioWidget li{border-right:"+b+" !important;}#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab, #virtualclassCont.congrea #audioWidget .audioTool, #virtualclassCont.congrea #networkStatusContainer, #virtualclassCont.congrea #alleditorRichContainerAnch{border-left:"+b+" !important;}#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a ,#virtualclassCont.congrea #audioWidget li,#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab li {border-right: 0.01em solid "+
a.fcolor+"!important;}#virtualclassCont.congrea .ui-widget-header.ui-corner-top.ui-chatbox-titlebar.ui-dialog-header{border: 0.02em solid "+a.fcolor+"!important;}#virtualclassCont.congrea .btn.btn-default ,#virtualclassCont.congrea .vceditor-toolbar ,#virtualclassCont.congrea #virtualclassAppRightPanel #chatWidget .chatBarTab,#virtualclassCont.congrea #stickybar .footerCtr .vmchat_search #congreaUserSearch ,#virtualclassCont.congrea #layoutQuiz .navbar ,#virtualclassCont.congrea button ,#virtualclassCont.congrea #alleditorRichContainer #alleditorRichContainerAnch,#virtualclassCont.congrea .zoomControler ,#virtualclassCont.congrea .btn-default {background-image: linear-gradient(to bottom, "+
a.fcolor+" 0%,"+a.scolor+" 100%) !important;}#virtualclassCont.congrea .shapesToolbox{border-right: 0.01em solid "+a.fcolor+"!important;}")},calcBrightness:function(b){b=chroma(b).rgb();b=Math.round((299*parseInt(b[0])+587*parseInt(b[1])+114*parseInt(b[2]))/1E3);console.log("brightne"+b);return b},makeThemeReadyMainCont:function(b,a,c,d){this.addCss("#virtualclassCont.congrea .ui-widget-header{background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important} #virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn{background-image: linear-gradient(to bottom, "+
a.fcolor+" 0%,"+a.scolor+" 100%) !important} #virtualclassCont.congrea #virtualclassAppLeftPanel #dashboardnav .btn.clicked{background-image: linear-gradient(to bottom, "+c.fcolor+" 0%,"+c.scolor+" 100%) !important} #virtualclassCont.congrea #navigator, #virtualclassCont.congrea #layoutQuiz .navbar, #virtualclassCont.congrea .commandToolsWrapper, #virtualclassCont.congrea .commandToolsWrapper .shapesToolbox .shapesTool,#virtualclassCont.congrea .commandToolsWrapper ul.strkSizeList li:hover,#virtualclassCont.congrea #virtualclassAppContainer .virtualclass .commandToolsWrapper .tool ul.strkSizeList li.selected,#virtualclassCont.congrea #virtualclassAppContainer .virtualclass .commandToolsWrapper .tool ul.fontSizeList span.selected,#virtualclassCont.congrea #playButton, #virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText{background-image: linear-gradient(to bottom, "+
a.fcolor+" 0%,"+a.scolor+" 100%) !important} #virtualclassCont.congrea #virtualclassOptionsCont:first-child {background-image: linear-gradient(to right, "+a.fcolor+" 0%,"+a.scolor+" 100%)} #virtualclassCont.congrea .commandToolsWrapper{background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%)} #virtualclassCont.congrea #virtualclassOptionsCont .appOptions.active, #virtualclassCont.congrea .commandToolsWrapper .tool.active a {background-image: radial-gradient(ellipse at center, "+
c.fcolor+" 0%,"+c.scolor+" 100%);} #virtualclassCont.congrea .tool.active a span:before {color:"+b+"!important}#virtualclassCont.congrea #virtualclassOptionsCont .appOptions:hover, #virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a:hover, #virtualclassCont.congrea .containerWb .commandToolsWrapper .tool ul.fontSizeList span:hover,#virtualclassCont.congrea #confirmCancel #confirmCancelButton:hover, #virtualclassCont.congrea #alleditorRichContainer:hover, #virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton:hover{background-image: radial-gradient(ellipse at center, "+
d.fcolor+" 0%,"+d.scolor+" 100%) !important}#virtualclassCont.congrea #confirm.popupWindow #confirmOk #confirmOkButton,#virtualclassCont.congrea #confirm.popupWindow #confirmCancel #confirmCancelButton{color:"+b+"!important}#virtualclassCont.congrea .appOptions:hover .cgIcon:before{color:"+d.frontColor+"!important}#virtualclassCont.congrea .active .cgIcon:before{color:"+c.frontColor+"!important}#virtualclassCont.congrea .commandToolsWrapper .tool:hover .cgIcon:before{color:"+d.frontColor+"!important}#virtualclassCont.congrea .cgIcon:before{color:"+
b+"!important}#virtualclassCont.congrea #docShareNav #totalPages{color:"+b+"!important}#virtualclassCont.congrea #docShareNav .pageNav{color:"+b+"!important}#virtualclassCont.congrea #docShareNav #dcPaging #stdPageNo{color:"+b+"!important}#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool a{color:"+b+"!important}#virtualclassCont.congrea .shapesToolbox a{color:"+b+"!important}#virtualclassCont.congrea .shapes_icon .icon-shapes.cgIcon:after{color:"+b+"!important}#virtualclassCont.congrea .cgText{color:"+
b+"!important}#virtualclassCont.congrea .vchead{color:"+b+"!important}#virtualclassCont.congrea .icon-publish2:before{color:"+c.fcolor+"!important}#virtualclassCont.congrea button ,#virtualclassCont.congrea .btn-default {background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important } #virtualclassCont.congrea #congdashboard .modal-header .close{opacity :1;}#virtualclassCont.congrea .modal-header .btn-default ,#virtualclassCont.congrea .modal .btn-default ,#virtualclassCont.congrea .precheck .btn-default {color :"+
b+"!important} #virtualclassCont.congrea .vjs-control-bar .vjs-autoPlay-button {background:none !important ;}#virtualclassCont.congrea .vjs-control-bar .vjs-button {background:none !important ; border:none !important ;color:white!important}#virtualclassCont.congrea  #onlineusertext:before{color :"+b+"!important} #virtualclassCont.congrea  #recordPlay #playButton:before{color :"+b+"!important} #virtualclassCont.congrea #recordingHeaderContainer  {background-image: linear-gradient(to bottom, "+a.fcolor+
" 0%,"+a.scolor+" 100%) !important ;color:"+b+"!important} #virtualclassCont.congrea  #virtualclassApp .playControllerMainCont {background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important ;color:"+b+"!important} #virtualclassCont.congrea  .dbContainer .qq-cancel-button-selector{color :"+b+"!important}  #virtualclassCont.congrea #virtualclassOptionsCont .appOptions {border : 1px solid"+a.fcolor+"!important} {background-image: linear-gradient(to bottom, "+c.fcolor+" 0%,"+
c.scolor+" 100%) !important ;color:"+b+"!important} {border-left: 1px solid "+a.fcolor+"!important}#virtualclassCont.congrea #screenController .share button,#virtualclassCont.congrea #stopScreenShare button{border-right:1px solid "+c.fcolor+"!important}#virtualclassCont.congrea #screenController .share button:hover,#virtualclassCont.congrea #stopScreenShare button:hover {background-image: linear-gradient(to bottom, "+d.fcolor+" 0%,"+d.scolor+" 100%) !important;color:"+b+"!important}#virtualclassCont.congrea  #playController button{background-image:none !important;color:"+
b+"!important; border-right: 1px solid "+a.fcolor+"!important}#virtualclassCont.congrea #virtualclassAppLeftPanel .containerWb .commandToolsWrapper .shapesToolbox.active{background-image: radial-gradient(ellipse at center, "+c.fcolor+" 0%,"+c.scolor+" 100%);} ")},makeThemeReadyEditor:function(b,a,c,d){this.addCss("#virtualclassCont.congrea a.vceditor-btn#virtualclassCont.congrea .containerWb .commandToolsWrapper .tool ul.fontSizeList span.selected,{background-color: "+c.fcolor+"} #virtualclassCont.congrea a.vceditor-btn{color: "+
c.frontColor+"} #virtualclassCont.congrea #alleditorRichContainer{background-color: "+c.frontColor+"} #virtualclassCont.congrea .vceditor-toolbar{background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important} #virtualclassCont.congrea a.vceditor-btn:hover{color:"+d.frontColor+"!important}#virtualclassCont.congrea a.vceditor-btn:hover{background-image: radial-gradient(ellipse at center, "+d.fcolor+" 0%,"+d.scolor+" 100%) !important}#virtualclassCont.congrea .commandToolsWrapper .tool.active a{background-image: radial-gradient(ellipse at center, "+
c.fcolor+" 0%,"+c.scolor+" 100% !important)} #virtualclassCont .vceditor-dropdown-menu a:hover{background-color:"+a.fcolor+"!important}")},makeThemeReadyRightPanel:function(b,a,c,d){this.addCss("#virtualclassCont.congrea #recordPlay .rv-vanilla-modal-body #downloadPcCont #downloadSessionText,#virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget{background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important}#virtualclassCont.congrea #chatWidget .chatBarTab{background: linear-gradient(to bottom, "+
a.fcolor+" 0%,"+a.scolor+" 100%) !important}#virtualclassCont.congrea #stickycontainer .inner_bt:hover, #virtualclassCont.congrea #stickycontainer .stdRaiseHand:hover, #virtualclassCont.congrea #stickycontainer #contrAudioAll:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li:hover, #virtualclassCont.congrea #virtualclassAppRightPanel #mainAudioPanel li a:hover,#virtualclassCont.congrea #audioWidget #speakerPressOnce:hover,#virtualclassCont.congrea #audioTest-box:hover,#virtualclassCont.congrea #playButton:hover, #virtualclassCont.congrea #alwaysPress:hover{background-image: radial-gradient(ellipse at center, "+
d.fcolor+" 0%,"+d.scolor+" 100%) !important}#virtualclassCont.congrea .vmchat_support.active ,#virtualclassCont.congrea .vmchat_room_bt.active,#virtualclassCont.congrea .vmchat_bar_button.active, #virtualclassCont.congrea #virtualclassAppRightPanel #audioWidget .settingActive,#virtualclassCont.congrea #virtualclassAppRightPanel #stickycontainer .handRaise.disable{background-image: radial-gradient(ellipse at center, "+c.fcolor+" 0%,"+c.scolor+" 100%) !important}#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgIcon:before{color:"+
d.frontColor+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel #appSettingCtrlAnchor span{color:"+b+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel li:hover .cgText{color:"+d.frontColor+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel .handRaise.enable #icHr:before{color:"+b+"!important}#virtualclassCont.congrea #virtualclassAppRightPanel .pre-check-btn{background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important ;color:"+
b+"!important} ")},makeThemeReadyVideo:function(b,a,c,d,g){var f=a.fcolor;180<g&&(f=c.fcolor);this.addCss("#virtualclassCont.congrea .ui-widget-header,#virtualclassCont.congrea #congdashboard .modal-header {background-image: linear-gradient(to bottom, "+a.fcolor+" 0%,"+a.scolor+" 100%) !important}#virtualclassCont.congrea #listvideo .linkvideo .videoTitleCont:before, #virtualclassCont.congrea #listvideo .linkvideo .controls .editanch:before, #virtualclassCont.congrea #listvideo .linkvideo .controls:before{color:"+
f+"!important}#virtualclassCont.congrea #listvideo .linkvideo .controls:hover:before{color:"+d.fcolor+"!important}#virtualclassCont.congrea #VideoDashboard button{color:"+b+"!important}#virtualclassCont.congrea #VideoDashboard button{border:1px solid"+b+"!important}{background-color: "+c.frontColor+"!important} #virtualclassCont.congrea #listvideo .linkvideo.playing{border:solid "+a.fcolor+" 1px!important}")},makeThemeReadyPoll:function(b,a,c,d,g){a=a.fcolor;180<g&&(a=c.fcolor);this.addCss("#virtualclassCont.congrea #virtualclassPoll .btn.btn-default, #virtualclassCont.congrea #virtualclassPoll #stdPollContainer #btnVote{color:"+
b+";}#virtualclassCont.congrea .bootstrap .pollNavBar > li > a {color:"+b+" ; }#virtualclassCont.congrea .bootstrap .navListTab:hover{color:"+d.frontColor+"!important;}#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, #virtualclassCont.congrea #virtualclassPoll .controlIcon:before{color:"+a+"!important}#virtualclassCont.congrea #virtualclassPoll .controlIcon:hover:before{color:"+d.fcolor+"!important}#virtualclassCont.congrea #virtualclassPoll #navigator #stdPollHeader{color:"+b+"!important;}#virtualclassCont.congrea #virtualclassPoll .modal button.close ,#virtualclassCont.congrea  .alert .close {background-image: none !important ;background-color:none !important}")},
makeThemeReadyPresentation:function(b,a,c,d,g){a=a.fcolor;180<g&&(a=c.fcolor,d.fcolor=chroma(c.fcolor).darken());this.addCss("#virtualclassCont.congrea #SharePresentationDashboard .btn-default{color:"+b+"!important;}#virtualclassCont.congrea #virtualclassPoll #chartMenuCont a, #virtualclassCont.congrea #SharePresentationDashboard .controls:before{color:"+a+"!important}#virtualclassCont.congrea #SharePresentationDashboard .controls:hover:before{color:"+d.fcolor+"!important}")},makeThemeReadyDocument:function(b,
a,c,d){this.addCss("#virtualclassCont.congrea #DocumentShareDashboard #newDocBtn {color:"+b+"!important; border: 1px solid "+a.fcolor+"!important}")},addCss:function(b){var a=document.getElementsByTagName("head")[0],c=document.createElement("style");c.setAttribute("type","text/css");c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.appendChild(c)}}})(window);/*


 chroma.js - JavaScript library for color conversions

 Copyright (c) 2011-2017, Gregor Aisch
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation
    and/or other materials provided with the distribution.

 3. The name Gregor Aisch may not be used to endorse or promote products
    derived from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


*/
(function(){var d,b,a=[].slice;var c=function(){var a;var c={};var b="Boolean Number String Function Array Date RegExp Undefined Null".split(" ");var d=0;for(a=b.length;d<a;d++){var f=b[d];c["[object "+f+"]"]=f.toLowerCase()}return function(a){a=Object.prototype.toString.call(a);return c[a]||"object"}}();var f=function(a,c,b){null==c&&(c=0);null==b&&(b=1);a<c&&(a=c);a>b&&(a=b);return a};var g=function(a){return 3<=a.length?[].slice.call(a):a[0]};var k=function(a){var c,b;a._clipped=!1;a._unclipped=
a.slice(0);for(c=b=0;3>b;c=++b)if(3>c){if(0>a[c]||255<a[c])a._clipped=!0;0>a[c]&&(a[c]=0);255<a[c]&&(a[c]=255)}else 3===c&&(0>a[c]&&(a[c]=0),1<a[c]&&(a[c]=1));a._clipped||delete a._unclipped;return a};var m=Math.PI;var n=Math.round;var p=Math.cos;var v=Math.floor;var u=Math.pow;var q=Math.log;var r=Math.sin;var t=Math.sqrt;var B=Math.atan2;var A=Math.max;var F=Math.abs;var E=2*m;var D=m/3;var H=m/180;var G=180/m;var z=function(){return arguments[0]instanceof C?arguments[0]:function(a,c,b){b.prototype=
a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,arguments,function(){})};z["default"]=z;var J=[];"undefined"!==typeof module&&null!==module&&null!=module.exports&&(module.exports=z);if("function"===typeof define&&define.amd)define([],function(){return z});else{var L="undefined"!==typeof exports&&null!==exports?exports:this;L.chroma=z}z.version="1.3.5";var K={};var O=[];var R=!1;var C=function(){function a(){var a,c;var b=[];var d=0;for(c=arguments.length;d<c;d++){var f=arguments[d];
null!=f&&b.push(f)}1<b.length&&(a=b[b.length-1]);if(null!=K[a])this._rgb=k(K[a](g(b.slice(0,-1))));else{R||(O=O.sort(function(a,c){return c.p-a.p}),R=!0);c=0;for(f=O.length;c<f&&!(a=O[c],a=a.test.apply(a,b));c++);a&&(this._rgb=k(K[a].apply(K,b)))}null==this._rgb&&console.warn("unknown format: "+b);null==this._rgb&&(this._rgb=[0,0,0]);3===this._rgb.length&&this._rgb.push(1)}a.prototype.toString=function(){return this.hex()};a.prototype.clone=function(){return z(me._rgb)};return a}();z._input=K;z.brewer=
d={OrRd:"#fff7ec #fee8c8 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #b30000 #7f0000".split(" "),PuBu:"#fff7fb #ece7f2 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #045a8d #023858".split(" "),BuPu:"#f7fcfd #e0ecf4 #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #810f7c #4d004b".split(" "),Oranges:"#fff5eb #fee6ce #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #a63603 #7f2704".split(" "),BuGn:"#f7fcfd #e5f5f9 #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #006d2c #00441b".split(" "),YlOrBr:"#ffffe5 #fff7bc #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #993404 #662506".split(" "),
YlGn:"#ffffe5 #f7fcb9 #d9f0a3 #addd8e #78c679 #41ab5d #238443 #006837 #004529".split(" "),Reds:"#fff5f0 #fee0d2 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #a50f15 #67000d".split(" "),RdPu:"#fff7f3 #fde0dd #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177 #49006a".split(" "),Greens:"#f7fcf5 #e5f5e0 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #006d2c #00441b".split(" "),YlGnBu:"#ffffd9 #edf8b1 #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #253494 #081d58".split(" "),Purples:"#fcfbfd #efedf5 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #54278f #3f007d".split(" "),
GnBu:"#f7fcf0 #e0f3db #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #0868ac #084081".split(" "),Greys:"#ffffff #f0f0f0 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525 #000000".split(" "),YlOrRd:"#ffffcc #ffeda0 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #bd0026 #800026".split(" "),PuRd:"#f7f4f9 #e7e1ef #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #980043 #67001f".split(" "),Blues:"#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #08519c #08306b".split(" "),PuBuGn:"#fff7fb #ece2f0 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016c59 #014636".split(" "),
Viridis:"#440154 #482777 #3f4a8a #31678e #26838f #1f9d8a #6cce5a #b6de2b #fee825".split(" "),Spectral:"#9e0142 #d53e4f #f46d43 #fdae61 #fee08b #ffffbf #e6f598 #abdda4 #66c2a5 #3288bd #5e4fa2".split(" "),RdYlGn:"#a50026 #d73027 #f46d43 #fdae61 #fee08b #ffffbf #d9ef8b #a6d96a #66bd63 #1a9850 #006837".split(" "),RdBu:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" "),PiYG:"#8e0152 #c51b7d #de77ae #f1b6da #fde0ef #f7f7f7 #e6f5d0 #b8e186 #7fbc41 #4d9221 #276419".split(" "),
PRGn:"#40004b #762a83 #9970ab #c2a5cf #e7d4e8 #f7f7f7 #d9f0d3 #a6dba0 #5aae61 #1b7837 #00441b".split(" "),RdYlBu:"#a50026 #d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" "),BrBG:"#543005 #8c510a #bf812d #dfc27d #f6e8c3 #f5f5f5 #c7eae5 #80cdc1 #35978f #01665e #003c30".split(" "),RdGy:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #ffffff #e0e0e0 #bababa #878787 #4d4d4d #1a1a1a".split(" "),PuOr:"#7f3b08 #b35806 #e08214 #fdb863 #fee0b6 #f7f7f7 #d8daeb #b2abd2 #8073ac #542788 #2d004b".split(" "),
Set2:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f #e5c494 #b3b3b3".split(" "),Accent:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f #bf5b17 #666666".split(" "),Set1:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628 #f781bf #999999".split(" "),Set3:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd #ccebc5 #ffed6f".split(" "),Dark2:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02 #a6761d #666666".split(" "),Paired:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a #ffff99 #b15928".split(" "),
Pastel2:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae #f1e2cc #cccccc".split(" "),Pastel1:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd #fddaec #f2f2f2".split(" ")};(function(){var a;var c=[];for(a in d)c.push(d[a.toLowerCase()]=d[a]);return c})();var I={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",
cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",
darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",
lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",
magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",
slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};z.colors=I;var Q=function(){var a=g(arguments);var c=a[0];var b=a[1];var d=a[2];c=(c+16)/116;var f=isNaN(b)?c:c+b/500;d=isNaN(d)?c:c-d/200;c=P.Yn*X(c);f=P.Xn*X(f);d=P.Zn*X(d);var k=W(3.2404542*f-1.5371385*c-.4985314*
d);b=W(-.969266*f+1.8760108*c+.041556*d);d=W(.0556434*f-.2040259*c+1.0572252*d);return[k,b,d,3<a.length?a[3]:1]};var W=function(a){return 255*(.00304>=a?12.92*a:1.055*u(a,1/2.4)-.055)};var X=function(a){return a>P.t1?a*a*a:P.t2*(a-P.t0)};var P={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452};var fa=function(){var a=g(arguments);a=la(a[0],a[1],a[2]);var c=a[0];var b=a[1];return[116*b-16,500*(c-b),200*(b-a[2])]};var Y=function(a){return.04045>=(a/=255)?a/12.92:
u((a+.055)/1.055,2.4)};var Z=function(a){return a>P.t3?u(a,1/3):a/P.t2+P.t0};var la=function(){var a=g(arguments);var c=a[0];var b=a[1];var d=a[2];c=Y(c);b=Y(b);d=Y(d);a=Z((.4124564*c+.3575761*b+.1804375*d)/P.Xn);var f=Z((.2126729*c+.7151522*b+.072175*d)/P.Yn);b=Z((.0193339*c+.119192*b+.9503041*d)/P.Zn);return[a,f,b]};z.lab=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["lab"]),function(){})};K.lab=Q;C.prototype.lab=
function(){return fa(this._rgb)};var aa=function(a){var c;a=function(){var b;var d=[];var f=0;for(b=a.length;f<b;f++)c=a[f],d.push(z(c));return d}();if(2===a.length){var b=function(){var b;var d=[];var f=0;for(b=a.length;f<b;f++)c=a[f],d.push(c.lab());return d}();var d=b[0];var f=b[1];b=function(a){var c,b;var g=[];for(c=b=0;2>=b;c=++b)g.push(d[c]+a*(f[c]-d[c]));return z.lab.apply(z,g)}}else if(3===a.length){b=function(){var b;var d=[];var f=0;for(b=a.length;f<b;f++)c=a[f],d.push(c.lab());return d}();
d=b[0];f=b[1];var g=b[2];b=function(a){var c,b;var k=[];for(c=b=0;2>=b;c=++b)k.push((1-a)*(1-a)*d[c]+2*(1-a)*a*f[c]+a*a*g[c]);return z.lab.apply(z,k)}}else if(4===a.length){b=function(){var b;var d=[];var f=0;for(b=a.length;f<b;f++)c=a[f],d.push(c.lab());return d}();d=b[0];f=b[1];g=b[2];var k=b[3];b=function(a){var c,b;var m=[];for(c=b=0;2>=b;c=++b)m.push((1-a)*(1-a)*(1-a)*d[c]+3*(1-a)*(1-a)*a*f[c]+3*(1-a)*a*a*g[c]+a*a*a*k[c]);return z.lab.apply(z,m)}}else if(5===a.length){var m=aa(a.slice(0,3));
var M=aa(a.slice(2,5));b=function(a){return.5>a?m(2*a):M(2*(a-.5))}}return b};z.bezier=function(a){var c=aa(a);c.scale=function(){return z.scale(c)};return c};z.cubehelix=function(a,b,d,f,g){null==a&&(a=300);null==b&&(b=-1.5);null==d&&(d=1);null==f&&(f=1);null==g&&(g=[0,1]);var m=0;if("array"===c(g))var M=g[1]-g[0];else M=0,g=[g,g];var n=function(c){var n=E*((a+120)/360+b*c);var N=u(g[0]+M*c,f);c=(0!==m?d[0]+c*m:d)*N*(1-N)/2;var q=p(n);n=r(n);return z(k([255*(N+c*(-.14861*q+1.78277*n)),255*(N+c*(-.29227*
q-.90649*n)),255*(N+1.97294*c*q)]))};n.start=function(c){if(null==c)return a;a=c;return n};n.rotations=function(a){if(null==a)return b;b=a;return n};n.gamma=function(a){if(null==a)return f;f=a;return n};n.hue=function(a){if(null==a)return d;d=a;"array"===c(d)?(m=d[1]-d[0],0===m&&(d=d[1])):m=0;return n};n.lightness=function(a){if(null==a)return g;"array"===c(a)?(g=a,M=a[1]-a[0]):(g=[a,a],M=0);return n};n.scale=function(){return z.scale(n)};n.hue(d);return n};z.random=function(){var a;var c="#";for(a=
0;6>a;++a)c+="0123456789abcdef".charAt(v(16*Math.random()));return new C(c)};J=[];var ba=function(a,b,d,f){var g;null==d&&(d=.5);null==f&&(f="rgb");"object"!==c(a)&&(a=z(a));"object"!==c(b)&&(b=z(b));var k=0;for(g=J.length;k<g;k++){var m=J[k];if(f===m[0]){var M=m[1](a,b,d,f);break}}if(null==M)throw"color mode "+f+" is not supported";return M.alpha(a.alpha()+d*(b.alpha()-a.alpha()))};z.interpolate=ba;C.prototype.interpolate=function(a,c,b){return ba(this,a,c,b)};z.mix=ba;C.prototype.mix=C.prototype.interpolate;
K.rgb=function(){var a;var c=g(arguments);var b=[];for(a in c){var d=c[a];b.push(d)}return b};z.rgb=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["rgb"]),function(){})};C.prototype.rgb=function(a){null==a&&(a=!0);return a?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)};C.prototype.rgba=function(a){null==a&&(a=!0);return a?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:
this._rgb.slice(0)};O.push({p:3,test:function(a){var b=g(arguments);if("array"===c(b)&&3===b.length||4===b.length&&"number"===c(b[3])&&0<=b[3]&&1>=b[3])return"rgb"}});K.lrgb=K.rgb;var ma=function(a){var c;var b=1/a.length;var d=[0,0,0,0];var f=0;for(c=a.length;f<c;f++){var g=a[f];g=g._rgb;d[0]+=u(g[0],2)*b;d[1]+=u(g[1],2)*b;d[2]+=u(g[2],2)*b;d[3]+=g[3]*b}d[0]=t(d[0]);d[1]=t(d[1]);d[2]=t(d[2]);return new C(d)};J.push(["lrgb",function(a,c,b,d){a=a._rgb;c=c._rgb;return new C(t(u(a[0],2)*(1-b)+u(c[0],
2)*b),t(u(a[1],2)*(1-b)+u(c[1],2)*b),t(u(a[2],2)*(1-b)+u(c[2],2)*b),d)}]);z.average=function(a,c){var b,d,f;null==c&&(c="rgb");var g=a.length;a=a.map(function(a){return z(a)});var k=a.splice(0,1)[0];if("lrgb"===c)return ma(a);var n=k.get(c);var M=[];var q=b=0;for(d in n)if(n[d]=n[d]||0,M.push(isNaN(n[d])?0:1),"h"===c.charAt(d)&&!isNaN(n[d])){var N=n[d]/180*m;b+=p(N);q+=r(N)}k=k.alpha();var u=0;for(f=a.length;u<f;u++){N=a[u];var t=N.get(c);k+=N.alpha();for(d in n)isNaN(t[d])||(n[d]+=t[d],M[d]+=1,"h"===
c.charAt(d)&&(N=n[d]/180*m,b+=p(N),q+=r(N)))}for(d in n)if(n[d]/=M[d],"h"===c.charAt(d)){for(N=B(q/M[d],b/M[d])/m*180;0>N;)N+=360;for(;360<=N;)N-=360;n[d]=N}return z(n,c).alpha(k/g)};var V=function(a){if(a.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)){if(4===a.length||7===a.length)a=a.substr(1);3===a.length&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var c=parseInt(a,16);return[c>>16,c>>8&255,c&255,1]}if(a.match(/^#?([A-Fa-f0-9]{8})$/)){9===a.length&&(a=a.substr(1));c=parseInt(a,16);var b=c>>
24&255;var d=c>>16&255;a=c>>8&255;c=n((c&255)/255*100)/100;return[b,d,a,c]}if(null!=K.css&&(d=K.css(a)))return d;throw"unknown color: "+a;};var oa=function(a,c){null==c&&(c="rgb");var b=a[0];var d=a[1];var f=a[2];a=a[3];b=Math.round(b);d=Math.round(d);f=Math.round(f);var g="000000"+(b<<16|d<<8|f).toString(16);g=g.substr(g.length-6);var k="0"+n(255*a).toString(16);k=k.substr(k.length-2);return"#"+function(){switch(c.toLowerCase()){case "rgba":return g+k;case "argb":return k+g;default:return g}}()};
K.hex=function(a){return V(a)};z.hex=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["hex"]),function(){})};C.prototype.hex=function(a){null==a&&(a="rgb");return oa(this._rgb,a)};O.push({p:4,test:function(a){if(1===arguments.length&&"string"===c(a))return"hex"}});var ca=function(){var a,c;var b=g(arguments);var d=b[0];var f=b[1];var k=b[2];if(0===f)var m=a=f=255*k;else{m=[0,0,0];a=[0,0,0];f=.5>k?k*(1+f):k+f-k*f;
k=2*k-f;d/=360;m[0]=d+1/3;m[1]=d;m[2]=d-1/3;for(d=c=0;2>=c;d=++c)0>m[d]&&(m[d]+=1),1<m[d]&&--m[d],a[d]=1>6*m[d]?k+6*(f-k)*m[d]:1>2*m[d]?f:2>3*m[d]?k+(f-k)*(2/3-m[d])*6:k;f=[n(255*a[0]),n(255*a[1]),n(255*a[2])];m=f[0];a=f[1];f=f[2]}return 3<b.length?[m,a,f,b[3]]:[m,a,f]};var T=function(a,c,b){void 0!==a&&3<=a.length&&(b=a,a=b[0],c=b[1],b=b[2]);a/=255;c/=255;b/=255;var d=Math.min(a,c,b);A=Math.max(a,c,b);var f=(A+d)/2;if(A===d){var g=0;var k=Number.NaN}else g=.5>f?(A-d)/(A+d):(A-d)/(2-A-d);a===A?k=
(c-b)/(A-d):c===A?k=2+(b-a)/(A-d):b===A&&(k=4+(a-c)/(A-d));k*=60;0>k&&(k+=360);return[k,g,f]};z.hsl=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["hsl"]),function(){})};K.hsl=ca;C.prototype.hsl=function(){return T(this._rgb)};var na=function(){var a=g(arguments);var c=a[0];var b=a[1];a=a[2];var d=Math.min(c,b,a);A=Math.max(c,b,a);d=A-d;var f=A/255;if(0===A){var k=Number.NaN;var m=0}else m=d/A,c===A&&(k=(b-a)/
d),b===A&&(k=2+(a-c)/d),a===A&&(k=4+(c-b)/d),k*=60,0>k&&(k+=360);return[k,m,f]};z.hsv=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["hsv"]),function(){})};K.hsv=function(){var a,c;var b=g(arguments);var d=b[0];var f=b[1];var k=b[2];k*=255;if(0===f)var m=c=a=k;else{360===d&&(d=0);360<d&&(d-=360);0>d&&(d+=360);d/=60;var n=v(d);var p=d-n;d=k*(1-f);var q=k*(1-f*p);f=k*(1-f*(1-p));switch(n){case 0:a=[k,f,d];m=a[0];
c=a[1];a=a[2];break;case 1:a=[q,k,d];m=a[0];c=a[1];a=a[2];break;case 2:a=[d,k,f];m=a[0];c=a[1];a=a[2];break;case 3:a=[d,q,k];m=a[0];c=a[1];a=a[2];break;case 4:a=[f,d,k];m=a[0];c=a[1];a=a[2];break;case 5:a=[k,d,q],m=a[0],c=a[1],a=a[2]}}return[m,c,a,3<b.length?b[3]:1]};C.prototype.hsv=function(){return na(this._rgb)};var qa=function(){var a=g(arguments);return(a[0]<<16)+(a[1]<<8)+a[2]};z.num=function(a){return new C(a,"num")};C.prototype.num=function(a){null==a&&(a="rgb");return qa(this._rgb,a)};K.num=
function(a){if("number"===c(a)&&0<=a&&16777215>=a)return[a>>16,a>>8&255,a&255,1];console.warn("unknown num color: "+a);return[0,0,0,1]};O.push({p:1,test:function(a){if(1===arguments.length&&"number"===c(a)&&0<=a&&16777215>=a)return"num"}});var pa=function(){var a=g(arguments);var c=a[0];var b=a[1];a=a[2];var d=Math.min(c,b,a);A=Math.max(c,b,a);var f=A-d;if(0===f)var k=Number.NaN;else c===A&&(k=(b-a)/f),b===A&&(k=2+(a-c)/f),a===A&&(k=4+(c-b)/f),k*=60,0>k&&(k+=360);return[k,100*f/255,d/(255-f)*100]};
z.hcg=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["hcg"]),function(){})};K.hcg=function(){var a;var c=g(arguments);var b=c[0];var d=c[1];var f=c[2];d/=100;var k=k/100*255;var m=255*d;if(0===d)var n=k=a=f;else{360===b&&(b=0);360<b&&(b-=360);0>b&&(b+=360);b/=60;var p=v(b);b-=p;f*=1-d;d=f+m*(1-b);b=f+m*b;m=f+m;switch(p){case 0:a=[m,b,f];n=a[0];k=a[1];a=a[2];break;case 1:a=[d,m,f];n=a[0];k=a[1];a=a[2];break;case 2:a=
[f,m,b];n=a[0];k=a[1];a=a[2];break;case 3:a=[f,d,m];n=a[0];k=a[1];a=a[2];break;case 4:a=[b,f,m];n=a[0];k=a[1];a=a[2];break;case 5:a=[m,f,d],n=a[0],k=a[1],a=a[2]}}return[n,k,a,3<c.length?c[3]:1]};C.prototype.hcg=function(){return pa(this._rgb)};var ra=function(a){var c;a=a.toLowerCase();if(null!=z.colors&&z.colors[a])return V(z.colors[a]);if(c=a.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){var b=c.slice(1,4);for(c=a=0;2>=a;c=++a)b[c]=+b[c];b[3]=1}else if(c=a.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(b=
c.slice(1,5),c=a=0;3>=a;c=++a)b[c]=+b[c];else if(c=a.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){b=c.slice(1,4);for(c=a=0;2>=a;c=++a)b[c]=n(2.55*b[c]);b[3]=1}else if(c=a.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){b=c.slice(1,5);for(c=a=0;2>=a;c=++a)b[c]=n(2.55*b[c]);b[3]=+b[3]}else if(c=a.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))b=
c.slice(1,4),b[1]*=.01,b[2]*=.01,b=ca(b),b[3]=1;else if(c=a.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))b=c.slice(1,4),b[1]*=.01,b[2]*=.01,b=ca(b),b[3]=+c[4];return b};var sa=function(a){var c=1>a[3]?"rgba":"rgb";if("rgb"===c)return c+"("+a.slice(0,3).map(n).join(",")+")";if("rgba"===c)return c+"("+a.slice(0,3).map(n).join(",")+","+a[3]+")"};var da=function(a){return n(100*a)/100};var ta=function(a,c){var b=1>c?"hsla":"hsl";a[0]=
da(a[0]||0);a[1]=da(100*a[1])+"%";a[2]=da(100*a[2])+"%";"hsla"===b&&(a[3]=c);return b+"("+a.join(",")+")"};K.css=function(a){return ra(a)};z.css=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["css"]),function(){})};C.prototype.css=function(a){null==a&&(a="rgb");if("rgb"===a.slice(0,3))return sa(this._rgb);if("hsl"===a.slice(0,3))return ta(this.hsl(),this.alpha())};K.named=function(a){return V(I[a])};O.push({p:5,
test:function(a){if(1===arguments.length&&null!=I[a])return"named"}});C.prototype.name=function(a){var c;arguments.length&&(I[a]&&(this._rgb=V(I[a])),this._rgb[3]=1,this);var b=this.hex();for(c in I)if(b===I[c])return c;return b};var ua=function(){var a=g(arguments);var c=a[0];var b=a[1];a=a[2];a*=H;return[c,p(a)*b,r(a)*b]};var ha=function(){var a=g(arguments);var c=ua(a[0],a[1],a[2]);var b=c[0];var d=c[1];c=c[2];c=Q(b,d,c);d=c[0];b=c[1];c=c[2];return[d,b,c,3<a.length?a[3]:1]};var va=function(){var a=
g(arguments);var c=a[0];var b=a[1];var d=a[2];a=t(b*b+d*d);b=(B(d,b)*G+360)%360;0===n(1E4*a)&&(b=Number.NaN);return[c,a,b]};var ia=function(){var a=g(arguments);var c=a[0];var b=a[1];a=a[2];a=fa(c,b,a);c=a[0];b=a[1];a=a[2];return va(c,b,a)};z.lch=function(){var a=g(arguments);return new C(a,"lch")};z.hcl=function(){var a=g(arguments);return new C(a,"hcl")};K.lch=ha;K.hcl=function(){var a=g(arguments);return ha([a[2],a[1],a[0]])};C.prototype.lch=function(){return ia(this._rgb)};C.prototype.hcl=function(){return ia(this._rgb).reverse()};
var wa=function(a){null==a&&(a="rgb");var c=g(arguments);var b=c[0];var d=c[1];c=c[2];b/=255;d/=255;c/=255;var f=1-Math.max(b,Math.max(d,c));var k=1>f?1/(1-f):0;return[(1-b-f)*k,(1-d-f)*k,(1-c-f)*k,f]};var xa=function(){var a=g(arguments);var c=a[0];var b=a[1];var d=a[2];var f=a[3];a=4<a.length?a[4]:1;return 1===f?[0,0,0,a]:[1<=c?0:255*(1-c)*(1-f),1<=b?0:255*(1-b)*(1-f),1<=d?0:255*(1-d)*(1-f),a]};K.cmyk=function(){return xa(g(arguments))};z.cmyk=function(){return function(a,c,b){b.prototype=a.prototype;
b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["cmyk"]),function(){})};C.prototype.cmyk=function(){return wa(this._rgb)};K.gl=function(){var a,c,b,d;var f=function(){var a=g(arguments);var b=[];for(c in a)d=a[c],b.push(d);return b}.apply(this,arguments);for(a=b=0;2>=b;a=++b)f[a]*=255;return f};z.gl=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["gl"]),function(){})};C.prototype.gl=
function(){var a=this._rgb;return[a[0]/255,a[1]/255,a[2]/255,a[3]]};var ja=function(a,c,b){var d=g(arguments);a=d[0];c=d[1];b=d[2];a=ea(a);c=ea(c);b=ea(b);return.2126*a+.7152*c+.0722*b};var ea=function(a){a/=255;return.03928>=a?a/12.92:u((a+.055)/1.055,2.4)};J.push(["rgb",function(a,c,b,d){a=a._rgb;c=c._rgb;return new C(a[0]+b*(c[0]-a[0]),a[1]+b*(c[1]-a[1]),a[2]+b*(c[2]-a[2]),d)}]);C.prototype.luminance=function(a,c){null==c&&(c="rgb");if(!arguments.length)return ja(this._rgb);if(0===a)this._rgb=
[0,0,0,this._rgb[3]];else if(1===a)this._rgb=[255,255,255,this._rgb[3]];else{var b=20;var d=function(f,g){var k=f.interpolate(g,.5,c);var m=k.luminance();return 1E-7>Math.abs(a-m)||!b--?k:m>a?d(f,k):d(k,g)};var f=ja(this._rgb);this._rgb=(f>a?d(z("black"),this):d(this,z("white"))).rgba()}return this};var ka=function(a){a/=100;if(66>a){var c=255;var b=-155.25485562709179-.44596950469579133*(b=a-2)+104.49216199393888*q(b);var d=20>a?0:-254.76935184120902+.8274096064007395*(d=a-10)+115.67994401066147*
q(d)}else c=351.97690566805693+.114206453784165*(c=a-55)-40.25366309332127*q(c),b=325.4494125711974+.07943456536662342*(b=a-50)-28.0852963507957*q(b),d=255;return[c,b,d]};var ya=function(){var a;var c=g(arguments);var b=c[0];c=c[2];var d=1E3;for(a=4E4;.4<a-d;){var f=.5*(a+d);var k=ka(f);k[2]/k[0]>=c/b?a=f:d=f}return n(f)};z.temperature=z.kelvin=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(C,a.call(arguments).concat(["temperature"]),function(){})};
K.temperature=K.kelvin=K.K=ka;C.prototype.temperature=function(){return ya(this._rgb)};C.prototype.kelvin=C.prototype.temperature;z.contrast=function(a,b){var d,f;if("string"===(d=c(a))||"number"===d)a=new C(a);if("string"===(f=c(b))||"number"===f)b=new C(b);a=a.luminance();b=b.luminance();return a>b?(a+.05)/(b+.05):(b+.05)/(a+.05)};z.distance=function(a,b,d){var f,g,k;null==d&&(d="lab");if("string"===(g=c(a))||"number"===g)a=new C(a);if("string"===(k=c(b))||"number"===k)b=new C(b);a=a.get(d);d=b.get(d);
g=0;for(f in a)b=(a[f]||0)-(d[f]||0),g+=b*b;return Math.sqrt(g)};z.deltaE=function(a,b,d,f){var g,k,n;null==d&&(d=1);null==f&&(f=1);if("string"===(g=c(a))||"number"===g)a=new C(a);if("string"===(k=c(b))||"number"===k)b=new C(b);g=a.lab();a=g[0];k=g[1];var q=g[2];b=b.lab();g=b[0];var u=b[1];var r=b[2];var v=t(k*k+q*q);var z=t(u*u+r*r);var N=16>a?.511:.040975*a/(1+.01765*a);b=.0638*v/(1+.0131*v)+.638;for(n=1E-6>v?0:180*B(q,k)/m;0>n;)n+=360;for(;360<=n;)n-=360;n=164<=n&&345>=n?.56+F(.2*p(m*(n+168)/180)):
.36+F(.4*p(m*(n+35)/180));var M=v*v*v*v;M=t(M/(M+1900));v-=z;k-=u;q-=r;d=(a-g)/(d*N);f=v/(f*b);a=b*(M*n+1-M);return t(d*d+f*f+(k*k+q*q-v*v)/(a*a))};C.prototype.get=function(a){var c=a.split(".");a=c[0];c=c[1];var b=this[a]();if(c){var d=a.indexOf(c);return-1<d?b[d]:console.warn("unknown channel "+c+" in mode "+a)}return b};C.prototype.set=function(a,b){var d=a.split(".");a=d[0];if(d=d[1]){var f=this[a]();var g=a.indexOf(d);if(-1<g)if("string"===c(b))switch(b.charAt(0)){case "+":f[g]+=+b;break;case "-":f[g]+=
+b;break;case "*":f[g]*=+b.substr(1);break;case "/":f[g]/=+b.substr(1);break;default:f[g]=+b}else f[g]=b;else console.warn("unknown channel "+d+" in mode "+a)}else f=b;return z(f,a).alpha(this.alpha())};C.prototype.clipped=function(){return this._rgb._clipped||!1};C.prototype.alpha=function(a){return arguments.length?z.rgb([this._rgb[0],this._rgb[1],this._rgb[2],a]):this._rgb[3]};C.prototype.darken=function(a){null==a&&(a=1);var c=this.lab();c[0]-=P.Kn*a;return z.lab(c).alpha(this.alpha())};C.prototype.brighten=
function(a){null==a&&(a=1);return this.darken(-a)};C.prototype.darker=C.prototype.darken;C.prototype.brighter=C.prototype.brighten;C.prototype.saturate=function(a){null==a&&(a=1);var c=this.lch();c[1]+=a*P.Kn;0>c[1]&&(c[1]=0);return z.lch(c).alpha(this.alpha())};C.prototype.desaturate=function(a){null==a&&(a=1);return this.saturate(-a)};C.prototype.premultiply=function(){var a=this.rgb();var c=this.alpha();return z(a[0]*c,a[1]*c,a[2]*c,c)};var S=function(a,c,b){if(!S[b])throw"unknown blend mode "+
b;return S[b](a,c)};L=function(a){return function(c,b){b=z(b).rgb();c=z(c).rgb();return z(a(b,c),"rgb")}};var U=function(a){return function(c,b){var d,f;var g=[];for(d=f=0;3>=f;d=++f)g[d]=a(c[d],b[d]);return g}};S.normal=L(U(function(a,c){return a}));S.multiply=L(U(function(a,c){return a*c/255}));S.screen=L(U(function(a,c){return 255*(1-(1-a/255)*(1-c/255))}));S.overlay=L(U(function(a,c){return 128>c?2*a*c/255:255*(1-2*(1-a/255)*(1-c/255))}));S.darken=L(U(function(a,c){return a>c?c:a}));S.lighten=
L(U(function(a,c){return a>c?a:c}));S.dodge=L(U(function(a,c){if(255===a)return 255;a=c/255*255/(1-a/255);return 255<a?255:a}));S.burn=L(U(function(a,c){return 255*(1-(1-c/255)/(a/255))}));z.blend=S;z.analyze=function(a){var c;var b={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};var d=0;for(c=a.length;d<c;d++){var f=a[d];null==f||isNaN(f)||(b.values.push(f),b.sum+=f,f<b.min&&(b.min=f),f>b.max&&(b.max=f),b.count+=1)}b.domain=[b.min,b.max];b.limits=function(a,c){return z.limits(b,
a,c)};return b};z.scale=function(a,b){var d="rgb";var f=z("#ccc");var g=0;var k=[0,1];var m=[];var n=[0,0];var p=!1;var q=[];var r=!1;var t=0;var v=1;var A=!1;var E={};var N=!0;var D=1;var B=function(a){var b,d;null==a&&(a=["#fff","#000"]);null!=a&&"string"===c(a)&&null!=z.brewer&&(a=z.brewer[a]||z.brewer[a.toLowerCase()]||a);if("array"===c(a)){a=a.slice(0);var f=b=0;for(d=a.length-1;0<=d?b<=d:b>=d;f=0<=d?++b:--b){var g=a[f];"string"===c(g)&&(a[f]=z(g))}f=b=m.length=0;for(g=a.length-1;0<=g?b<=g:b>=
g;f=0<=g?++b:--b)m.push(f/(a.length-1))}G();return q=a};var H=function(a){var c;if(null!=p){var b=p.length-1;for(c=0;c<b&&a>=p[c];)c++;return c-1}return 0};var M=function(a){return a};var F=function(a,b){var g,k;null==b&&(b=!1);if(isNaN(a))return f;b||(p&&2<p.length?(a=H(a),a/=p.length-2):a=v!==t?(a-t)/(v-t):1);b||(a=M(a));1!==D&&(a=u(a,D));a=n[0]+a*(1-n[0]-n[1]);a=Math.min(1,Math.max(0,a));var r=Math.floor(1E4*a);if(N&&E[r])var A=E[r];else{if("array"===c(q))for(b=g=0,k=m.length-1;0<=k?g<=k:g>=k;b=
0<=k?++g:--g){var B=m[b];if(a<=B){A=q[b];break}if(a>=B&&b===m.length-1){A=q[b];break}if(a>B&&a<m[b+1]){a=(a-B)/(m[b+1]-B);A=z.interpolate(q[b],q[b+1],a,d);break}}else"function"===c(q)&&(A=q(a));N&&(E[r]=A)}return A};var G=function(){return E={}};B(a);var C=function(a){a=z(F(a));return r&&a[r]?a[r]():a};C.classes=function(a){if(null!=a){if("array"===c(a))p=a,k=[a[0],a[a.length-1]];else{var b=z.analyze(k);p=0===a?[b.min,b.max]:z.limits(b,"e",a)}return C}return p};C.domain=function(a){var c;if(!arguments.length)return k;
t=a[0];v=a[a.length-1];m=[];var b=q.length;if(a.length===b&&t!==v){var d=0;for(b=a.length;d<b;d++){var f=a[d];m.push((f-t)/(v-t))}}else for(f=c=0,d=b-1;0<=d?c<=d:c>=d;f=0<=d?++c:--c)m.push(f/(b-1));k=[t,v];return C};C.mode=function(a){if(!arguments.length)return d;d=a;G();return C};C.range=function(a,c){B(a,c);return C};C.out=function(a){r=a;return C};C.spread=function(a){if(!arguments.length)return g;g=a;return C};C.correctLightness=function(a){null==a&&(a=!0);A=a;G();M=A?function(a){var c=F(0,!0).lab()[0];
var b=F(1,!0).lab()[0];var d=c>b;var f=F(a,!0).lab()[0];c+=(b-c)*a;f-=c;var g=0;var k=1;for(b=20;.01<Math.abs(f)&&0<b--;)d&&(f*=-1),0>f?(g=a,a+=.5*(k-a)):(k=a,a+=.5*(g-a)),f=F(a,!0).lab()[0],f-=c;return a}:function(a){return a};return C};C.padding=function(a){return null!=a?("number"===c(a)&&(a=[a,a]),n=a,C):n};C.colors=function(c,b){var d,f,g;2>arguments.length&&(b="hex");var m=[];if(0===arguments.length)m=q.slice(0);else if(1===c)m=[C(.5)];else if(1<c){var n=k[0];var u=k[1]-n;m=function(){f=[];
for(var a=0;0<=c?a<c:a>c;0<=c?a++:a--)f.push(a);return f}.apply(this).map(function(a){return C(n+a/(c-1)*u)})}else{a=[];var r=[];if(p&&2<p.length)for(m=g=1,d=p.length;1<=d?g<d:g>d;m=1<=d?++g:--g)r.push(.5*(p[m-1]+p[m]));else r=k;m=r.map(function(a){return C(a)})}z[b]&&(m=m.map(function(a){return a[b]()}));return m};C.cache=function(a){return null!=a?(N=a,C):N};C.gamma=function(a){return null!=a?(D=a,C):D};return C};null==z.scales&&(z.scales={});z.scales.cool=function(){return z.scale([z.hsl(180,1,
.9),z.hsl(250,.7,.4)])};z.scales.hot=function(){return z.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")};z.analyze=function(a,b,d){var f;var g={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};null==d&&(d=function(){return!0});var k=function(a){null==a||isNaN(a)||(g.values.push(a),g.sum+=a,a<g.min&&(g.min=a),a>g.max&&(g.max=a),g.count+=1)};var m=function(a,f){if(d(a,f))return null!=b&&"function"===c(b)?k(b(a)):null!=b&&"string"===c(b)||"number"===c(b)?k(a[b]):
k(a)};if("array"===c(a)){var n=0;for(f=a.length;n<f;n++){var p=a[n];m(p)}}else for(f in a)p=a[f],m(p,f);g.domain=[g.min,g.max];g.limits=function(a,c){return z.limits(g,a,c)};return g};z.limits=function(a,b,d){var f,g,k,m,n,p,r;null==b&&(b="equal");null==d&&(d=7);"array"===c(a)&&(a=z.analyze(a));var t=a.min;A=a.max;var E=a.values.sort(function(a,b){return a-b});if(1===d)return[t,A];a=[];"c"===b.substr(0,1)&&(a.push(t),a.push(A));if("e"===b.substr(0,1)){a.push(t);b=E=1;for(f=d-1;1<=f?E<=f:E>=f;b=1<=
f?++E:--E)a.push(t+b/d*(A-t));a.push(A)}else if("l"===b.substr(0,1)){if(0>=t)throw"Logarithmic scales are only possible for values > 0";f=Math.LOG10E*q(t);E=Math.LOG10E*q(A);a.push(t);b=m=1;for(n=d-1;1<=n?m<=n:m>=n;b=1<=n?++m:--m)a.push(u(10,f+b/d*(E-f)));a.push(A)}else if("q"===b.substr(0,1)){a.push(t);b=f=1;for(n=d-1;1<=n?f<=n:f>=n;b=1<=n?++f:--f)m=(E.length-1)*b/d,b=v(m),b===m?a.push(E[b]):(m-=b,a.push(E[b]*(1-m)+E[b+1]*m));a.push(A)}else if("k"===b.substr(0,1)){n=E.length;f=Array(n);var B=Array(d);
var D=!0;var H=0;var C=null;C=[];C.push(t);b=g=1;for(k=d-1;1<=k?g<=k:g>=k;b=1<=k?++g:--g)C.push(t+b/d*(A-t));for(C.push(A);D;){t=b=0;for(g=d-1;0<=g?b<=g:b>=g;t=0<=g?++b:--b)B[t]=0;b=g=0;for(p=n-1;0<=p?g<=p:g>=p;b=0<=p?++g:--g){var M=E[b];var G=Number.MAX_VALUE;t=D=0;for(r=d-1;0<=r?D<=r:D>=r;t=0<=r?++D:--D)k=F(C[t]-M),k<G&&(G=k,m=t);B[m]++;f[b]=m}g=Array(d);t=b=0;for(D=d-1;0<=D?b<=D:b>=D;t=0<=D?++b:--b)g[t]=null;b=D=0;for(k=n-1;0<=k?D<=k:D>=k;b=0<=k?++D:--D)t=f[b],g[t]=null===g[t]?E[b]:g[t]+E[b];t=
D=0;for(k=d-1;0<=k?D<=k:D>=k;t=0<=k?++D:--D)g[t]*=1/B[t];D=!1;t=k=0;for(G=d-1;0<=G?k<=G:k>=G;t=0<=G?++k:--k)if(g[t]!==C[b]){D=!0;break}C=g;H++;200<H&&(D=!1)}m={};t=b=0;for(C=d-1;0<=C?b<=C:b>=C;t=0<=C?++b:--b)m[t]=[];b=C=0;for(--n;0<=n?C<=n:C>=n;b=0<=n?++C:--C)t=f[b],m[t].push(E[b]);E=[];t=b=0;for(--d;0<=d?b<=d:b>=d;t=0<=d?++b:--b)E.push(m[t][0]),E.push(m[t][m[t].length-1]);E=E.sort(function(a,b){return a-b});a.push(E[0]);b=d=1;for(f=E.length-1;d<=f;b=d+=2)b=E[b],isNaN(b)||-1!==a.indexOf(b)||a.push(b)}return a};
var za=function(){var a=g(arguments);var b=a[0];var c=a[1];a=a[2];E=2*Math.PI;b/=255;c/=255;a/=255;var d=Math.min(b,c,a);var f=(b+c+a)/3;d=1-d/f;0===d?b=0:(b=(b-c+(b-a))/2/Math.sqrt((b-c)*(b-c)+(b-a)*(c-a)),b=Math.acos(b),a>c&&(b=E-b),b/=E);return[360*b,d,f]};z.hsi=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(C,a.call(arguments).concat(["hsi"]),function(){})};K.hsi=function(a,b,c){var d=g(arguments);a=d[0];b=d[1];c=d[2];isNaN(a)&&(a=0);
a/=360;if(a<1/3){var k=(1-b)/3;var m=(1+b*p(E*a)/p(D-E*a))/3;var n=1-(k+m)}else a<2/3?(a-=1/3,m=(1-b)/3,n=(1+b*p(E*a)/p(D-E*a))/3,k=1-(m+n)):(a-=2/3,n=(1-b)/3,k=(1+b*p(E*a)/p(D-E*a))/3,m=1-(n+k));m=f(c*m*3);n=f(c*n*3);k=f(c*k*3);return[255*m,255*n,255*k,3<d.length?d[3]:1]};C.prototype.hsi=function(){return za(this._rgb)};var Aa=function(a,b,c,d){var f;if("hsl"===d){var g=a.hsl();var k=b.hsl()}else if("hsv"===d)g=a.hsv(),k=b.hsv();else if("hcg"===d)g=a.hcg(),k=b.hcg();else if("hsi"===d)g=a.hsi(),k=
b.hsi();else if("lch"===d||"hcl"===d)d="hcl",g=a.hcl(),k=b.hcl();if("h"===d.substr(0,1)){var m=g[0];var n=g[1];var p=g[2];var q=k[0];var r=k[1];var u=k[2]}isNaN(m)||isNaN(q)?isNaN(m)?isNaN(q)?a=Number.NaN:(a=q,1!==p&&0!==p||"hsv"===d||(f=r)):(a=m,1!==u&&0!==u||"hsv"===d||(f=n)):a=m+c*(q>m&&180<q-m?q-(m+360):q<m&&180<m-q?q+360-m:q-m);null==f&&(f=n+c*(r-n));return z[d](a,f,p+c*(u-p))};J=J.concat(function(){var a;var c="hsv hsl hsi hcl lch hcg".split(" ");var d=[];var f=0;for(a=c.length;f<a;f++)b=c[f],
d.push([b,Aa]);return d}());J.push(["num",function(a,b,c,d){a=a.num();b=b.num();return z.num(a+(b-a)*c,"num")}]);J.push(["lab",function(a,b,c,d){a=a.lab();b=b.lab();return new C(a[0]+c*(b[0]-a[0]),a[1]+c*(b[1]-a[1]),a[2]+c*(b[2]-a[2]),d)}])}).call(this);(function(d,b){d.appSetting=function(a){return{init:function(){var a=b.querySelector("#virtualclassCont.congrea #appSettingCtrl"),d=b.querySelector("#virtualclassCont.congrea #chatWidget"),g=b.querySelector("#virtualclassCont.congrea #appSettingDetail"),k=b.querySelector("#virtualclassCont.congrea .vmchat_bar_button"),m=b.querySelector("#virtualclassCont.congrea .vmchat_room_bt");a&&a.addEventListener("click",function(){a.classList.contains("chatActive")?(a.classList.remove("chatActive"),a.classList.add("settingActive"),
d.classList.remove("active"),d.classList.add("deactive"),g.classList.add("active"),g.classList.remove("deactive"),k.classList.contains("active")&&k.classList.remove("active"),m.classList.contains("active")&&m.classList.remove("active")):(a.classList.add("chatActive"),a.classList.remove("settingActive"),d.classList.remove("deactive"),d.classList.add("active"),g.classList.remove("active"),g.classList.add("deactive"),b.querySelector(".congrea #memlist.enable")&&k.classList.add("active"),b.querySelector(".congrea #chatrm.enable")&&
m.classList.add("active"))})}}}()})(window,document);function Network(){this.sumLatency=this.latency=0;this.minLatency=999999;this.countLatency=0;this.avgLatency=1;this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0}Network.prototype.pingToServer=function(){if(io.webSocketConnected()){var d=Date.now();ioAdapter.sendPing(d)}};
Network.prototype.initToPing=function(d){var b=this;this.hasOwnProperty("initToPingTime")&&clearTimeout(this.initToPingTime);this.hasOwnProperty("sleepTime")&&clearTimeout(this.sleepTime);this.initToPingTime=setTimeout(function(){b.pingToServer();b.sleepTime=setTimeout(function(){b.latency=3E3;b.initToPing(5E3)},3E3)},d);this.variations()};
Network.prototype.variations=function(){this.latency&&3E3>this.latency&&0<this.latency&&(this.sumLatency+=this.latency,this.countLatency++,this.avgLatency=Math.round(this.sumLatency/this.countLatency),this.latency<this.minLatency&&10<this.latency&&(this.minLatency=this.latency));this.avgLatency>2*this.minLatency&&this.resetVariations();this.adaptiveMedia()};
Network.prototype.adaptiveMedia=function(){3>virtualclass.videoHost.gObj.MYSPEED&&(3E3<=this.latency||999999>this.minLatency&&this.latency>3*this.minLatency)?(this.MYSPEED_COUNTER_OK=0,this.MYSPEED_COUNTER_HIGH++,this.updateNetworkInfo("slow"),1==virtualclass.videoHost.gObj.MYSPEED&&3<=this.MYSPEED_COUNTER_HIGH?(this.MYSPEED_COUNTER_HIGH=0,this.setSpeed(2)):2==virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_HIGH&&(this.MYSPEED_COUNTER_HIGH=0,this.setSpeed(3))):1<virtualclass.videoHost.gObj.MYSPEED&&
999999>this.minLatency&&this.latency<2*this.minLatency?(this.MYSPEED_COUNTER_OK++,this.MYSPEED_COUNTER_HIGH=0,this.updateNetworkInfo("fast"),2<virtualclass.videoHost.gObj.MYSPEED&&4<=this.MYSPEED_COUNTER_OK?(this.MYSPEED_COUNTER_OK=0,this.setSpeed(2)):1<virtualclass.videoHost.gObj.MYSPEED&&10<=this.MYSPEED_COUNTER_OK&&(this.MYSPEED_COUNTER_OK=0,this.setSpeed(1))):(2E3<this.latency?this.updateNetworkInfo("slow"):this.updateNetworkInfo("fast"),this.MYSPEED_COUNTER_HIGH=this.MYSPEED_COUNTER_OK=0)};
Network.prototype.updateNetworkInfo=function(d){var b;1==virtualclass.videoHost.gObj.MYSPEED?b="high":2==virtualclass.videoHost.gObj.MYSPEED?b="medium":3==virtualclass.videoHost.gObj.MYSPEED&&(b="low");var a=document.getElementById("proposedSpeed");a&&(a.dataset.suggestion=b);if(b=document.getElementById("networkLatency"))b.dataset.latency=d,d=virtualclass.lang.getString("band"+d),b.dataset.title=d};
Network.prototype.setSpeed=function(d){virtualclass.videoHost.gObj.MYSPEED=d;ioAdapter.sendSpeed(virtualclass.videoHost.gObj.MYSPEED);console.log("Latency - CHANGE SPEED TO "+virtualclass.videoHost.gObj.MYSPEED);this.hideTeacherVideo();this.resetVariations()};Network.prototype.hideTeacherVideo=function(){if(roles.isStudent()&&3<=virtualclass.videoHost.gObj.MYSPEED){var d=document.querySelector("#videoParticipate"),b=d.getContext("2d");b.fillStyle="#000000";b.fillRect(0,0,d.offsetWidth,d.offsetHeight)}};
Network.prototype.resetVariations=function(){this.countLatency=this.sumLatency=0;this.avgLatency=1;this.minLatency=999999};Network.prototype.netWorkElementIsReady=function(){var d=document.querySelector("#networkStatusContainer");if(null==d){var b=this;virtualclass.gObj.connectingRoom=setTimeout(function(){b.netWorkElementIsReady()},1E3)}else d.classList.add("connecting-room"),clearTimeout(virtualclass.gObj.connectingRoom)};var gesture={initClassJoin:function(){var d=document.querySelector("#joinClassModal");null!=d&&(d.style.display="block");document.querySelector("#joinClassModal").className="modal in";var b=document.querySelector("#virtualclassCont #virtualclassApp");null!=b&&(b.style.display="none");var a=document.querySelector("#joinClassModal .joinClasscontainer button");d&&d.addEventListener("click",function(){a.focus()});this.classJoin=!0},attachHandler:function(){var d=document.querySelector("#joinClassModal .joinClasscontainer button");
d.focus();null!=d&&(d.addEventListener("click",function(){virtualclass.gesture.clickToContinue()}),d.addEventListener("keydown",function(b){b.preventDefault();13==b.keyCode&&virtualclass.gesture.clickToContinue()}))},clickToContinue:function(){var d=document.querySelector("#virtualclassCont #virtualclassApp"),b=document.querySelector("#joinClassModal");d.style.display="block";b.style.display="none";virtualclass.media.audio.initAudiocontext();virtualclass.vutil.triggerMouseEvent(document.querySelector(".CodeMirror-scroll"),
"mousedown")},initAudioResume:function(d){var b=document.querySelector("#joinClassModal");null!==b&&(b.style.display="block");virtualclass.modal.show("#joinClassModal");if(null===document.getElementById("initAudio")){var a=document.querySelector("#joinClassModal .modal-body"),c=document.createElement("div");c.id="initAudio";c.innerHTML=virtualclass.lang.getString("clickheretoplay");a.appendChild(c);a.onclick=function(){virtualclass.media.audio.initScriptNode(d);b.style.display="none";virtualclass.gObj.requestToScriptNode=
null}}a=document.querySelector("#joinClassModal .joinClasscontainer");null!==a&&(a.style.display="none")}};(function(d,b){var a=function(a){this.shownPages=6;this.app=a};a.prototype.init=function(){this.UI.container();var a=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});this.subCont=b.querySelector("#virtualclassCont.congrea #dcPaging");this.width=a.width;this.shownPages=this.countNumberOfNavigation(this.width)};a.prototype.createIndex=function(){this.init();for(var a=0;a<virtualclass.dts.order.length;a++)this.createDocNavigationNumber(virtualclass.dts.order[a],a);b.querySelector("#dcPaging").addEventListener("change",
function(){virtualclass.dts.docs.goToNavs(this.value)()});this.shownPage(this.width);this.addActiveNavigation();this.setTotalPages(virtualclass.dts.order.length)};a.prototype.setTotalPages=function(a){var c=b.querySelector("#docShareNav #totalPages");c&&(roles.hasControls(),c.innerHTML=" of "+a,c=b.querySelector("#docShareNav"),a?(c.classList.add("show"),c.classList.remove("hide")):(c.classList.add("hide"),c.classList.remove("show")))};a.prototype.adjustPageNavigation=function(a,d){var c;if("right"==
d){d=b.querySelectorAll(".noteIndex.shw");if(d.length){var f=d[d.length-1];var m=parseInt(f.getAttribute("title"))}for(;m<a;m++)if("DocumentShare"==virtualclass.currApp&&virtualclass.dts.indexNav.UI.setClassPrevNext(),c=b.querySelector(".noteIndex.hid.right"))if(c.classList.remove("hid","right"),c.classList.add("shw"),f=b.querySelector(".noteIndex.shw"))f.classList.remove("shw"),f.classList.add("hid","left");"DocumentShare"==virtualclass.currApp&&(a=virtualclass.dts.docs.currNote,(a=b.querySelector(".congrea #dcPaging #index"+
a))&&!a.classList.contains("active")&&a.classList.add("active"))}else{for((d=b.querySelector(".noteIndex.shw"))&&(m=parseInt(d.getAttribute("title")));m>a;m--)"DocumentShare"==virtualclass.currApp&&virtualclass.dts.indexNav.UI.setClassPrevNext(),d=b.querySelectorAll(".noteIndex.hid.left"),d.length&&(c=d[d.length-1]),c&&(c.classList.remove("hid","left"),c.classList.add("shw"),d=b.querySelectorAll(".noteIndex.shw"),d.length&&(f=d[d.length-1]),f&&(f.classList.remove("shw"),f.classList.add("hid","right")));
"DocumentShare"==virtualclass.currApp&&(a=virtualclass.dts.docs.currNote,(a=b.querySelector(".congrea #dcPaging #index"+a))&&!a.classList.contains("active")&&(a.classList.add("active"),a.setAttribute("selected","selected")))}};a.prototype.removeNav=function(){for(var a=b.getElementById("docShareNav");a.firstChild;)a.removeChild(a.firstChild)};a.prototype.addActiveNavigation=function(a){this.addActiveClass(a);a=b.querySelector("#rightNavPage.disable");this.UI.isNodeAvailable(".noteIndex.shw.active",
"next")?null!=a&&("Whiteboard"==virtualclass.currApp?this.UI.setArrowStatus("rightNavPage","enable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(b.getElementById("rightNavPage"),"enable","disable")):"Whiteboard"==virtualclass.currApp?this.UI.setArrowStatus("rightNavPage","disable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(b.getElementById("rightNavPage"),"disable","enable");a=b.querySelector("#leftNavPage.disable");this.UI.isNodeAvailable(".noteIndex.shw.active","prev")?null!=a&&("Whiteboard"==
virtualclass.currApp?this.UI.setArrowStatus("leftNavPage","enable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(b.getElementById("leftNavPage"),"enable","disable")):"Whiteboard"==virtualclass.currApp?this.UI.setArrowStatus("leftNavPage","disable"):virtualclass.dts.indexNav.UI._setArrowStatusDocs(b.getElementById("leftNavPage"),"disable","enable")};a.prototype.addActiveClass=function(a){var c;if("Whiteboard"==virtualclass.currApp){var d=a.split("doc_0_")[1];var k=virtualclass.gObj.wbCount+1}else k=
virtualclass.dts.order.length;(a=b.querySelector(".congrea #dcPaging .noteIndex.active"))&&a.classList.remove("active");d="DocumentShare"==virtualclass.currApp?virtualclass.dts.docs.currNote:d;if(a=b.querySelector("#index"+d)){a.classList.add("active");a.selected="selected";(c=b.querySelector("#totalPages"))&&c.parentNode.removeChild(c);var m=b.createElement("span");m.id="totalPages";c=b.querySelector("#pageAnc");c.appendChild(m);this.setTotalPages(k)}k=b.querySelector("#dcPaging .hid.right.active");
c=b.querySelector("#dcPaging .hid.left.active");if(k||c){if(k){var n=k.title;k="right"}else n=c.title,k="left";this.adjustPageNavigation(parseInt(n),k)}if("Whiteboard"==virtualclass.currApp){if(this.index=+d+1,n=b.querySelector(".noteIndex.active"))c=b.querySelector("#currIndex"),c.innerHTML=n.innerHTML,ioAdapter.mustSend({wbData:"wbIndex",wbIndex:n.innerHTML,cf:"wbData"})}else this.index=null!=n?n:null!=a&&"undefined"!=typeof a?a.title:1,virtualclass.dts.order.length||(this.index=0),n=b.querySelector("#docShareNav"),
this.index?(n.classList.add("show"),n.classList.remove("hide")):(n.classList.add("hide"),n.classList.remove("show")),b.querySelector("#currIndex").innerHTML=this.index;n=b.getElementById("teacherCurrPage");null!=n&&(n.innerHTML=this.index)};a.prototype.rearrangePageNavigation=function(a){var c=b.getElementById("dcPaging");if(c){var d=b.createElement("div");d.id="dcPaging";if(null!=d){var k=[];if(this.oldOrder)for(var m=0;m<this.oldOrder.length;m++){var n=this.oldOrder[m];k[n]=b.getElementById("index"+
this.oldOrder[m]).className}for(m=0;m<a.length;m++){var p=b.getElementById("index"+a[m]);this.oldOrder&&(n=this.oldOrder[m],p.className=k[n]);d.appendChild(p);p.innerHTML=m+1;p.title=m+1}c.parentNode.replaceChild(d,c)}}this.UI.setClassPrevNext();this.addActiveNavigation()};a.prototype.shownPage=function(a){var c=b.querySelectorAll(".noteIndex");a=this.countNumberOfNavigation(a);for(var d=0;d<c.length;d++)c[d].className=d>a?"noteIndex hid right":"noteIndex shw"};a.prototype.countNumberOfNavigation=
function(a){return 1200<=a?8:700<=a?5:500<=a?4:2};a.prototype.movePageIndex=function(a){virtualclass.dts.indexNav.addActiveNavigation();virtualclass.dts.indexNav.UI.setClassPrevNext();virtualclass.dts.indexNav.UI.pageNavHandler(a)};a.prototype.createDocNavigationNumber=function(a,d){var c=b.createElement("span");c.id="index"+a;c.value=a;c.className="noteIndex";var f=d+1;c.setAttribute("title",f);c.innerHTML=f;this.subCont.appendChild(c);virtualclass.dts.docs.currNote==a&&(c.classList.add("active"),
b.querySelector("#currIndex").innerHTML=d+1);this.index=f;c.onclick=virtualclass.dts.docs.goToNavs(a)};a.prototype.createWbNavigationNumber=function(a,d){var c="_doc_0_"+a,f=b.createElement("span");f.id="index"+a;f.className="noteIndex";f.setAttribute("title",a+1);f.innerHTML=d+1;f.setAttribute("value",c);this.subCont.appendChild(f);f.className=a>this.shownPages?"noteIndex hid right":"noteIndex shw";virtualclass.gObj.currWb==c&&(virtualclass.wbCommon.indexNav.addActiveNavigation(c),b.querySelector("#currIndex").innerHTML=
d+1);f.onclick=function(){virtualclass.wbCommon.setCurrSlideNumber(c);virtualclass.wbCommon.indexNav.addActiveNavigation(c);virtualclass.wbCommon.readyCurrentWhiteboard(c);virtualclass.gObj.currWb=c}};a.prototype.newWbpage=function(a){virtualclass.vutil.navWhiteboard(virtualclass.wbCommon,virtualclass.wbCommon.newPage);virtualclass.wbCommon.hasOwnProperty("setNextWhiteboardTime")&&clearTimeout(virtualclass.wbCommon.setNextWhiteboardTime);"Whiteboard"==virtualclass.currApp&&(virtualclass.wbCommon.setNextWhiteboardTime=
setTimeout(function(){virtualclass.zoom.normalRender()},500))};a.prototype.studentDocNavigation=function(a){if(virtualclass.dts.order){a=virtualclass.dts.order.indexOf(a);var c=b.querySelector("#docShareNav");-1==a?(c.classList.add("hide"),c.classList.remove("show")):(c.classList.add("show"),c.classList.remove("hide"));if(c=b.getElementById("stdPageNo"))c.innerHTML=a+1;var d=this;setTimeout(function(){d.setTotalPages(virtualclass.dts.order.length)},100)}};a.prototype.studentWBPagination=function(a){var c=
b.getElementById("stdPageNo");if(c){c.innerHTML=parseInt(a)+1;var d=this;setTimeout(function(){d.setTotalPages(virtualclass.gObj.wbCount+1)},100)}};a.prototype.UI={container:function(){var a=b.getElementById("docShareNav");if(roles.hasControls()){for(;a.firstChild;)a.removeChild(a.firstChild);a=b.querySelector(".congrea #docShareNav");var d=b.createElement("span");d.id="leftNavPage";d.className="pageNav";a.appendChild(d);var g=b.createElement("span");g.classList.add("navArrow");g.innerHTML="";a.appendChild(g);
g=b.createElement("span");g.classList.add("pageHead");g.innerHTML="Page";a.appendChild(g);g=b.createElement("div");g.id="ancCont";g.classList.add("noCont");a.appendChild(g);var k=b.createElement("div");k.id="pageAnc";g.appendChild(k);g=b.createElement("span");g.id="currIndex";k.appendChild(g);k.addEventListener("click",function(){var a=b.querySelector("#dcPaging");a&&(a.classList.toggle("close"),a.classList.toggle("open"))});"Whiteboard"==virtualclass.currApp&&(g=b.createElement("span"),g.id="addNewPage",
g.className="newPage",a.appendChild(g),k=b.createElement("span"),g.appendChild(k),k.className="icon-newPage congtooltip",k.setAttribute("data-title",virtualclass.lang.getString("newPage")),k.addEventListener("click",function(){virtualclass.wbCommon.indexNav.newWbpage(this.type)}));var m=b.createElement("div");m.id="dcPaging";m.classList.add("close");a.appendChild(m);g=b.createElement("span");g.id="rightNavPage";g.className="pageNav";a.appendChild(g);var n=this;a.addEventListener("mouseover",function(){m.classList.add("open");
m.classList.remove("close")});a.addEventListener("mouseout",function(){m.classList.add("close");m.classList.remove("open")});d.addEventListener("click",function(){"Whiteboard"==virtualclass.currApp?n.isNodeAvailable(".noteIndex.shw.active","prev")?b.querySelector("#virtualclassWhiteboard .prev").click():n.setArrowStatus("leftNavPage","disable"):(b.getElementById("docsprev").click(),n.setArrowStatus("leftNavPage","disable"))});g.addEventListener("click",function(){"Whiteboard"==virtualclass.currApp?
n.isNodeAvailable(".noteIndex.shw.active","next")?(b.querySelector("#virtualclassWhiteboard .next").click(),virtualclass.gObj.currWb.split("_doc_0")[1]>this.shownPages&&(b.querySelector(".noteIndex.shw").className="noteIndex hid left")):n.setArrowStatus("rightNavPage","disable"):(b.getElementById("docsnext").click(),n.setArrowStatus("rightNavPage","disable"))})}else a=b.querySelector(".congrea #docShareNav"),b.querySelector(".congrea #stdPageNo")||(g=b.createElement("span"),g.classList.add("pageHead"),
g.innerHTML="Page",a.appendChild(g),m=b.createElement("div"),m.id="dcPaging",a.appendChild(m),a=b.createElement("span"),a.id="stdPageNo",m.appendChild(a));roles.hasControls()||(a=b.querySelector("#totalPages"),a||(a=b.createElement("span"),a.id="totalPages",a.className="pages",null!=m&&m.appendChild(a)))},setClassPrevNext:function(){var a=b.querySelector("#documentScreen #note"+virtualclass.dts.docs.currNote);if(null!=a){var d=a.previousElementSibling;var g=a.nextElementSibling}b.querySelector("#leftNavPage")&&
(d?this.setArrowStatus("leftNavPage","enable"):this.setArrowStatus("leftNavPage","disable"));b.querySelector("#rightNavPage")&&(g?this.setArrowStatus("rightNavPage","enable"):this.setArrowStatus("rightNavPage","disable"))},pageNavHandler:function(a,d){var c;if("right"==a){if(a=b.querySelector(".noteIndex.hid.right.active"))if(a.classList.remove("hid"),a.classList.remove("right"),a.classList.add("shw"),c=b.querySelector(".noteIndex.shw"))c.classList.remove("shw"),c.classList.add("hid","left")}else if(a=
b.querySelector(".noteIndex.hid.left.active"))a.classList.remove("hid"),a.classList.remove("left"),a.classList.add("shw"),a=b.querySelectorAll(".noteIndex.shw"),a.length&&(c=a[a.length-1]),c&&(c.classList.remove("shw"),c.classList.add("hid"),c.classList.add("right"))},setArrowStatus:function(a,d){var c="disable"==d?"enable":"disable";a=b.getElementById(a);"Whiteboard"==virtualclass.currApp?(a.classList.add(d),a.classList.remove(c)):virtualclass.dts.docs.currNote==virtualclass.dts.order[virtualclass.dts.order.length-
1]&&this._setArrowStatusDocs(a,d,c)},_setArrowStatusDocs:function(a,b,d){a.classList.add(b);a.classList.remove(d)},isNodeAvailable:function(a,d){d="next"==d?"nextSibling":"previousSibling";return(a=b.querySelector(a))&&null!=a[d]}};d.pageIndexNav=a})(window,document);var chatContainerEvent={ub:"init_chatBox",ac:"footerControler",ch:"footerControler",er:"footerControler",rs:"footerControler",rh:"footerControler",getEvent:function(d){return this[d.dataset.event]},init_chatBox:function(d,b){var a=$(d);if("videoSubWrapper"==d.className||"userVideos"==d.classList){var c=a[0].id;d=c.replace("user","")}else c=a.attr("href"),d=c.replace("#","");"undefined"!=typeof c&&(a=0<a.parent(".usern").length?a.html():chat_div.shadowRoot.querySelector("#ml"+d+" .usern a").title,
-1==$.inArray(d,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(d),virtualclass.chat.vmstorage.hasOwnProperty(d)||(virtualclass.chat.vmstorage[d]=[],virtualclass.chat.vmstorage[d].push({userid:d,name:a}))),b.addBox(d,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:a,type:"privateChat"}),b.init({user:{name:a},messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}}),virtualclass.chat.vmstorage.hasOwnProperty(d)&&
displayUserSinglePvtChatHistory(d),a=d=null)},onEvent:function(d,b){var a=this.getEvent(d);"userVideos"==d.classList||"videoSubWrapper"==d.classList||"init_chatBox"==a?(d=d.classList.contains("media-heading")?d.parentNode.previousElementSibling:d.parentNode,this.init_chatBox(d,b)):"footerControler"==a&&("A"==d.tagName&&(d=d.firstElementChild,"SPAN"!=d.tagName&&alert("no span tag is found")),virtualclass.user.control.init.call(virtualclass.user,d))},elementFromShadowDom:function(d,b,a){if(null!=virtualclass.gObj.testChatDiv){var c=
virtualclass.gObj.testChatDiv.shadowRoot;return"undefined"!=typeof b&&"all"==b?c.querySelectorAll(d):"undefined"!=typeof a?c.getElementById(d):c.querySelector(d)}}};var micTesting={audioPlayerNode:!1,manipulateStreamFallback:function(d){this.playAudio=!0;this.audioToBePlay=[];this.allAudioArr=[];this.bufferSize=16384;if(null!=d){if(!virtualclass.media.audioVisual.hasOwnProperty("audioCtx")||virtualclass.media.audioVisual.hasOwnProperty("audioCtx")&&null==virtualclass.media.audioVisual.audioCtx)virtualclass.media.audioVisual.audioCtx=new (window.AudioContext||window.webkitAudioContext);virtualclass.system.mediaDevices.hasMicrophone?null==this.audioCreatorNode||
void 0==this.audioCreatorNode||"undefined"==typeof this.audioCreatorNode?(console.log("processor intialize"),this.audioInput=virtualclass.media.audioVisual.audioCtx.createMediaStreamSource(d),this.audioCreatorNode=virtualclass.media.audioVisual.audioCtx.createScriptProcessor(this.bufferSize,1,1),this.audioCreatorNode.onaudioprocess=this.recorderProcessFallback.bind(this),this.audioInput.connect(this.audioCreatorNode),this.audioCreatorNode.connect(virtualclass.media.audioVisual.audioCtx.destination)):
console.log("No audio "):console.log("There is no microphone")}else console.log("No stream is found")},recorderProcessFallback:function(d){if(this.playAudio){virtualclass.precheck.mic.graph.microphone.hasOwnProperty("localAudioBuffer")&&null!=virtualclass.precheck.mic.graph.microphone.localAudioBuffer||(virtualclass.precheck.mic.graph.microphone.localAudioBuffer=virtualclass.media.audioVisual.audioCtx.createBuffer(1,this.bufferSize,virtualclass.media.audioVisual.audioCtx.sampleRate));var b=d.inputBuffer.getChannelData(0);
this.queueWithFallback(b);this.playWithFallback();virtualclass.precheck.mic.graph.microphone.reloadBufferFunction(d)}},queueWithFallback:function(d){for(var b=0;b<d.length;b++)this.allAudioArr.push(d[b]);for(;this.allAudioArr.length>=this.bufferSize;)d=this.allAudioArr.splice(0,this.bufferSize),this.audioToBePlay.push(new Float32Array(d))},playWithFallback:function(){var d=this;this.audioPlayerNode||(this.audioPlayerNode=virtualclass.media.audioVisual.audioCtx.createScriptProcessor(this.bufferSize,
1,1),this.audioPlayerNode.onaudioprocess=function(b){if(micTesting.playAudio){b=b.outputBuffer.getChannelData(0);var a=d.getAudioChunks();if(null!=a)for(i=0;i<a.length;i++)b[i]=a[i]}else for(b=b.outputBuffer.getChannelData(0),i=0;i<b.length;i++)b[i]=0},this.audioPlayerNode.connect(virtualclass.media.audioVisual.audioCtx.destination))},getAudioChunks:function(){if(5<=this.audioToBePlay.length){for(;2<=this.audioToBePlay.length;)this.audioToBePlay.shift();this.aChunksPlay=!0;return this.audioToBePlay.shift()}if(2<=
this.audioToBePlay.length||0<this.audioToBePlay.length&&!0===this.aChunksPlay)return this.aChunksPlay=!0,this.audioToBePlay.shift();this.aChunksPlay=!1},makeAudioEmpty:function(){this.playAudio=!1;this.audioToBePlay=[]},destroyAudioNode:function(){this.makeAudioEmpty();if(virtualclass.gObj.meetingMode)for(var d=virtualclass.multiVideo.localStream.getTracks(),b=0;b<d.length;b++)d[b].stop();else this.audioPlayerNode&&(this.audioPlayerNode.disconnect(virtualclass.media.audioVisual.audioCtx.destination),
delete this.audioPlayerNode,this.audioPlayerNode=!1),this.audioCreatorNode&&(this.audioCreatorNode.disconnect(virtualclass.media.audioVisual.audioCtx.destination),delete this.audioCreatorNode,"Firefox"!=virtualclass.system.mybrowser.name&&"iOS"!=virtualclass.system.mybrowser.name&&"Safari"!=virtualclass.system.mybrowser.name||virtualclass.media.audioVisual.audioCtx.close(),virtualclass.precheck.mic.hasOwnProperty("graphProcessor")&&null!=virtualclass.precheck.mic.graphProcessor&&virtualclass.precheck.mic.graphProcessor.disconnect(virtualclass.precheck.mic.graphContext.destination),
"Firefox"!=virtualclass.system.mybrowser.name&&"iOS"!=virtualclass.system.mybrowser.name&&"Safari"!=virtualclass.system.mybrowser.name||null==virtualclass.precheck.mic.graphContext||virtualclass.precheck.mic.graphContext.close(),delete virtualclass.media.audioVisual.audioCtx)}};function CommonXHR(){this.init()}CommonXHR.prototype.init=function(){this.httpObj=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.onReadStateChange()};CommonXHR.prototype.onReadStateChange=function(){var d=this;this.httpObj.onreadystatechange=function(){4==d.httpObj.readyState&&"undefined"!=typeof d.cb&&(200==d.httpObj.status?d.cb(d.httpObj.response):d.cb("ERROR"))}};
CommonXHR.prototype.send=function(d,b,a){console.log("Common URL "+d);this.cb=b;this.httpObj.open("GET",d,!0);this.httpObj.responseType=a;this.httpObj.setRequestHeader("x-api-key",wbUser.lkey);this.httpObj.setRequestHeader("x-congrea-authuser",wbUser.auth_user);this.httpObj.setRequestHeader("x-congrea-authpass",wbUser.auth_pass);this.httpObj.setRequestHeader("x-congrea-room",wbUser.room);this.httpObj.withCredentials=!0;this.httpObj.send()};(function(d){d.modal=function(){return{show:function(b){b=document.querySelector(b);null!=b&&b.classList.add("in")},hide:function(){var b=document.querySelector(b);null!=b&&b.classList.add("fade")},removeModal:function(){var b=document.querySelector("#editPollModal");b&&b.parentNode.removeChild(b)},closeModalHandler:function(b){var a=this;(b=document.querySelector("#"+b+" .close"))&&b.addEventListener("click",function(){a.removeModal()})},hideModal:function(){var b=document.querySelector("#congdashboard");
b&&(b.className="modal fade")},showModal:function(){var b=document.querySelector("#congdashboard");b&&(b.className="modal in")},attachpopupHandler:function(b,a,c){var d=document.querySelector("#qnText"+b+a);d.insertAdjacentHTML("beforeend",c);document.querySelector("#qnText"+b+a+" .popover-content").classList.add("hide");var g=document.querySelector("#qnText"+b+a+" .popover-content");d.addEventListener("mouseover",function(){g.classList.add("show");g.classList.remove("hide")});d.addEventListener("mouseleave",
function(){g.classList.remove("show");g.classList.add("hide")})}}}()})(window);(function(d){function b(a){var b=new Promise(function(b,c){var d=function(){a.removeEventListener("success",g);a.removeEventListener("error",k)},g=function(){b(f(a.result));d()},k=function(){c(a.error);d()};a.addEventListener("success",g);a.addEventListener("error",k)});b.then(function(b){b instanceof IDBCursor&&p.set(b,a)});r.set(b,a);return b}function a(a){if(!v.has(a)){var b=new Promise(function(b,c){var d=function(){a.removeEventListener("complete",f);a.removeEventListener("error",g);a.removeEventListener("abort",
g)},f=function(){b();d()},g=function(){c(a.error);d()};a.addEventListener("complete",f);a.addEventListener("error",g);a.addEventListener("abort",g)});v.set(a,b)}}function c(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(b){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];a.apply(r.get(this),c);return f(p.get(this))}:
function(b){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];return f(a.apply(r.get(this),c))}:function(b,c){for(var d=[],g=1;g<arguments.length;++g)d[g-1]=arguments[g];d=a.call.apply(a,[].concat([r.get(this),b],$jscomp.arrayFromIterable(d)));u.set(d,b.sort?b.sort():[b]);return f(d)}}function f(d){if(d instanceof IDBRequest)return b(d);if(q.has(d))return q.get(d);if("function"===typeof d)var f=c(d);else d instanceof IDBTransaction&&a(d),f=k(d,m||(m=[IDBDatabase,IDBObjectStore,IDBIndex,
IDBCursor,IDBTransaction]))?new Proxy(d,t):d;f!==d&&(q.set(d,f),r.set(f,d));return f}function g(a,b){if(a instanceof IDBDatabase&&!(b in a)&&"string"===typeof b){if(F.get(b))return F.get(b);var c=b.replace(/FromIndex$/,""),d=b!==c,f=A.includes(c);if(c in(d?IDBIndex:IDBObjectStore).prototype&&(f||B.includes(c)))return a=function(a,b){for(var g=[],k=1;k<arguments.length;++k)g[k-1]=arguments[k];var m=this;return $jscomp.executeAsyncGenerator(function(){function b(b,r){for(;;)switch(k){case 0:q=m.transaction(a,
f?"readwrite":"readonly");p=q.store;d&&(p=p.index(g.shift()));n=p[c].apply(null,[].concat($jscomp.arrayFromIterable(g)));if(!f){k=1;break}k=2;return{value:q.done,done:!1};case 2:if(void 0===r){k=3;break}k=-1;throw r;case 3:case 1:return k=-1,{value:n,done:!0};default:return{value:void 0,done:!0}}}var k=0,n,p,q,r={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();r[Symbol.iterator]=function(){return this};
return r}())},F.set(b,a),a}}var k=function(a,b){return b.some(function(b){return a instanceof b})},m,n,p=new WeakMap,v=new WeakMap,u=new WeakMap,q=new WeakMap,r=new WeakMap,t={get:function(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return v.get(a);if("objectStoreNames"===b)return a.objectStoreNames||u.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return f(a[b])},has:function(a,b){return a instanceof IDBTransaction&&("done"===b||"store"===
b)?!0:b in a}},B=["get","getKey","getAll","getAllKeys","count"],A=["put","add","delete","clear"],F=new Map;t=function(a){return{get:function(b,c,d){return g(b,c)||a.get(b,c,d)},has:function(b,c){return!!g(b,c)||a.has(b,c)}}}(t);d.virtualclassOpenDB=function(a,b,c){c=void 0===c?{}:c;var d=c.blocked,g=c.upgrade,k=c.blocking,m=indexedDB.open(a,b);a=f(m);g&&m.addEventListener("upgradeneeded",function(a){g(f(m.result),a.oldVersion,a.newVersion,f(m.transaction))});d&&m.addEventListener("blocked",function(){return d()});
k&&a.then(function(a){return a.addEventListener("versionchange",k)});return a};d.virtualclassDeleteDB=function(a,b){var c=(void 0===b?{}:b).blocked;a=indexedDB.deleteDatabase(a);c&&a.addEventListener("blocked",function(){return c()});return f(a).then(function(){})}})(window);var screenDecodeBlob=URL.createObjectURL(new Blob(["(",function(){function d(a){myLoop=4*a.length;k=new Uint8ClampedArray(myLoop);for(var b=0;b<myLoop;b++)k[4*b+0]=36.5*(a[b]>>5),k[4*b+1]=36.5*((a[b]&28)>>2),k[4*b+2]=85*(a[b]&3),k[4*b+3]=255}function b(a,b,c,d,f){for(var k=g.width,m=0,n=b;n<d+b;n++)for(var p=a;p<c+a;p++){var q=4*(n*k+p);g.data[q]=f[m++];g.data[q+1]=f[m++];g.data[q+2]=f[m++];g.data[q+3]=f[m++]}}function a(a,b){a=c(a);b=c(b);return parseInt(a+b)}function c(a){a=a.toString();if(1==a.length)return"0"+
a;if(2==a.length)return a}function f(c){for(var f=7,n=0;n+7<=c.length;n=l+1)x=a(c[n+1],c[n+2]),y=a(c[n+3],c[n+4]),h=parseInt(c[n+5]),w=parseInt(c[n+6]),l=f+h*w-1,recmsg=c.subarray(f,l+1),d(recmsg),b(x,y,w,h,k),f=l+7+1;m&&clearTimeout(m);m=setTimeout(function(){postMessage({globalImageData:g,dtype:"drgb"})},100)}var g={},k,m;onmessage=function(a){if(a.data.hasOwnProperty("dtype"))if("drgb"==a.data.dtype){var b=a.data.encodeArr;g=new ImageData(a.data.cw,a.data.ch);a=4*b.length;for(var c=0;c<a;c++)g.data[4*
c+0]=36.5*(b[c]>>5),g.data[4*c+1]=36.5*((b[c]&28)>>2),g.data[4*c+2]=85*(b[c]&3),g.data[4*c+3]=255;postMessage({globalImageData:g,dtype:"drgb",stype:"full"})}else f(a.data.data_pack)}}.toString(),")()"],{type:"application/javascript"})),sdworker=new Worker(screenDecodeBlob);var screenWorkerBlob=URL.createObjectURL(new Blob(["(",function(){function d(a,b){a=a.toString();var c;for(c=a.length;c<b;c++)a="0"+a;return a.match(/[\S]{1,2}/g)||[]}function b(b){0===k?c=a=0:(f=k%b.data.resB,g=Math.floor(k/b.data.resB),a=f*b.data.dw,c=g*b.data.dh);return{x:a,y:c,w:b.data.dw,h:b.data.dh}}var a,c,f,g,k,m=0,n,p,v,u,q=null,r=[],t=function(a,b,c,d,f,g,k){g=new Uint8ClampedArray(c*d);for(var m=0,n=b;n<d+b;n+=1)for(var p=a;p<c+a;p+=1){var q=n*f+p;g[m++]=k[q]}return g},B=function(a,b,c){var d=
b.length,f;if(b.length!==a.length)return!1;for(f=0;f<d;f+=1){if(b[f]!==a[f])return!1;f+=c}for(f=0;f<d;--f)if(f+=c,b[f]!==a[f])return!1;for(f=0;f<d;f+=7)if(b[f]!==a[f])return!1;return!0};onmessage=function(a){if(a.data.hasOwnProperty("initPrevImg"))r=[],q=null;else if(a.data.hasOwnProperty("resize"))for(k=0;k<a.data.resA*a.data.resB;k++)v=b(a),r[k]=t(v.x,v.y,v.w,v.h,a.data.offsetWidth,a.data.offsetHeight,a.data.img);else{var c=a.data.img,f=c.length/4,g;if(null===q||q.length!==f)q=new Uint8ClampedArray(f);
for(g=0;g<f;g++){var A=c[4*g];var G=c[4*g+1];var z=c[4*g+2];A=(Math.round(A/36.5)<<5)+(Math.round(G/36.5)<<2)+Math.round(z/85);q[g]=A}for(k=0;k<a.data.resA*a.data.resB;k++)if(v=b(a),u=t(v.x,v.y,v.w,v.h,a.data.offsetWidth,a.data.offsetHeight,q),"undefined"!==typeof r[k]){if(n=B(u,r[k],v.w),!n){if(r[k].length!==u.length)r[k]=u;else for(c=0;c<u.length;c++)r[k][c]=u[c];c=u;A=v;G=a.data.type;g=d(A.x,4);f=d(A.y,4);g=new Uint8ClampedArray(["ss"===G?103:203,g[0],g[1],f[0],f[1],A.h,A.w]);f=new Uint8ClampedArray(c.length+
g.length);f.set(g);f.set(c,g.length);c=f;null===p||void 0===p?p=c:(f=new Uint8ClampedArray(p.length+c.length),f.set(p),f.set(c,p.length),p=f)}}else r[k]=u,m=1;p?postMessage({masterSlice:p,needFullScreen:m},[p.buffer]):postMessage({masterSlice:null,needFullScreen:m});m=0;p=null}}}.toString(),")()"],{type:"application/javascript"})),sworker=new Worker(screenWorkerBlob);var dtConWorkerBlob=URL.createObjectURL(new Blob(["(",function(){var d=function(){function b(a,b){a=a.replace(/[^A-Za-z0-9\+\/]/g,"");var c=a.length;b=b?Math.ceil((3*c+1>>2)/b)*b:3*c+1>>2;for(var d=new Uint8Array(b),f,n=0,p=0,v=0;v<c;v++){f=v&3;var u=a.charCodeAt(v);n|=(64<u&&91>u?u-65:96<u&&123>u?u-71:47<u&&58>u?u+4:43===u?62:47===u?63:0)<<6*(3-f);if(3===f||1===c-v){for(f=0;3>f&&p<b;f++,p++)d[p]=n>>>(16>>>f&24)&255;n=0}}return d}function a(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?
47:65}return{base64EncArrInt:function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=0>a[c]?-1*a[c]+127:a[c];return this.base64EncArr(b)},base64EncArr:function(b){for(var c=2,d="",k=b.length,m=0,n=0;n<k;n++)if(c=n%3,0<n&&0===4*n/3%76&&(d+="\r\n"),m|=b[n]<<(16>>>c&24),2===c||1===b.length-n)d+=String.fromCharCode(a(m>>>18&63),a(m>>>12&63),a(m>>>6&63),a(m&63)),m=0;return d.substr(0,d.length-2+c)+(2===c?"":1===c?"=":"==")},base64DecToArrInt:function(a){a=b(a);for(var c=new Int8Array(a.length),
d=0;d<a.length;d++)c[d]=128<=a[d]?-1*(a[d]-127):a[d];return c},base64DecToArrclm:function(a){a=b(a);return new Uint8ClampedArray(a.buffer)}}}();onmessage=function(b){var a;b.data.hasOwnProperty("dt")&&("a"==b.data.dt?a=d.base64EncArrInt(b.data.msg):"c"==b.data.dt&&(a=d.base64EncArr(b.data.msg)),postMessage({dt:b.data.dt,msg:a}))}}.toString(),")()"],{type:"application/javascript"}));sworker=new Worker(screenWorkerBlob);var webpToPngBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://live.congrea.net/virtualclass/external/build/src/video-libwebp-0.1.3.min.js");onmessage=function(d){if(d.data.hasOwnProperty("vdata")){var b=d.data.vdata;d=d.data.canid;var a=new WebPDecoder;b=convertBinaryToArray(b);var c=a.WebPDecoderConfig,f=c.output;var g=c.input;if(a.WebPInitDecoderConfig(c)){c.options.no_fancy_upsampling=0;c.options.bypass_filtering=0;c.options.use_cropping=0;c.options.crop_left=0;c.options.crop_top=
0;c.options.crop_width=0;c.options.crop_height=0;var k=a.VP8StatusCode;if(0<b.length&&(g=a.WebPGetFeatures(b,b.length,g),g!=k.VP8_STATUS_OK&&alert("error"),f.colorspace=a.WEBP_CSP_MODE.MODE_RGBA,0<b.length))if(g=parseInt(a.WebPDecode(b,b.length,c),10),g!=k.VP8_STATUS_OK)alert("Decoding of %s failed.\n");else if(b=f.u.RGBA.rgba)a=f.height,f=f.width,b.pop(),postMessage({vdata:new Uint8ClampedArray(b),bh:a,bw:f,canid:d})}else alert("Library version mismatch!\n")}}}.toString(),")()"],{type:"application/javascript"})),
webpToPng=new Worker(webpToPngBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file receives the audio from workerio and
 decode the audio and send this to reciever audio worklert(worklet-audio-rec.js)
*/
var workerAudioRecBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://live.congrea.net/virtualclass/build/src/audio-g711-and-resampler.min.js");var d={workletAudioRec:null,workerIO:null,samples:null,allAudioArr:{},audioToBePlay:{},gAudio:{},adSign:{},resamplerdecode:{},mergeAllAudioSend:[],allAudioSend:[],supportAudioWorklet:!1,sampleRate:null,extractData:function(b){b=new Int8Array(b);return[this.numValidateFour(b[1],b[2],b[3],b[4]),b.subarray(5,b.length)]},numValidateFour:function(b,
a,c,d){b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);c=this.preNumValidateTwo(c);d=this.preNumValidateTwo(d);return parseInt(b+a+c+d)},numValidateTwo:function(b,a){b=this.preNumValidateTwo(b);a=this.preNumValidateTwo(a);return parseInt(b+a)},preNumValidateTwo:function(b){b=b.toString();if(1==b.length)return"0"+b;if(2==b.length)return b},resample:function(b,a){this.audioToBePlay.hasOwnProperty(a)||(this.audioToBePlay[a]=[]);this.samples=G711.decode(b,{floating_point:!0,Eight:!0});"object"!=
typeof this.resamplerdecode[a]&&(this.resamplerdecode[a]=new Resampler(8E3,this.sampleRate,1,32768));return this.samples=this.resamplerdecode[a].resampler(this.samples)},onMessage:function(b){if(b.data.hasOwnProperty("cmd"))switch(b.data.cmd){case "workerIO":this.workerIO=b.ports[0];this.sampleRate=b.data.sampleRate;this.workerIO.onmessage=this.fromworkerIO.bind(this);break;case "workletAudioRec":this.workletAudioRec=b.ports[0],this.workletAudioRec.onmessage=this.fromworkletAudioRec.bind(this);case "audioWorklet":this.supportAudioWorklet=
b.data.msg;default:console.log("do nothing")}},fromworkletAudioRec:function(){console.log("from audio worklet")},fromworkerIO:function(b){if(b.data.hasOwnProperty("msg")){var a=this.extractData(b.data.msg);b=a[0];this.adSign.hasOwnProperty(b)||(this.adSign[b]={},this.adSign[b].ad=!0,this.workerIO.postMessage({cmd:"firstAudio",msg:{userId:b},dest:"mainthread"}));a=this.resample(a[1],b);this.supportAudioWorklet?this.workletAudioRec.postMessage({cmd:"audio",msg:{data:a,uid:b}}):postMessage({cmd:"noAudioWorklet",
msg:{data:a,uid:b}})}}};onmessage=function(b){d.onMessage(b)}}.toString(),")()"],{type:"application/javascript"})),workerAudioRec=new Worker(workerAudioRecBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file recevied the audio from audio worker send (worker-audio-send),
 encode the audio and send it to io worker(worker-io.js)
*/
var workerAudioSendBlob=URL.createObjectURL(new Blob(["(",function(){importScripts("https://live.congrea.net/virtualclass/build/src/audio-g711-and-resampler.min.js");var d={audioWorkletSend:null,workerIO:null,gObjUid:null,audMouseDown:!1,precheck:!1,repMode:!1,minthreshold:65535,audioWasSent:0,preAvg:0,curAvg:0,maxthreshold:0,convertFloat32ToInt16:function(b){for(var a=b.length,c=new Int16Array(a);a--;)c[a]=32767*Math.min(1,b[a]);return c},encodeAudio:function(b){return G711.encode(b,{alaw:!0})},
breakintobytes:function(b,a){b=b.toString();for(var c=b.length;c<a;c++)b="0"+b;return b.match(/[\S]{1,2}/g)||[]},sendBinary:function(b){null!=this.workerIO&&this.workerIO.postMessage({cmd:"sendBinary",msg:b})},audioSend:function(b,a){if(this.audMouseDown&&!this.precheck){var c=this.breakintobytes(this.gObjUid,8);c=new Int8Array([101,c[0],c[1],c[2],c[3]]);var d=new Int8Array(b.length+c.length);d.set(c);d.set(b,c.length);this.sendBinary(d);postMessage({cmd:"adStatus",msg:a})}else postMessage({cmd:"adStatus",
msg:"stop"})},silenceDetection:function(b,a){var c=sum=rate=0;for(i=0;i<a.length;i++){var d=Math.abs(a[i]);c<d&&(c=d);sum+=d}this.curAvg=sum/a.length;rate=Math.abs(this.curAvg^2-this.preAvg^2);this.preAvg=this.curAvg;5>rate&&(this.minthreshold=c);this.minthreshold>c&&(this.minthreshold=c);this.maxthreshold<c&&(this.maxthreshold=c);20*this.minthreshold<this.maxthreshold&&(this.minthreshold*=5);this.maxthreshold/20>this.minthreshold&&(this.maxthreshold/=5);10<g&&(this.maxthreshold*=.8);var g=this.maxthreshold/
this.minthreshold;a=c/this.minthreshold;0!==c&&postMessage({cmd:"unMuteAudio"});isFinite(g)&&20<=g||2<a||rate>this.minthreshold||25<rate||c>2*this.minthreshold||4>=g?(this.audioSend(b,"sending"),this.audioWasSent=6):0<this.audioWasSent?(this.audioSend(b,"sending"),this.audioWasSent--):2>g?this.audioSend(b,"sending"):(postMessage({cmd:"adStatus",msg:"notSending"}),postMessage({cmd:"ioAdapterSend",msg:{cf:"na"}}),0===c&&postMessage({cmd:"muteAudio"}));return b},recorderProcess:function(b){if(!this.repMode&&
this.audMouseDown&&!this.precheck){b=this.resampler.resampler(b);b=this.convertFloat32ToInt16(b);var a=this.encodeAudio(b);this.silenceDetection(a,b)}},onMessage:function(b){switch(b.data.cmd){case "workerIO":this.workerIO=b.ports[0];this.resampler=new Resampler(b.data.sampleRate,8E3,1,4096);this.workerIO.onmessage=function(a){console.log("From io lib")};this.gObjUid=b.data.uid;break;case "audioWorkletSend":this.audioWorkletSend=b.ports[0];this.repMode=b.data.msg.repMode;this.audioWorkletSend.onmessage=
this.formAudioWorkletSend.bind(this);break;case "audioMouseDown":this.audMouseDown=b.data.msg.adMouseDown;break;case "precheck":this.precheck=b.data.msg.precheck;break;case "rawAudio":this.recorderProcess(b.data.msg);break;default:console.log("Do nothing")}},formAudioWorkletSend:function(b){b.data.hasOwnProperty("cmd")&&"rawAudio"==b.data.cmd&&this.recorderProcess(b.data.msg)}};onmessage=function(b){d.onMessage(b)}}.toString(),")()"],{type:"application/javascript"})),workerAudioSend=new Worker(workerAudioSendBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file sends/receives packet to/from  Server through websocket
*/
var workerIOBlob=URL.createObjectURL(new Blob(["(",function(){var d={workerAudioRec:!1,workerAudioSend:!1,binMsgQueue:[],recBinMsgQueue:[],init:function(b){this.cfg=b;this.wsconnect()},userauthenticate:function(){var b="F-AH-"+JSON.stringify({authuser:this.cfg.authuser,authpass:this.cfg.authpass});this.finallySend(b)},addclient:function(){var b="F-JR-"+JSON.stringify({client:this.cfg.userid,roomname:this.cfg.room,user:this.cfg.userobj});this.finallySend(b)},wsconnect:function(){console.log("member_added init for socket connect");
d.wsuri=this.cfg.rid;"undefined"!=typeof WebSocket?(console.log("rid "+d.wsuri),this.sock=new WebSocket(d.wsuri)):(console.log("Browser does not support WebSocket!"),this.error=lang.wserror);var b=this;this.sock.onopen=function(){this.readyToSend=!1;console.log("member_added Connected to "+b.cfg.rid);b.userauthenticate();b.addclient();postMessage({cmd:"connectionopen",msg:{type:"connectionopen"}})};this.sock.binaryType="arraybuffer";this.sock.onmessage=function(a){if(a.data instanceof ArrayBuffer)d.onRecBinary(a);
else postMessage({cmd:"receivedJson",msg:a.data})};this.sock.onerror=function(a){b.error=a;console.log("Error:"+a);postMessage({cmd:"error",msg:a.reason})};this.sock.onclose=function(a){console.log("Connection Closed");postMessage({cmd:"close",msg:a.reason})}},disconnect:function(){this.sock.onclose=function(){};this.sock.close();console.log("i am closing this connection");postMessage({cmd:"iamclosing"})},onRecBinary:function(b){if(b.data instanceof ArrayBuffer)if(b=new Uint8Array(b.data),0==b[1]){var a=
101==b[2]?new Int8Array(b):new Uint8ClampedArray(b);postMessage({cmd:"stBinary",msg:a});b=b.subarray(2);var c=101==b[0]?new Int8Array(b):new Uint8ClampedArray(b);101==b[0]?this.workerAudioRec?this.workerAudioRec.postMessage({cmd:"ad",msg:b},[b.buffer]):(postMessage({cmd:"initAudioWorklet"}),console.log("workerAudioRec is not defined")):postMessage({cmd:"notaudio",msg:c.buffer})}else if(1==b[1])this.recBinMsgQueue=[],this.recBinMsgQueue[0]=b.subarray(2);else if(2==b[1])0<this.recBinMsgQueue.length&&
this.recBinMsgQueue.push(b.subarray(2));else if(3==b[1]&&0<this.recBinMsgQueue.length){this.recBinMsgQueue.push(b.subarray(2));for(a=c=0;a<this.recBinMsgQueue.length;a++)c+=this.recBinMsgQueue[a].length;c=101==b[0]?new Int8Array(c):new Uint8ClampedArray(c);for(b=a=0;a<this.recBinMsgQueue.length;a++)c.set(this.recBinMsgQueue[a],b),b+=this.recBinMsgQueue[a].length;postMessage({cmd:"endBinary",msg:c})}},webSocketConnected:function(){return 1==this.sock.readyState&&this.readyToSend},finallySend:function(b){this.sock.send(b)},
sendBinary:function(b){var a;if(this.webSocketConnected()&&b.length)if(6E5>=b.length)b.constructor===Int8Array?a=new Int8Array(b.length+2):b.constructor===Uint8ClampedArray&&(a=new Uint8ClampedArray(b.length+2)),a.set([b[0],0]),a.set(b,2),this.finallySend(a.buffer),postMessage({cmd:"stBinary",msg:a});else{this.binMsgQueue=[];for(var c=a=0;a<b.length;c++){var d=b.slice(a,a+55E4);b.constructor===Int8Array?this.binMsgQueue[c]=new Int8Array(d.length+2):b.constructor===Uint8ClampedArray&&(this.binMsgQueue[c]=
new Uint8ClampedArray(d.length+2));this.binMsgQueue[c].set([b[0],2]);this.binMsgQueue[c].set(d,2);d.length&&(a+=d.length)}this.binMsgQueue[0][1]=1;this.binMsgQueue[this.binMsgQueue.length-1][1]=3;for(b=0;b<this.binMsgQueue.length;b++)this.finallySend(this.binMsgQueue[b].buffer),postMessage({cmd:"stBinary",msg:this.binMsgQueue[b]});this.binMsgQueue=[]}},onMessage:function(b){switch(b.data.cmd){case "init":this.init(b.data.msg);break;case "wsconnect":this.wsconnect();break;case "disconnect":this.disconnect();
break;case "sessionEndClose":this.sock&&this.sock.close();break;case "workerAudioRec":this.workerAudioRec=b.ports[0];this.workerAudioRec.onmessage=function(a){a.data.hasOwnProperty("dest")&&"mainthread"==a.data.dest&&postMessage(a.data)};break;case "send":this.webSocketConnected()&&"undefined"!=typeof b.data.msg&&this.finallySend(b.data.msg);break;case "sendBinary":this.sendBinary(b.data.msg);break;case "workerAudioSend":this.workerAudioSend=b.ports[0];this.workerAudioSend.onmessage=this.fromWorkerAudioSend.bind(this);
break;case "readyToSend":this.readyToSend=!0;break;case "onRecBinary":this.onRecBinary({data:b.data.msg});break;default:this.finallySend(b.data.msg)}},fromWorkerAudioSend:function(b){b.data.hasOwnProperty("cmd")&&this.sendBinary(b.data.msg)}};onmessage=function(b){d.onMessage(b)}}.toString(),")()"],{type:"application/javascript"}));workerIO=new Worker(workerIOBlob);/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file(Audio worklet) plays the received Audio from received audio worker(worker-audio-rec.js)
*/
var workletAudioRecBlob=URL.createObjectURL(new Blob(["(",function(){function d(a){a.data.hasOwnProperty("cmd")&&"workerAudioRec"===a.data.cmd&&(m=a.ports[0],m.onmessage=b)}function b(b){if(b.data.hasOwnProperty("cmd")&&"audio"===b.data.cmd){var c=b.data.msg.data;b=b.data.msg.uid;null==a[b]&&(a[b]=[]);null==g[b]&&(g[b]=[]);for(var d=0;d<c.length;d++)g[b].push(c[d]);for(;128<=g[b].length;)c=g[b].splice(0,128),a[b].push(new Float32Array(c))}}var a={},c={},f=0,g={},k,m,n=[],p=0,v=function(){var a=AudioWorkletProcessor.call(this)||
this;a.port.onmessage=d;return a};$jscomp.inherits(v,AudioWorkletProcessor);v.prototype.process=function(b,d){p=n.length=0;for(k in a){b:{b=k;if(null!==a){if(288<=a[b].length){for(;96<=a[b].length;)a[b].shift();c[b]=!0;b=a[b].shift();break b}if(64<=a[b].length){c[b]=!0;b=a[b].shift();break b}if(0<a[b].length&&!0===c[b]){c[b]=!0;b=a[b].shift();break b}c[b]=!1;0===a[b].length&&delete a[b]}b=void 0}if(null!=b)if(p++,1===p)for(var g=0;128>g;g++)n[g]=b[g];else for(g=0;128>g;g++)n[g]+=b[g]}if(1===p)b=n;
else if(1<p){for(b=0;128>b;b++)n[b]/=p;b=n}else b=void 0;if(null!=b)d[0][0].set(b,0),f=b[127];else if(null!==f)for(b=0;128>b;b++)d[0][0][b]=f;return!0};registerProcessor("worklet-audio-rec",v)}.toString(),")()"],{type:"application/javascript"}));/*
  2018 Suman Bogati  {@link http://vidyamantra.com}
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 This file gets audio continuously from getUserMedia, and
 send it to send audio worker (worker-audio-send.js)
*/
var workletAudioSendBlob=URL.createObjectURL(new Blob(["(",function(){var d=function(){var b=AudioWorkletProcessor.call(this)||this;b.audios=new Float32Array(4096);b.position=0;b.port.onmessage=function(a){a.data.hasOwnProperty("cmd")&&"workerAudioSend"==a.data.cmd&&(b.workerAudioSend=a.ports[0],b.workerAudioSend.onmessage=b.fromworkerAudioSend)};return b};$jscomp.inherits(d,AudioWorkletProcessor);d.prototype.fromworkerAudioSend=function(){console.log("This is from audio sender")};d.prototype.process=
function(b,a){console.log("Audio is generating");b=b[0][0];this.audios.set(b,this.position);this.position+=b.length;4096<=this.position&&(this.hasOwnProperty("workerAudioSend")&&this.workerAudioSend.postMessage({cmd:"rawAudio",msg:this.audios}),this.audios=new Float32Array(4096),this.position=0);return!0};registerProcessor("worklet-audio-send",d)}.toString(),")()"],{type:"application/javascript"}));$.uiBackCompat=!1;
$(document).ready(function(){window.onload=function(){return $jscomp.executeAsyncGenerator(function(){function d(d,n){for(var p,q;;)switch(b){case 0:console.log("Whiteboard init very start");window.earlierWidth=window.innerWidth;window.earlierHeight=window.innerHeight;window.wbUser=wbUser;window.pageEnter=(new Date).getTime();m=new window.virtualclass;m.virtualclassIDBOpen=window.virtualclassOpenDB;window.virtualclass=m;m.gObj.displayError=1;m.lang={};m.lang.getString=window.getString;m.lang.message=
window.message;m.createMainContainer();m.gObj.sessionClear=!1;m.settings=window.settings;m.settings.init();m.handleCurrentUserWithPrevious();m.ioEventApi=ioEventApi;m.gObj.mobileVchOffset=vhCheck();k=localStorage.getItem("wIds");null!=k&&(k=JSON.parse(k),m.gObj.wids=k,m.gObj.wbCount=k.length-1);g=localStorage.getItem("anyp");null==g?localStorage.setItem("anyp",wbUser.anyonepresenter):g!=wbUser.anyonepresenter&&(localStorage.removeItem("uRole"),localStorage.setItem("anyp",wbUser.anyonepresenter));
wbUser.virtualclassPlay=parseInt(wbUser.virtualclassPlay,10);wbUser.virtualclassPlay&&(m.gObj.sessionClear=!0,m.gObj.role="s",localStorage.removeItem("teacherId"),wbUser.id=99955551230,m.gObj.uid=wbUser.id);f=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};c=JSON.parse(localStorage.getItem("prevApp"));m.gObj.prevApp=c;null!=c?(m.previousApp=c,q=f(c.name),"Yts"==c.name||"DocumentShare"==c.name?null==c.metaData?p=null:(p=c.metaData,p.fromReload=!0):"Video"==c.name?null==c.metaData||null==c.metaData.init?
p=null:(p=c.metaData,p.fromReload=!0):"Whiteboard"==c.name&&(null==k&&(m.gObj.wbCount=c.wbn),d=localStorage.getItem("currSlide"),null!=d&&(m.gObj.currSlide=d))):q=m.gObj.defaultApp;"undefined"==typeof p&&(p=null);m.popup=new PopUp({showOverlay:!0});m.precheck=localStorage.getItem("precheck");d=localStorage.getItem("precheck");null!=d&&(m.isPrecheck=JSON.parse(d));wbUser.virtualclassPlay?(m.isPrecheck=!1,m.enablePreCheck=!1):(m.precheck=localStorage.getItem("precheck"),m.enablePreCheck=!0,d=localStorage.getItem("precheck"),
null!=d&&(m.isPrecheck=JSON.parse(d)));!m.enablePreCheck||null!=m.isPrecheck&&m.isPrecheck?(m.makePreCheckAvailable=!1,m.popup.waitMsg("refresh")):m.makePreCheckAvailable=!0;null!=localStorage.getItem("beTeacher")?(m.gObj.doEndSession=!0,m.gObj.beTeacher=!0,wbUser.role="t",m.gObj.uRole="t",localStorage.setItem("uRole","t"),localStorage.removeItem("beTeacher"),console.log("From locastorage:- beteacher found")):console.log("From locastorage:- beteacher not found");m.gObj.fromPageRefresh=!0;if(m.isPlayMode||
"thisismyplaymode"!==localStorage.getItem("mySession")){b=1;break}console.log("DELETE PlayMode Data");localStorage.clear();b=3;return{value:m.init(wbUser.role,q,p),done:!1};case 3:if(void 0===n){b=4;break}b=-1;throw n;case 4:m.storage.config.endSession();b=2;break;case 1:return b=5,{value:m.init(wbUser.role,q,p),done:!1};case 5:if(void 0===n){b=6;break}b=-1;throw n;case 6:case 2:"Edge"==m.system.mybrowser.name&&(d=document.getElementById("virtualclassCont"),null!=d&&d.classList.add("edge"));wbUser.virtualclassPlay||
(m.editorRich.veryInit(),m.editorCode.veryInit());m.vutil.isMiniFileIncluded("wb.min")&&(m.gObj.displayError=0);if(!(2<window.virtualclass.error.length)){b=7;break}window.virtualclass.error=[];b=-1;return{value:void 0,done:!0};case 7:m.vutil.initDefaultInfo(wbUser.role,q),roles.isStudent()&&(n=localStorage.getItem("audEnable"),null!==n&&"false"===n.ac&&(m.user.control.mediaWidgetDisable(),m.gObj.audioEnable=!1)),setTimeout(function(){window.postMessage({type:"isInstalled",id:1},"*")},500),m.vutil.attachClickOutSideCanvas(),
a=function(){m.gObj.readyToCommunicate||setTimeout(function(){a()},700)},m.vutil.isPlayMode()&&setTimeout(function(){localStorage.removeItem("editorRich");localStorage.removeItem("editorCode");m.notPLayed=!0;m.storage.config.endSession();m.chat.chatroombox=!1;var b=document.getElementById("chatrm");null!==b&&b.parentNode.removeChild(b);b=document.getElementById("canvas");null!==b&&(b.style.pointerEvents="none");a()},500),null!=m.isPrecheck&&("undefined"==typeof m.videoHost.gObj.MYSPEED&&(m.videoHost.gObj.MYSPEED=
1),m.videoHost.afterSessionJoin()),m.gObj.memberlistpending=[],m.gObj.veryFirstJoin=!0,m.gObj.testChatDiv=document.querySelector("#chat_div"),m.gObj.testChatDiv.attachShadow({mode:"open"}),b=-1;default:return{value:void 0,done:!0}}}var b=0,a,c,f,g,k,m,n={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n}())}});
//# sourceMappingURL=https://live.congrea.net/virtualclass/build/src/wb-map
